{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"index.html","title":"Wulfram 2 Server Implementation Guide","text":"<p>Welcome to the comprehensive documentation for implementing a Wulfram 2 game server.</p>"},{"location":"index.html#about-this-documentation","title":"About This Documentation","text":"<p>This guide walks you through implementing a Wulfram 2 server that successfully transitions clients from Login \u2192 Team Select \u2192 Game State. Each section builds on the previous one, with complete pseudo-examples you can use as templates.</p> <p>Important: This documentation was reconstructed through reverse engineering, as no original server source code or protocol specifications exist.</p>"},{"location":"index.html#documentation-structure","title":"Documentation Structure","text":""},{"location":"index.html#core-protocol-flow","title":"Core Protocol Flow","text":"<ol> <li>Part 1.0 - Introduction - Protocol fundamentals, byte order, packet structure</li> <li>Part 2.0 - HELLO Handshake - Initial connection handshake</li> <li>Part 3.0 - Login Authentication - User authentication flow</li> <li>Part 4.x - BEHAVIOR Packet - Game configuration data (largest packet)</li> <li>Part 5.0 - TEAM INFO - Team selection data</li> <li>Part 6.0 - REINCARNATE - Spawning into the game</li> <li>Part 7.0 - UPDATE ARRAY - Real-time game state updates</li> <li>Part 8.0 - Structures - Packet structure definitions</li> <li>Part 9.0 - UDP Protocol - UDP packet types and real-time data</li> <li>Part 11.0 - TCP Protocol - TCP packet types</li> </ol>"},{"location":"index.html#reference-materials","title":"Reference Materials","text":"<ul> <li>Part 10.0 - Data Files - Reference data tables</li> </ul>"},{"location":"index.html#quick-start","title":"Quick Start","text":"<p>Start with Part 1: Introduction to understand the fundamental protocol rules, then proceed sequentially through the parts.</p>"},{"location":"index.html#conventions","title":"Conventions","text":"<ul> <li>Values marked with <code>?</code> are unknown/undocumented and need verification</li> <li>Values marked as \"Derived\" were calculated or inferred from game behavior</li> <li>Values marked as \"Estimated\" are educated guesses based on similar entities</li> </ul>"},{"location":"part-0-game-state/index.html","title":"Game State","text":"<p>This section covers the packets used during active gameplay.</p>"},{"location":"part-0-game-state/index.html#contents","title":"Contents","text":"<ul> <li>Part 5.0 - TEAM INFO - Team selection and configuration (0x25)</li> <li>Part 6.0 - REINCARNATE - Spawning into the game (0x30)</li> <li>Part 7.0 - UPDATE ARRAY - Real-time game state updates (0x33)</li> </ul>"},{"location":"part-0-game-state/index.html#game-entry-flow","title":"Game Entry Flow","text":"<pre><code>After BEHAVIOR packet:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Client receives TEAM_INFO                                  \u2502\n\u2502       \u2193                                                     \u2502\n\u2502  Player selects team                                        \u2502\n\u2502       \u2193                                                     \u2502\n\u2502  Client sends REINCARNATE                                   \u2502\n\u2502       \u2193                                                     \u2502\n\u2502  Server sends WORLD_STATS, PLAYER                           \u2502\n\u2502       \u2193                                                     \u2502\n\u2502  Game begins - UPDATE_ARRAY packets flow                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-0-getting-started/index.html","title":"Getting Started","text":"<p>This section covers the initial connection flow for the Wulfram 2 protocol.</p>"},{"location":"part-0-getting-started/index.html#contents","title":"Contents","text":"<ul> <li>Part 1.0 - Introduction - Protocol fundamentals, byte order, packet structure</li> <li>Part 2.0 - HELLO Handshake - Initial server handshake (0x13)</li> <li>Part 3.0 - Login Authentication - User authentication flow (0x11/0x12)</li> </ul>"},{"location":"part-0-getting-started/index.html#connection-flow-overview","title":"Connection Flow Overview","text":"<pre><code>Client                              Server\n  \u2502                                   \u2502\n  \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 TCP CONNECT \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n  \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 HELLO (0x13) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n  \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 LOGIN (0x11) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n  \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 LOGIN_STATUS (0x12) \u2500\u2500\u2500\u2500\u2500\u2502\n  \u2502                                   \u2502\n  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Ready for BEHAVIOR \u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Continue to the Introduction to learn the protocol fundamentals.</p>"},{"location":"part-1-introduction/index.html","title":"Wulfram 2 Server Implementation Guide","text":""},{"location":"part-1-introduction/index.html#part-1-introduction-protocol-fundamentals","title":"Part 1: Introduction &amp; Protocol Fundamentals","text":""},{"location":"part-1-introduction/index.html#welcome","title":"Welcome","text":"<p>This guide will walk you through implementing a Wulfram 2 server that successfully transitions clients from Login \u2192 Team Select \u2192 Game State. Each section builds on the previous one, with complete pseudo-examples you can use as templates.</p> <p>By the end of this guide, you'll understand: - How the Wulfram 2 protocol works at the byte level - What each packet does and why it's needed - How to construct valid packets with real example values - How to debug common issues</p>"},{"location":"part-1-introduction/index.html#data-sources-accuracy","title":"Data Sources &amp; Accuracy","text":"<p>Important: This documentation was reconstructed through reverse engineering, as no original server source code or protocol specifications exist.</p> Source Description Reliability Decompiled Client Binary Function analysis, memory layouts, packet parsing High - direct evidence Team Tactical Fan Site Game stats, build times, HP values (archived) Medium - player-tested Official Game Documentation Vehicle descriptions, basic mechanics Medium - may be outdated Packet Captures Wire format verification High - when available <p>Conventions used in this guide: - Values marked with <code>?</code> are unknown/undocumented and need verification - Values marked as \"Derived\" were calculated or inferred from game behavior - Values marked as \"Estimated\" are educated guesses based on similar entities</p> <p>When implementing your server, start with the documented values and adjust based on testing.</p>"},{"location":"part-1-introduction/index.html#the-big-picture-connection-flow","title":"The Big Picture: Connection Flow","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        WULFRAM 2 CONNECTION FLOW                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                             \u2502\n\u2502  PHASE 1: HANDSHAKE                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                       \u2502\n\u2502  \u2502 CLIENT  \u2502\u25c4\u2500\u2500\u2500\u2500 TCP CONNECT \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502 SERVER  \u2502                       \u2502\n\u2502  \u2502         \u2502\u25c4\u2500\u2500\u2500\u2500 HELLO (version) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502         \u2502                       \u2502\n\u2502  \u2502         \u2502\u25c4\u2500\u2500\u2500\u2500 HELLO (UDP info) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502         \u2502                       \u2502\n\u2502  \u2502         \u2502\u25c4\u2500\u2500\u2500\u2500 HELLO (server name) \u2500\u2500\u2500\u2500\u2502         \u2502                       \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                       \u2502\n\u2502                                                                             \u2502\n\u2502  PHASE 2: AUTHENTICATION                                                    \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                       \u2502\n\u2502  \u2502 CLIENT  \u2502\u2500\u2500\u2500\u2500\u2500 LOGIN \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502 SERVER  \u2502                       \u2502\n\u2502  \u2502         \u2502\u25c4\u2500\u2500\u2500\u2500 LOGIN_STATUS \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502         \u2502                       \u2502\n\u2502  \u2502         \u2502\u25c4\u2500\u2500\u2500\u2500 BEHAVIOR \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502         \u2502  \u2190 BIG packet!        \u2502\n\u2502  \u2502         \u2502\u25c4\u2500\u2500\u2500\u2500 TEAM_INFO \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502         \u2502                       \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                       \u2502\n\u2502       \u2551                                                                     \u2502\n\u2502       \u2551 Client now shows TEAM SELECTION screen                              \u2502\n\u2502       \u25bc                                                                     \u2502\n\u2502  PHASE 3: GAME ENTRY                                                        \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                       \u2502\n\u2502  \u2502 CLIENT  \u2502\u2500\u2500\u2500\u2500\u2500 REINCARNATE \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502 SERVER  \u2502  (team choice)        \u2502\n\u2502  \u2502         \u2502\u25c4\u2500\u2500\u2500\u2500 WORLD_STATS \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502         \u2502                       \u2502\n\u2502  \u2502         \u2502\u25c4\u2500\u2500\u2500\u2500 PLAYER \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502         \u2502  \u2190 CRITICAL!          \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                       \u2502\n\u2502       \u2551                                                                     \u2502\n\u2502       \u2551 Client is now IN GAME                                               \u2502\n\u2502       \u25bc                                                                     \u2502\n\u2502  \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550   \u2502\n\u2502                         GAMEPLAY STATE                                      \u2502\n\u2502  \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550   \u2502\n\u2502                                                                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-1-introduction/index.html#packet-type-quick-reference","title":"Packet Type Quick Reference","text":"<p>The following packet types are used in the connection flow:</p> Type Code Name Direction Size Part <code>0x13</code> HELLO Server \u2192 Client Variable (3 sub-packets) Part 2 <code>0x11</code> LOGIN Client \u2192 Server Variable Part 3 <code>0x12</code> LOGIN_STATUS Server \u2192 Client ~4 bytes Part 3 <code>0x24</code> BEHAVIOR Server \u2192 Client ~3,118+ bytes Part 4 <code>0x25</code> TEAM_INFO Server \u2192 Client Variable Part 5 <code>0x30</code> REINCARNATE Client \u2192 Server ~5 bytes Part 6 <code>0x31</code> WORLD_STATS Server \u2192 Client Variable Part 7 <code>0x32</code> PLAYER Server \u2192 Client Variable Part 7 <code>0x33</code> UPDATE_ARRAY Server \u2192 Client Variable Part 7 <p>Note: The BEHAVIOR packet is by far the largest packet in the handshake sequence, containing all game configuration data including entity stats, weapon data, vehicle physics, and more.</p>"},{"location":"part-1-introduction/index.html#key-protocol-constants","title":"Key Protocol Constants","text":"<p>These fixed quantities appear throughout the protocol and must be exact:</p> Constant Value Context Entity Types 39 Indices 0-38, always sent in BEHAVIOR Playable Vehicles 2 Tank (0) and Scout (1) Vehicle Models 3 Tank, Medic/Scout, Bomber (physics data) Weapon Slots per Vehicle 13 Fixed array size Physics Tables 4 Sent in BEHAVIOR packet Entities with Weapon Data 4 Tank, Scout, Assault Platform, Bomber <pre><code>BEHAVIOR Packet Size Breakdown:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Section 1: Fixed Header                              95 bytes         \u2502\n\u2502  Section 2: Entity Weapon Data (4 \u00d7 13 \u00d7 45)       2,340 bytes         \u2502\n\u2502  Section 3: Entity Core Stats (39 \u00d7 12)              468 bytes         \u2502\n\u2502  Section 4: Vehicle Type Data (2 \u00d7 36)                72 bytes         \u2502\n\u2502  Section 5: Physics Tables + Vehicle Models          140+ bytes        \u2502\n\u2502  Finalization: Byte alignment padding                0-7 bits          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  MINIMUM TOTAL:                                   ~3,118 bytes         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-1-introduction/index.html#fundamental-rule-1-big-endian-byte-order","title":"Fundamental Rule #1: Big-Endian Byte Order","text":"<p>This is the most common source of bugs. Wulfram 2 uses BIG-ENDIAN byte order for all multi-byte values.</p>"},{"location":"part-1-introduction/index.html#what-does-big-endian-mean","title":"What does Big-Endian mean?","text":"<p>Big-Endian means the Most Significant Byte (MSB) comes first.</p> <pre><code>Example: The number 0x4E89 (decimal 20105)\n\nBIG-ENDIAN (Wulfram 2 uses this):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   0x4E   \u2502   0x89   \u2502   \u2192 Wire bytes: 4E 89\n\u2502  (high)  \u2502  (low)   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n   Byte 0     Byte 1\n\nLITTLE-ENDIAN (x86 native - DON'T USE):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   0x89   \u2502   0x4E   \u2502   \u2192 Wire bytes: 89 4E  \u2190 WRONG!\n\u2502  (low)   \u2502  (high)  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n   Byte 0     Byte 1\n</code></pre>"},{"location":"part-1-introduction/index.html#how-the-client-reads-big-endian-data","title":"How the Client Reads Big-Endian Data","text":"<p>The client's read function shifts existing bits left and adds new bytes as the LSB:</p> <pre><code>// From decompiled FUN_00508e70\nuVar1 = uVar1 &lt;&lt; 8 | (uint)*pbVar4;  // MSB arrives first\n</code></pre> <p>And writes by extracting the MSB first:</p> <pre><code>// From decompiled FUN_00508df0\n*pbVar5 = (byte)(uVar6 &gt;&gt; 0x18);  // Write MSB (shift right 24 bits)\nuVar6 = uVar6 &lt;&lt; 8;               // Shift to get next byte\n</code></pre>"},{"location":"part-1-introduction/index.html#quick-reference-big-endian-encoding","title":"Quick Reference: Big-Endian Encoding","text":"Value Type Big-Endian Bytes 5 uint16 <code>00 05</code> 2627 (0x0A43) uint16 <code>0A 43</code> 20105 (0x4E89) uint32 <code>00 00 4E 89</code> 1 uint32 <code>00 00 00 01</code> 100 uint32 <code>00 00 00 64</code>"},{"location":"part-1-introduction/index.html#python-encoding","title":"Python Encoding","text":"<pre><code>import struct\n\n# BIG-ENDIAN encoding (correct for Wulfram 2)\nstruct.pack('&gt;H', 2627)      # Returns: b'\\x0a\\x43'  (2 bytes)\nstruct.pack('&gt;I', 20105)     # Returns: b'\\x00\\x00\\x4e\\x89'  (4 bytes)\nstruct.pack('&gt;i', 1)         # Returns: b'\\x00\\x00\\x00\\x01'  (4 bytes signed)\n\n# The '&gt;' character means BIG-ENDIAN\n# 'H' = unsigned 16-bit (2 bytes)\n# 'I' = unsigned 32-bit (4 bytes)\n# 'i' = signed 32-bit (4 bytes)\n</code></pre>"},{"location":"part-1-introduction/index.html#fundamental-rule-2-packet-frame-structure","title":"Fundamental Rule #2: Packet Frame Structure","text":"<p>Every Wulfram 2 TCP packet has this structure:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    TYPE      \u2502     LENGTH       \u2502           PAYLOAD               \u2502\n\u2502   (1 byte)   \u2502  (2 bytes BE)    \u2502      (LENGTH bytes)             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502   0x13       \u2502     00 05        \u2502   00 00 00 4E 89                \u2502\n\u2502   (HELLO)    \u2502     (5)          \u2502   (sub_type + version)          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2191               \u2191                      \u2191\n     \u2502               \u2502                      \u2502\n   Packet        Payload size          Actual data\n    type         (NOT including       (this is what\n                 type byte)           LENGTH counts)\n</code></pre> <p>Important: The LENGTH field counts only the payload bytes, NOT the type byte!</p> <p>Implementation Note: The client's TCP receive handler operates as a  state machine that reads the length field first, then processes the type  and payload. Your server should send complete packets in the documented  order: <code>[TYPE:1][LENGTH:2][PAYLOAD:N]</code></p>"},{"location":"part-1-introduction/index.html#example-hello-version-packet","title":"Example: HELLO Version Packet","text":"<pre><code>Complete packet: 13 00 05 00 00 00 4E 89\n                 \u2500\u2500 \u2500\u2500\u2500\u2500\u2500 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n                 \u2502    \u2502         \u2502\n                 \u2502    \u2502         \u2514\u2500 Payload: 5 bytes (sub_type + version)\n                 \u2502    \u2514\u2500 Length: 5 (0x0005 big-endian)\n                 \u2514\u2500 Type: 0x13 (HELLO)\n\nPayload breakdown:\n                 00 00 00 4E 89\n                 \u2500\u2500 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n                 \u2502       \u2502\n                 \u2502       \u2514\u2500 Version number: 0x00004E89 (20105) as uint32 BE\n                 \u2514\u2500 Sub-type: 0x00 (version sub-packet)\n\nTotal wire size: 1 + 2 + 5 = 8 bytes\n</code></pre>"},{"location":"part-1-introduction/index.html#internal-bit-stream-protocol","title":"Internal Bit-Stream Protocol","text":"<p>Internally, Wulfram 2 uses a bit-oriented buffer system that can read arbitrary numbers of bits. However, the wire format uses byte-aligned frames. The internal read functions are:</p> Function Bits Read Bytes Description <code>FUN_005092e0</code> 8 bits 1 byte Read uint8 <code>FUN_005092f0</code> 16 bits 2 bytes Read uint16 (BE) <code>FUN_00509310</code> 32 bits 4 bytes Read uint32 (BE) <code>FUN_00509340</code> variable variable Read length-prefixed string"},{"location":"part-1-introduction/index.html#fundamental-rule-3-fixed-point-number-encoding","title":"Fundamental Rule #3: Fixed-Point Number Encoding","text":"<p>Wulfram 2 transmits floating-point values as fixed-point integers to save bandwidth.</p>"},{"location":"part-1-introduction/index.html#the-formula","title":"The Formula","text":"<pre><code>To ENCODE (float \u2192 wire):   wire_value = (int)(float_value \u00d7 65536)\nTo DECODE (wire \u2192 float):   float_value = wire_value \u00d7 (1/65536)\n                            float_value = wire_value \u00d7 0.0000152587890625\n</code></pre>"},{"location":"part-1-introduction/index.html#verification-from-decompiled-code","title":"Verification from Decompiled Code","text":"<p>The client's decoding function confirms this exact formula:</p> <pre><code>// From FUN_004dc620 (line 150538-150541)\nfloat10 FUN_004dc620(int param_1) {\n    return (float10)param_1 * (float10)1.52587890625e-05;\n}\n// Note: 1.52587890625e-05 = 1/65536 exactly\n</code></pre>"},{"location":"part-1-introduction/index.html#why-65536","title":"Why 65536?","text":"<p>65536 = 2^16. This gives 16 bits of fractional precision, which is enough for game physics.</p>"},{"location":"part-1-introduction/index.html#examples","title":"Examples","text":"Float Value Calculation Wire Value (decimal) Wire Value (hex BE) 1.0 1.0 \u00d7 65536 = 65536 65536 <code>00 01 00 00</code> 2.0 2.0 \u00d7 65536 = 131072 131072 <code>00 02 00 00</code> 0.5 0.5 \u00d7 65536 = 32768 32768 <code>00 00 80 00</code> 20.0 20.0 \u00d7 65536 = 1310720 1310720 <code>00 14 00 00</code> 4.0 4.0 \u00d7 65536 = 262144 262144 <code>00 04 00 00</code> 0.0 0.0 \u00d7 65536 = 0 0 <code>00 00 00 00</code> 100.0 100.0 \u00d7 65536 = 6553600 6553600 <code>00 64 00 00</code> -1.0 -1.0 \u00d7 65536 = -65536 -65536 (signed) <code>FF FF 00 00</code>"},{"location":"part-1-introduction/index.html#python-encoding_1","title":"Python Encoding","text":"<pre><code>def encode_fixed_point(float_value):\n    \"\"\"Convert a float to Wulfram 2 fixed-point format (4 bytes big-endian)\"\"\"\n    wire_value = int(float_value * 65536)\n    return struct.pack('&gt;i', wire_value)  # Use signed int for negative values\n\ndef decode_fixed_point(wire_bytes):\n    \"\"\"Convert Wulfram 2 fixed-point bytes back to float\"\"\"\n    wire_value = struct.unpack('&gt;i', wire_bytes)[0]\n    return wire_value * (1.0 / 65536.0)\n\n# Examples:\nencode_fixed_point(1.0)   # Returns: b'\\x00\\x01\\x00\\x00'\nencode_fixed_point(20.0)  # Returns: b'\\x00\\x14\\x00\\x00'\nencode_fixed_point(0.5)   # Returns: b'\\x00\\x00\\x80\\x00'\nencode_fixed_point(-1.0)  # Returns: b'\\xff\\xff\\x00\\x00'\n</code></pre>"},{"location":"part-1-introduction/index.html#fundamental-rule-4-strings-are-length-prefixed-and-null-terminated","title":"Fundamental Rule #4: Strings Are Length-Prefixed AND Null-Terminated","text":"<p>Important: Strings in Wulfram 2 have TWO components: 1. A 16-bit big-endian length prefix (counts all bytes including the null terminator) 2. The string data, ending with a null byte (<code>0x00</code>)</p> <pre><code>String: \"Hello\"\n\nWire format:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  LENGTH         \u2502  STRING DATA (with \\0)       \u2502\n\u2502  (2 bytes BE)   \u2502  (LENGTH bytes)              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502    00 06        \u2502  48 65 6C 6C 6F 00           \u2502\n\u2502    (6)          \u2502  H  e  l  l  o  \\0           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nComplete wire bytes: 00 06 48 65 6C 6C 6F 00\n                     \u2500\u2500\u2500\u2500\u2500 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n                       \u2502         \u2502\n                       \u2502         \u2514\u2500 \"Hello\" + null terminator (6 bytes)\n                       \u2514\u2500 Length: 6 (includes the null terminator!)\n</code></pre>"},{"location":"part-1-introduction/index.html#verification-from-decompiled-code_1","title":"Verification from Decompiled Code","text":"<p>Reading strings (FUN_00509340): <pre><code>// Line 184735-184746\nuVar1 = FUN_00509050(0x10);              // Read 16-bit length\nuVar1 = uVar1 &amp; 0xffff;\npvVar2 = _malloc(uVar1);                  // Allocate length bytes\nFUN_00509160(pvVar2, uVar1, 0, 0);       // Read the string data\n*(undefined1 *)(*param_1 + -1 + uVar1) = 0;  // Ensure null termination\n</code></pre></p> <p>Writing strings (FUN_00509600): <pre><code>// Line 184993-184998\n// Calculate length by finding null terminator\ndo { cVar2 = *pcVar9; pcVar9++; } while (cVar2 != '\\0');\nuVar7 = (uint)(pcVar9 + (1 - (int)(param_2 + 1))) &amp; 0xffff;  // Length including \\0\nFUN_005094b0(uVar7);                     // Write 16-bit length prefix\n// Then write string data...\n</code></pre></p>"},{"location":"part-1-introduction/index.html#python-encoding_2","title":"Python Encoding","text":"<pre><code>def encode_string(text):\n    \"\"\"\n    Encode a string for Wulfram 2 protocol.\n    Format: [length:2 bytes BE][string data with null terminator]\n    \"\"\"\n    string_bytes = text.encode('utf-8') + b'\\x00'  # Add null terminator\n    length = struct.pack('&gt;H', len(string_bytes))   # Length includes the \\0\n    return length + string_bytes\n\ndef decode_string(data, offset=0):\n    \"\"\"\n    Decode a Wulfram 2 string from bytes.\n    Returns (string, new_offset)\n    \"\"\"\n    length = struct.unpack('&gt;H', data[offset:offset+2])[0]\n    string_data = data[offset+2:offset+2+length]\n    # Remove null terminator for Python string\n    text = string_data.rstrip(b'\\x00').decode('utf-8')\n    return text, offset + 2 + length\n\n# Examples:\nencode_string(\"Hello\")        # b'\\x00\\x06Hello\\x00'\nencode_string(\"Red Team\")     # b'\\x00\\x09Red Team\\x00'\nencode_string(\"127.0.0.1\")    # b'\\x00\\x0a127.0.0.1\\x00'\nencode_string(\"\")             # b'\\x00\\x01\\x00'  (length 1 for just the null byte)\n</code></pre>"},{"location":"part-1-introduction/index.html#common-string-examples","title":"Common String Examples","text":"String Length (decimal) Length (hex) Wire Bytes \"\" (empty) 1 <code>00 01</code> <code>00 01 00</code> \"Hi\" 3 <code>00 03</code> <code>00 03 48 69 00</code> \"Hello\" 6 <code>00 06</code> <code>00 06 48 65 6C 6C 6F 00</code> \"Test Server\" 12 <code>00 0C</code> <code>00 0C 54 65 73 74 20 53 65 72 76 65 72 00</code>"},{"location":"part-1-introduction/index.html#fundamental-rule-5-booleans","title":"Fundamental Rule #5: Booleans","text":"<p>Boolean values are encoded as a single byte: - <code>0x00</code> = false - Any non-zero value = true (typically <code>0x01</code>)</p> <pre><code>def encode_bool(value):\n    \"\"\"Encode a boolean for Wulfram 2 protocol\"\"\"\n    return bytes([0x01 if value else 0x00])\n\ndef decode_bool(byte_value):\n    \"\"\"Decode a Wulfram 2 boolean\"\"\"\n    return byte_value != 0x00\n</code></pre>"},{"location":"part-1-introduction/index.html#fundamental-rule-6-tcp-vs-udp-packet-namespaces","title":"Fundamental Rule #6: TCP vs UDP Packet Namespaces","text":"<p>CRITICAL: TCP and UDP use completely separate packet type namespaces. The same type code represents different packets depending on the socket type!</p> <p>This is a common source of confusion. When you see type code <code>0x08</code>, you must know whether it came from TCP or UDP:</p> Type Code TCP Packet UDP Packet <code>0x08</code> ROOT HELLO_ACK <code>0x09</code> (reserved) ROOT/START <code>0x0A</code> (reserved) VOICE <code>0x0B</code> PING_REQUEST PRIORITY <code>0x0C</code> PING WEAPONS <code>0x0D</code> TRANSIENT_ARRAY ACK_WPNS <code>0x0E</code> UPDATE_ARRAY PRIORITY2 <code>0x10</code> RESENDS RESENDS <code>0x11</code> HUD_MESSAGE (unknown) <code>0x12</code> LAG_FIX GRAPH_RESPONSE <code>0x13</code> HELLO GRAPH_DATA <code>0x14</code> HIDE_OBJECT IGNORE"},{"location":"part-1-introduction/index.html#when-is-udp-used","title":"When is UDP Used?","text":"<ul> <li>TCP: Connection setup, login, game state, roster updates, chat \u2014 reliable delivery required</li> <li>UDP: Voice chat, real-time position updates (PRIORITY), weapon state \u2014 low latency preferred</li> </ul> <p>The client establishes the UDP channel after receiving HELLO sub-type 1 (UDP port info). See Part 9: UDP Protocol for complete UDP documentation.</p>"},{"location":"part-1-introduction/index.html#summary-the-building-blocks","title":"Summary: The Building Blocks","text":"<p>Before we dive into specific packets, make sure you understand these fundamentals:</p> Concept Rule Wire Format Byte Order Always BIG-ENDIAN for multi-byte integers MSB first Packet Frame <code>[type:1][length:2 BE][payload:length]</code> 3-byte header + payload Length Field Counts payload bytes only (excludes type byte) uint16 BE Floats/Doubles Encoded as <code>int(value \u00d7 65536)</code> int32 BE (signed) Strings Length-prefixed AND null-terminated <code>[len:2 BE][data + \\0]</code> Booleans 1 byte: <code>0x00</code> = false, else = true uint8"},{"location":"part-1-introduction/index.html#quick-reference-data-type-encoding","title":"Quick Reference: Data Type Encoding","text":"<pre><code>import struct\n\n# === INTEGERS ===\ndef encode_uint8(value):\n    return bytes([value &amp; 0xFF])\n\ndef encode_uint16(value):\n    return struct.pack('&gt;H', value)\n\ndef encode_uint32(value):\n    return struct.pack('&gt;I', value)\n\ndef encode_int32(value):\n    return struct.pack('&gt;i', value)\n\n# === FIXED-POINT FLOATS ===\ndef encode_fixed_point(float_value):\n    return struct.pack('&gt;i', int(float_value * 65536))\n\n# === STRINGS ===\ndef encode_string(text):\n    string_bytes = text.encode('utf-8') + b'\\x00'\n    return struct.pack('&gt;H', len(string_bytes)) + string_bytes\n\n# === BOOLEANS ===\ndef encode_bool(value):\n    return bytes([0x01 if value else 0x00])\n\n# === PACKET WRAPPER ===\ndef make_packet(packet_type, payload):\n    \"\"\"Wrap payload in a complete packet frame\"\"\"\n    return bytes([packet_type]) + struct.pack('&gt;H', len(payload)) + payload\n</code></pre>"},{"location":"part-1-introduction/index.html#whats-next","title":"What's Next?","text":"<p>In Part 2, we'll implement the HELLO handshake - the first packets your server needs to send to establish a connection with the client.</p> <p>Continue to Part 2: The HELLO Handshake</p>"},{"location":"part-10-reference-files/index.html","title":"Wulfram 2 - Complete Game Documentation","text":"<p>Sources: Official Game Documentation, Team Tactical Fan Site (archived) Technical Data: Values extracted from BEHAVIOR packet specification in decompiled client Legend: Values marked with <code>?</code> are unknown/undocumented and need verification</p> <p>For protocol documentation, see Part 9: UDP Protocol and Part 11: TCP Protocol.</p>"},{"location":"part-10-reference-files/index.html#table-of-contents","title":"Table of Contents","text":"<ol> <li>Background &amp; Lore</li> <li>Manned Vehicles</li> <li>Weapons &amp; Armaments</li> <li>Base Structures</li> <li>Utility Structures</li> <li>Space Units</li> </ol>"},{"location":"part-10-reference-files/index.html#background-lore","title":"Background &amp; Lore","text":""},{"location":"part-10-reference-files/index.html#the-new-social-contract","title":"The New Social Contract","text":"<p>There was this thing called the Coalition Government, which through the inertia of time had become this big agency that controlled pretty much all of the civilized worlds that humanity had inhabited (though most of the galaxy was still unexplored).</p> <p>The Coalition Government was not excessively martial or imperialistic, and neither was it too big-brotherish, though like all modern governments, it had slight tendencies toward all three.</p> <p>As a result of the general progress of technology, several things happened: It became extremely cheap to make things, in general (such as weapons), and maintenance costs became very low. One of the things that it became much cheaper to make was spaceships; though they still weren't exactly cheap, they had become inexpensive enough that people besides the government could afford to build large ones.</p> <p>Because of the increased availabilities (and capabilities) of interstellar transportation, there were suddenly places to go to that nobody had been yet. And the increased availability of military power meant that if you went somewhere and decided that the Coalition Government wasn't allowed to tell you what to do, well, they couldn't stop you without prohibitive expense.</p> <p>Seeing the freedom that many were gaining just by leaving, subjects of the Coalition Government became dissatisfied with the whole concept of compromise. New political parties formed, and factions became larger; eventually they decided to split off from the main government in big chunks. The first such major defeat of the Coalition Government was at Cantero, where the Independent Party captured the seat of power for an entire planet.</p> <p>The Independent Party was soon rocked by scandal, and survived only a few years before splitting up. Technology kept advancing, things kept getting easier, and political and religious factions kept splitting and splitting. Eventually we end up with more factions than there are major planetary landmasses, each faction consisting of people who believe in some major concept or ideal; all the known planets are full, but most of the galaxy consists of unknown planets; every group is hunting for a good one to call their own.</p>"},{"location":"part-10-reference-files/index.html#the-battle-of-cantero-2642","title":"The Battle of Cantero (2642)","text":"<p>The Coalition Government \"quarantined\" the offending Independent Party areas (which were the size of small towns) and cut off their means of supply. They were building tanks and other offensive units, but all visual evidence showed that it would take them months to manufacture enough to be any real threat.</p> <p>The Coalition took a very defensive stance: they surrounded their important governmental centers with heavy defenses that would easily shred any oncoming tanks. They never attacked the Independents, for fear of bad publicity and economics\u2014when assaulting the enemy's bases, they'd lose equipment and suffer casualties. If they just wait, the enemy would collapse.</p> <p>The Coalition didn't know about Portals, though, because they hadn't been invented yet. About one week before their resources ran out, it became clear why the Independents hadn't built very many tanks: inside big warehouses they'd been cranking out a number of portals. They performed a tactic that became known as a \"portal rush\": leave four or five portals half-set-up and get one tank through defenses into an enemy area, long enough to drop a portal. Then you have a gate inside, and the second guy flies through and drops his other portal. Repeat until you run out of portals.</p> <p>Using this tactic, for which the Coalition had been completely unprepared, the Independents took control of all the planet's governmental centers within three days.</p>"},{"location":"part-10-reference-files/index.html#manned-vehicles","title":"Manned Vehicles","text":""},{"location":"part-10-reference-files/index.html#tank","title":"Tank","text":"<p>Entity Index: 0</p> <p>This is a manned, armored hovercraft\u2014the backbone of the Wulfram 2 combat force.</p> <p>The tank can carry a number of special armaments, including rockets, missiles, and proximity mines. Its main gun is a rapid-fire autocannon that fires 12.5 rounds per second. Its secondary gun is the Pulse Cannon, a sniper's gun that fires explosive rounds at ranges of up to 1150 meters.</p> Stat Value Hit Points 500 HP Top Speed 201 km/h (124.9 mph) Maximum Load 325 MU Range at Top Speed ~2.85 km Can Carry Cargo Yes Can Carry Uplink Yes Can Jump Yes <p>Primary Weapon: AutoCannon - Fires 12.5 rounds per second - Range up to 550m (effective at ~300m or less) - Deals approximately 11 HP damage per second if all bullets hit - Uses moderate fuel per burst</p> <p>Secondary Weapon: Pulse Cannon - Fires explosive pulse shells - Range up to 1050-1150m before self-detonation - Deals 300 HP damage on direct hit (when fully charged) - Has splash damage effect - ~3 second recharge time - Pulse velocity inherits from tank movement</p> <p>Abilities: - Jump Jets: Make great leaps into the sky to avoid incoming fire or reach elevated areas - Pulse Jump: Advanced technique of jumping and firing pulse at apex for hitting enemies behind cover</p> <p>Tactical Notes: - Use both missiles in pairs, preferably of different kinds (Hunter-Piercer combination recommended) - Watch fuel meter\u2014tank is very slow when out of fuel - When low on fuel, land for 10-15 seconds to recover fuel and HP - Against scouts: back up rather than using jump jets</p>"},{"location":"part-10-reference-files/index.html#scout","title":"Scout","text":"<p>Entity Index: 1</p> <p>This is a light manned hovercraft, often considered the Medic of the team.</p> <p>The scout is less armored than the tank, but it moves more quickly. It can carry fewer special armaments than the tank can. The scout's main gun is a light version of the rapid-fire autocannon called the Chaingun. Its secondary gun is the Repair Beam, which can be used to repair friendly units or strip armor from enemy units.</p> Stat Value Hit Points 330 HP Top Speed 288 km/h (179 mph) Maximum Load 136 MU Range at Top Speed ~1.86 km Can Carry Cargo No Can Carry Uplink No Can Jump No <p>Primary Weapon: Chaingun - Lighter version of autocannon - Lesser range and damage than tank autocannon</p> <p>Secondary Weapon: Repair Beam - Heals allies and base components (closer = more effective) - Healing range: ~200m - Damages enemies and gives beam more healing power - Damage range: up to 581m (sticks at 600m, damages at 550m) - Excellent at shooting down Hunter missiles due to auto-tracking - Uses no fuel when stationary</p> <p>Limitations: - Cannot carry Cargo or Uplink - Can only hold Thumpers, Piercers, Flares, or Maser - Cannot jump - Small fuel tank\u2014runs out quickly when firing and beaming simultaneously</p> <p>Tactical Notes: - Uses no fuel when strafing (Shift-strafe allows quick movement while regaining fuel) - Multiple scouts traveling together are deadly - Scout packs are vulnerable to Caltrops and equal numbers of tanks - The scout \"slides\" through turns at high speeds</p>"},{"location":"part-10-reference-files/index.html#other-manned-units-undocumented","title":"Other Manned Units (Undocumented)","text":"Index Name Status 2 Assault Platform Not documented\u2014may be cut content 3 Bomber Not documented\u2014may be cut content 4 Transport Not documented\u2014may be cut content"},{"location":"part-10-reference-files/index.html#weapons-armaments","title":"Weapons &amp; Armaments","text":""},{"location":"part-10-reference-files/index.html#missile-weapons","title":"Missile Weapons","text":""},{"location":"part-10-reference-files/index.html#hunter","title":"Hunter","text":"<p>Entity Index: 8</p> <p>The hunter is a fully-guided missile causing medium damage. Fire it and it will track the target, even if that target is behind you.</p> Stat Value Damage 200 HP Range ~3000m (3 km) Install Cost 60 MU Additional Cost 50 MU each Reload Time 1.5 seconds Available To Tank only Tracking Strong (fully guided) <p>Usage: - Missile jumping technique - Excellent punch when attacking enemy bases - Use as distraction in standoffs\u2014if enemy goes for hunter, close in and pulse/autocannon</p> <p>Defense: - Do not jump\u2014Hunter will recorrect its course and continue tracking - If fired high, avoid by moving forward; if fired low, hide behind cover - Can be targeted and shot down with 'i' key - Scout Repair Beam easily picks off hunters due to auto-tracking - Flares distract incoming hunters</p>"},{"location":"part-10-reference-files/index.html#piercer","title":"Piercer","text":"<p>Entity Index: 11</p> <p>The piercer is a direct-fire rocket that penetrates the target's armor and shatters, causing medium damage. To aid in hitting targets, the piercer is equipped with weak guidance thrusters. However, it is not fully guided, so you should be careful to aim it at the target before firing.</p> Stat Value Damage 108 HP Range ~1200m Install Cost 64 MU Additional Cost 24 MU each Reload Time 2.25 seconds Available To Tank and Scout Tracking Good (weak guidance) <p>Usage: - When opening a fight with clear shot - Support damage for autocannon and pulse shells - Best for destroying Flak Turrets (direct fire, straight line) - When shooting at distant enemy (~800m), fire one, then another after 5 seconds\u2014if target jumps to avoid first, second has high chance of hitting</p> <p>Dodging: - Jump - Press Forward + left/right strafe simultaneously - Shoot it down - Get behind a hill</p>"},{"location":"part-10-reference-files/index.html#thumper","title":"Thumper","text":"<p>Entity Index: 12</p> <p>The thumper is a direct-fire rocket that throws angular momentum into its target, disorienting it. The thumper causes only light damage. To aid in hitting targets, the thumper is equipped with weak guidance thrusters. However, it is not fully guided.</p> Stat Value Damage 41-45 HP Range ~1735m Install Cost 50 MU Additional Cost 30 MU each Reload Time 3.0 seconds Available To Tank and Scout Tracking Poor (weak guidance) <p>Usage: - Disorients target (spins them around), giving time to land shots - At Gun Turrets so they cannot return fire\u2014can literally run next to GT and autocannon it to death - Very underrated missile\u2014make sure reticle is right on enemy or where they're about to be - Close range weapon\u2014not recommended over 200m - Can use as distraction\u2014few people check what kind of missile is incoming</p> <p>Dodging: - Jump (will almost always miss) - Strafe (will not guide well) - Get behind a hill - Just move and it will miss</p>"},{"location":"part-10-reference-files/index.html#caltrop","title":"Caltrop","text":"<p>Entity Index: 13</p> <p>Caltrops are floating semi-guided explosive mines, usually released in groups. They will home in on enemy targets as a cloud of bombs. Each caltrop causes only light damage, but they add up quickly.</p> Stat Value Damage 50 HP each Lifetime ~30 seconds Install Cost 69 MU Additional Cost 4 MU each Available To Tank only Tracking Slow homing <p>Notes: - Only attacks tanks, scouts, and other caltrops - Especially useful when being chased\u2014deploy while escaping - After 30 seconds, fall to ground and explode - Caltrops come from the REAR of your tank - Holding down release button (5 key) continuously releases until exhausted</p> <p>Tactical Uses: - Very effective against Scouts (they need to get close for Repair Beam) - Prevent enemy tanks from rushing new offensive Sky Pumps - May absorb pulse shells fired from afar - Don't take 65 caltrops\u201435 is sensible even for large group</p> <p>Defense: - Release your own caltrops - Pulse can destroy several if it hits them - Jump over enemy deploying caltrops</p>"},{"location":"part-10-reference-files/index.html#flare","title":"Flare","text":"<p>Entity Index: 17</p> <p>Flares distract missiles. When rushing a base fortified by many missile launchers, or playing against a missile-heavy team, flares can truly be helpful.</p> Stat Value Damage 0 HP Install Cost 64 MU Additional Cost 24 MU each Reload Time ~2 seconds Available To Tank and Scout <p>Usage: - Flare distracts hunters when it reaches top of arc and \"poofs\" - Pop at about 500m or so\u2014wait too long and missiles still hit - Flare will distract Flak Turret fire momentarily - Gun Turret completely ignores flares</p>"},{"location":"part-10-reference-files/index.html#mine","title":"Mine","text":"<p>Entity Index: Not a projectile entity</p> <p>Proximity mines that explode for heavy damage on detection of enemy unit. They contain stealth circuitry that makes them difficult to spot on enemy radar.</p> Stat Value Damage 300 HP direct hit Effect Area damage Install Cost 30 MU Additional Cost 25 MU each Reload Time 1.5 seconds Available To Tank only <p>Notes: - Shows on map as yellow dots (flashes intermittently if enemy) - Makes pinging noise when nearby - Can set each other off in chain reaction - Can be targeted and destroyed with gunfire</p> <p>Defensive Use: - Lay field around base in areas under fire from your guns - Deploy in evenly-spaced field rather than line or cluster - Lay second line in probable \"landing zone\" for jumping enemies - Deploy about 100m apart to prevent chain reaction destroying whole field</p> <p>Offensive Use: - Drop one or two mines before combat on your side of corner/hill - Jump over enemies laying mine on top of them - Seed backslope of hills you're camping with mines</p>"},{"location":"part-10-reference-files/index.html#maser","title":"Maser","text":"<p>Entity Index: Not a projectile entity</p> <p>A very weak 'laser-pointer' type device with infinite range.</p> Stat Value Damage ~20 HP/second Range Infinite (line of sight) Install Cost 80 MU Available To Tank and Scout Tracking Manual aim <p>Limitations: - Cannot damage base structures - Cannot damage through physical objects (walls, hills)</p> <p>Uses: - Annoy enemies during battle by forcing constant movement - Keep enemy base components from automatically repairing - Stop enemies from using refuel pads - Designated sniper role from elevated position</p>"},{"location":"part-10-reference-files/index.html#other-projectiles-entity-reference","title":"Other Projectiles (Entity Reference)","text":"Index Name Category Notes 5 Flak Shell Turret Ammo Fired by Flak Turrets, knocks back enemies 6 Pulse Shell Tank Secondary See Pulse Cannon description 7 Short Missile Unknown Possibly early/internal name 9 Heavy Missile Unknown Possibly Missile Launcher ammo 10 (Unknown) Unknown Entity slot exists 14 Orbital Bomb Ship Weapon Bombardment projectile, can be shot down 15 Cruise Missile Unknown Undocumented 16 Mortar Shell Unknown Undocumented 18 Aerial Bomb Unknown Possibly Bomber weapon"},{"location":"part-10-reference-files/index.html#base-structures","title":"Base Structures","text":""},{"location":"part-10-reference-files/index.html#power-cell","title":"Power Cell","text":"<p>Entity Index: 25</p> <p>An all-purpose energy source that generates power and beams it to all nearby equipment. Not all types of equipment require external power, but you will find a power cell essential to building a useful base.</p> Stat Value Hit Points 700 HP Build Time 2:30 Effect Radius ~280m Requires Power No (is power source) <p>Mechanics: - Powers all base components within radius - A power cell can only supply energy to a limited number of field units - When you target a power cell, its energy output is displayed as a horizontal bar below the targeting reticle - Two power cells cannot supply energy to overlapping regions (would overload and explode) - Standby Mode: Deploy within 25m of primary Power Cell to create backup</p> <p>Claiming Neutral Units: - Regardless of which army built a field unit, if it is neutral, you can take control of it by powering it with your own cell - If your units lose power through cell's destruction, they become neutral</p> <p>Vehicle Boost: - Power cells boost repairing and refueling rates of all vehicles within range - Effect is highest when cell is not expending energy powering base structures - Effect limited to one cell\u2014two overlapping cells don't help more than one</p> <p>Radar Visibility: - Enemy power cells are difficult to spot on radar unless you have direct line of sight or are very close - Visible at &gt;600m with line of sight, &gt;200m otherwise - When damaged, becomes temporarily visible to all radar (including map mode) - Under Dark Light, cannot be targeted with 'U' or 'Tab' - Can be seen and targeted from initial starting map</p>"},{"location":"part-10-reference-files/index.html#repair-pad","title":"Repair Pad","text":"<p>Entity Index: 27</p> <p>Nanoassemblers programmed with the precise physical structure of each vehicle, repair pads can fix vehicles perfectly, restoring them down to the last molecule. Using the same technique, this pad can also build vehicles from scratch. This construction ability is one of the little miracles that changed the world and made possible war as we know it.</p> Stat Value Hit Points 1000 HP Build Time 4:00 Requires Power Yes <p>Function: - Respawn point for destroyed players - Heals damaged vehicles (land on pad) - If all Repair Pads are destroyed, dead players cannot re-enter play - If all players defeated with no RPs, game is over</p> <p>Tactical Notes: - Waste to put two Repair Pads in same base - Leave as cargo until you can get Power Cell and Refuel Pad to go with it - The closer to enemy, the better\u2014saves \"long drive\" to front</p>"},{"location":"part-10-reference-files/index.html#refuel-pad","title":"Refuel Pad","text":"<p>Entity Index: 26</p> <p>Produces fuel and ammunition, supplying them to friendly vehicles. Crucially important for those in a defensive role; repeatedly throughout history, strong forces have been incapacitated by fuel shortage, succumbing soon after.</p> Stat Value Hit Points 600 HP Build Time 4:30 Requires Power Yes <p>Ammunition Stocks:</p> Weapon Max Stock Available To Piercer 30 Tank/Scout Thumper 20 Tank/Scout Hunter 17 Tank Caltrop 150 Tank Mine 15 Tank Flare 20 Tank/Scout Maser 1 Tank/Scout <p>Notes: - Weapons eventually replenish on their own - When fuel drops to 30% or less, break off and visit Refuel Pad - Refuel pads win games\u2014deploy enough so team can rush correctly</p>"},{"location":"part-10-reference-files/index.html#gun-turret","title":"Gun Turret","text":"<p>Entity Index: 30</p> <p>This automated turret is armed with a rapid-fire, medium-calibre cannon for excellent short-range defense. Without support, however, a gun turret is vulnerable to weapons with longer reach.</p> Stat Value Hit Points 525 HP Build Time 4:00 Range ~475m Requires Power Yes <p>Characteristics: - Devastating damage\u2014tank destroyed in seconds - Uses autocannon with less cooldown than flak - No minimum range like Flak Turret - Slow turn rate (weakness) - Large explosion if destroyed</p> <p>Deployment: - Close to base components, but far enough that explosion doesn't damage others - Don't deploy all gun turrets on same side of base - Deploy close to (but not touching) Flak Turrets to protect flak's \"inner sanctum\" - At least 100m from other buildings</p> <p>Defeating Gun Turrets: - Fire pulse over turret (it tracks and shoots), fire second pulse, then fire Thumper\u2014turret gets hit in back and can't return fire - Simply outrange it\u2014get to ~500m and autocannon from there - See also: Turning Gun Turrets technique</p>"},{"location":"part-10-reference-files/index.html#flak-turret","title":"Flak Turret","text":"<p>Entity Index: 29</p> <p>A medium-range defensive weapon that fires exploding flak shells. It is computer controlled, automatically tracking and firing at potential threats. As a safety precaution, the flak shells are armed by a timer and will not explode if they strike a target that is too close.</p> Stat Value Hit Points 550 HP Build Time 4:00-5:00 Range 300-1000m Minimum Range ~300m Requires Power Yes <p>Characteristics: - Intercepts incoming missiles and pulse shells - Enemies struck by flak shell are knocked back and disoriented - Fires 3 flak shells at a time - Often waits to fire until enemy is 900m away - Flak bursts can be avoided by maneuverable craft - Creates large explosion on destruction (~100m damage radius)</p> <p>Limitations: - Inner Sanctum: Minimum range of ~300m creates vulnerability zone - Most effective when backed up by other firepower - Always pair with Gun Turret (with 100m+ between them)</p>"},{"location":"part-10-reference-files/index.html#missile-launcher","title":"Missile Launcher","text":"<p>Entity Index: 32</p> <p>A long-range defensive unit that fires guided missiles at hostile targets. Though the guided missiles have a long reach and are good at hitting larger moving targets, they are not themselves effective anti-missile systems, and require medium- and short-range guns for support.</p> Stat Value Hit Points 500 HP Build Time 7:00 Range 900-1400m Requires Power Yes <p>Characteristics: - Fires up to 4 Hunter missiles at a time - Immobile (does not track) - Does NOT create explosion when destroyed - Hunters fired by MLs are more powerful than tank-fired hunters</p> <p>Tactical Notes: - Deploy behind additional defenses\u2014fodder for enemies in dead zone - Multiple Missile Launchers are typically good idea - In 2647, undefended missile launchers at New Qumran were eliminated by tanks firing their own guided missiles from behind rocky ridges</p>"},{"location":"part-10-reference-files/index.html#heavy-silo","title":"Heavy Silo","text":"<p>Entity Index: 31</p> <p>Fires very-long-range ballistic missiles at hostile installations. These missiles will usually be intercepted near the target unless its defensive systems are otherwise occupied. But when used properly, they can provide the extra impact necessary to turn the tide of battle.</p> Stat Value Hit Points ? Build Time ? Range Very long Requires Power Yes <p>Notes: Undocumented in player guides\u2014requires verification from packet captures.</p>"},{"location":"part-10-reference-files/index.html#portal","title":"Portal","text":"<p>Entity Index: 34</p> <p>A portal is a doorway between two locations in space, formed by two devices that serve as endpoints.</p> <p>Portals are often referred to as \"the doors to independence\" and \"the passage to the modern day\", referring to the Independent Party's landslide victory over the Coalition Government at the Battle of Cantero in 2642.</p> Stat Value Hit Points ? Build Time ? Requires Power At least one endpoint <p>Mechanics: - At least one endpoint must be powered for friendly forces to pass through - If source point is controlled by hostile forces, it will be impassable - When one half is destroyed, the other end will collapse and explode (connected by topological isocontours)</p>"},{"location":"part-10-reference-files/index.html#uplink","title":"Uplink","text":"<p>Entity Index: 20</p> <p>Uplinks are used to communicate with supply ships. The carrier of the Uplink is called the Linker.</p> Stat Value Rebuild Time 2:00 (if ship exists) Self-Destruct 13 minutes in enemy hands <p>Usage: 1. Target friendly uplink with 'l' 2. Pick it up 3. Deploy key (\".\") to install in tank 4. Uplink icon moves to left side of HUD 5. Go to map screen (M) to order ships</p> <p>Notes: - Enemy CAN steal uplink if carrier is destroyed with it - Enemy CANNOT use it\u2014only hold or put down - Self-destructs 13 minutes after falling into enemy hands - If recaptured, self-destruct sequence cancels - After self-destruct, ship builds new one in 2:00 - Must deploy (\".\") before use; un-deploy (\",\") before dropping - Press \",\" twice to drop installed uplink</p>"},{"location":"part-10-reference-files/index.html#cargo-box","title":"Cargo Box","text":"<p>Entity Index: 19</p> <p>Cargo Boxes are the containers that hold Cargo when it is dropped from Supply Ships.</p> Stat Value Hit Points 90 HP"},{"location":"part-10-reference-files/index.html#utility-structures","title":"Utility Structures","text":""},{"location":"part-10-reference-files/index.html#sky-pump","title":"Sky Pump","text":"<p>Entity Index: 33</p> <p>Warp travel does bad things to the fabric of space, and the gravitational ripples caused by warp effects can prevent further warp-ins and destroy objects that are \"native\" to faraway space.</p> <p>The skypump acts as a gravitational lens, creating a field of stability that extends upward into orbit, effectively tuning space to the same frequency as the space of your forces' origin worlds.</p> Stat Value Hit Points 300 HP Build Time 2:45 Requires Power No (internal batteries) <p>Ship Movement: - 1 Sky Pump in sector: Supply ships can move through and occupy that space - 2+ Sky Pumps in sector: Can warp in a new ship</p> <p>Movement Mechanics: - Ships move into adjacent sectors with at least 1 Sky Pump - Takes 0:30 to move one sector - At 0:30 mark, ship crosses into new sector (continues visually moving to center) - If pump destroyed before 0:30, ship remains\u2014only remaining time needed once new pump placed</p> <p>Warping Ships: - Requires Warp Glimpse \u2192 Warp Push sequence - Both pumps must remain intact during both stages - If one destroyed, replace before countdown reaches zero - Maximum 3 ships per team</p> <p>Deployment Notes: - Placing on steep slope can cause it to roll over and explode - Raise altitude enough when deploying - Can be deployed at lower altitudes, especially when moving</p>"},{"location":"part-10-reference-files/index.html#dark-light","title":"Dark Light","text":"<p>Entity Index: 35</p> <p>Twists photons into their left-hand-universe counterparts, thus oozing a darkness that obscures units and renders them invisible to radar.</p> <p>By carefully modulating the energy levels of emitted photons, the darklight pulses in a cryptographically secure sequence that can be filtered by friendly forces, allowing them to see almost normally.</p> Stat Value Hit Points 250 HP Build Time 8:00 Effect Radius ~210m Requires Power No (absorbs/re-emits existing light) <p>Effects: - Tanks and Scouts under darklight CANNOT be targeted by Tab, 'U', or 'T' - Power Cells under darklight CANNOT be targeted by Tab or 'U' - Enemy units under friendly darklight cannot be seen on radar</p> <p>Tactical Notes: - Place in planned expansion base FIRST (before anything except maybe Power Cell) - Enemy cannot have prior knowledge of \"ghost base\" - Crafty enemy linker might notice stream of people disappearing - Can place near enemy front line for ambush staging - Not always good idea\u2014enemy may stumble across and destroy (8 minutes wasted)</p> <p>Tip: Store darklight under targeting key (F5), press before deploying base units to check if within 180m radius</p>"},{"location":"part-10-reference-files/index.html#space-units","title":"Space Units","text":""},{"location":"part-10-reference-files/index.html#supply-ship","title":"Supply Ship","text":"<p>Entity Index: 21</p> <p>The Supply Ship (sometimes referred to as Starship) is one of the most vital tools for your team\u2014if not the most important.</p> Stat Value Hit Points ? Movement Time 0:30 per sector Max Per Team 3 <p>Control: - Only person carrying Uplink can utilize Supply Ship functions - Press '.' to deploy uplink, 'M' to access map - Click on ship to see status, cargo status, BuildMode setting - Can order Orbital Strike or move ship from map screen</p> <p>Ship Combat: - Ships in non-adjacent sectors are evenly matched (no damage dealt) - To destroy enemy ship: get Sky Pump in two separate sectors adjacent to enemy ship - Move your ships to those sectors\u2014they team up and destroy enemy ship in 1-2 minutes</p> <p>Getting New Ships: 1. Sector has no supply ship 2. Has 2 Sky Pumps when Warp Glimpse occurs 3. Has 2 Sky Pumps when Warp Push occurs 4. New ship arrives (up to max 3)</p> <p>Tactic: Deploy Sky Pump in forward square, move original ship there, then DoublePump old square to warp new ship\u2014only have to defend ONE pump away from initial base</p>"},{"location":"part-10-reference-files/index.html#orbital-strike-bombardment","title":"Orbital Strike (Bombardment)","text":"<p>Entity Index: 14 (Orbital Bomb)</p> <p>A massive bombardment from an overhead Supply Ship, ordered by whoever is carrying the Uplink. Completely annihilates enemy structures and units in designated sector, leaving allied units unharmed.</p> <p>Warning: Exploding Gun Turrets and Flak Turrets close to allied units will still harm them.</p> <p>Defense: - Orbital Bombs can be targeted and attacked as Pulse Shell, Flak Shell, or any missile type - Can be destroyed\u2014most easily by group of scouts - Flak Turrets can attack falling bombs (but only small number)</p> <p>Performing Orbital Strike: 1. Find target base 2. Select ship for orbital strike 3. Set path to base from selected ship 4. Estimate time for ship to reach base 5. Start countdown by selecting \"Orbital Strike\" in ship orders 6. Have teammates set and defend Sky Pumps in connecting sectors 7. Move ship to pumped sectors 8. Repeat until ship arrives</p>"},{"location":"part-10-reference-files/index.html#other-space-entities","title":"Other Space Entities","text":"Index Name Notes 22 Torpedo Unknown\u2014possibly ship weapon 23 Particle Beam Unknown\u2014possibly ship weapon 24 Space Explosion Visual effect entity"},{"location":"part-10-reference-files/index.html#technical-reference","title":"Technical Reference","text":""},{"location":"part-10-reference-files/index.html#complete-entity-index","title":"Complete Entity Index","text":"<p>All 39 entity types required for BEHAVIOR packet:</p> Index Entity Name Category Documented 0 Tank Manned Unit \u2713 1 Scout Manned Unit \u2713 2 Assault Platform Manned Unit \u2717 3 Bomber Manned Unit \u2717 4 Transport Manned Unit \u2717 5 Flak Shell Weapon Partial 6 Pulse Shell Weapon \u2713 7 Short Missile Weapon \u2717 8 Hunter Weapon \u2713 9 Heavy Missile Weapon \u2717 10 (Unknown) Weapon \u2717 11 Piercer Weapon \u2713 12 Thumper Weapon \u2713 13 Caltrop Weapon \u2713 14 Orbital Bomb Weapon Partial 15 Cruise Missile Weapon \u2717 16 Mortar Shell Weapon \u2717 17 Flare Weapon \u2713 18 Aerial Bomb Weapon \u2717 19 Cargo Box Deployable \u2713 20 Uplink Deployable \u2713 21 Supply Ship Space Unit Partial 22 Torpedo Space Unit \u2717 23 Particle Beam Space Unit \u2717 24 Space Explosion Space Unit \u2717 25 Power Cell Ground Unit \u2713 26 Refuel Pad Ground Unit \u2713 27 Repair Pad Ground Unit \u2713 28 Shield Ground Unit \u2717 29 Flak Turret Ground Unit \u2713 30 Gun Turret Ground Unit \u2713 31 Heavy Missile Silo Ground Unit Partial 32 Missile Launcher Ground Unit \u2713 33 Sky Pump Ground Unit \u2713 34 Portal Ground Unit \u2713 35 Dark Light Ground Unit \u2713 36 Spy Bug Ground Unit \u2717 37 Decoration Ground Unit Partial 38 ILLEGAL Placeholder N/A"},{"location":"part-10-reference-files/index.html#quick-stats-reference","title":"Quick Stats Reference","text":""},{"location":"part-10-reference-files/index.html#manned-units","title":"Manned Units","text":"Unit HP Speed (km/h) Load (MU) Tank 500 201 325 Scout 330 288 136"},{"location":"part-10-reference-files/index.html#structures","title":"Structures","text":"Structure HP Build Time Power Power Cell 700 2:30 Source Repair Pad 1000 4:00 Yes Refuel Pad 600 4:30 Yes Gun Turret 525 4:00 Yes Flak Turret 550 4:00-5:00 Yes Missile Launcher 500 7:00 Yes Sky Pump 300 2:45 No Dark Light 250 8:00 No Cargo Box 90 N/A No"},{"location":"part-10-reference-files/index.html#missiles","title":"Missiles","text":"Missile Damage Range (m) Install MU +MU Reload Hunter 200 3000 60 50 1.5s Piercer 108 1200 64 24 2.25s Thumper 41-45 1735 50 30 3.0s Caltrop 50 N/A 69 4 N/A Flare 0 N/A 64 24 2.0s Mine 300 N/A 30 25 1.5s Maser 20/s \u221e 80 N/A N/A"},{"location":"part-10-reference-files/index.html#behavior-packet-format","title":"BEHAVIOR Packet Format","text":"<p>For server implementation, entity core stats are encoded as:</p> Field Size Format Build Time 4 bytes Fixed-point (\u00d765536), big-endian Build Cost 4 bytes Fixed-point (\u00d765536), big-endian Max HP 4 bytes uint32, big-endian <p>Total: 39 entities \u00d7 12 bytes = 468 bytes (fixed size)</p>"},{"location":"part-10-reference-files/index.html#data-quality-notes","title":"Data Quality Notes","text":""},{"location":"part-10-reference-files/index.html#known-discrepancies","title":"Known Discrepancies","text":"Value Issue Flak Turret build time Listed as 4:00, one source says 5:00 Thumper damage Listed as 45 HP, one source says 41 HP Dark Light radius Listed as 150m, 180m, or 210m (tested at 210m) Pulse range Official docs say 1150m, Team Tactical says 1050m"},{"location":"part-10-reference-files/index.html#undocumented-entities","title":"Undocumented Entities","text":"<p>These entities exist in the client binary but have no player-facing documentation:</p> <ul> <li>Manned Units: Assault Platform, Bomber, Transport</li> <li>Weapons: Short Missile, Heavy Missile, Cruise Missile, Mortar Shell, Aerial Bomb</li> <li>Ground Units: Shield, Spy Bug</li> <li>Space Units: Torpedo, Particle Beam</li> </ul> <p>Previous: Part 9: UDP Protocol Next: Part 11: TCP Protocol</p>"},{"location":"part-11-tcp-protocol/index.html","title":"Wulfram 2 Server Implementation Guide","text":""},{"location":"part-11-tcp-protocol/index.html#part-11-tcp-protocol","title":"Part 11: TCP Protocol","text":""},{"location":"part-11-tcp-protocol/index.html#overview","title":"Overview","text":"<p>Wulfram 2 uses TCP for reliable, ordered delivery of critical game data:</p> <ul> <li>Authentication (LOGIN, LOGIN_STATUS)</li> <li>Game state initialization (BEHAVIOR, HELLO handshake)</li> <li>Player/entity management (PLAYER, TANK, BIRTH_NOTICE, DEATH_NOTICE)</li> <li>Chat and communication (COMM_MESSAGE)</li> <li>Squad system (SQUAD packets)</li> <li>World state (UPDATE_ARRAY, WORLD_STATS)</li> </ul> <p>Important: TCP packet type codes exist in a separate namespace from UDP. Type <code>0x13</code> over TCP is HELLO, but over UDP it's GRAPH_DATA. See Part 1 for the complete comparison table.</p>"},{"location":"part-11-tcp-protocol/index.html#tcp-packet-frame-structure","title":"TCP Packet Frame Structure","text":"<p>All TCP packets use this framing:</p> <pre><code>TCP Packet Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TYPE    \u2502   LENGTH     \u2502           PAYLOAD               \u2502\n\u2502 (1 byte) \u2502  (2 bytes)   \u2502         (variable)              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> Field Size Type Description Type 1 uint8 Packet type identifier Length 2 uint16 BE Length of payload (not including type/length) Payload variable bytes Packet-specific data"},{"location":"part-11-tcp-protocol/index.html#complete-tcp-packet-type-reference","title":"Complete TCP Packet Type Reference","text":"<p>Source: Packet analysis by baffler, verified against decompiled client code.</p> Type Name Direction Status <code>0x08</code> ROOT ? \u2713 Verified <code>0x0B</code> PING_REQUEST C\u2192S \u2713 Verified <code>0x0C</code> PING S\u2192C \u2713 Verified <code>0x0D</code> TRANSIENT_ARRAY S\u2192C \u2713 Verified <code>0x0E</code> UPDATE_ARRAY S\u2192C \u2713 Verified <code>0x0F</code> VIEW_UPDATE S\u2192C \u2713 Verified <code>0x10</code> RESENDS S\u2192C \u2713 Verified <code>0x11</code> HUD_MESSAGE S\u2192C \u2713 Verified <code>0x12</code> LAG_FIX S\u2192C \u2713 Verified <code>0x13</code> HELLO Bidirectional \u2713 Verified <code>0x14</code> HIDE_OBJECT S\u2192C \u2713 Verified <code>0x15</code> DELETE_OBJECT S\u2192C \u2713 Verified <code>0x16</code> WORLD_STATS S\u2192C \u2713 Verified <code>0x17</code> PLAYER S\u2192C \u2713 Verified <code>0x18</code> TANK S\u2192C \u2713 Verified <code>0x19</code> TANK_RESEND_REQUEST C\u2192S \u26a0\ufe0f See FUN_00509ac0 <code>0x1A</code> ADD_TO_ROSTER S\u2192C \u2713 Verified <code>0x1B</code> REMOVE_FROM_ROSTER S\u2192C \u2713 Verified <code>0x1C</code> UPDATE_STATS S\u2192C \u2713 Verified <code>0x1D</code> DEATH_NOTICE S\u2192C \u2713 Verified <code>0x1E</code> BIRTH_NOTICE S\u2192C \u2713 Verified <code>0x1F</code> COMM_MESSAGE S\u2192C \u2713 Verified <code>0x20</code> COMM_MESSAGE_REQUEST C\u2192S \u26a0\ufe0f See FUN_00509ac0 <code>0x21</code> LOGIN C\u2192S \u2713 Verified <code>0x22</code> LOGIN_STATUS S\u2192C \u2713 Verified <code>0x23</code> MOTD S\u2192C \u2713 Verified <code>0x24</code> BEHAVIOR S\u2192C \u2713 Verified <code>0x25</code> REINCARNATE C\u2192S \u26a0\ufe0f See FUN_00509ac0 <code>0x26</code> RETARGET C\u2192S \u26a0\ufe0f See FUN_00509ac0 <code>0x27</code> SHIP_STATUS S\u2192C \u2713 Verified <code>0x28</code> TEAM_INFO S\u2192C \u2713 Verified <code>0x29</code> CARRYING_INFO S\u2192C \u2713 Verified <code>0x2A</code> UPLINK_INFO S\u2192C \u2713 Verified <code>0x2B</code> DROP_REQUEST C\u2192S \u26a0\ufe0f See FUN_00509ac0 <code>0x2C</code> SPACEMAP_UPDATE S\u2192C \u2713 Verified <code>0x2D</code> SUPPLY_SHIP_INFO S\u2192C \u2713 Verified <code>0x2E</code> WEAPON_DEMAND C\u2192S \u26a0\ufe0f See FUN_00509ac0 <code>0x2F</code> GAME_CLOCK S\u2192C \u2713 Verified <code>0x30</code> WARP_STATUS S\u2192C \u2713 Verified <code>0x31</code> CONTINUOUS_SOUND S\u2192C \u2713 Verified <code>0x32</code> PROCESS_TRANSLATION S\u2192C \u2713 Verified <code>0x33</code> UNKNOWN S\u2192C \u26a0\ufe0f See FUN_00509ac0 <code>0x34</code> MODEM S\u2192C \u2713 Verified <code>0x35</code> VIEWPOINT_INFO S\u2192C \u26a0\ufe0f See FUN_00509ac0 <code>0x36</code> STRING_VALUE Bidirectional \u2713 Verified <code>0x37</code> VERSION_ERROR S\u2192C \u2713 Verified <code>0x38</code> DOCKING S\u2192C \u2713 Verified <code>0x39</code> WANT_UPDATES C\u2192S \u2713 Verified <code>0x3A</code> BEACON_REQUEST C\u2192S \u26a0\ufe0f See FUN_00509ac0 <code>0x3B</code> BEACON_MODIFY C\u2192S \u26a0\ufe0f See FUN_00509ac0 <code>0x3C</code> UNKNOWN S\u2192C ? Unknown <code>0x3D</code> UNKNOWN S\u2192C ? Unknown <code>0x3E</code> LOAD_STATUS S\u2192C \u2713 Verified <code>0x3F</code> RESET_GAME S\u2192C \u2713 Verified <code>0x40</code> INPUT_FEEDBACK C\u2192S \u26a0\ufe0f See FUN_00509ac0 <code>0x41</code> SHUTDOWN S\u2192C \u2713 Verified <code>0x42</code> SQUAD_CREATE C\u2192S \u26a0\ufe0f See FUN_00509ac0 <code>0x43</code> SQUAD_DEFINITION S\u2192C \u2713 Verified <code>0x44</code> SQUAD_UPDATE S\u2192C \u2713 Verified <code>0x45</code> SQUAD_MEMBERSHIP S\u2192C \u2713 Verified <code>0x46</code> SQUAD_INVITE C\u2192S \u26a0\ufe0f See FUN_00509ac0 <code>0x47</code> SQUAD_OUST C\u2192S \u2713 Verified <code>0x48</code> SQUAD_INFO S\u2192C \u2713 Verified <code>0x49</code> SQUAD_ANSWER_INVITE C\u2192S \u26a0\ufe0f See FUN_00509ac0 <code>0x4A</code> SQUAD_RESULT S\u2192C \u26a0\ufe0f See FUN_00509ac0 <code>0x4B</code> REQUEST_ACCOUNT_HANDLE C\u2192S \u2713 Verified <code>0x4C</code> ROUTING_PING C\u2192S \u2713 Verified <code>0x4D</code> IDENTIFIED_UDP S\u2192C \u2713 Verified <code>0x4E</code> BPS_REQUEST C\u2192S \u2713 Verified <code>0x4F</code> KUDOS C\u2192S \u26a0\ufe0f See FUN_00509ac0 <code>0x50</code> MILTAB S\u2192C \u2713 Verified <code>0x51</code> VOICE_RESP S\u2192C \u2713 Verified <code>0x52</code> LOGIN_INFO S\u2192C \u2713 Verified <code>0x53</code> VIDEO_MSG S\u2192C \u2713 Verified <code>0x54</code> GENERIC C\u2192S \u2713 Verified"},{"location":"part-11-tcp-protocol/index.html#fun_00509ac0-packet-registration-flags","title":"FUN_00509ac0: Packet Registration Flags","text":"<p>Several packets are registered via <code>FUN_00509ac0(type, flags)</code> with a second argument that appears to indicate packet handling characteristics. These packets need further investigation:</p> <pre><code>// From decompiled client (wulfram2_exe.c around line 77085-77100)\nFUN_00509ac0(0x20, 3);  // COMM_MESSAGE_REQUEST\nFUN_00509ac0(0x25, 3);  // REINCARNATE\nFUN_00509ac0(0x26, 1);  // RETARGET\nFUN_00509ac0(0x2b, 1);  // DROP_REQUEST\nFUN_00509ac0(0x2e, 3);  // WEAPON_DEMAND\nFUN_00509ac0(0x35, 1);  // VIEWPOINT_INFO\nFUN_00509ac0(0x3a, 3);  // BEACON_REQUEST\nFUN_00509ac0(0x3b, 3);  // BEACON_MODIFY\nFUN_00509ac0(0x33, 3);  // Unknown (0x33)\nFUN_00509ac0(0x19, 1);  // TANK_RESEND_REQUEST\nFUN_00509ac0(0x40, 0);  // INPUT_FEEDBACK\nFUN_00509ac0(0x42, 3);  // SQUAD_CREATE\nFUN_00509ac0(0x46, 3);  // SQUAD_INVITE\nFUN_00509ac0(0x49, 3);  // SQUAD_ANSWER_INVITE\nFUN_00509ac0(0x4a, 3);  // SQUAD_RESULT\nFUN_00509ac0(0x4f, 3);  // KUDOS\n</code></pre>"},{"location":"part-11-tcp-protocol/index.html#flag-value-analysis","title":"Flag Value Analysis","text":"Flag Packets Suspected Meaning 0 INPUT_FEEDBACK Unknown - possibly no special handling 1 RETARGET, DROP_REQUEST, VIEWPOINT_INFO, TANK_RESEND_REQUEST Unknown - possibly immediate/priority 3 Most others Unknown - possibly queued/buffered <p>TODO: Further reverse engineering of <code>FUN_00509ac0</code> needed to determine what these flags control.</p>"},{"location":"part-11-tcp-protocol/index.html#documented-tcp-packets","title":"Documented TCP Packets","text":"<p>The following TCP packets have detailed documentation:</p> Packet Documentation HELLO (0x13) Part 2: Hello Handshake LOGIN (0x21), LOGIN_STATUS (0x22) Part 3: Login Authentication BEHAVIOR (0x24) Part 4: Behavior Packet TEAM_INFO (0x28) Part 5: Team Info REINCARNATE (0x25) Part 6: Reincarnate UPDATE_ARRAY (0x0E) Part 7: Update Array ADD_TO_ROSTER, BIRTH_NOTICE, UPDATE_STATS Part 8: Structures"},{"location":"part-11-tcp-protocol/index.html#reference-packet-name-lookup-python","title":"Reference: Packet Name Lookup (Python)","text":"<pre><code>def get_tcp_packet_name(type_byte):\n    \"\"\"Get the name of a TCP packet by its type byte\"\"\"\n    names = {\n        0x08: \"ROOT\",\n        0x0B: \"PING_REQUEST\",\n        0x0C: \"PING\",\n        0x0D: \"TRANSIENT_ARRAY\",\n        0x0E: \"UPDATE_ARRAY\",\n        0x0F: \"VIEW_UPDATE\",\n        0x10: \"RESENDS\",\n        0x11: \"HUD_MESSAGE\",\n        0x12: \"LAG_FIX\",\n        0x13: \"HELLO\",\n        0x14: \"HIDE_OBJECT\",\n        0x15: \"DELETE_OBJECT\",\n        0x16: \"WORLD_STATS\",\n        0x17: \"PLAYER\",\n        0x18: \"TANK\",\n        0x19: \"TANK_RESEND_REQUEST\",\n        0x1A: \"ADD_TO_ROSTER\",\n        0x1B: \"REMOVE_FROM_ROSTER\",\n        0x1C: \"UPDATE_STATS\",\n        0x1D: \"DEATH_NOTICE\",\n        0x1E: \"BIRTH_NOTICE\",\n        0x1F: \"COMM_MESSAGE\",\n        0x20: \"COMM_MESSAGE_REQUEST\",\n        0x21: \"LOGIN\",\n        0x22: \"LOGIN_STATUS\",\n        0x23: \"MOTD\",\n        0x24: \"BEHAVIOR\",\n        0x25: \"REINCARNATE\",\n        0x26: \"RETARGET\",\n        0x27: \"SHIP_STATUS\",\n        0x28: \"TEAM_INFO\",\n        0x29: \"CARRYING_INFO\",\n        0x2A: \"UPLINK_INFO\",\n        0x2B: \"DROP_REQUEST\",\n        0x2C: \"SPACEMAP_UPDATE\",\n        0x2D: \"SUPPLY_SHIP_INFO\",\n        0x2E: \"WEAPON_DEMAND\",\n        0x2F: \"GAME_CLOCK\",\n        0x30: \"WARP_STATUS\",\n        0x31: \"CONTINUOUS_SOUND\",\n        0x32: \"PROCESS_TRANSLATION\",\n        0x33: \"UNKNOWN_0x33\",\n        0x34: \"MODEM\",\n        0x35: \"VIEWPOINT_INFO\",\n        0x36: \"STRING_VALUE\",\n        0x37: \"VERSION_ERROR\",\n        0x38: \"DOCKING\",\n        0x39: \"WANT_UPDATES\",\n        0x3A: \"BEACON_REQUEST\",\n        0x3B: \"BEACON_MODIFY\",\n        0x3C: \"UNKNOWN_0x3C\",\n        0x3D: \"UNKNOWN_0x3D\",\n        0x3E: \"LOAD_STATUS\",\n        0x3F: \"RESET_GAME\",\n        0x40: \"INPUT_FEEDBACK\",\n        0x41: \"SHUTDOWN\",\n        0x42: \"SQUAD_CREATE\",\n        0x43: \"SQUAD_DEFINITION\",\n        0x44: \"SQUAD_UPDATE\",\n        0x45: \"SQUAD_MEMBERSHIP\",\n        0x46: \"SQUAD_INVITE\",\n        0x47: \"SQUAD_OUST\",\n        0x48: \"SQUAD_INFO\",\n        0x49: \"SQUAD_ANSWER_INVITE\",\n        0x4A: \"SQUAD_RESULT\",\n        0x4B: \"REQUEST_ACCOUNT_HANDLE\",\n        0x4C: \"ROUTING_PING\",\n        0x4D: \"IDENTIFIED_UDP\",\n        0x4E: \"BPS_REQUEST\",\n        0x4F: \"KUDOS\",\n        0x50: \"MILTAB\",\n        0x51: \"VOICE_RESP\",\n        0x52: \"LOGIN_INFO\",\n        0x53: \"VIDEO_MSG\",\n        0x54: \"GENERIC\",\n    }\n    return names.get(type_byte, f\"UNKNOWN (0x{type_byte:02X})\")\n</code></pre>"},{"location":"part-11-tcp-protocol/index.html#tcp-vs-udp-comparison","title":"TCP vs UDP Comparison","text":"Aspect TCP UDP Packet types 0x08-0x54 0x08-0x14 Frame header Type (1) + Length (2) Type (1) only Reliability Guaranteed delivery Best-effort Use case Critical game state Real-time updates <p>Note: Type <code>0x08</code> exists in both namespaces but means different things: - TCP 0x08 = ROOT - UDP 0x08 = D_ Protocol (D_HANDSHAKE, D_ACK, etc.)</p> <p>Previous: Part 10: Reference Files</p>"},{"location":"part-2-hello-handshake/index.html","title":"Wulfram 2 Server Implementation Guide","text":""},{"location":"part-2-hello-handshake/index.html#part-2-the-hello-handshake","title":"Part 2: The HELLO Handshake","text":""},{"location":"part-2-hello-handshake/index.html#overview","title":"Overview","text":"<p>The HELLO handshake is the first exchange between server and client. When a client connects, the server must send a series of HELLO packets to:</p> <ol> <li>Validate protocol version (REQUIRED - or client shows version error)</li> <li>Provide UDP port info (REQUIRED - for voice/UDP features)</li> <li>Identify the server (OPTIONAL - but recommended)</li> </ol> <pre><code>CLIENT                                    SERVER\n   \u2502                                        \u2502\n   \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 TCP Connection \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n   \u2502                                        \u2502\n   \u2502\u25c4\u2500\u2500\u2500\u2500 HELLO sub=0 (version check) \u2500\u2500\u2500\u2500\u2500\u2500\u2502  REQUIRED\n   \u2502                                        \u2502\n   \u2502\u25c4\u2500\u2500\u2500\u2500 HELLO sub=1 (UDP port info) \u2500\u2500\u2500\u2500\u2500\u2500\u2502  REQUIRED\n   \u2502                                        \u2502\n   \u2502\u25c4\u2500\u2500\u2500\u2500 HELLO sub=2 (server name) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502  OPTIONAL\n   \u2502                                        \u2502\n</code></pre>"},{"location":"part-2-hello-handshake/index.html#packet-type-hello-0x13","title":"Packet Type: HELLO (0x13)","text":"<p>The HELLO packet is a polymorphic packet - its structure changes based on a sub-type byte.</p> <pre><code>HELLO Packet General Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TYPE    \u2502   LENGTH     \u2502 SUB_TYPE  \u2502   SUB_TYPE DATA     \u2502\n\u2502  0x13    \u2502  (2 bytes)   \u2502 (1 byte)  \u2502   (variable)        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-2-hello-handshake/index.html#known-sub-types","title":"Known Sub-Types","text":"Sub-Type Name Direction Purpose 0 Version Check Server \u2192 Client Validate protocol version 1 UDP Info Server \u2192 Client Provide UDP port and interfaces 2 Server Name Server \u2192 Client Identify server name 3 Acknowledgment Client \u2192 Server Keep-alive/acknowledgment"},{"location":"part-2-hello-handshake/index.html#hello-sub-type-0-version-check-required","title":"HELLO Sub-Type 0: Version Check (REQUIRED)","text":"<p>This is the most critical HELLO packet. If you don't send this, or send the wrong version, the client will display a \"Version Mismatch\" error and refuse to continue.</p>"},{"location":"part-2-hello-handshake/index.html#what-the-client-does","title":"What the Client Does","text":"<p>When the client receives HELLO sub-type 0:</p> <pre><code>// From FUN_0046d020 (line 77553-77586 in wulfram2_exe.c)\nif (sub_type == 0) {\n    FUN_00509310(&amp;local_10);  // Read 32-bit version number\n\n    if (local_10 != 0x4e89) {\n        // VERSION MISMATCH!\n        DAT_005dd67c = local_10;    // Store received version\n        DAT_005dd674 = 0x4e89;      // Store expected version\n        DAT_00677f1d = 1;           // Set error flag\n        return;                      // Show error screen\n    }\n    // Version OK, continue...\n}\n</code></pre> <p>The magic number 0x4E89 (decimal 20105) is hardcoded in the client. You MUST send this exact value.</p>"},{"location":"part-2-hello-handshake/index.html#packet-structure","title":"Packet Structure","text":"<pre><code>HELLO Sub-Type 0 Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TYPE    \u2502   LENGTH     \u2502 SUB_TYPE  \u2502   VERSION (uint32 BE)   \u2502\n\u2502  0x13    \u2502   00 05      \u2502   0x00    \u2502   00 00 4E 89           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n   1 byte     2 bytes       1 byte         4 bytes\n\nTotal: 8 bytes on wire\n</code></pre>"},{"location":"part-2-hello-handshake/index.html#byte-by-byte-breakdown","title":"Byte-by-Byte Breakdown","text":"<pre><code>Hex: 13 00 05 00 00 00 4E 89\n\nPosition:  0  1  2  3  4  5  6  7\n           \u2502  \u2502  \u2502  \u2502  \u2502  \u2502  \u2502  \u2502\n           \u2502  \u2502  \u2502  \u2502  \u2514\u2500\u2500\u2534\u2500\u2500\u2534\u2500\u2500\u2534\u2500 Version: 0x00004E89 = 20105\n           \u2502  \u2502  \u2502  \u2514\u2500 Sub-type: 0 (version check)\n           \u2502  \u2514\u2500\u2500\u2534\u2500 Length: 0x0005 = 5 bytes\n           \u2514\u2500 Type: 0x13 (HELLO)\n</code></pre>"},{"location":"part-2-hello-handshake/index.html#python-implementation","title":"Python Implementation","text":"<pre><code>import struct\n\ndef create_hello_version():\n    \"\"\"\n    Create HELLO sub-type 0 packet (version check)\n\n    The client expects version 0x4E89. Any other value\n    triggers a \"Version Mismatch\" error screen.\n    \"\"\"\n    PROTOCOL_VERSION = 0x4E89\n\n    # Build payload: sub_type (1 byte) + version (4 bytes BE)\n    payload = bytes([0x00])  # Sub-type 0\n    payload += struct.pack('&gt;I', PROTOCOL_VERSION)  # Version as big-endian uint32\n\n    # Build complete packet: type + length + payload\n    packet_type = bytes([0x13])  # HELLO\n    length = struct.pack('&gt;H', len(payload))  # Length as big-endian uint16\n\n    return packet_type + length + payload\n\n# Result: b'\\x13\\x00\\x05\\x00\\x00\\x00\\x4e\\x89'\n</code></pre>"},{"location":"part-2-hello-handshake/index.html#verification","title":"Verification","text":"<pre><code>Expected output: 13 00 05 00 00 00 4E 89\n                 \u2502  \u2514\u2500\u2500\u252c\u2500\u2500\u2518 \u2502  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\n                 \u2502     \u2502    \u2502       \u2502\n                 \u2502     \u2502    \u2502       \u2514\u2500 0x4E89 = 20105 (version)\n                 \u2502     \u2502    \u2514\u2500 Sub-type 0\n                 \u2502     \u2514\u2500 Length = 5\n                 \u2514\u2500 Type 0x13 (HELLO)\n</code></pre>"},{"location":"part-2-hello-handshake/index.html#hello-sub-type-1-udp-port-information-required","title":"HELLO Sub-Type 1: UDP Port Information (REQUIRED)","text":"<p>This packet tells the client which UDP port to use for voice chat and other UDP-based features.</p>"},{"location":"part-2-hello-handshake/index.html#what-the-client-does_1","title":"What the Client Does","text":"<pre><code>// From FUN_0046d020 (line 77557-77570)\nelse if (iVar2 == 1) {\n    FUN_005092f0(&amp;local_c);     // Read 16-bit UDP port\n    FUN_005092f0(&amp;local_14);    // Read 16-bit interface count\n    pvVar1 = _malloc((local_14 &amp; 0xffff) * 4 + 4);\n    pvVar3 = pvVar1;\n    if ((short)local_14 != 0) {\n        do {\n            FUN_00509340(pvVar3);   // Read LENGTH-PREFIXED string!\n            iVar4 = iVar4 + 1;\n            pvVar3 = (void *)((int)pvVar3 + 4);\n        } while (iVar4 &lt; (int)(local_14 &amp; 0xffff));\n    }\n}\n</code></pre> <p>IMPORTANT: Interface strings use FUN_00509340, which reads length-prefixed strings (16-bit length + data including null terminator), NOT simple null-terminated strings!</p>"},{"location":"part-2-hello-handshake/index.html#packet-structure_1","title":"Packet Structure","text":"<pre><code>HELLO Sub-Type 1 Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TYPE    \u2502   LENGTH     \u2502 SUB_TYPE  \u2502 UDP_PORT   \u2502 IFACE_COUNT \u2502 INTERFACE_STRINGS  \u2502\n\u2502  0x13    \u2502  (2 bytes)   \u2502   0x01    \u2502 (2 bytes)  \u2502 (2 bytes)   \u2502 (len-prefixed each)\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Each interface string is encoded as: <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  STRING_LENGTH  \u2502  STRING DATA (with \\0)       \u2502\n\u2502  (2 bytes BE)   \u2502  (LENGTH bytes)              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre></p>"},{"location":"part-2-hello-handshake/index.html#example-server-on-port-2627-with-one-interface-127001","title":"Example: Server on port 2627 with one interface (127.0.0.1)","text":"<pre><code>Building the payload:\n\u251c\u2500 Sub-type:        01                              (1 byte)\n\u251c\u2500 UDP Port:        0A 43                           (2627 as big-endian uint16)\n\u251c\u2500 Interface count: 00 01                           (1 interface)\n\u2514\u2500 Interface #1:    00 0A 31 32 37 2E 30 2E 30 2E 31 00\n                    \u2500\u2500\u2500\u2500\u2500 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n                      \u2502              \u2502\n                      \u2502              \u2514\u2500 \"127.0.0.1\\0\" (10 bytes)\n                      \u2514\u2500 Length: 10 (0x000A)\n\nPayload bytes: 01 0A 43 00 01 00 0A 31 32 37 2E 30 2E 30 2E 31 00\n               \u2500\u2500 \u2500\u2500\u2500\u2500\u2500 \u2500\u2500\u2500\u2500\u2500 \u2500\u2500\u2500\u2500\u2500 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n               \u2502    \u2502     \u2502     \u2502              \u2502\n               \u2502    \u2502     \u2502     \u2502              \u2514\u2500 \"127.0.0.1\" + null (10 bytes)\n               \u2502    \u2502     \u2502     \u2514\u2500 String length: 10\n               \u2502    \u2502     \u2514\u2500 Count: 1 interface\n               \u2502    \u2514\u2500 Port: 2627 (0x0A43)\n               \u2514\u2500 Sub-type: 1\n\nPayload length: 1 + 2 + 2 + 2 + 10 = 17 bytes\n</code></pre>"},{"location":"part-2-hello-handshake/index.html#complete-packet","title":"Complete Packet","text":"<pre><code>Hex: 13 00 11 01 0A 43 00 01 00 0A 31 32 37 2E 30 2E 30 2E 31 00\n\n     13           - Type: HELLO\n     00 11        - Length: 17 bytes (0x0011)\n     01           - Sub-type: 1 (UDP info)\n     0A 43        - UDP Port: 2627\n     00 01        - Interface count: 1\n     00 0A        - String length: 10 bytes\n     31 32 37 2E 30 2E 30 2E 31 00 - \"127.0.0.1\\0\"\n\nTotal: 20 bytes on wire\n</code></pre> <p>Note: After processing sub-type 1, the client may send back a HELLO  sub-type 0 packet containing the version number. This is normal client  behavior and can be logged but doesn't require a response.</p>"},{"location":"part-2-hello-handshake/index.html#python-implementation_1","title":"Python Implementation","text":"<pre><code>def encode_string(text):\n    \"\"\"\n    Encode a string for Wulfram 2 protocol.\n    Format: [length:2 bytes BE][string data with null terminator]\n    \"\"\"\n    string_bytes = text.encode('utf-8') + b'\\x00'\n    length = struct.pack('&gt;H', len(string_bytes))\n    return length + string_bytes\n\ndef create_hello_udp_info(udp_port=2627, interfaces=None):\n    \"\"\"\n    Create HELLO sub-type 1 packet (UDP port information)\n\n    Args:\n        udp_port: The UDP port for voice/real-time features\n        interfaces: List of IP address strings (default: [\"127.0.0.1\"])\n    \"\"\"\n    if interfaces is None:\n        interfaces = [\"127.0.0.1\"]\n\n    # Build payload\n    payload = bytes([0x01])  # Sub-type 1\n    payload += struct.pack('&gt;H', udp_port)  # Port as big-endian uint16\n    payload += struct.pack('&gt;H', len(interfaces))  # Count as big-endian uint16\n\n    # Add each interface string (LENGTH-PREFIXED, not just null-terminated!)\n    for interface in interfaces:\n        payload += encode_string(interface)\n\n    # Build complete packet\n    packet_type = bytes([0x13])\n    length = struct.pack('&gt;H', len(payload))\n\n    return packet_type + length + payload\n\n# Example output for port 2627, interface \"127.0.0.1\":\n# b'\\x13\\x00\\x11\\x01\\x0a\\x43\\x00\\x01\\x00\\x0a127.0.0.1\\x00'\n#                              \u2500\u2500\u2500\u2500\u2500\n#                                \u2502\n#                                \u2514\u2500 Length prefix (was missing in v4!)\n</code></pre>"},{"location":"part-2-hello-handshake/index.html#multiple-interfaces-example","title":"Multiple Interfaces Example","text":"<p>If your server has multiple network interfaces:</p> <pre><code>packet = create_hello_udp_info(2627, [\"192.168.1.100\", \"10.0.0.1\"])\n\n# Payload breakdown:\n# 01                    - Sub-type 1\n# 0A 43                 - Port 2627\n# 00 02                 - 2 interfaces\n# 00 0E                 - First string length: 14\n# 31 39 32 2E 31 36 38 2E 31 2E 31 30 30 00  - \"192.168.1.100\\0\"\n# 00 0A                 - Second string length: 10\n# 31 30 2E 30 2E 30 2E 31 00                 - \"10.0.0.1\\0\"\n</code></pre>"},{"location":"part-2-hello-handshake/index.html#hello-sub-type-2-server-name-optional","title":"HELLO Sub-Type 2: Server Name (OPTIONAL)","text":"<p>This packet identifies your server to the client. While not required for the connection to work, it's good practice to send it.</p>"},{"location":"part-2-hello-handshake/index.html#what-the-client-does_2","title":"What the Client Does","text":"<pre><code>// From FUN_0046d020 (line 77572-77573)\nelse if (iVar2 == 2) {\n    FUN_00509340(&amp;local_8);  // Read LENGTH-PREFIXED string!\n}\n</code></pre> <p>IMPORTANT: The server name uses FUN_00509340, which reads a length-prefixed string, NOT a simple null-terminated string!</p>"},{"location":"part-2-hello-handshake/index.html#packet-structure_2","title":"Packet Structure","text":"<pre><code>HELLO Sub-Type 2 Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TYPE    \u2502   LENGTH     \u2502 SUB_TYPE  \u2502 NAME_LENGTH \u2502 SERVER_NAME (with \\0)   \u2502\n\u2502  0x13    \u2502  (2 bytes)   \u2502   0x02    \u2502 (2 bytes)   \u2502 \"My Server\\0\"           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-2-hello-handshake/index.html#example-server-named-wulfram2-dev-server","title":"Example: Server named \"Wulfram2 Dev Server\"","text":"<pre><code>Building the payload:\n\u251c\u2500 Sub-type:     02                                        (1 byte)\n\u251c\u2500 Name length:  00 14                                     (20 bytes = 19 chars + null)\n\u2514\u2500 Server name:  57 75 6C 66 72 61 6D 32 20 44 65 76 20 53 65 72 76 65 72 00\n                 W  u  l  f  r  a  m  2     D  e  v     S  e  r  v  e  r  \\0\n\nPayload length: 1 + 2 + 20 = 23 bytes\n</code></pre>"},{"location":"part-2-hello-handshake/index.html#complete-packet_1","title":"Complete Packet","text":"<pre><code>Hex: 13 00 17 02 00 14 57 75 6C 66 72 61 6D 32 20 44 65 76 20 53 65 72 76 65 72 00\n\n     13           - Type: HELLO\n     00 17        - Length: 23 bytes (0x0017)\n     02           - Sub-type: 2 (server name)\n     00 14        - String length: 20 bytes\n     57 75 6C ... - \"Wulfram2 Dev Server\\0\" (20 bytes)\n\nTotal: 26 bytes on wire\n</code></pre>"},{"location":"part-2-hello-handshake/index.html#python-implementation_2","title":"Python Implementation","text":"<pre><code>def create_hello_server_name(server_name=\"Wulfram2 Server\"):\n    \"\"\"\n    Create HELLO sub-type 2 packet (server name)\n\n    Args:\n        server_name: Human-readable server name string\n    \"\"\"\n    # Build payload\n    payload = bytes([0x02])  # Sub-type 2\n    payload += encode_string(server_name)  # LENGTH-PREFIXED string!\n\n    # Build complete packet\n    packet_type = bytes([0x13])\n    length = struct.pack('&gt;H', len(payload))\n\n    return packet_type + length + payload\n\n# Example output for \"Test Server\":\n# b'\\x13\\x00\\x0f\\x02\\x00\\x0cTest Server\\x00'\n#                  \u2500\u2500\u2500\u2500\u2500\n#                    \u2502\n#                    \u2514\u2500 Length prefix: 12 (11 chars + null)\n</code></pre>"},{"location":"part-2-hello-handshake/index.html#hello-sub-type-3-acknowledgment-client-server","title":"HELLO Sub-Type 3: Acknowledgment (Client \u2192 Server)","text":"<p>This sub-type is sent by the client to the server, typically as a keep-alive or acknowledgment signal. The server should be prepared to receive this but doesn't need to send it.</p>"},{"location":"part-2-hello-handshake/index.html#what-the-client-sends","title":"What the Client Sends","text":"<pre><code>// From FUN_0046d020 (line 77599-77600)\ncase 3:\n    FUN_0046b750();  // Triggers acknowledgment handling\n</code></pre> <p>The sub-type 3 packet contains no additional data beyond the sub-type byte itself.</p>"},{"location":"part-2-hello-handshake/index.html#packet-structure_3","title":"Packet Structure","text":"<pre><code>HELLO Sub-Type 3 Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TYPE    \u2502   LENGTH     \u2502 SUB_TYPE  \u2502\n\u2502  0x13    \u2502   00 01      \u2502   0x03    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n   1 byte     2 bytes       1 byte\n\nTotal: 4 bytes on wire\n</code></pre>"},{"location":"part-2-hello-handshake/index.html#server-handling","title":"Server Handling","text":"<p>When your server receives a HELLO sub-type 3 packet, you can safely acknowledge it or ignore it. It's primarily used by the client to signal it's ready or as a keep-alive mechanism.</p> <pre><code>def handle_hello_subtype_3():\n    \"\"\"\n    Handle HELLO sub-type 3 (acknowledgment from client)\n\n    This packet has no payload beyond the sub-type byte.\n    The server can acknowledge or simply ignore it.\n    \"\"\"\n    # Log for debugging\n    print(\"Received HELLO acknowledgment from client\")\n    # No response required\n</code></pre>"},{"location":"part-2-hello-handshake/index.html#complete-hello-handshake-implementation","title":"Complete HELLO Handshake Implementation","text":"<p>Here's how to send all HELLO packets when a client connects:</p> <pre><code>import socket\nimport struct\n\ndef encode_string(text):\n    \"\"\"Encode a length-prefixed, null-terminated string\"\"\"\n    string_bytes = text.encode('utf-8') + b'\\x00'\n    return struct.pack('&gt;H', len(string_bytes)) + string_bytes\n\ndef make_packet(packet_type, payload):\n    \"\"\"Wrap payload in a complete packet frame\"\"\"\n    return bytes([packet_type]) + struct.pack('&gt;H', len(payload)) + payload\n\nclass Wulfram2Server:\n    PROTOCOL_VERSION = 0x4E89\n    PACKET_HELLO = 0x13\n\n    def __init__(self, host='0.0.0.0', port=2627):\n        self.host = host\n        self.port = port\n\n    def send_packet(self, conn, data):\n        \"\"\"Send raw packet data to client\"\"\"\n        conn.send(data)\n        print(f\"TX: {data.hex(' ')}\")\n\n    def send_hello_handshake(self, conn):\n        \"\"\"\n        Send the complete HELLO handshake sequence.\n        This must be the FIRST thing sent after TCP connection.\n        \"\"\"\n\n        # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        # HELLO Sub-type 0: Version Check (REQUIRED)\n        # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        # Client will show \"Version Mismatch\" error if this is wrong\n        payload = bytes([0x00])  # Sub-type: 0\n        payload += struct.pack('&gt;I', self.PROTOCOL_VERSION)  # Version: 0x4E89\n\n        hello_version = make_packet(self.PACKET_HELLO, payload)\n        self.send_packet(conn, hello_version)\n        # Expected: 13 00 05 00 00 00 4E 89\n\n        # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        # HELLO Sub-type 1: UDP Port Info (REQUIRED)\n        # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        payload = bytes([0x01])  # Sub-type: 1\n        payload += struct.pack('&gt;H', self.port)  # UDP port\n        payload += struct.pack('&gt;H', 1)  # Interface count: 1\n        payload += encode_string(\"127.0.0.1\")  # Length-prefixed interface string\n\n        hello_udp = make_packet(self.PACKET_HELLO, payload)\n        self.send_packet(conn, hello_udp)\n        # Expected: 13 00 11 01 0A 43 00 01 00 0A 31 32 37 2E 30 2E 30 2E 31 00\n\n        # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        # HELLO Sub-type 2: Server Name (OPTIONAL but recommended)\n        # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        payload = bytes([0x02])  # Sub-type: 2\n        payload += encode_string(\"Wulfram2 Dev Server\")  # Length-prefixed server name\n\n        hello_name = make_packet(self.PACKET_HELLO, payload)\n        self.send_packet(conn, hello_name)\n        # Expected: 13 00 17 02 00 14 57 75 6C 66 72 61 6D 32 20 44 65 76 ...\n\n        print(\"HELLO handshake complete!\")\n</code></pre>"},{"location":"part-2-hello-handshake/index.html#expected-wire-output","title":"Expected Wire Output","text":"<p>After the HELLO handshake, your server should have sent exactly these bytes:</p> <pre><code>Packet 1 - HELLO Version (8 bytes):\n13 00 05 00 00 00 4E 89\n\nBreakdown:\n  13       = Type: HELLO\n  00 05    = Length: 5 bytes\n  00       = Sub-type: 0 (version)\n  00 00 4E 89 = Version: 0x4E89\n\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nPacket 2 - HELLO UDP Info (20 bytes for \"127.0.0.1\"):\n13 00 11 01 0A 43 00 01 00 0A 31 32 37 2E 30 2E 30 2E 31 00\n\nBreakdown:\n  13       = Type: HELLO\n  00 11    = Length: 17 bytes\n  01       = Sub-type: 1 (UDP info)\n  0A 43    = Port: 2627\n  00 01    = Interface count: 1\n  00 0A    = String length: 10\n  31 32 37 2E 30 2E 30 2E 31 00 = \"127.0.0.1\\0\"\n\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nPacket 3 - HELLO Server Name (26 bytes for \"Wulfram2 Dev Server\"):\n13 00 17 02 00 14 57 75 6C 66 72 61 6D 32 20 44 65 76 20 53 65 72 76 65 72 00\n\nBreakdown:\n  13       = Type: HELLO\n  00 17    = Length: 23 bytes\n  02       = Sub-type: 2 (server name)\n  00 14    = String length: 20\n  57 75 6C ... 00 = \"Wulfram2 Dev Server\\0\"\n</code></pre>"},{"location":"part-2-hello-handshake/index.html#quick-reference-hello-packet-sizes","title":"Quick Reference: HELLO Packet Sizes","text":"Sub-Type Description Payload Formula Example Size 0 Version 1 + 4 = 5 bytes 8 bytes total 1 UDP Info 1 + 2 + 2 + \u03a3(2 + len(iface)+1) 20 bytes (1 interface) 2 Server Name 1 + 2 + len(name) + 1 26 bytes (\"Wulfram2 Dev Server\") 3 Ack (client\u2192server) 1 byte 4 bytes total"},{"location":"part-2-hello-handshake/index.html#troubleshooting","title":"Troubleshooting","text":""},{"location":"part-2-hello-handshake/index.html#problem-client-shows-version-mismatch-error","title":"Problem: Client Shows \"Version Mismatch\" Error","text":"<p>Cause: You sent the wrong version number, or forgot to send HELLO sub-type 0.</p> <p>Solution: Ensure you're sending exactly <code>00 00 4E 89</code> as the version bytes.</p> <pre><code>WRONG: 13 00 05 00 89 4E 00 00   \u2190 Little-endian (reversed)\nRIGHT: 13 00 05 00 00 00 4E 89   \u2190 Big-endian (correct)\n</code></pre>"},{"location":"part-2-hello-handshake/index.html#problem-client-connects-but-nothing-happens","title":"Problem: Client Connects But Nothing Happens","text":"<p>Cause: You didn't send any HELLO packets.</p> <p>Solution: The server must initiate by sending HELLO packets. The client waits for them.</p>"},{"location":"part-2-hello-handshake/index.html#problem-client-crashes-or-disconnects-after-hello","title":"Problem: Client Crashes or Disconnects After HELLO","text":"<p>Cause: Strings are missing length prefixes.</p> <p>Solution: All strings in HELLO packets (interface addresses, server name) must be length-prefixed:</p> <pre><code>WRONG: 01 0A 43 00 01 31 32 37 2E 30 2E 30 2E 31 00\n                     \u2191\n                     Missing length prefix!\n\nRIGHT: 01 0A 43 00 01 00 0A 31 32 37 2E 30 2E 30 2E 31 00\n                     \u2500\u2500\u2500\u2500\u2500\n                       \u2191\n                       Length prefix (10 bytes)\n</code></pre>"},{"location":"part-2-hello-handshake/index.html#problem-udp-features-dont-work","title":"Problem: UDP Features Don't Work","text":"<p>Cause: HELLO sub-type 1 not sent or has invalid port/interface.</p> <p>Solution: Make sure you're sending a valid port number and at least one properly-encoded interface string.</p>"},{"location":"part-2-hello-handshake/index.html#common-mistakes","title":"Common Mistakes","text":"Mistake Symptom Fix Missing length prefix on strings Client crash/disconnect Use <code>encode_string()</code> for all strings Wrong byte order for version \"Version Mismatch\" error Use big-endian (<code>&gt;I</code>) Forgetting null terminator String parsing errors Include <code>\\x00</code> in string data Wrong payload length Packet parsing fails Recalculate after adding length prefixes Not sending sub-type 0 first Client hangs Always send version check first"},{"location":"part-2-hello-handshake/index.html#whats-next","title":"What's Next?","text":"<p>After the HELLO handshake, the client will send a LOGIN packet with credentials. In Part 3, we'll handle the LOGIN/LOGIN_STATUS exchange to authenticate the player.</p> <p>Previous: Part 1: Introduction Next: Part 3: Login Authentication</p>"},{"location":"part-3-login-authentication/index.html","title":"Wulfram 2 Server Implementation Guide","text":""},{"location":"part-3-login-authentication/index.html#part-3-login-authentication","title":"Part 3: Login Authentication","text":""},{"location":"part-3-login-authentication/index.html#overview","title":"Overview","text":"<p>After the HELLO handshake, the client sends a LOGIN packet with the player's credentials. Your server must respond with LOGIN_STATUS to either accept or reject the login.</p> <pre><code>CLIENT                                    SERVER\n   \u2502                                        \u2502\n   \u2502  (HELLO handshake completed)           \u2502\n   \u2502                                        \u2502\n   \u2502\u2500\u2500\u2500\u2500\u2500 LOGIN (username/password) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n   \u2502                                        \u2502\n   \u2502\u25c4\u2500\u2500\u2500\u2500 LOGIN_STATUS (success/fail) \u2500\u2500\u2500\u2500\u2500\u2500\u2502\n   \u2502                                        \u2502\n   \u2502  If successful, client expects         \u2502\n   \u2502  BEHAVIOR and TEAM_INFO next...        \u2502\n   \u2502                                        \u2502\n</code></pre>"},{"location":"part-3-login-authentication/index.html#receiving-the-login-packet-0x21","title":"Receiving the LOGIN Packet (0x21)","text":"<p>When the client sends LOGIN, you'll receive a packet containing credentials.</p>"},{"location":"part-3-login-authentication/index.html#what-the-client-sends","title":"What the Client Sends","text":"<p>From the decompiled code (FUN_0046cea0, lines 77470-77472):</p> <pre><code>thunk_FUN_00509440(in_EAX);   // Write 8-bit sub-type\nFUN_00509600(param_2);         // Write username - LENGTH-PREFIXED string!\nFUN_00509600(param_3);         // Write password - LENGTH-PREFIXED string!\n</code></pre> <p>IMPORTANT: Username and password are length-prefixed strings, NOT simple null-terminated strings!</p>"},{"location":"part-3-login-authentication/index.html#login-packet-structure","title":"LOGIN Packet Structure","text":"<pre><code>LOGIN (0x21) Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TYPE    \u2502   LENGTH     \u2502 SUB_TYPE  \u2502    USERNAME      \u2502    PASSWORD      \u2502  (extra)   \u2502\n\u2502  0x21    \u2502  (2 bytes)   \u2502 (1 byte)  \u2502 (len-prefixed)   \u2502 (len-prefixed)   \u2502  varies    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Each string is encoded as: <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  STRING_LENGTH  \u2502  STRING DATA (with \\0)       \u2502\n\u2502  (2 bytes BE)   \u2502  (LENGTH bytes)              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre></p>"},{"location":"part-3-login-authentication/index.html#sub-types","title":"Sub-Types","text":"Sub-Type Meaning Additional Data 0x00 Normal login Just username/password 0x02, 0x03, 0x04 Game service login Extra: count (32-bit) + N strings + final string"},{"location":"part-3-login-authentication/index.html#example-player-root-logging-in-with-password-secret123","title":"Example: Player \"ROOT\" logging in with password \"secret123\"","text":"<pre><code>Building the packet:\n\u251c\u2500 Type:            21                              (1 byte)\n\u251c\u2500 Length:          00 14                           (20 bytes payload)\n\u251c\u2500 Sub-type:        00                              (1 byte - normal login)\n\u251c\u2500 Username length: 00 05                           (5 bytes = \"ROOT\" + null)\n\u251c\u2500 Username data:   52 4F 4F 54 00                  (\"ROOT\\0\")\n\u251c\u2500 Password length: 00 0A                           (10 bytes = \"secret123\" + null)\n\u2514\u2500 Password data:   73 65 63 72 65 74 31 32 33 00   (\"secret123\\0\")\n\nComplete packet:\n21 00 14 00 00 05 52 4F 4F 54 00 00 0A 73 65 63 72 65 74 31 32 33 00\n\u2500\u2500 \u2500\u2500\u2500\u2500\u2500 \u2500\u2500 \u2500\u2500\u2500\u2500\u2500 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u2500\u2500\u2500\u2500\u2500 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\u2502    \u2502   \u2502    \u2502         \u2502           \u2502              \u2502\n\u2502    \u2502   \u2502    \u2502         \u2502           \u2502              \u2514\u2500 \"secret123\\0\" (10 bytes)\n\u2502    \u2502   \u2502    \u2502         \u2502           \u2514\u2500 Password length: 10\n\u2502    \u2502   \u2502    \u2502         \u2514\u2500 \"ROOT\\0\" (5 bytes)\n\u2502    \u2502   \u2502    \u2514\u2500 Username length: 5\n\u2502    \u2502   \u2514\u2500 Sub-type: 0 (normal login)\n\u2502    \u2514\u2500 Payload length: 20 bytes (0x0014)\n\u2514\u2500 Type: 0x21 (LOGIN)\n\nTotal: 23 bytes on wire\n</code></pre>"},{"location":"part-3-login-authentication/index.html#python-parsing-login-packet","title":"Python: Parsing LOGIN Packet","text":"<pre><code>import struct\n\ndef decode_string(data, offset):\n    \"\"\"\n    Decode a length-prefixed string from Wulfram 2 protocol.\n    Returns (string, new_offset)\n    \"\"\"\n    length = struct.unpack('&gt;H', data[offset:offset+2])[0]\n    string_data = data[offset+2:offset+2+length]\n    # Remove null terminator for Python string\n    text = string_data.rstrip(b'\\x00').decode('utf-8')\n    return text, offset + 2 + length\n\ndef parse_login_packet(data):\n    \"\"\"\n    Parse a LOGIN packet received from the client.\n\n    Args:\n        data: Raw packet bytes (including type and length)\n\n    Returns:\n        dict with 'sub_type', 'username', 'password', and optionally 'extra_data'\n    \"\"\"\n    # Verify packet type\n    if data[0] != 0x21:\n        raise ValueError(f\"Not a LOGIN packet: 0x{data[0]:02x}\")\n\n    # Read length (big-endian)\n    payload_length = struct.unpack('&gt;H', data[1:3])[0]\n\n    # Get payload\n    payload = data[3:3+payload_length]\n\n    # Parse sub-type (1 byte)\n    sub_type = payload[0]\n    offset = 1\n\n    # Parse username (length-prefixed string)\n    username, offset = decode_string(payload, offset)\n\n    # Parse password (length-prefixed string)\n    password, offset = decode_string(payload, offset)\n\n    result = {\n        'sub_type': sub_type,\n        'username': username,\n        'password': password\n    }\n\n    # For sub-types 2, 3, 4: parse additional game service data\n    if sub_type in (0x02, 0x03, 0x04) and offset &lt; len(payload):\n        extra_count = struct.unpack('&gt;I', payload[offset:offset+4])[0]\n        offset += 4\n\n        extra_strings = []\n        for _ in range(extra_count):\n            s, offset = decode_string(payload, offset)\n            extra_strings.append(s)\n\n        # One more string at the end\n        final_string, offset = decode_string(payload, offset)\n\n        result['extra_strings'] = extra_strings\n        result['final_string'] = final_string\n\n    return result\n\n# Example usage:\n# data = bytes.fromhex('21001400000552 4F 4F 5400000A736563726574313233 00')\n# result = parse_login_packet(data)\n# print(result)  # {'sub_type': 0, 'username': 'ROOT', 'password': 'secret123'}\n</code></pre>"},{"location":"part-3-login-authentication/index.html#sending-login_status-0x22","title":"Sending LOGIN_STATUS (0x22)","text":"<p>After receiving LOGIN, you must respond with LOGIN_STATUS to tell the client whether login succeeded.</p>"},{"location":"part-3-login-authentication/index.html#what-the-client-expects","title":"What the Client Expects","text":"<p>From the decompiled code (FUN_0046db40, lines 77927-77935):</p> <pre><code>void FUN_0046db40(param_1, param_2, param_3) {\n    FUN_00509db0(\"LOGIN_STATUS\", param_3);\n    FUN_005092e0(&amp;local_5);    // Read 8-bit flag\n    FUN_005092e0(&amp;local_4);    // Read 8-bit status\n    FUN_00509dc0(param_3, param_2);\n\n    FUN_004617f0(local_4);     // Process status code\n\n    if ((char)local_4 == '\\b') {   // Status == 8\n        DAT_0067916b = local_5 == '\\x01';  // Store flag\n        DAT_0067916c = DAT_0067916b;\n    }\n}\n</code></pre>"},{"location":"part-3-login-authentication/index.html#login_status-packet-structure","title":"LOGIN_STATUS Packet Structure","text":"<pre><code>LOGIN_STATUS (0x22) Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TYPE    \u2502   LENGTH     \u2502   FLAG    \u2502   STATUS      \u2502\n\u2502  0x22    \u2502   00 02      \u2502 (1 byte)  \u2502   (1 byte)    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n   1 byte     2 bytes        1 byte       1 byte\n\nTotal: 5 bytes on wire\n</code></pre>"},{"location":"part-3-login-authentication/index.html#status-codes","title":"Status Codes","text":"<p>From FUN_004617f0 (lines 69909-69961):</p> Status Hex Client Action Description 1 0x01 Shows password prompt Existing user - \"Enter your password for this handle\" 2 0x02 Re-sends LOGIN with sub-type 3 Game service continuation 3 0x03 Shows new password prompt New account - \"This is a new handle. Supply a password\" 4 0x04 Proceeds to game Direct game entry (similar to 8) 5 0x05 Shows handle prompt Login cleanup - \"Welcome to/back to Wulfram!\" 6 0x06 Shows handle prompt Login cleanup - \"Welcome to/back to Wulfram!\" 7 0x07 Shows handle prompt Login cleanup - \"Welcome to/back to Wulfram!\" 8 0x08 Proceeds to team select SUCCESS - Login accepted! Other - Shows error message \"XXX not handling some login_status return code XXX\" <p>The magic status code is 8 (0x08). This tells the client that login was successful and it should proceed to the team selection screen.</p>"},{"location":"part-3-login-authentication/index.html#flag-byte","title":"Flag Byte","text":"<p>The flag byte (first byte of payload) is stored in <code>DAT_0067916b</code> when status=8.  - Set to <code>0x01</code> for a normal successful login - The exact meaning depends on server implementation, but <code>0x01</code> is standard</p>"},{"location":"part-3-login-authentication/index.html#example-successful-login-response","title":"Example: Successful Login Response","text":"<pre><code>Building LOGIN_STATUS for successful login:\n\nHex: 22 00 02 01 08\n     \u2500\u2500 \u2500\u2500\u2500\u2500\u2500 \u2500\u2500 \u2500\u2500\n     \u2502    \u2502   \u2502  \u2502\n     \u2502    \u2502   \u2502  \u2514\u2500 Status: 8 (SUCCESS!)\n     \u2502    \u2502   \u2514\u2500 Flag: 1 (normal)\n     \u2502    \u2514\u2500 Length: 2 bytes\n     \u2514\u2500 Type: 0x22 (LOGIN_STATUS)\n\nTotal: 5 bytes on wire\n</code></pre>"},{"location":"part-3-login-authentication/index.html#python-implementation","title":"Python Implementation","text":"<pre><code>def create_login_status(status=0x08, flag=0x01):\n    \"\"\"\n    Create a LOGIN_STATUS response packet.\n\n    Args:\n        status: Status code (default 0x08 for success)\n        flag: Flag byte (default 0x01 for normal)\n\n    Returns:\n        Complete packet bytes\n\n    Status codes:\n        1 = Existing user, prompt for password\n        2 = Continue login flow (game service)\n        3 = New account, prompt for new password\n        4 = Direct game entry\n        5, 6, 7 = Cleanup/restart login\n        8 = SUCCESS - proceed to team select\n    \"\"\"\n    packet_type = bytes([0x22])  # LOGIN_STATUS\n    payload = bytes([flag, status])\n    length = struct.pack('&gt;H', len(payload))\n\n    return packet_type + length + payload\n\n# Successful login:\n# create_login_status(status=0x08, flag=0x01)\n# Returns: b'\\x22\\x00\\x02\\x01\\x08'\n\n# Failed login (restart):\n# create_login_status(status=0x05, flag=0x00)\n# Returns: b'\\x22\\x00\\x02\\x00\\x05'\n</code></pre>"},{"location":"part-3-login-authentication/index.html#complete-login-flow-example","title":"Complete Login Flow Example","text":"<p>Here's the complete server-side implementation of the login exchange:</p> <pre><code>import struct\n\ndef encode_string(text):\n    \"\"\"Encode a length-prefixed, null-terminated string\"\"\"\n    string_bytes = text.encode('utf-8') + b'\\x00'\n    return struct.pack('&gt;H', len(string_bytes)) + string_bytes\n\ndef decode_string(data, offset):\n    \"\"\"Decode a length-prefixed string, returns (string, new_offset)\"\"\"\n    length = struct.unpack('&gt;H', data[offset:offset+2])[0]\n    string_data = data[offset+2:offset+2+length]\n    text = string_data.rstrip(b'\\x00').decode('utf-8')\n    return text, offset + 2 + length\n\ndef make_packet(packet_type, payload):\n    \"\"\"Wrap payload in a complete packet frame\"\"\"\n    return bytes([packet_type]) + struct.pack('&gt;H', len(payload)) + payload\n\nclass Wulfram2Server:\n    PACKET_LOGIN = 0x21\n    PACKET_LOGIN_STATUS = 0x22\n\n    def send_packet(self, conn, data):\n        \"\"\"Send raw packet data to client\"\"\"\n        conn.send(data)\n        print(f\"TX: {data.hex(' ')}\")\n\n    def recv_packet(self, conn):\n        \"\"\"Receive a complete packet from client\"\"\"\n        # Read packet header (type + length)\n        header = conn.recv(3)\n        if len(header) &lt; 3:\n            return None, None, None\n\n        packet_type = header[0]\n        packet_length = struct.unpack('&gt;H', header[1:3])[0]\n\n        # Read payload\n        payload = conn.recv(packet_length)\n        print(f\"RX: {header.hex(' ')} {payload.hex(' ')}\")\n\n        return packet_type, packet_length, payload\n\n    def handle_login(self, conn):\n        \"\"\"\n        Handle the login exchange after HELLO handshake.\n\n        1. Receive LOGIN packet from client\n        2. Validate credentials (or accept all for testing)\n        3. Send LOGIN_STATUS response\n        \"\"\"\n\n        # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        # Step 1: Receive LOGIN packet\n        # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        packet_type, packet_length, payload = self.recv_packet(conn)\n\n        if packet_type is None:\n            print(\"Connection closed before LOGIN\")\n            return False\n\n        # Verify it's a LOGIN packet\n        if packet_type != self.PACKET_LOGIN:\n            print(f\"Expected LOGIN (0x21), got 0x{packet_type:02x}\")\n            return False\n\n        # Parse LOGIN packet\n        sub_type = payload[0]\n        offset = 1\n\n        # Decode username (length-prefixed string)\n        username, offset = decode_string(payload, offset)\n\n        # Decode password (length-prefixed string)\n        password, offset = decode_string(payload, offset)\n\n        print(f\"Login attempt: sub_type={sub_type}, username='{username}', password='{password}'\")\n\n        # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        # Step 2: Validate credentials\n        # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        # For testing, accept all logins\n        # In production, check against your user database\n        login_valid = True  # Accept all for now\n\n        # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        # Step 3: Send LOGIN_STATUS response\n        # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        if login_valid:\n            # SUCCESS! Status = 8\n            payload = bytes([0x01, 0x08])  # Flag=1, Status=8\n            login_status = make_packet(self.PACKET_LOGIN_STATUS, payload)\n\n            self.send_packet(conn, login_status)\n            print(\"Login successful! Sent LOGIN_STATUS with status=8\")\n\n            # Expected bytes sent: 22 00 02 01 08\n            return True\n        else:\n            # FAILURE! Status = 5 (cleanup/restart)\n            payload = bytes([0x00, 0x05])  # Flag=0, Status=5\n            login_status = make_packet(self.PACKET_LOGIN_STATUS, payload)\n\n            self.send_packet(conn, login_status)\n            print(\"Login failed! Sent LOGIN_STATUS with status=5\")\n            return False\n</code></pre>"},{"location":"part-3-login-authentication/index.html#pseudo-example-complete-exchange","title":"Pseudo-Example: Complete Exchange","text":"<p>Let's trace through a complete login exchange:</p> <pre><code>\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\nSTEP 1: Client connects and receives HELLO handshake (see Part 2)\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nSERVER \u2192 CLIENT: 13 00 05 00 00 00 4E 89              (HELLO version)\nSERVER \u2192 CLIENT: 13 00 11 01 0A 43 00 01 00 0A ...   (HELLO UDP)\nSERVER \u2192 CLIENT: 13 00 17 02 00 14 57 75 ...         (HELLO name)\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\nSTEP 2: Client sends LOGIN with credentials\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nCLIENT \u2192 SERVER: 21 00 14 00 00 05 52 4F 4F 54 00 00 0A 73 65 63 72 65 74 31 32 33 00\n                 \u2502  \u2514\u2500\u2500\u252c\u2500\u2500\u2518 \u2502  \u2514\u2500\u2500\u252c\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u252c\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                 \u2502     \u2502    \u2502     \u2502         \u2502         \u2502                 \u2502\n                 \u2502     \u2502    \u2502     \u2502         \u2502         \u2502                 \u2514\u2500 \"secret123\\0\"\n                 \u2502     \u2502    \u2502     \u2502         \u2502         \u2514\u2500 Password length: 10\n                 \u2502     \u2502    \u2502     \u2502         \u2514\u2500 \"ROOT\\0\"\n                 \u2502     \u2502    \u2502     \u2514\u2500 Username length: 5\n                 \u2502     \u2502    \u2514\u2500 Sub-type: 0 (normal login)\n                 \u2502     \u2514\u2500 Length: 20 bytes\n                 \u2514\u2500 Type: 0x21 (LOGIN)\n\nParsed: sub_type=0, username=\"ROOT\", password=\"secret123\"\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\nSTEP 3: Server validates and responds with LOGIN_STATUS\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nServer validates credentials... (accept for testing)\n\nSERVER \u2192 CLIENT: 22 00 02 01 08\n                 \u2502  \u2514\u2500\u2500\u252c\u2500\u2500\u2518 \u2502  \u2502\n                 \u2502     \u2502    \u2502  \u2514\u2500 Status: 8 (SUCCESS!)\n                 \u2502     \u2502    \u2514\u2500 Flag: 1\n                 \u2502     \u2514\u2500 Length: 2 bytes\n                 \u2514\u2500 Type: 0x22 (LOGIN_STATUS)\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\nSTEP 4: Client receives status=8, waits for BEHAVIOR and TEAM_INFO\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nClient internal state:\n  - Login successful\n  - Flag stored: DAT_0067916b = true\n  - Waiting for BEHAVIOR packet...\n  - Then TEAM_INFO packet...\n  - Then will show team selection screen\n</code></pre>"},{"location":"part-3-login-authentication/index.html#what-happens-after-login_status","title":"What Happens After LOGIN_STATUS?","text":"<p>After sending LOGIN_STATUS with status=8, the client is now waiting for:</p> <ol> <li>BEHAVIOR packet (0x24) - The big configuration packet</li> <li>TEAM_INFO packet (0x28) - Team data for the selection screen</li> </ol> <p>The client will NOT show the team selection screen until it receives both of these packets!</p>"},{"location":"part-3-login-authentication/index.html#quick-reference-login-packet-sizes","title":"Quick Reference: LOGIN Packet Sizes","text":"Component Size Example Type 1 byte <code>0x21</code> Length 2 bytes <code>0x0014</code> (20) Sub-type 1 byte <code>0x00</code> Username 2 + len + 1 bytes <code>00 05 52 4F 4F 54 00</code> Password 2 + len + 1 bytes <code>00 0A 73 65 63 72 65 74 31 32 33 00</code> <p>Payload formula: <code>1 + (2 + username_len + 1) + (2 + password_len + 1)</code></p> <p>Example: username=\"ROOT\" (4 chars), password=\"secret123\" (9 chars) - Payload = 1 + (2 + 4 + 1) + (2 + 9 + 1) = 1 + 7 + 12 = 20 bytes</p>"},{"location":"part-3-login-authentication/index.html#troubleshooting","title":"Troubleshooting","text":""},{"location":"part-3-login-authentication/index.html#problem-client-stuck-at-login-screen","title":"Problem: Client Stuck at Login Screen","text":"<p>Cause: LOGIN_STATUS not sent, or wrong status code.</p> <p>Solution: Make sure you're sending <code>22 00 02 01 08</code> after receiving LOGIN.</p> <pre><code># This exact sequence is required:\nconn.send(bytes.fromhex('22 00 02 01 08'))\n</code></pre>"},{"location":"part-3-login-authentication/index.html#problem-client-shows-error-after-login","title":"Problem: Client Shows Error After Login","text":"<p>Cause: Status code other than 8, or packets sent in wrong order.</p> <p>Solution:  1. Use status code 8 for success 2. Make sure you completed HELLO handshake before LOGIN 3. Send BEHAVIOR and TEAM_INFO after LOGIN_STATUS</p>"},{"location":"part-3-login-authentication/index.html#problem-server-fails-to-parse-login","title":"Problem: Server Fails to Parse LOGIN","text":"<p>Cause: Expecting null-terminated strings instead of length-prefixed strings.</p> <p>Solution: Use proper length-prefixed string decoding:</p> <pre><code># WRONG - Don't do this:\nstrings = payload[1:].split(b'\\x00')  # \u2190 WRONG!\n\n# CORRECT - Do this:\nusername, offset = decode_string(payload, 1)\npassword, offset = decode_string(payload, offset)\n</code></pre>"},{"location":"part-3-login-authentication/index.html#problem-nothing-happens-after-login_status","title":"Problem: Nothing Happens After LOGIN_STATUS","text":"<p>Cause: Client is waiting for BEHAVIOR packet.</p> <p>Solution: Immediately send BEHAVIOR (0x24) after LOGIN_STATUS. The client won't proceed without it.</p>"},{"location":"part-3-login-authentication/index.html#common-mistakes","title":"Common Mistakes","text":"Mistake Symptom Fix Null-terminated strings Parse failure Use length-prefixed string decoding Wrong payload length Packet rejected Recalculate: 1 + (2+len+1) per string Status code not 8 Client shows prompts Use status=8 for successful login Missing BEHAVIOR packet Client hangs Send BEHAVIOR immediately after LOGIN_STATUS Wrong byte order Parse failure Use big-endian (<code>&gt;H</code>) for length prefix"},{"location":"part-3-login-authentication/index.html#whats-next","title":"What's Next?","text":"<p>The client is now waiting for the BEHAVIOR packet - the largest and most complex packet in the protocol. In Part 4, we'll start building the BEHAVIOR packet by understanding its structure and the fixed header.</p> <p>Previous: Part 2: HELLO Handshake Next: Part 4: BEHAVIOR Packet - Overview</p>"},{"location":"part-4-behavior-packet/index.html","title":"BEHAVIOR Packet (Part 4.x)","text":"<p>The BEHAVIOR packet (0x24) is the largest and most complex packet in the protocol. This section covers all its components.</p>"},{"location":"part-4-behavior-packet/index.html#contents","title":"Contents","text":"<ul> <li>Part 4.1 - Fixed Header</li> <li>Part 4.2 - Entity Weapon Data</li> <li>Part 4.3 - Entity Core Stats</li> <li>Part 4.4 - Vehicle Type Data</li> <li>Part 4.5 - Physics Tables</li> <li>Part 4.6 - Packet Finalization</li> <li>Part 4.7 - Post BEHAVIOR Flow</li> </ul>"},{"location":"part-4-behavior-packet/part-4-1-fixed-header.html","title":"Wulfram 2 Server Implementation Guide","text":""},{"location":"part-4-behavior-packet/part-4-1-fixed-header.html#part-4-1-behavior-packet-overview-fixed-header","title":"Part 4-1: BEHAVIOR Packet - Overview &amp; Fixed Header","text":""},{"location":"part-4-behavior-packet/part-4-1-fixed-header.html#overview","title":"Overview","text":"<p>The BEHAVIOR packet (0x24) is the largest and most complex packet in the Wulfram 2 protocol. It configures everything the client needs to know about the game: physics, weapons, vehicles, entity types, and more.</p> <p>This is also where most implementation bugs occur, so pay close attention!</p> <pre><code>Client State After LOGIN_STATUS (status=8):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  \"I'm logged in successfully!\"          \u2502\n\u2502  \"Now I need game configuration...\"     \u2502\n\u2502  \"Waiting for BEHAVIOR packet...\"       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2502\n          \u25bc\nServer must send BEHAVIOR (0x24) next!\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-1-fixed-header.html#why-behavior-is-challenging","title":"Why BEHAVIOR Is Challenging","text":"<p>The BEHAVIOR packet has five data sections that must be sent in exact order, followed by packet finalization:</p> <pre><code>BEHAVIOR Packet Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         BEHAVIOR (0x24)                                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502 SECTION 1: Fixed Header                           (95 bytes)     \u2502  \u2502\n\u2502  \u2502 Global game settings, physics constants, timers                  \u2502  \u2502\n\u2502  \u2502 Handler: Inline in FUN_0046dc00                                  \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                              \u2502                                         \u2502\n\u2502                              \u25bc                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502 SECTION 2: Entity Weapon Data                     (variable)     \u2502  \u2502\n\u2502  \u2502 Weapon configs for each entity type \u00d7 13 slots                   \u2502  \u2502\n\u2502  \u2502 Handler: FUN_004e2f90                                            \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                              \u2502                                         \u2502\n\u2502                              \u25bc                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502 SECTION 3: Entity Core Stats                      (468 bytes)    \u2502  \u2502\n\u2502  \u2502 ALWAYS 39 entities \u00d7 12 bytes (build time, cost, HP)             \u2502  \u2502\n\u2502  \u2502 Handler: FUN_004e4a80                                            \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                              \u2502                                         \u2502\n\u2502                              \u25bc                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502 SECTION 4: Vehicle Type Data                      (variable)     \u2502  \u2502\n\u2502  \u2502 Physics params for each vehicle type \u00d7 36 bytes                  \u2502  \u2502\n\u2502  \u2502 Handler: FUN_004e5ce0                                            \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                              \u2502                                         \u2502\n\u2502                              \u25bc                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502 SECTION 5: Physics Tables + Vehicle Models        (variable)     \u2502  \u2502\n\u2502  \u2502 Physics lookup tables + Tank/Medic/Bomber behaviors              \u2502  \u2502\n\u2502  \u2502 Handler: FUN_004e9630                                            \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                              \u2502                                         \u2502\n\u2502                              \u25bc                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502 PACKET FINALIZATION: Byte Alignment               (0-7 bits)     \u2502  \u2502\n\u2502  \u2502 Ensures bit stream is byte-aligned before packet ends            \u2502  \u2502\n\u2502  \u2502 Handler: FUN_00509dc0 \u2192 FUN_00509410                             \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Note: The \"Byte Alignment\" step is NOT a data section\u2014it's packet finalization that pads any remaining bits to reach a byte boundary. It reads 0-7 padding bits (not bytes).</p>"},{"location":"part-4-behavior-packet/part-4-1-fixed-header.html#the-handler-code","title":"The Handler Code","text":"<p>Here's the complete client handler for BEHAVIOR (from FUN_0046dc00, lines 77941-77984):</p> <pre><code>void FUN_0046dc00(param_1, param_2, param_3) {\n    FUN_004e5080();                    // Initialize context\n    FUN_00509db0(\"BEHAVIOR\", param_3); // Set packet name (for error messages)\n    FUN_004e5090(param_3);             // Set context pointer\n\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    // SECTION 1: Read Fixed Header (95 bytes)\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n    // --- Byte 0: Main behavior flag ---\n    FUN_005092e0(local_5);             // 1 byte:  main flag\n    DAT_0067916d = local_5[0] != '\\0';\n\n    // --- Bytes 1-20: Physics doubles 1-5 (timing/physics params) ---\n    FUN_004e51d0(&amp;DAT_00679170);       // 4 bytes: round_time_minutes (\u00d71000 for ms)\n    FUN_004e51d0(&amp;DAT_006792f8);       // 4 bytes: physics param 2\n    FUN_004e51d0(&amp;DAT_00679300);       // 4 bytes: physics param 3\n    FUN_004e51d0(&amp;DAT_00679308);       // 4 bytes: physics param 4\n    FUN_004e51d0(&amp;DAT_00679310);       // 4 bytes: physics param 5\n\n    // --- Bytes 21-32: Physics integers 1-3 ---\n    FUN_00509310(&amp;DAT_0067917c);       // 4 bytes: physics int 1 (game limit)\n    FUN_00509310(&amp;DAT_006791b0);       // 4 bytes: physics int 2\n    FUN_00509310(&amp;DAT_006791b4);       // 4 bytes: physics int 3\n\n    // --- Bytes 33-36: Gravity constant ---\n    FUN_004e51d0(&amp;DAT_005738b8);       // 4 bytes: gravity (used in projectile physics)\n\n    // --- Bytes 37-44: Physics integers 4-5 ---\n    FUN_00509310(&amp;DAT_006791b8);       // 4 bytes: sky_height (map vertical bounds)\n    FUN_00509310(&amp;DAT_006791bc);       // 4 bytes: physics int 5\n\n    // --- Bytes 45-48: Physics double 7 ---\n    FUN_004e51d0(&amp;DAT_006792a0);       // 4 bytes: physics threshold value\n\n    // --- Bytes 49-92: Render floats 1-11 (camera/view parameters) ---\n    FUN_004e5170(&amp;DAT_00679180);       // 4 bytes: render param 1\n    FUN_004e5170(&amp;DAT_00679184);       // 4 bytes: render param 2\n    FUN_004e5170(&amp;DAT_00679188);       // 4 bytes: render param 3\n    FUN_004e5170(&amp;DAT_0067918c);       // 4 bytes: render param 4\n    FUN_004e5170(&amp;DAT_00679190);       // 4 bytes: render param 5\n    FUN_004e5170(&amp;DAT_00679194);       // 4 bytes: render param 6\n    FUN_004e5170(&amp;DAT_00679198);       // 4 bytes: render param 7\n    FUN_004e5170(&amp;DAT_0067919c);       // 4 bytes: render param 8\n    FUN_004e5170(&amp;DAT_006791a0);       // 4 bytes: render param 9\n    FUN_004e5170(&amp;DAT_006791a4);       // 4 bytes: render param 10\n    FUN_004e5170(&amp;DAT_006791ac);       // 4 bytes: render param 11 (range threshold)\n\n    // --- Bytes 93-94: Game mode flags ---\n    FUN_005092e0(local_5);             // 1 byte: friendly fire flag\n    DAT_006791c0 = local_5[0] != '\\0';\n    FUN_005092e0(local_5);             // 1 byte: final flag\n    DAT_006792c4 = local_5[0] != '\\0';\n\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    // SECTIONS 2-5: Call sub-handlers\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    FUN_004e2f90(param_3);   // Section 2: Entity weapon data\n    FUN_004e4a80(param_3);   // Section 3: Entity core stats\n    FUN_004e5ce0(param_3);   // Section 4: Vehicle type data\n    FUN_004e9630(param_3);   // Section 5: Physics + vehicle models\n\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    // PACKET FINALIZATION: Byte alignment\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    FUN_00509dc0(param_3, param_2);    // Align bit stream to byte boundary\n}\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-1-fixed-header.html#understanding-the-reader-functions","title":"Understanding the Reader Functions","text":"<p>The BEHAVIOR packet uses several reader functions. Here's what each one does:</p> Function Bits Read Wire Bytes Target Type Description <code>FUN_005092e0</code> 8 bits 1 byte <code>uint8</code> Reads a single byte (for booleans/flags) <code>FUN_00509310</code> 32 bits 4 bytes <code>uint32</code> Reads a 32-bit integer (big-endian) <code>FUN_004e5170</code> 32 bits 4 bytes <code>float</code> Reads fixed-point \u2192 converts to float <code>FUN_004e51d0</code> 32 bits 4 bytes <code>double</code> Reads fixed-point \u2192 converts to double <p>Important: Both <code>FUN_004e5170</code> (float) and <code>FUN_004e51d0</code> (double) read 4 bytes from the wire! The difference is only in the C type they store the result into. On the wire, both are 4-byte fixed-point values.</p>"},{"location":"part-4-behavior-packet/part-4-1-fixed-header.html#verification-fixed-point-conversion","title":"Verification: Fixed-Point Conversion","text":"<p>Both functions internally call <code>FUN_00509310</code> to read 4 bytes, then convert using <code>FUN_004dc620</code>:</p> <pre><code>// FUN_004e5170 (float reader) - line 157101\nvoid FUN_004e5170(float *param_1) {\n    FUN_00509310(&amp;local_4);                    // Read 4 bytes\n    fVar1 = (float10)FUN_004dc620(local_4);    // Convert from fixed-point\n    *param_1 = (float)fVar1;\n}\n\n// FUN_004e51d0 (double reader) - line 157125\nvoid FUN_004e51d0(double *param_1) {\n    FUN_00509310(&amp;local_4);                    // Read 4 bytes\n    fVar1 = (float10)FUN_004dc620(local_4);    // Convert from fixed-point\n    *param_1 = (double)fVar1;\n}\n\n// FUN_004dc620 (fixed-point decoder) - line 150538\nfloat10 FUN_004dc620(int param_1) {\n    return (float10)param_1 * (float10)1.52587890625e-05;  // = 1/65536\n}\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-1-fixed-header.html#section-1-fixed-header-95-bytes","title":"Section 1: Fixed Header (95 bytes)","text":"<p>The fixed header contains global game configuration. Here's its exact structure:</p> <pre><code>Fixed Header Layout (95 bytes total):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset  \u2502 Size \u2502 Reader Func    \u2502 Description                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0       \u2502 1    \u2502 FUN_005092e0   \u2502 Main behavior flag (bool)                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 1       \u2502 4    \u2502 FUN_004e51d0   \u2502 Round time (minutes, default 60.0)        \u2502\n\u2502 5       \u2502 4    \u2502 FUN_004e51d0   \u2502 Physics double 2 (fixed-point)            \u2502\n\u2502 9       \u2502 4    \u2502 FUN_004e51d0   \u2502 Physics double 3 (fixed-point)            \u2502\n\u2502 13      \u2502 4    \u2502 FUN_004e51d0   \u2502 Physics double 4 (fixed-point)            \u2502\n\u2502 17      \u2502 4    \u2502 FUN_004e51d0   \u2502 Physics double 5 (fixed-point)            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 21      \u2502 4    \u2502 FUN_00509310   \u2502 Physics int 1 (game limit)                \u2502\n\u2502 25      \u2502 4    \u2502 FUN_00509310   \u2502 Physics int 2                             \u2502\n\u2502 29      \u2502 4    \u2502 FUN_00509310   \u2502 Physics int 3                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 33      \u2502 4    \u2502 FUN_004e51d0   \u2502 Gravity constant (used in physics calcs)  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 37      \u2502 4    \u2502 FUN_00509310   \u2502 Sky height / map vertical bound           \u2502\n\u2502 41      \u2502 4    \u2502 FUN_00509310   \u2502 Physics int 5                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 45      \u2502 4    \u2502 FUN_004e51d0   \u2502 Physics threshold value                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 49      \u2502 4    \u2502 FUN_004e5170   \u2502 Render float 1 (camera/view param)        \u2502\n\u2502 53      \u2502 4    \u2502 FUN_004e5170   \u2502 Render float 2 (camera/view param)        \u2502\n\u2502 57      \u2502 4    \u2502 FUN_004e5170   \u2502 Render float 3 (camera/view param)        \u2502\n\u2502 61      \u2502 4    \u2502 FUN_004e5170   \u2502 Render float 4 (camera/view param)        \u2502\n\u2502 65      \u2502 4    \u2502 FUN_004e5170   \u2502 Render float 5 (camera/view param)        \u2502\n\u2502 69      \u2502 4    \u2502 FUN_004e5170   \u2502 Render float 6 (camera/view param)        \u2502\n\u2502 73      \u2502 4    \u2502 FUN_004e5170   \u2502 Render float 7 (camera/view param)        \u2502\n\u2502 77      \u2502 4    \u2502 FUN_004e5170   \u2502 Render float 8 (camera/view param)        \u2502\n\u2502 81      \u2502 4    \u2502 FUN_004e5170   \u2502 Render float 9 (camera/view param)        \u2502\n\u2502 85      \u2502 4    \u2502 FUN_004e5170   \u2502 Render float 10 (camera/view param)       \u2502\n\u2502 89      \u2502 4    \u2502 FUN_004e5170   \u2502 Render float 11 (range threshold)         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 93      \u2502 1    \u2502 FUN_005092e0   \u2502 Friendly fire flag (bool)                 \u2502\n\u2502 94      \u2502 1    \u2502 FUN_005092e0   \u2502 Final flag (bool)                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nTotal: 1 + 20 + 12 + 4 + 8 + 4 + 44 + 2 = 95 bytes\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-1-fixed-header.html#field-details-from-decompiled-code","title":"Field Details from Decompiled Code","text":""},{"location":"part-4-behavior-packet/part-4-1-fixed-header.html#round-time-offset-1-dat_00679170","title":"Round Time (Offset 1, DAT_00679170)","text":"<p>The first physics double is used as a round time in minutes. From line 23370-23378:</p> <pre><code>// If round time is negative, default to 60 minutes\nif (_DAT_00679170 &lt; 0.0 != (_DAT_00679170 == 0.0)) {\n    _DAT_00679170 = 60.0;\n}\n// Calculate end time: current_time + (round_time_minutes \u00d7 1000)\nlocal_2c = (undefined4)(longlong)ROUND(dVar1 + _DAT_00679170 * 1000.0);\n</code></pre> <p>Recommended value: <code>60.0</code> (60 minutes per round)</p>"},{"location":"part-4-behavior-packet/part-4-1-fixed-header.html#gravity-constant-offset-33-dat_005738b8","title":"Gravity Constant (Offset 33, DAT_005738b8)","text":"<p>Used in projectile and entity physics. From lines 85215-85227:</p> <pre><code>// Gravity applied with damping factor\nfVar7 = (float10)(float)((float10)_DAT_005738b8 * (float10)-0.85 * fVar6);\n*(float *)((int)_Memory + 0x1c) = (float)(fVar7 + (float10)*(float *)((int)_Memory + 0x1c));\n</code></pre> <p>Recommended value: <code>20.0</code> (typical game gravity)</p>"},{"location":"part-4-behavior-packet/part-4-1-fixed-header.html#friendly-fire-flag-offset-93-dat_006791c0","title":"Friendly Fire Flag (Offset 93, DAT_006791c0)","text":"<p>Controls whether teammates can damage each other. From line 75309:</p> <pre><code>// If same team AND friendly fire is disabled, don't apply damage\nif ((*(int *)(local_14 + 0xf0) == *(int *)(unaff_ESI + 0xf0)) &amp;&amp; (DAT_006791c0 == '\\0')) {\n    bVar1 = true;  // Same team, no friendly fire\n}\n</code></pre> <p>Values: <code>0x00</code> = friendly fire OFF, <code>0x01</code> = friendly fire ON</p>"},{"location":"part-4-behavior-packet/part-4-1-fixed-header.html#building-the-fixed-header-in-python","title":"Building the Fixed Header in Python","text":"<pre><code>import struct\n\ndef encode_fixed_point(float_value):\n    \"\"\"Convert a float to Wulfram 2 fixed-point format (4 bytes big-endian)\"\"\"\n    wire_value = int(float_value * 65536)\n    return struct.pack('&gt;i', wire_value)\n\ndef create_behavior_fixed_header():\n    \"\"\"\n    Create the fixed header section of the BEHAVIOR packet.\n    Returns exactly 95 bytes.\n    \"\"\"\n    data = bytearray()\n\n    # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    # Byte 0: Main behavior flag\n    # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    main_flag = True\n    data.append(0x01 if main_flag else 0x00)\n    # Current size: 1 byte\n\n    # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    # Bytes 1-20: Five physics doubles (fixed-point)\n    # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    round_time_minutes = 60.0  # 60 minute rounds (default)\n    physics_double_2 = 1.0\n    physics_double_3 = 1.0\n    physics_double_4 = 1.0\n    physics_double_5 = 1.0\n\n    data.extend(encode_fixed_point(round_time_minutes))\n    data.extend(encode_fixed_point(physics_double_2))\n    data.extend(encode_fixed_point(physics_double_3))\n    data.extend(encode_fixed_point(physics_double_4))\n    data.extend(encode_fixed_point(physics_double_5))\n    # Current size: 1 + 20 = 21 bytes\n\n    # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    # Bytes 21-32: Three physics integers (big-endian uint32)\n    # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    physics_int_1 = 0  # Game limit\n    physics_int_2 = 0\n    physics_int_3 = 0\n\n    data.extend(struct.pack('&gt;I', physics_int_1))\n    data.extend(struct.pack('&gt;I', physics_int_2))\n    data.extend(struct.pack('&gt;I', physics_int_3))\n    # Current size: 21 + 12 = 33 bytes\n\n    # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    # Bytes 33-36: Gravity constant (fixed-point)\n    # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    gravity = 20.0  # Standard game gravity\n    data.extend(encode_fixed_point(gravity))\n    # Current size: 33 + 4 = 37 bytes\n\n    # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    # Bytes 37-44: Two physics integers\n    # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    sky_height = 1000  # Map vertical bound\n    physics_int_5 = 0\n\n    data.extend(struct.pack('&gt;I', sky_height))\n    data.extend(struct.pack('&gt;I', physics_int_5))\n    # Current size: 37 + 8 = 45 bytes\n\n    # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    # Bytes 45-48: Physics threshold (fixed-point)\n    # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    physics_threshold = 1.0\n    data.extend(encode_fixed_point(physics_threshold))\n    # Current size: 45 + 4 = 49 bytes\n\n    # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    # Bytes 49-92: Eleven render floats (fixed-point)\n    # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    # These control camera/view parameters - use 1.0 as safe defaults\n    render_floats = [1.0] * 11\n    for value in render_floats:\n        data.extend(encode_fixed_point(value))\n    # Current size: 49 + 44 = 93 bytes\n\n    # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    # Bytes 93-94: Two game mode flags\n    # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    friendly_fire = False  # Disable friendly fire\n    final_flag = False     # Normal mode\n\n    data.append(0x01 if friendly_fire else 0x00)\n    data.append(0x01 if final_flag else 0x00)\n    # Final size: 93 + 2 = 95 bytes\n\n    assert len(data) == 95, f\"Fixed header should be 95 bytes, got {len(data)}\"\n    return bytes(data)\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-1-fixed-header.html#example-fixed-header-bytes","title":"Example Fixed Header Bytes","text":"<p>Using the code above with recommended default values:</p> <pre><code>Fixed Header (95 bytes):\n\nOffset 0:      01                      Main flag: true\n               \u2500\u2500\n\nOffset 1-4:    00 3C 00 00             Round time: 60.0 minutes\n               \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500             (60.0 \u00d7 65536 = 3,932,160 = 0x003C0000)\n\nOffset 5-8:    00 01 00 00             Physics double 2: 1.0\nOffset 9-12:   00 01 00 00             Physics double 3: 1.0\nOffset 13-16:  00 01 00 00             Physics double 4: 1.0\nOffset 17-20:  00 01 00 00             Physics double 5: 1.0\n\nOffset 21-24:  00 00 00 00             Physics int 1: 0\nOffset 25-28:  00 00 00 00             Physics int 2: 0\nOffset 29-32:  00 00 00 00             Physics int 3: 0\n\nOffset 33-36:  00 14 00 00             Gravity: 20.0\n               \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500             (20.0 \u00d7 65536 = 1,310,720 = 0x00140000)\n\nOffset 37-40:  00 00 03 E8             Sky height: 1000\nOffset 41-44:  00 00 00 00             Physics int 5: 0\n\nOffset 45-48:  00 01 00 00             Physics threshold: 1.0\n\nOffset 49-52:  00 01 00 00             Render float 1: 1.0\nOffset 53-56:  00 01 00 00             Render float 2: 1.0\n... (render floats 3-10, all 1.0)\nOffset 85-88:  00 01 00 00             Render float 10: 1.0\nOffset 89-92:  00 01 00 00             Render float 11: 1.0\n\nOffset 93:     00                      Friendly fire: false\nOffset 94:     00                      Final flag: false\n</code></pre> <p>Full Hex Dump (95 bytes): <pre><code>01 00 3C 00 00 00 01 00 00 00 01 00 00 00 01 00\n00 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00\n00 00 14 00 00 00 00 03 E8 00 00 00 00 00 01 00\n00 00 01 00 00 00 01 00 00 00 01 00 00 00 01 00\n00 00 01 00 00 00 01 00 00 00 01 00 00 00 01 00\n00 00 01 00 00 00 01 00 00 00 01 00 00 00 00\n</code></pre></p>"},{"location":"part-4-behavior-packet/part-4-1-fixed-header.html#key-points-about-fixed-header","title":"Key Points About Fixed Header","text":"<ol> <li>Exact size: Always exactly 95 bytes, no more, no less</li> <li>Order matters: Values must be in the exact order shown</li> <li>Fixed-point encoding: All doubles and floats use <code>value \u00d7 65536</code> encoding (4 bytes each)</li> <li>Booleans: 1 byte each, <code>0x00</code> = false, any non-zero = true</li> <li>Big-endian integers: All uint32 values use big-endian byte order</li> <li>Round time default: If negative, client defaults to 60 minutes</li> <li>Gravity: Affects projectile physics (multiplied by ~-0.85 for vertical motion)</li> <li>Friendly fire: When <code>0x00</code>, same-team damage is prevented</li> </ol>"},{"location":"part-4-behavior-packet/part-4-1-fixed-header.html#common-mistakes","title":"Common Mistakes","text":"Mistake Symptom Fix Wrong byte count Client crashes or hangs Verify exactly 95 bytes Little-endian encoding Garbled values, weird physics Use <code>&gt;</code> prefix in struct.pack Missing fixed-point conversion Physics values are tiny/huge Multiply by 65536 before sending Wrong field order Unpredictable behavior Follow the exact order from decompile Using 8-byte doubles Extra bytes corrupt next section Both doubles and floats are 4 bytes on wire"},{"location":"part-4-behavior-packet/part-4-1-fixed-header.html#what-comes-after-the-fixed-header","title":"What Comes After the Fixed Header?","text":"<p>After the 95-byte fixed header, the client immediately reads Section 2 (Entity Weapon Data). This is where things get more complex because the size depends on how many entities are registered.</p> <p>In Part 4-2, we'll tackle the Entity Weapon Data section - the largest variable-size section of the BEHAVIOR packet.</p>"},{"location":"part-4-behavior-packet/part-4-1-fixed-header.html#summary-fixed-header-checklist","title":"Summary: Fixed Header Checklist","text":"Requirement Value Size Exactly 95 bytes Main flag 1 byte (bool) at offset 0 Physics doubles 7 \u00d7 4 bytes (fixed-point) at offsets 1, 5, 9, 13, 17, 33, 45 Physics integers 5 \u00d7 4 bytes (uint32 BE) at offsets 21, 25, 29, 37, 41 Render floats 11 \u00d7 4 bytes (fixed-point) at offsets 49-92 Flag booleans 2 \u00d7 1 byte at offsets 93, 94 Byte order All multi-byte values are BIG-ENDIAN Fixed-point formula <code>wire_value = int(float_value \u00d7 65536)</code> <p>Previous: Part 3: Login Authentication Next: Part 4-2: BEHAVIOR - Entity Weapon Data</p>"},{"location":"part-4-behavior-packet/part-4-2-entity-weapon-data.html","title":"Wulfram 2 Server Implementation Guide","text":""},{"location":"part-4-behavior-packet/part-4-2-entity-weapon-data.html#part-4-2-behavior-packet-entity-weapon-data","title":"Part 4-2: BEHAVIOR Packet - Entity Weapon Data","text":""},{"location":"part-4-behavior-packet/part-4-2-entity-weapon-data.html#overview","title":"Overview","text":"<p>The Entity Weapon Data section is the first variable-length section of the BEHAVIOR packet. It configures weapon loadouts for each playable vehicle type in the game.</p> <pre><code>Position in BEHAVIOR Packet:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  SECTION 1: Fixed Header (95 bytes)                        \u2713 Complete  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  SECTION 2: Entity Weapon Data (2,340 bytes)               \u25c4 YOU ARE   \u2502\n\u2502             4 entities \u00d7 13 weapon slots \u00d7 45 bytes            HERE    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  SECTION 3: Entity Core Stats (468 bytes)                              \u2502\n\u2502  SECTION 4: Vehicle Type Data (variable)                               \u2502\n\u2502  SECTION 5: Physics Tables + Vehicle Models (variable)                 \u2502\n\u2502  PACKET FINALIZATION: Byte Alignment                                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-2-entity-weapon-data.html#the-handler-code","title":"The Handler Code","text":"<p>From FUN_004e2f90 (lines 155752-155801):</p> <pre><code>void FUN_004e2f90(undefined4 param_1) {\n    FUN_004e5080();                    // Initialize context\n    FUN_004e5090(param_1);             // Set context pointer\n\n    // Get linked list of entity types with weapon data\n    local_4 = *(undefined4 **)(DAT_005b9a4c + 4);\n\n    if (local_4 != (undefined4 *)0x0) {\n        local_8 = 0;\n        do {\n            iVar1 = local_4[2];        // Get entity data pointer\n            iVar2 = 0;\n            local_4 = (undefined4 *)*local_4;  // Advance to next entity\n\n            // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n            // Read 13 weapon slots for this entity\n            // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n            do {\n                iVar3 = *(int *)(iVar1 + 8) + iVar2;  // Weapon slot pointer\n\n                // --- 5 boolean flags (5 bytes) ---\n                FUN_005092e0(local_d);\n                *(bool *)(iVar3 + 0x10) = local_d[0] != '\\0';  // Enabled flag\n                FUN_005092e0(local_d);\n                *(bool *)(iVar3 + 0x11) = local_d[0] != '\\0';  // Flag 2\n                FUN_005092e0(local_d);\n                *(bool *)(iVar3 + 0x12) = local_d[0] != '\\0';  // Flag 3\n                FUN_005092e0(local_d);\n                *(bool *)(iVar3 + 0x13) = local_d[0] != '\\0';  // Flag 4\n                FUN_005092e0(local_d);\n                *(bool *)(iVar3 + 0x14) = local_d[0] != '\\0';  // Flag 5\n\n                // --- 1 fixed-point double (4 bytes) ---\n                FUN_004e51d0(iVar3 + 0x18);  // Weapon parameter 1\n\n                // --- 5 uint32 integers (20 bytes) ---\n                FUN_00509310(iVar3 + 0x20);  // Integer param 1\n                FUN_00509310(iVar3 + 0x24);  // Integer param 2\n                FUN_00509310(iVar3 + 0x28);  // Integer param 3\n                FUN_00509310(iVar3 + 0x2c);  // Integer param 4\n                FUN_00509310(iVar3 + 0x30);  // Integer param 5\n\n                // --- 4 fixed-point doubles (16 bytes) ---\n                FUN_004e51d0(iVar3 + 0x38);  // Double param 1\n                FUN_004e51d0(iVar3 + 0x40);  // Double param 2\n                FUN_004e51d0(iVar3 + 0x48);  // Double param 3\n                FUN_004e51d0(iVar3 + 0x50);  // Double param 4\n\n                iVar3 = local_8;\n                iVar2 = iVar2 + 0x58;  // Next weapon slot (stride = 88 bytes)\n            } while (iVar2 &lt; 0x478);   // 0x478 / 0x58 = 13 slots\n\n            FUN_004e27d0();             // Process weapon flags\n            local_8 = iVar3 + 0x10;\n        } while (local_4 != (undefined4 *)0x0);  // Until end of linked list\n    }\n}\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-2-entity-weapon-data.html#key-constants","title":"Key Constants","text":"Constant Value (Hex) Value (Decimal) Meaning Weapon slot stride <code>0x58</code> 88 Bytes per slot in memory Total weapon array <code>0x478</code> 1144 Total bytes for all slots (88 \u00d7 13) Number of slots <code>0x0D</code> 13 Weapon slots per entity Bytes per slot (wire) - 45 Actual bytes read per slot"},{"location":"part-4-behavior-packet/part-4-2-entity-weapon-data.html#how-many-entities-have-weapon-data","title":"How Many Entities Have Weapon Data?","text":"<p>The weapon registry is initialized in FUN_004e2e60 (lines 155679-155720):</p> <pre><code>void FUN_004e2e60(void) {\n    // Allocate weapon slot arrays (5 times, but only 4 used)\n    FUN_004e2d70();  // Allocates 0x478 bytes\n    FUN_004e2d70();\n    FUN_004e2d70();\n    FUN_004e2d70();\n    FUN_004e2d70();\n\n    // Initialize DAT_005b9900 array for 39 entities\n    for (iVar3 = 0x27; iVar3 != 0; iVar3 = iVar3 + -1) {\n        *puVar4 = uVar1;\n        puVar4 = puVar4 + 1;\n    }\n\n    // Create weapon entity registry (linked list)\n    DAT_005b9a4c = FUN_004dc7c0();\n\n    // Register 4 entity types with weapon data\n    FUN_004e2cd0();  // Entity type 0 (Tank)\n    FUN_004e2cd0();  // Entity type 1 (Scout)\n    FUN_004e2cd0();  // Entity type 2 (Medic/Assault Platform)\n    FUN_004e2cd0();  // Entity type 3 (Bomber)\n\n    FUN_004e2840();  // Build entity index\n}\n</code></pre> <p>Important: The client expects weapon data for exactly 4 entity types. These correspond to the playable vehicle types:</p> Entity Index Entity Name Description 0 Tank Main battle vehicle 1 Scout Fast reconnaissance vehicle 2 Medic / Assault Platform Support vehicle 3 Bomber Air attack vehicle"},{"location":"part-4-behavior-packet/part-4-2-entity-weapon-data.html#section-size-calculation","title":"Section Size Calculation","text":"<pre><code>Entity Weapon Data Size:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  4 entities \u00d7 13 slots \u00d7 45 bytes = 2,340 bytes                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nBreakdown per entity (585 bytes):\n  - 13 weapon slots\n  - Each slot: 45 bytes\n\nBreakdown per weapon slot (45 bytes):\n  - 5 boolean flags:    5 \u00d7 1 byte  =  5 bytes\n  - 1 fixed-point:      1 \u00d7 4 bytes =  4 bytes\n  - 5 integers:         5 \u00d7 4 bytes = 20 bytes\n  - 4 fixed-points:     4 \u00d7 4 bytes = 16 bytes\n  - Total:                          = 45 bytes\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-2-entity-weapon-data.html#weapon-slot-structure-45-bytes","title":"Weapon Slot Structure (45 bytes)","text":"<p>Each weapon slot contains configuration for one weapon/ability:</p> <pre><code>Weapon Slot Wire Format (45 bytes):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset  \u2502 Size \u2502 Reader Func    \u2502 Description                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0       \u2502 1    \u2502 FUN_005092e0   \u2502 Weapon enabled flag (bool)                \u2502\n\u2502 1       \u2502 1    \u2502 FUN_005092e0   \u2502 Slot flag 2 (bool)                        \u2502\n\u2502 2       \u2502 1    \u2502 FUN_005092e0   \u2502 Slot flag 3 (bool)                        \u2502\n\u2502 3       \u2502 1    \u2502 FUN_005092e0   \u2502 Slot flag 4 (bool)                        \u2502\n\u2502 4       \u2502 1    \u2502 FUN_005092e0   \u2502 Slot flag 5 (bool)                        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 5       \u2502 4    \u2502 FUN_004e51d0   \u2502 Weapon parameter (fixed-point double)     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 9       \u2502 4    \u2502 FUN_00509310   \u2502 Integer param 1 (uint32 BE)               \u2502\n\u2502 13      \u2502 4    \u2502 FUN_00509310   \u2502 Integer param 2 (uint32 BE)               \u2502\n\u2502 17      \u2502 4    \u2502 FUN_00509310   \u2502 Integer param 3 (uint32 BE)               \u2502\n\u2502 21      \u2502 4    \u2502 FUN_00509310   \u2502 Integer param 4 (uint32 BE)               \u2502\n\u2502 25      \u2502 4    \u2502 FUN_00509310   \u2502 Integer param 5 (uint32 BE)               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 29      \u2502 4    \u2502 FUN_004e51d0   \u2502 Double param 1 (fixed-point)              \u2502\n\u2502 33      \u2502 4    \u2502 FUN_004e51d0   \u2502 Double param 2 (fixed-point)              \u2502\n\u2502 37      \u2502 4    \u2502 FUN_004e51d0   \u2502 Double param 3 (fixed-point)              \u2502\n\u2502 41      \u2502 4    \u2502 FUN_004e51d0   \u2502 Double param 4 (fixed-point)              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nTotal: 5 + 4 + 20 + 16 = 45 bytes\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-2-entity-weapon-data.html#memory-vs-wire-format","title":"Memory vs Wire Format","text":"<p>The weapon slot structure in memory is 88 bytes (<code>0x58</code>), but only 45 bytes are transmitted over the network:</p> <pre><code>Memory Layout (88 bytes):          Wire Format (45 bytes):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset 0x00-0x0F: Reserved  \u2502    \u2502 NOT SENT                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524    \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Offset 0x10: Bool 1         \u2502\u2500\u2500\u2500\u25ba\u2502 Byte 0: Bool 1              \u2502\n\u2502 Offset 0x11: Bool 2         \u2502\u2500\u2500\u2500\u25ba\u2502 Byte 1: Bool 2              \u2502\n\u2502 Offset 0x12: Bool 3         \u2502\u2500\u2500\u2500\u25ba\u2502 Byte 2: Bool 3              \u2502\n\u2502 Offset 0x13: Bool 4         \u2502\u2500\u2500\u2500\u25ba\u2502 Byte 3: Bool 4              \u2502\n\u2502 Offset 0x14: Bool 5         \u2502\u2500\u2500\u2500\u25ba\u2502 Byte 4: Bool 5              \u2502\n\u2502 Offset 0x15-0x17: Padding   \u2502    \u2502 NOT SENT                    \u2502\n\u2502 Offset 0x18: Double (8b)    \u2502\u2500\u2500\u2500\u25ba\u2502 Bytes 5-8: Fixed-point      \u2502\n\u2502 Offset 0x20: Int 1          \u2502\u2500\u2500\u2500\u25ba\u2502 Bytes 9-12: Int 1           \u2502\n\u2502 Offset 0x24: Int 2          \u2502\u2500\u2500\u2500\u25ba\u2502 Bytes 13-16: Int 2          \u2502\n\u2502 Offset 0x28: Int 3          \u2502\u2500\u2500\u2500\u25ba\u2502 Bytes 17-20: Int 3          \u2502\n\u2502 Offset 0x2C: Int 4          \u2502\u2500\u2500\u2500\u25ba\u2502 Bytes 21-24: Int 4          \u2502\n\u2502 Offset 0x30: Int 5          \u2502\u2500\u2500\u2500\u25ba\u2502 Bytes 25-28: Int 5          \u2502\n\u2502 Offset 0x34-0x37: Padding   \u2502    \u2502 NOT SENT                    \u2502\n\u2502 Offset 0x38: Double 1 (8b)  \u2502\u2500\u2500\u2500\u25ba\u2502 Bytes 29-32: Fixed-point    \u2502\n\u2502 Offset 0x40: Double 2 (8b)  \u2502\u2500\u2500\u2500\u25ba\u2502 Bytes 33-36: Fixed-point    \u2502\n\u2502 Offset 0x48: Double 3 (8b)  \u2502\u2500\u2500\u2500\u25ba\u2502 Bytes 37-40: Fixed-point    \u2502\n\u2502 Offset 0x50: Double 4 (8b)  \u2502\u2500\u2500\u2500\u25ba\u2502 Bytes 41-44: Fixed-point    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-2-entity-weapon-data.html#data-flow-diagram","title":"Data Flow Diagram","text":"<pre><code>Entity Weapon Data Reading Order:\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nEntity 0 (Tank):\n\u251c\u2500\u2500 Slot 0:  [5 bools][1 double][5 ints][4 doubles] = 45 bytes\n\u251c\u2500\u2500 Slot 1:  [5 bools][1 double][5 ints][4 doubles] = 45 bytes\n\u251c\u2500\u2500 Slot 2:  [5 bools][1 double][5 ints][4 doubles] = 45 bytes\n\u2502   ... (slots 3-11)\n\u2514\u2500\u2500 Slot 12: [5 bools][1 double][5 ints][4 doubles] = 45 bytes\n                                           Total: 585 bytes\n\nEntity 1 (Scout):\n\u251c\u2500\u2500 Slot 0-12: Same structure as above\n                                           Total: 585 bytes\n\nEntity 2 (Medic):\n\u251c\u2500\u2500 Slot 0-12: Same structure as above\n                                           Total: 585 bytes\n\nEntity 3 (Bomber):\n\u251c\u2500\u2500 Slot 0-12: Same structure as above\n                                           Total: 585 bytes\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\nGrand Total: 4 \u00d7 585 = 2,340 bytes\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-2-entity-weapon-data.html#building-entity-weapon-data-in-python","title":"Building Entity Weapon Data in Python","text":"<pre><code>import struct\n\ndef encode_fixed_point(float_value):\n    \"\"\"Convert a float to fixed-point format (4 bytes big-endian)\"\"\"\n    wire_value = int(float_value * 65536)\n    return struct.pack('&gt;i', wire_value)\n\ndef create_weapon_slot(enabled=False, flags=(False, False, False, False),\n                       param1=0.0, ints=(0, 0, 0, 0, 0),\n                       doubles=(0.0, 0.0, 0.0, 0.0)):\n    \"\"\"\n    Create a single weapon slot (45 bytes).\n\n    Args:\n        enabled: Whether this weapon slot is active\n        flags: Tuple of 4 additional boolean flags\n        param1: First fixed-point parameter\n        ints: Tuple of 5 integer parameters\n        doubles: Tuple of 4 fixed-point double parameters\n\n    Returns:\n        45 bytes of weapon slot data\n    \"\"\"\n    data = bytearray()\n\n    # 5 boolean flags (5 bytes)\n    data.append(0x01 if enabled else 0x00)\n    for flag in flags:\n        data.append(0x01 if flag else 0x00)\n\n    # 1 fixed-point double (4 bytes)\n    data.extend(encode_fixed_point(param1))\n\n    # 5 uint32 integers (20 bytes)\n    for value in ints:\n        data.extend(struct.pack('&gt;I', value))\n\n    # 4 fixed-point doubles (16 bytes)\n    for value in doubles:\n        data.extend(encode_fixed_point(value))\n\n    assert len(data) == 45, f\"Weapon slot should be 45 bytes, got {len(data)}\"\n    return bytes(data)\n\ndef create_entity_weapons(slot_configs=None):\n    \"\"\"\n    Create weapon data for a single entity (13 slots = 585 bytes).\n\n    Args:\n        slot_configs: List of 13 slot configurations, or None for defaults\n\n    Returns:\n        585 bytes of entity weapon data\n    \"\"\"\n    data = bytearray()\n\n    for slot_idx in range(13):\n        if slot_configs and slot_idx &lt; len(slot_configs):\n            slot_data = create_weapon_slot(**slot_configs[slot_idx])\n        else:\n            # Default: disabled weapon slot\n            slot_data = create_weapon_slot()\n        data.extend(slot_data)\n\n    assert len(data) == 585, f\"Entity weapons should be 585 bytes, got {len(data)}\"\n    return bytes(data)\n\ndef create_behavior_entity_weapon_data():\n    \"\"\"\n    Create the complete Entity Weapon Data section (4 entities = 2,340 bytes).\n\n    Returns:\n        2,340 bytes of entity weapon configuration data\n    \"\"\"\n    data = bytearray()\n\n    # Entity 0: Tank\n    data.extend(create_entity_weapons())\n\n    # Entity 1: Scout\n    data.extend(create_entity_weapons())\n\n    # Entity 2: Medic/Assault Platform\n    data.extend(create_entity_weapons())\n\n    # Entity 3: Bomber\n    data.extend(create_entity_weapons())\n\n    assert len(data) == 2340, f\"Entity weapon data should be 2340 bytes, got {len(data)}\"\n    return bytes(data)\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-2-entity-weapon-data.html#example-weapon-slot-with-values","title":"Example Weapon Slot with Values","text":"<p>Here's an example of a configured weapon slot (slot 0 for Tank):</p> <pre><code># Example: Tank's primary weapon (slot 0)\ntank_slot_0 = create_weapon_slot(\n    enabled=True,           # Weapon is active\n    flags=(True, True, False, False),  # Slot flags\n    param1=1.0,             # Weapon parameter\n    ints=(100, 50, 10, 5, 0),   # Damage, range, cooldown, etc.\n    doubles=(1.0, 1.0, 0.5, 0.0)  # Accuracy, spread, etc.\n)\n</code></pre> <p>Hex dump of this slot (45 bytes): <pre><code>01 01 01 00 00              Bools: enabled=T, flags=T,T,F,F\n00 01 00 00                 Param1: 1.0\n00 00 00 64                 Int1: 100\n00 00 00 32                 Int2: 50\n00 00 00 0A                 Int3: 10\n00 00 00 05                 Int4: 5\n00 00 00 00                 Int5: 0\n00 01 00 00                 Double1: 1.0\n00 01 00 00                 Double2: 1.0\n00 00 80 00                 Double3: 0.5\n00 00 00 00                 Double4: 0.0\n</code></pre></p>"},{"location":"part-4-behavior-packet/part-4-2-entity-weapon-data.html#default-values-all-zeros","title":"Default Values (All Zeros)","text":"<p>For a basic implementation, you can send all weapon slots as disabled (zeros):</p> <pre><code>def create_empty_weapon_data():\n    \"\"\"Create 2,340 bytes of empty weapon data (all disabled).\"\"\"\n    return bytes(2340)  # All zeros\n</code></pre> <p>This creates valid data where: - All 5 booleans = <code>0x00</code> (false) - All fixed-point values = <code>0x00000000</code> (0.0) - All integers = <code>0x00000000</code> (0)</p>"},{"location":"part-4-behavior-packet/part-4-2-entity-weapon-data.html#post-processing-fun_004e27d0","title":"Post-Processing: FUN_004e27d0","text":"<p>After reading all 13 weapon slots for an entity, the client calls FUN_004e27d0 to count up enabled weapons:</p> <pre><code>// From FUN_004e27d0 (lines 155372-155403)\nvoid FUN_004e27d0(int param_1) {\n    *in_EAX = 0;      // Counter 1\n    in_EAX[1] = 0;    // Counter 2\n    in_EAX[2] = 0;    // Counter 3\n    in_EAX[3] = 0;    // Counter 4\n\n    pcVar1 = (char *)(param_1 + 0x11);\n    iVar2 = 0xd;  // 13 iterations\n\n    do {\n        if (pcVar1[-1] != '\\0') {   // If slot enabled (offset 0x10)\n            if (*pcVar1 != '\\0') {   // Check flag at offset 0x11\n                *in_EAX = *in_EAX + 1;\n            }\n            if (pcVar1[1] != '\\0') { // Check flag at offset 0x12\n                in_EAX[1] = in_EAX[1] + 1;\n            }\n            if (pcVar1[2] != '\\0') { // Check flag at offset 0x13\n                in_EAX[2] = in_EAX[2] + 1;\n            }\n            if (pcVar1[3] != '\\0') { // Check flag at offset 0x14\n                in_EAX[3] = in_EAX[3] + 1;\n            }\n        }\n        pcVar1 = pcVar1 + 0x58;  // Next slot\n        iVar2 = iVar2 + -1;\n    } while (iVar2 != 0);\n}\n</code></pre> <p>This counts how many weapon slots have each flag set, which is used for UI display and game logic.</p>"},{"location":"part-4-behavior-packet/part-4-2-entity-weapon-data.html#common-mistakes","title":"Common Mistakes","text":"Mistake Symptom Fix Wrong entity count Data misalignment, crash Send exactly 4 entities Wrong slot count Missing/extra data Send exactly 13 slots per entity Wrong byte count per slot Corruption of following sections Ensure 45 bytes per slot Little-endian integers Garbled values Use big-endian (<code>&gt;I</code>) Forgetting fixed-point Values 65536\u00d7 too small Multiply floats by 65536"},{"location":"part-4-behavior-packet/part-4-2-entity-weapon-data.html#verification-checklist","title":"Verification Checklist","text":"<p>Before moving to Section 3, verify:</p> <ul> <li>[ ] Exactly 4 entities worth of data</li> <li>[ ] Exactly 13 weapon slots per entity</li> <li>[ ] Exactly 45 bytes per weapon slot</li> <li>[ ] Total size is exactly 2,340 bytes</li> <li>[ ] All integers are big-endian</li> <li>[ ] All floats/doubles are fixed-point encoded</li> <li>[ ] Booleans are 1 byte each (0x00 or 0x01)</li> </ul>"},{"location":"part-4-behavior-packet/part-4-2-entity-weapon-data.html#section-summary","title":"Section Summary","text":"Property Value Section Number 2 Handler Function FUN_004e2f90 Entity Count 4 (Tank, Scout, Medic, Bomber) Slots per Entity 13 Bytes per Slot 45 Bytes per Entity 585 Total Section Size 2,340 bytes Position After Fixed Header (offset 95) Position Before Entity Core Stats <p>Previous: Part 4-1: BEHAVIOR - Fixed Header Next: Part 4-3: BEHAVIOR - Entity Core Stats</p>"},{"location":"part-4-behavior-packet/part-4-3-entity-core-stats.html","title":"Wulfram 2 Server Implementation Guide","text":""},{"location":"part-4-behavior-packet/part-4-3-entity-core-stats.html#part-4-3-behavior-packet-entity-core-stats","title":"Part 4-3: BEHAVIOR Packet - Entity Core Stats","text":""},{"location":"part-4-behavior-packet/part-4-3-entity-core-stats.html#overview","title":"Overview","text":"<p>The Entity Core Stats section defines the build time, build cost, and max hit points for all 39 entity types in the game. Unlike the Entity Weapon Data (which only covers 4 vehicle types), this section covers every entity type.</p> <pre><code>Position in BEHAVIOR Packet:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  SECTION 1: Fixed Header (95 bytes)                        \u2713 Complete  \u2502\n\u2502  SECTION 2: Entity Weapon Data (2,340 bytes)               \u2713 Complete  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  SECTION 3: Entity Core Stats (468 bytes)                  \u25c4 YOU ARE   \u2502\n\u2502             39 entities \u00d7 12 bytes each                        HERE    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  SECTION 4: Vehicle Type Data (variable)                               \u2502\n\u2502  SECTION 5: Physics Tables + Vehicle Models (variable)                 \u2502\n\u2502  PACKET FINALIZATION: Byte Alignment                                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-3-entity-core-stats.html#the-handler-code","title":"The Handler Code","text":"<p>From FUN_004e4a80 (lines 156648-156665):</p> <pre><code>void FUN_004e4a80(undefined4 param_1) {\n    int iVar1;\n    int *piVar2;\n\n    FUN_004e5080();                    // Initialize context\n    FUN_004e5090(param_1);             // Set context pointer\n\n    // Start at entity type array (DAT_005b9a68)\n    piVar2 = &amp;DAT_005b9a68;\n\n    do {\n        iVar1 = *piVar2;               // Get entity type pointer\n\n        // Read 3 values for this entity type:\n        FUN_004e51d0(iVar1 + 0x38);    // 4 bytes: Build time (fixed-point)\n        FUN_004e51d0(iVar1 + 0x40);    // 4 bytes: Build cost (fixed-point)\n        FUN_00509310(iVar1 + 0x48);    // 4 bytes: Max HP (uint32)\n\n        piVar2 = piVar2 + 1;           // Next entity type\n    } while ((int)piVar2 &lt; 0x5b9b04);  // Until end of entity array\n}\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-3-entity-core-stats.html#loop-analysis","title":"Loop Analysis","text":"<p>The loop iterates through a contiguous array of entity type pointers:</p> <pre><code>Loop bounds:\n  Start:  &amp;DAT_005b9a68  = 0x5b9a68\n  End:    0x5b9b04       (exclusive)\n\n  Range:  0x5b9b04 - 0x5b9a68 = 0x9C = 156 bytes\n\n  Entity count: 156 / 4 = 39 entities\n</code></pre> <p>Key point: The client always expects exactly 39 entity types, regardless of how many are actually used in gameplay.</p>"},{"location":"part-4-behavior-packet/part-4-3-entity-core-stats.html#entity-core-stats-structure-12-bytes-per-entity","title":"Entity Core Stats Structure (12 bytes per entity)","text":"<pre><code>Entity Core Stats Layout (12 bytes):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset  \u2502 Size \u2502 Reader Func    \u2502 Description                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0       \u2502 4    \u2502 FUN_004e51d0   \u2502 Build time (fixed-point double)           \u2502\n\u2502 4       \u2502 4    \u2502 FUN_004e51d0   \u2502 Build cost (fixed-point double)           \u2502\n\u2502 8       \u2502 4    \u2502 FUN_00509310   \u2502 Max hit points (uint32 big-endian)        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nTotal: 4 + 4 + 4 = 12 bytes per entity\n</code></pre> <p>Note: FUN_004e51d0 is a fixed-point reader wrapper that internally  calls FUN_00509310 (32-bit big-endian read) and then converts the result  using the 1/65536 multiplier described in Part 1.</p>"},{"location":"part-4-behavior-packet/part-4-3-entity-core-stats.html#section-size-calculation","title":"Section Size Calculation","text":"<pre><code>Entity Core Stats Size:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  39 entities \u00d7 12 bytes = 468 bytes                                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nThis size is FIXED - always exactly 468 bytes.\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-3-entity-core-stats.html#the-39-entity-types","title":"The 39 Entity Types","text":"<p>Based on the entity registration in FUN_004e3bd0 (lines 156405-156621):</p> Index Entity Name Category 0 Tank Manned Unit 1 Scout Manned Unit 2 Assault Platform Manned Unit 3 Bomber Manned Unit 4 Transport Manned Unit 5 Flak Shell Weapon 6 Pulse Shell Weapon 7 Short Missile Weapon 8 Hunter Weapon 9 Heavy Missile Weapon 10 (Unknown) Weapon 11 Piercer Weapon 12 Thumper Weapon 13 Caltrop Weapon 14 Orbital Bomb Weapon 15 Cruise Missile Weapon 16 Mortar Shell Weapon 17 Flare Weapon 18 Aereal Bomb Weapon 19 Cargo Box Deployable 20 Uplink Deployable 21 Supply Ship Space Unit 22 Torpedo Space Unit 23 Particle Beam Space Unit 24 Space Explosion Space Unit 25 Power Cell Ground Unit 26 Refuel Pad Ground Unit 27 Repair Pad Ground Unit 28 Shield Ground Unit 29 Flak Turret Ground Unit 30 Gun Turret Ground Unit 31 Heavy Missile Silo Ground Unit 32 Missile Launcher Ground Unit 33 Skypump Ground Unit 34 Portal Ground Unit 35 Darklight Ground Unit 36 Spy Bug Ground Unit 37 Decoration Ground Unit 38 ILLEGAL (Placeholder) <p>Note: The last entry (index 38) is a placeholder/sentinel value. The entity array actually has slots for indices 38, 39, and 40, but they all point to the same \"ILLEGAL\" entity. However, the BEHAVIOR packet only reads 39 entries (indices 0-38).</p>"},{"location":"part-4-behavior-packet/part-4-3-entity-core-stats.html#field-verification-max-hit-points","title":"Field Verification: Max Hit Points","text":"<p>The offset 0x48 field is confirmed as max HP from multiple code references:</p> <pre><code>// From FUN_00490ae0 (line 102056) - Health bar calculation\niVar1 = *(int *)((&amp;DAT_005b9a68)[*(int *)((int)pfVar3[-1] + 8)] + 0x48);\n// ...\n*pfVar3 = (1.0 - fVar2 / (float)iVar1) * *pfVar3;  // Health percentage\n</code></pre> <pre><code>// From FUN_00479470 (line 88056) - Setting initial HP\n*(float *)(iVar2 + 0xd0) = \n     (float)*(int *)((&amp;DAT_005b9a68)[*(int *)(iVar2 + 8)] + 0x48) * *unaff_ESI;\n</code></pre> <p>The pattern <code>entity_type_array[entity_index] + 0x48</code> consistently retrieves max HP, which is then used to calculate health percentages and damage.</p>"},{"location":"part-4-behavior-packet/part-4-3-entity-core-stats.html#data-flow-diagram","title":"Data Flow Diagram","text":"<pre><code>Entity Core Stats Reading Order:\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nEntity 0  (Tank):              [build_time][build_cost][max_hp] = 12 bytes\nEntity 1  (Scout):             [build_time][build_cost][max_hp] = 12 bytes\nEntity 2  (Assault Platform):  [build_time][build_cost][max_hp] = 12 bytes\nEntity 3  (Bomber):            [build_time][build_cost][max_hp] = 12 bytes\nEntity 4  (Transport):         [build_time][build_cost][max_hp] = 12 bytes\nEntity 5  (Flak Shell):        [build_time][build_cost][max_hp] = 12 bytes\n...\nEntity 37 (Decoration):        [build_time][build_cost][max_hp] = 12 bytes\nEntity 38 (ILLEGAL):           [build_time][build_cost][max_hp] = 12 bytes\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\nTotal: 39 \u00d7 12 = 468 bytes\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-3-entity-core-stats.html#building-entity-core-stats-in-python","title":"Building Entity Core Stats in Python","text":"<pre><code>import struct\n\ndef encode_fixed_point(float_value):\n    \"\"\"Convert a float to fixed-point format (4 bytes big-endian)\"\"\"\n    wire_value = int(float_value * 65536)\n    return struct.pack('&gt;i', wire_value)\n\ndef create_entity_core_stats(build_time=0.0, build_cost=0.0, max_hp=0):\n    \"\"\"\n    Create core stats for a single entity type (12 bytes).\n\n    Args:\n        build_time: Time to build/spawn this entity (seconds or game ticks)\n        build_cost: Resource cost to build this entity\n        max_hp: Maximum hit points for this entity\n\n    Returns:\n        12 bytes of entity core stats\n    \"\"\"\n    data = bytearray()\n\n    # Build time (4 bytes, fixed-point)\n    data.extend(encode_fixed_point(build_time))\n\n    # Build cost (4 bytes, fixed-point)\n    data.extend(encode_fixed_point(build_cost))\n\n    # Max HP (4 bytes, uint32 big-endian)\n    data.extend(struct.pack('&gt;I', max_hp))\n\n    assert len(data) == 12, f\"Entity stats should be 12 bytes, got {len(data)}\"\n    return bytes(data)\n\ndef create_behavior_entity_core_stats():\n    \"\"\"\n    Create the complete Entity Core Stats section (39 entities = 468 bytes).\n\n    Returns:\n        468 bytes of entity core stats data\n    \"\"\"\n    data = bytearray()\n\n    # Define stats for all 39 entity types\n    # Format: (build_time, build_cost, max_hp)\n    entity_stats = [\n        # Manned Units (indices 0-4)\n        (10.0, 100.0, 1000),   # 0: Tank\n        (5.0, 50.0, 500),      # 1: Scout\n        (15.0, 150.0, 1500),   # 2: Assault Platform\n        (8.0, 80.0, 800),      # 3: Bomber\n        (12.0, 120.0, 600),    # 4: Transport\n\n        # Weapons (indices 5-18)\n        (0.0, 0.0, 10),        # 5: Flak Shell\n        (0.0, 0.0, 10),        # 6: Pulse Shell\n        (0.0, 0.0, 20),        # 7: Short Missile\n        (0.0, 0.0, 25),        # 8: Hunter\n        (0.0, 0.0, 50),        # 9: Heavy Missile\n        (0.0, 0.0, 10),        # 10: (Unknown)\n        (0.0, 0.0, 15),        # 11: Piercer\n        (0.0, 0.0, 15),        # 12: Thumper\n        (0.0, 0.0, 5),         # 13: Caltrop\n        (0.0, 0.0, 100),       # 14: Orbital Bomb\n        (0.0, 0.0, 75),        # 15: Cruise Missile\n        (0.0, 0.0, 10),        # 16: Mortar Shell\n        (0.0, 0.0, 5),         # 17: Flare\n        (0.0, 0.0, 50),        # 18: Aereal Bomb\n\n        # Deployables (indices 19-20)\n        (0.0, 25.0, 100),      # 19: Cargo Box\n        (0.0, 10.0, 50),       # 20: Uplink\n\n        # Space Units (indices 21-24)\n        (30.0, 500.0, 5000),   # 21: Supply Ship\n        (0.0, 0.0, 30),        # 22: Torpedo\n        (0.0, 0.0, 10),        # 23: Particle Beam\n        (0.0, 0.0, 0),         # 24: Space Explosion\n\n        # Ground Units (indices 25-37)\n        (20.0, 200.0, 500),    # 25: Power Cell\n        (25.0, 300.0, 750),    # 26: Refuel Pad\n        (25.0, 300.0, 750),    # 27: Repair Pad\n        (30.0, 400.0, 1000),   # 28: Shield\n        (20.0, 250.0, 600),    # 29: Flak Turret\n        (20.0, 250.0, 600),    # 30: Gun Turret\n        (35.0, 500.0, 800),    # 31: Heavy Missile Silo\n        (25.0, 350.0, 700),    # 32: Missile Launcher\n        (15.0, 200.0, 400),    # 33: Skypump\n        (20.0, 300.0, 500),    # 34: Portal\n        (25.0, 350.0, 600),    # 35: Darklight\n        (10.0, 100.0, 100),    # 36: Spy Bug\n        (0.0, 0.0, 100),       # 37: Decoration\n\n        # Placeholder (index 38)\n        (0.0, 0.0, 0),         # 38: ILLEGAL\n    ]\n\n    # Generate data for all 39 entities\n    for i, (build_time, build_cost, max_hp) in enumerate(entity_stats):\n        data.extend(create_entity_core_stats(build_time, build_cost, max_hp))\n\n    assert len(data) == 468, f\"Entity core stats should be 468 bytes, got {len(data)}\"\n    return bytes(data)\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-3-entity-core-stats.html#simplified-version-all-zeros","title":"Simplified Version (All Zeros)","text":"<p>For initial testing, you can send all zeros:</p> <pre><code>def create_empty_entity_core_stats():\n    \"\"\"Create 468 bytes of empty entity core stats (all zeros).\"\"\"\n    return bytes(468)\n</code></pre> <p>This is valid but means: - All entities have 0 build time - All entities have 0 build cost - All entities have 0 max HP (may cause issues!)</p> <p>Warning: Setting max_hp to 0 may cause division-by-zero errors in health calculations. Consider using at least <code>max_hp=1</code> for all entities.</p>"},{"location":"part-4-behavior-packet/part-4-3-entity-core-stats.html#example-entity-stats-bytes","title":"Example Entity Stats Bytes","text":"<p>Here's an example for the Tank entity (index 0):</p> <pre><code>Entity 0 (Tank) with build_time=10.0, build_cost=100.0, max_hp=1000:\n\nOffset 0-3:   00 0A 00 00    Build time: 10.0 (10.0 \u00d7 65536 = 655,360 = 0x000A0000)\nOffset 4-7:   00 64 00 00    Build cost: 100.0 (100.0 \u00d7 65536 = 6,553,600 = 0x00640000)\nOffset 8-11:  00 00 03 E8    Max HP: 1000 (0x000003E8)\n\nTotal: 12 bytes\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-3-entity-core-stats.html#common-mistakes","title":"Common Mistakes","text":"Mistake Symptom Fix Wrong entity count Corruption of next section Send exactly 39 entities Max HP = 0 Division by zero, crashes Use at least 1 for all entities Little-endian encoding Garbled values Use big-endian (<code>&gt;I</code>) Missing fixed-point Build values 65536\u00d7 wrong Multiply by 65536 Wrong total size Data misalignment Verify exactly 468 bytes"},{"location":"part-4-behavior-packet/part-4-3-entity-core-stats.html#verification-checklist","title":"Verification Checklist","text":"<p>Before moving to Section 4, verify:</p> <ul> <li>[ ] Exactly 39 entities</li> <li>[ ] Exactly 12 bytes per entity</li> <li>[ ] Total size is exactly 468 bytes</li> <li>[ ] Build time: fixed-point encoded (4 bytes)</li> <li>[ ] Build cost: fixed-point encoded (4 bytes)</li> <li>[ ] Max HP: uint32 big-endian (4 bytes)</li> <li>[ ] Max HP &gt; 0 for all damageable entities</li> </ul>"},{"location":"part-4-behavior-packet/part-4-3-entity-core-stats.html#section-summary","title":"Section Summary","text":"Property Value Section Number 3 Handler Function FUN_004e4a80 Entity Count 39 (fixed) Bytes per Entity 12 Total Section Size 468 bytes (fixed) Position After Entity Weapon Data (offset 2,435) Position Before Vehicle Type Data"},{"location":"part-4-behavior-packet/part-4-3-entity-core-stats.html#cumulative-offset-after-section-3","title":"Cumulative Offset After Section 3","text":"<pre><code>After Section 3:\n  Fixed Header:        95 bytes\n  Entity Weapon Data:  2,340 bytes\n  Entity Core Stats:   468 bytes\n  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  Total:               2,903 bytes\n</code></pre> <p>Previous: Part 4-2: BEHAVIOR - Entity Weapon Data Next: Part 4-4: BEHAVIOR - Vehicle Type Data</p>"},{"location":"part-4-behavior-packet/part-4-4-vehicle-type-data.html","title":"Wulfram 2 Server Implementation Guide","text":""},{"location":"part-4-behavior-packet/part-4-4-vehicle-type-data.html#part-4-4-behavior-packet-vehicle-type-data","title":"Part 4-4: BEHAVIOR Packet - Vehicle Type Data","text":""},{"location":"part-4-behavior-packet/part-4-4-vehicle-type-data.html#overview","title":"Overview","text":"<p>The Vehicle Type Data section transmits physics and movement parameters for the 2 playable vehicle types: Tank and Scout (Medic). </p> <p>Historical Note: Wulfram 2 was designed to support additional vehicles (Bomber, Transport, Assault Platform), but these were either gameplay-broken (Bomber was too overpowered) or incomplete. In the released game, only Tank and Scout are playable. The client still registers exactly 2 vehicle types.</p> <pre><code>Position in BEHAVIOR Packet:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  SECTION 1: Fixed Header (95 bytes)                        \u2713 Complete  \u2502\n\u2502  SECTION 2: Entity Weapon Data (2,340 bytes)               \u2713 Complete  \u2502\n\u2502  SECTION 3: Entity Core Stats (468 bytes)                  \u2713 Complete  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  SECTION 4: Vehicle Type Data (72 bytes)                   \u25c4 YOU ARE   \u2502\n\u2502             2 vehicle types \u00d7 36 bytes each                    HERE    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  SECTION 5: Physics Tables + Vehicle Models (variable)                 \u2502\n\u2502  PACKET FINALIZATION: Byte Alignment                                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-4-vehicle-type-data.html#the-handler-code","title":"The Handler Code","text":"<p>From FUN_004e5ce0 (lines 157822-157847):</p> <pre><code>void FUN_004e5ce0(undefined4 param_1) {\n    undefined4 *puVar1;\n    int iVar2;\n    undefined4 *puVar3;\n\n    FUN_004e5080();                                // Initialize context\n    FUN_004e5090(param_1);                         // Set context pointer\n\n    // Get first element from vehicle type linked list\n    puVar3 = *(undefined4 **)(DAT_005ba124 + 4);\n\n    while (puVar3 != (undefined4 *)0x0) {\n        puVar1 = (undefined4 *)*puVar3;            // Next pointer\n        iVar2 = *(int *)(puVar3[2] + 4);           // Vehicle info structure pointer\n\n        // Read 9 fields (36 bytes total):\n        FUN_004e51d0(iVar2 + 0x00);    // 4 bytes: fixed-point (field 1)\n        FUN_004e51d0(iVar2 + 0x08);    // 4 bytes: fixed-point (field 2)\n        FUN_00509310(iVar2 + 0x10);    // 4 bytes: uint32 BE   (field 3)\n        FUN_00509310(iVar2 + 0x14);    // 4 bytes: uint32 BE   (field 4)\n        FUN_004e51d0(iVar2 + 0x18);    // 4 bytes: fixed-point (field 5)\n        FUN_004e51d0(iVar2 + 0x20);    // 4 bytes: fixed-point (field 6)\n        FUN_004e51d0(iVar2 + 0x28);    // 4 bytes: fixed-point (field 7)\n        FUN_00509310(iVar2 + 0x30);    // 4 bytes: uint32 BE   (field 8)\n        FUN_00509310(iVar2 + 0x34);    // 4 bytes: uint32 BE   (field 9)\n\n        puVar3 = puVar1;               // Move to next vehicle type\n    }\n    return;\n}\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-4-vehicle-type-data.html#vehicle-type-count-2-fixed","title":"Vehicle Type Count: 2 (Fixed)","text":"<p>The client registers exactly 2 vehicle types during initialization:</p> <p>From FUN_004e5b50 (lines 157814-157815): <pre><code>FUN_004e5ad0();    // Register vehicle type 0 (Tank)\nFUN_004e5ad0();    // Register vehicle type 1 (Scout)\n</code></pre></p> <p>The registration function FUN_004e5ad0 adds each vehicle to a linked list, which FUN_004e5ce0 then iterates through.</p> <p>Important: The linked list is traversed in registration order. Since <code>FUN_004e5ad0()</code> is called for Tank first (index 0), then Scout (index 1), the server must send Tank data before Scout data. Reversing this order will cause the client to apply Tank physics to Scout and vice versa.</p>"},{"location":"part-4-behavior-packet/part-4-4-vehicle-type-data.html#vehicle-info-structure-memory-layout","title":"Vehicle Info Structure (Memory Layout)","text":"<p>Each vehicle type has a 0x38 (56) byte structure in memory:</p> <pre><code>Vehicle Info Memory Structure (56 bytes / 0x38):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset  \u2502 Size \u2502 Description                                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0x00    \u2502 8    \u2502 Field 1 (double) - Default: 20.0                        \u2502\n\u2502 0x08    \u2502 8    \u2502 Field 2 (double) - Default: 4.0                         \u2502\n\u2502 0x10    \u2502 4    \u2502 Field 3 (uint32) - Default: 700                         \u2502\n\u2502 0x14    \u2502 4    \u2502 Field 4 (uint32) - Default: 550 (0x226)                 \u2502\n\u2502 0x18    \u2502 8    \u2502 Field 5 (double) - Default: 1.0                         \u2502\n\u2502 0x20    \u2502 8    \u2502 Field 6 (double) - Default: 0.5                         \u2502\n\u2502 0x28    \u2502 8    \u2502 Field 7 (double) - Default: 2.0                         \u2502\n\u2502 0x30    \u2502 4    \u2502 Field 8 (uint32) - Default: 0                           \u2502\n\u2502 0x34    \u2502 4    \u2502 Field 9 (uint32) - Default: 0                           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nTotal Memory: 56 bytes (0x38)\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-4-vehicle-type-data.html#wire-format-36-bytes-per-vehicle","title":"Wire Format (36 bytes per vehicle)","text":"<p>The wire format is more compact - doubles are sent as 4-byte fixed-point values:</p> <pre><code>Vehicle Type Wire Format (36 bytes):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Wire Byte \u2502 Size \u2502 Reader Func    \u2502 Description                         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0-3       \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 1 (fixed-point \u2192 double)      \u2502\n\u2502 4-7       \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 2 (fixed-point \u2192 double)      \u2502\n\u2502 8-11      \u2502 4    \u2502 FUN_00509310   \u2502 Field 3 (uint32 big-endian)         \u2502\n\u2502 12-15     \u2502 4    \u2502 FUN_00509310   \u2502 Field 4 (uint32 big-endian)         \u2502\n\u2502 16-19     \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 5 (fixed-point \u2192 double)      \u2502\n\u2502 20-23     \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 6 (fixed-point \u2192 double)      \u2502\n\u2502 24-27     \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 7 (fixed-point \u2192 double)      \u2502\n\u2502 28-31     \u2502 4    \u2502 FUN_00509310   \u2502 Field 8 (uint32 big-endian)         \u2502\n\u2502 32-35     \u2502 4    \u2502 FUN_00509310   \u2502 Field 9 (uint32 big-endian)         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nTotal Wire: 36 bytes per vehicle type\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-4-vehicle-type-data.html#field-purpose-analysis-speculative","title":"Field Purpose Analysis (Speculative)","text":"<p>Based on code analysis patterns, these fields likely control:</p> Field Default Tank Scout Likely Purpose 1 20.0 20.0 20.0 Max speed or base velocity multiplier 2 4.0 4.0 4.0 Acceleration rate 3 700 700 700 Turn rate or rotation speed 4 550 550 550 Unknown (consistent between vehicles) 5 1.0 0.8 0.8 Handling/traction factor 6 0.5 0.05 0.15 Braking/friction coefficient 7 2.0 1.3 1.1 Mass/inertia factor 8 0 0 0 Timer/cooldown related 9 0 33000 13000 Fuel/energy capacity <p>Note: These purposes are inferred from code context and may not be exact. The Scout's higher Field 6 (0.15 vs 0.05) and lower Field 9 (13000 vs 33000) align with it being a faster, lighter vehicle with less fuel capacity.</p>"},{"location":"part-4-behavior-packet/part-4-4-vehicle-type-data.html#section-size-calculation","title":"Section Size Calculation","text":"<pre><code>Vehicle Type Data Size:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  2 vehicle types \u00d7 36 bytes = 72 bytes                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nThis size is FIXED - always exactly 72 bytes.\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-4-vehicle-type-data.html#default-values-from-code","title":"Default Values from Code","text":"<p>From FUN_004e5a20 (lines 157669-157702) and FUN_004e5b50 (lines 157761-157773):</p>"},{"location":"part-4-behavior-packet/part-4-4-vehicle-type-data.html#default-values-all-vehicles","title":"Default Values (All Vehicles):","text":"Field Memory Offset Hex Value Decoded Value 1 0x00 0x4034000000000000 20.0 2 0x08 0x4010000000000000 4.0 3 0x10 0x000002BC 700 4 0x14 0x00000226 550 5 0x18 0x3FF0000000000000 1.0 6 0x20 0x3FE0000000000000 0.5 7 0x28 0x4000000000000000 2.0 8 0x30 0x00000000 0 9 0x34 0x00000000 0"},{"location":"part-4-behavior-packet/part-4-4-vehicle-type-data.html#tank-specific-overrides-vehicle-type-0","title":"Tank-Specific Overrides (Vehicle Type 0):","text":"Field Memory Offset Value Notes 5 0x18 0.8 6 0x20 0.05 7 0x28 1.3 9 0x34 33000"},{"location":"part-4-behavior-packet/part-4-4-vehicle-type-data.html#scout-specific-overrides-vehicle-type-1","title":"Scout-Specific Overrides (Vehicle Type 1):","text":"Field Memory Offset Value Notes 5 0x18 0.8 6 0x20 0.15 7 0x28 1.1 9 0x34 13000 <p>Implementation Note: Field 8 (offset 0x30) is not explicitly initialized in the code\u2014it relies on <code>operator_new</code> returning zero-initialized memory. Your server should explicitly set Field 8 to 0 rather than relying on implicit behavior.</p>"},{"location":"part-4-behavior-packet/part-4-4-vehicle-type-data.html#data-flow-diagram","title":"Data Flow Diagram","text":"<pre><code>Vehicle Type Data Reading Order:\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nVehicle Type 0 (Tank):\n  [field1][field2][field3][field4][field5][field6][field7][field8][field9]\n  [  4   ][  4   ][  4   ][  4   ][  4   ][  4   ][  4   ][  4   ][  4   ]\n  = 36 bytes\n\nVehicle Type 1 (Scout):\n  [field1][field2][field3][field4][field5][field6][field7][field8][field9]\n  [  4   ][  4   ][  4   ][  4   ][  4   ][  4   ][  4   ][  4   ][  4   ]\n  = 36 bytes\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\nTotal: 2 \u00d7 36 = 72 bytes\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-4-vehicle-type-data.html#building-vehicle-type-data-in-python","title":"Building Vehicle Type Data in Python","text":"<pre><code>import struct\n\ndef encode_fixed_point(float_value):\n    \"\"\"Convert a float/double to fixed-point format (4 bytes big-endian).\"\"\"\n    wire_value = int(float_value * 65536)\n    return struct.pack('&gt;i', wire_value)\n\ndef create_vehicle_type_data(field1=20.0, field2=4.0, field3=700, field4=550,\n                              field5=1.0, field6=0.5, field7=2.0, \n                              field8=0, field9=0):\n    \"\"\"\n    Create data for a single vehicle type (36 bytes).\n\n    Args:\n        field1-field7: Physics parameters (doubles, sent as fixed-point)\n        field3-field4, field8-field9: Integer parameters (uint32)\n\n    Returns:\n        36 bytes of vehicle type data\n    \"\"\"\n    data = bytearray()\n\n    # Field 1: fixed-point (4 bytes)\n    data.extend(encode_fixed_point(field1))\n\n    # Field 2: fixed-point (4 bytes)\n    data.extend(encode_fixed_point(field2))\n\n    # Field 3: uint32 big-endian (4 bytes)\n    data.extend(struct.pack('&gt;I', field3))\n\n    # Field 4: uint32 big-endian (4 bytes)\n    data.extend(struct.pack('&gt;I', field4))\n\n    # Field 5: fixed-point (4 bytes)\n    data.extend(encode_fixed_point(field5))\n\n    # Field 6: fixed-point (4 bytes)\n    data.extend(encode_fixed_point(field6))\n\n    # Field 7: fixed-point (4 bytes)\n    data.extend(encode_fixed_point(field7))\n\n    # Field 8: uint32 big-endian (4 bytes)\n    data.extend(struct.pack('&gt;I', field8))\n\n    # Field 9: uint32 big-endian (4 bytes)\n    data.extend(struct.pack('&gt;I', field9))\n\n    assert len(data) == 36, f\"Vehicle type should be 36 bytes, got {len(data)}\"\n    return bytes(data)\n\ndef create_behavior_vehicle_type_data():\n    \"\"\"\n    Create the complete Vehicle Type Data section (2 vehicles = 72 bytes).\n\n    Returns:\n        72 bytes of vehicle type data\n    \"\"\"\n    data = bytearray()\n\n    # Vehicle Type 0: Tank\n    # Uses defaults except: field5=0.8, field6=0.05, field7=1.3, field9=33000\n    tank_data = create_vehicle_type_data(\n        field1=20.0,\n        field2=4.0,\n        field3=700,\n        field4=550,\n        field5=0.8,\n        field6=0.05,\n        field7=1.3,\n        field8=0,\n        field9=33000\n    )\n    data.extend(tank_data)\n\n    # Vehicle Type 1: Scout (Medic)\n    # Uses defaults except: field5=0.8, field6=0.15, field7=1.1, field9=13000\n    scout_data = create_vehicle_type_data(\n        field1=20.0,\n        field2=4.0,\n        field3=700,\n        field4=550,\n        field5=0.8,\n        field6=0.15,\n        field7=1.1,\n        field8=0,\n        field9=13000\n    )\n    data.extend(scout_data)\n\n    assert len(data) == 72, f\"Vehicle type data should be 72 bytes, got {len(data)}\"\n    return bytes(data)\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-4-vehicle-type-data.html#simplified-version-default-values","title":"Simplified Version (Default Values)","text":"<p>For initial testing, you can use default values for both vehicles:</p> <pre><code>def create_default_vehicle_type_data():\n    \"\"\"Create 72 bytes using default values for both vehicle types.\"\"\"\n    data = bytearray()\n\n    # Both vehicles with defaults\n    for _ in range(2):\n        data.extend(create_vehicle_type_data())  # All defaults\n\n    return bytes(data)\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-4-vehicle-type-data.html#example-vehicle-type-bytes","title":"Example Vehicle Type Bytes","text":"<p>Here's the Tank (Vehicle Type 0) with its specific values: <pre><code>Tank Vehicle Type Data (36 bytes):\n\nField 1 (20.0):     00 14 00 00    (20.0 \u00d7 65536 = 1,310,720 = 0x00140000)\nField 2 (4.0):      00 04 00 00    (4.0 \u00d7 65536 = 262,144 = 0x00040000)\nField 3 (700):      00 00 02 BC    (700 = 0x000002BC)\nField 4 (550):      00 00 02 26    (550 = 0x00000226)\nField 5 (0.8):      00 00 CC CC    (0.8 \u00d7 65536 \u2248 52,428 = 0x0000CCCC)*\nField 6 (0.05):     00 00 0C CC    (0.05 \u00d7 65536 \u2248 3,276 = 0x00000CCC)*\nField 7 (1.3):      00 01 4C CC    (1.3 \u00d7 65536 \u2248 85,196 = 0x00014CCC)*\nField 8 (0):        00 00 00 00\nField 9 (33000):    00 00 80 E8    (33000 = 0x000080E8)\n\n* Using int() truncation. Use round() for 0xCCCD/0xCCD values if preferred.\n</code></pre></p>"},{"location":"part-4-behavior-packet/part-4-4-vehicle-type-data.html#the-2-playable-vehicle-types","title":"The 2 Playable Vehicle Types","text":"Index Vehicle Name Role Notes 0 Tank Main combat vehicle Default spawn, heavy armor 1 Scout Fast reconnaissance / Medic Can heal teammates <p>Note: Other vehicles (Bomber, Transport, Assault Platform) exist in entity definitions but were never enabled for player use. The Bomber was tested but deemed too overpowered.</p>"},{"location":"part-4-behavior-packet/part-4-4-vehicle-type-data.html#common-mistakes","title":"Common Mistakes","text":"Mistake Symptom Fix Wrong vehicle count Data misalignment Send exactly 2 vehicle types Wrong bytes per vehicle Corruption of next section Send exactly 36 bytes each Little-endian integers Garbled values Use big-endian (<code>&gt;I</code>) Missing fixed-point conversion Physics values 65536\u00d7 wrong Multiply floats by 65536 Sending more vehicles Client reads garbage Only Tank and Scout are registered"},{"location":"part-4-behavior-packet/part-4-4-vehicle-type-data.html#verification-checklist","title":"Verification Checklist","text":"<p>Before moving to Section 5, verify:</p> <ul> <li>[ ] Exactly 2 vehicle types (Tank, then Scout)</li> <li>[ ] Exactly 36 bytes per vehicle type</li> <li>[ ] Total size is exactly 72 bytes</li> <li>[ ] Fields 1, 2, 5, 6, 7: fixed-point encoded (4 bytes each)</li> <li>[ ] Fields 3, 4, 8, 9: uint32 big-endian (4 bytes each)</li> <li>[ ] Order: Tank first (index 0), Scout second (index 1)</li> </ul>"},{"location":"part-4-behavior-packet/part-4-4-vehicle-type-data.html#section-summary","title":"Section Summary","text":"Property Value Section Number 4 Handler Function FUN_004e5ce0 Vehicle Type Count 2 (fixed: Tank and Scout) Bytes per Vehicle 36 Total Section Size 72 bytes (fixed) Position After Entity Core Stats (offset 2,903) Position Before Physics Tables + Vehicle Models"},{"location":"part-4-behavior-packet/part-4-4-vehicle-type-data.html#cumulative-offset-after-section-4","title":"Cumulative Offset After Section 4","text":"<pre><code>After Section 4:\n  Fixed Header:        95 bytes\n  Entity Weapon Data:  2,340 bytes\n  Entity Core Stats:   468 bytes\n  Vehicle Type Data:   72 bytes\n  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  Total:               2,975 bytes\n</code></pre> <p>Previous: Part 4-3: BEHAVIOR - Entity Core Stats Next: Part 4-5: BEHAVIOR - Physics Tables + Vehicle Models</p>"},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html","title":"Wulfram 2 Server Implementation Guide","text":""},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html#part-4-5-behavior-packet-physics-tables-vehicle-models","title":"Part 4-5: BEHAVIOR Packet - Physics Tables + Vehicle Models","text":""},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html#overview","title":"Overview","text":"<p>The Physics Tables + Vehicle Models section is the fifth and final data section of the BEHAVIOR packet. It contains physics lookup tables used for game simulation and per-vehicle-model configuration parameters.</p> <p>Critical Note: This section is often overlooked, but the client will read garbage data if it's missing or undersized, leading to corrupted physics and vehicle behavior.</p> <pre><code>Position in BEHAVIOR Packet:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  SECTION 1: Fixed Header (95 bytes)                        \u2713 Complete  \u2502\n\u2502  SECTION 2: Entity Weapon Data (2,340 bytes)               \u2713 Complete  \u2502\n\u2502  SECTION 3: Entity Core Stats (468 bytes)                  \u2713 Complete  \u2502\n\u2502  SECTION 4: Vehicle Type Data (72 bytes)                   \u2713 Complete  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  SECTION 5: Physics Tables + Vehicle Models (140+ bytes)   \u25c4 YOU ARE   \u2502\n\u2502             4 physics tables + 3 vehicle models                HERE    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  PACKET FINALIZATION: Byte Alignment (0-7 bits padding)                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html#the-handler-code","title":"The Handler Code","text":"<p>From FUN_004e9630 (lines 160966-160980):</p> <pre><code>void FUN_004e9630(undefined4 param_1) {\n    undefined4 *puVar1;\n    undefined4 *puVar2;\n\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    // PART 1: Read Physics Tables\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    FUN_004df690(param_1);              // Reads 4 physics tables\n\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    // PART 2: Read Vehicle Models\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    puVar2 = DAT_005c41c8;              // Get vehicle model linked list\n\n    while (puVar2 != (undefined4 *)0x0) {\n        puVar1 = (undefined4 *)*puVar2;                      // Next pointer\n        (**(code **)(*(int *)puVar2[2] + 0x10))(param_1);    // Call vtable[0x10]\n        puVar2 = puVar1;                                      // Move to next\n    }\n    return;\n}\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html#part-1-physics-tables","title":"Part 1: Physics Tables","text":""},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html#physics-table-dispatcher-fun_004df690","title":"Physics Table Dispatcher (FUN_004df690)","text":"<p>From FUN_004df690 (lines 152925-152931):</p> <pre><code>void FUN_004df690(void) {\n    FUN_004df5c0(0);    // Read 2 physics tables for index 0\n    FUN_004df5c0(1);    // Read 2 physics tables for index 1\n    return;\n}\n</code></pre> <p>Each call to <code>FUN_004df5c0</code> reads 2 physics tables, for a total of 4 physics tables.</p>"},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html#physics-table-pair-reader-fun_004df5c0","title":"Physics Table Pair Reader (FUN_004df5c0)","text":"<p>From FUN_004df5c0 (lines 152872-152921):</p> <pre><code>void FUN_004df5c0(void) {\n    puVar1 = (undefined4 *)FUN_004de690();   // Get physics context\n    _Memory = (void *)FUN_004df500();         // Read physics table 1\n    _Memory_00 = (void *)FUN_004df500();      // Read physics table 2\n\n    // ... stores tables in physics context ...\n\n    FUN_004de6f0();                            // Finalize context\n    return;\n}\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html#single-physics-table-reader-fun_004df500","title":"Single Physics Table Reader (FUN_004df500)","text":"<p>From FUN_004df500 (lines 152833-152868):</p> <pre><code>void * FUN_004df500(undefined4 param_1) {\n    FUN_004e5080();                       // Initialize context\n    FUN_004e5090(param_1);                // Set context pointer\n\n    // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    // Read entry count (uint32 big-endian)\n    // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    FUN_00509310(&amp;local_c);               // 4 bytes: entry count\n\n    pvVar1 = operator_new(0xa0);          // Allocate physics table\n    FUN_004dee40(local_c);                // Initialize with count\n\n    // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    // Read N entries (28 bytes each)\n    // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    iVar2 = 0;\n    if (0 &lt; local_c) {\n        iVar3 = 0;\n        do {\n            // Read first float3 (12 bytes: 3 \u00d7 fixed-point)\n            FUN_004e5100(*(int *)((int)pvVar1 + 0x34) + iVar3);\n\n            // Read second float3 (12 bytes: 3 \u00d7 fixed-point)\n            FUN_004e5100(*(int *)((int)pvVar1 + 0x38) + iVar3);\n\n            // Read bool flag (4 bytes: uint32)\n            FUN_00509310(&amp;local_8);\n            *(bool *)(iVar2 + *(int *)((int)pvVar1 + 0x3c)) = local_8 != 0;\n\n            iVar2 = iVar2 + 1;\n            iVar3 = iVar3 + 0xc;          // Stride = 12 bytes\n        } while (iVar2 &lt; local_c);\n    }\n\n    // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    // Read final float (4 bytes: fixed-point)\n    // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    FUN_004e5170(&amp;local_4);               // 4 bytes: final float\n    *(double *)((int)pvVar1 + 0x90) = (double)local_4;\n\n    return pvVar1;\n}\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html#float3-reader-fun_004e5100","title":"Float3 Reader (FUN_004e5100)","text":"<p>From FUN_004e5100 (lines 157081-157097):</p> <pre><code>void FUN_004e5100(float *param_1) {\n    FUN_00509310(&amp;local_4);               // Read 4 bytes (fixed-point)\n    fVar1 = (float10)FUN_004dc620(local_4);\n    *param_1 = (float)fVar1;              // Store as float\n\n    FUN_00509310(&amp;local_4);               // Read 4 bytes (fixed-point)\n    fVar1 = (float10)FUN_004dc620(local_4);\n    param_1[1] = (float)fVar1;            // Store as float\n\n    FUN_00509310(&amp;local_4);               // Read 4 bytes (fixed-point)\n    fVar1 = (float10)FUN_004dc620(local_4);\n    param_1[2] = (float)fVar1;            // Store as float\n    return;\n}\n</code></pre> <p>This function reads 3 consecutive fixed-point values (12 bytes total) and converts them to floats.</p>"},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html#physics-table-wire-format","title":"Physics Table Wire Format","text":""},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html#single-physics-table-structure","title":"Single Physics Table Structure","text":"<pre><code>Physics Table Wire Format:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Entry Count  \u2502           Entry Data (N entries)         \u2502  Final Float  \u2502\n\u2502  (4 bytes BE) \u2502         (28 bytes per entry)             \u2502  (4 bytes FP) \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html#physics-table-entry-structure-28-bytes","title":"Physics Table Entry Structure (28 bytes)","text":"<pre><code>Physics Table Entry Wire Format (28 bytes):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset  \u2502 Size \u2502 Reader Func    \u2502 Description                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0-3     \u2502 4    \u2502 FUN_00509310   \u2502 Float3[0] - X component (fixed-point)     \u2502\n\u2502 4-7     \u2502 4    \u2502 FUN_00509310   \u2502 Float3[0] - Y component (fixed-point)     \u2502\n\u2502 8-11    \u2502 4    \u2502 FUN_00509310   \u2502 Float3[0] - Z component (fixed-point)     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 12-15   \u2502 4    \u2502 FUN_00509310   \u2502 Float3[1] - X component (fixed-point)     \u2502\n\u2502 16-19   \u2502 4    \u2502 FUN_00509310   \u2502 Float3[1] - Y component (fixed-point)     \u2502\n\u2502 20-23   \u2502 4    \u2502 FUN_00509310   \u2502 Float3[1] - Z component (fixed-point)     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 24-27   \u2502 4    \u2502 FUN_00509310   \u2502 Bool flag (uint32 BE, non-zero = true)    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nTotal: 12 + 12 + 4 = 28 bytes per entry\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html#physics-table-size-formula","title":"Physics Table Size Formula","text":"<pre><code>Physics Table Size = 4 + (entry_count \u00d7 28) + 4\n\nExamples:\n  0 entries: 4 + (0 \u00d7 28) + 4 = 8 bytes\n  1 entry:   4 + (1 \u00d7 28) + 4 = 36 bytes\n  5 entries: 4 + (5 \u00d7 28) + 4 = 148 bytes\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html#part-2-vehicle-models","title":"Part 2: Vehicle Models","text":""},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html#vehicle-model-registration","title":"Vehicle Model Registration","text":"<p>The client registers exactly 3 vehicle models during initialization in FUN_004e95b0 (lines 160928-160944):</p> <pre><code>void FUN_004e95b0(void) {\n    FUN_004f9a90(&amp;DAT_005c41c4);    // Register Tank_Model\n    FUN_004f6e50(&amp;DAT_005c41c4);    // Register Medic_Model\n    FUN_00501530(&amp;DAT_005c41c4);    // Register Bomber_Model\n\n    // Initialize each model via vtable[0x04]\n    puVar2 = DAT_005c41c8;\n    while (puVar2 != (undefined4 *)0x0) {\n        puVar1 = (undefined4 *)*puVar2;\n        (**(code **)(*(int *)puVar2[2] + 4))();\n        puVar2 = puVar1;\n    }\n}\n</code></pre> <p>Important: The linked list is traversed in registration order. The server must send model data in the order: Tank \u2192 Medic \u2192 Bomber.</p>"},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html#vehicle-model-virtual-table","title":"Vehicle Model Virtual Table","text":"<p>Each vehicle model has a virtual function table (vtable). The relevant entry for BEHAVIOR packet reading:</p> Vtable Offset Function Purpose 0x04 Init Called during client initialization 0x10 Receive Called to read model data from BEHAVIOR packet <p>The <code>FUN_004e9630</code> handler calls <code>vtable[0x10]</code> for each model to read its configuration.</p>"},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html#vehicle-model-1-tank-28-bytes","title":"Vehicle Model 1: Tank (28 bytes)","text":"<p>From FUN_004f94c0 (lines 173247-173260):</p> <pre><code>void __thiscall FUN_004f94c0(int param_1, undefined4 param_2) {\n    FUN_004e5080();                    // Initialize context\n    FUN_004e5090(param_2);             // Set context pointer\n\n    // Read 7 fixed-point doubles (28 bytes total)\n    FUN_004e51d0(param_1 + 0x10);      // 4 bytes: field 1\n    FUN_004e51d0(param_1 + 0x18);      // 4 bytes: field 2\n    FUN_004e51d0(param_1 + 0x20);      // 4 bytes: field 3\n    FUN_004e51d0(param_1 + 0x28);      // 4 bytes: field 4\n    FUN_004e51d0(param_1 + 0x30);      // 4 bytes: field 5\n    FUN_004e51d0(param_1 + 0x38);      // 4 bytes: field 6\n    FUN_004e51d0(param_1 + 0x40);      // 4 bytes: field 7\n    return;\n}\n</code></pre> <pre><code>Tank Model Wire Format (28 bytes):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset  \u2502 Size \u2502 Reader Func    \u2502 Description                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0-3     \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 1 (fixed-point \u2192 double)            \u2502\n\u2502 4-7     \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 2 (fixed-point \u2192 double)            \u2502\n\u2502 8-11    \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 3 (fixed-point \u2192 double)            \u2502\n\u2502 12-15   \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 4 (fixed-point \u2192 double)            \u2502\n\u2502 16-19   \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 5 (fixed-point \u2192 double)            \u2502\n\u2502 20-23   \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 6 (fixed-point \u2192 double)            \u2502\n\u2502 24-27   \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 7 (fixed-point \u2192 double)            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nTotal: 7 \u00d7 4 = 28 bytes\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html#vehicle-model-2-medicscout-36-bytes","title":"Vehicle Model 2: Medic/Scout (36 bytes)","text":"<p>From FUN_004f6860 (lines 171052-171067):</p> <pre><code>void __thiscall FUN_004f6860(int param_1, undefined4 param_2) {\n    FUN_004e5080();                    // Initialize context\n    FUN_004e5090(param_2);             // Set context pointer\n\n    // Read 9 fixed-point doubles (36 bytes total)\n    FUN_004e51d0(param_1 + 0x10);      // 4 bytes: field 1\n    FUN_004e51d0(param_1 + 0x18);      // 4 bytes: field 2\n    FUN_004e51d0(param_1 + 0x20);      // 4 bytes: field 3\n    FUN_004e51d0(param_1 + 0x28);      // 4 bytes: field 4\n    FUN_004e51d0(param_1 + 0x30);      // 4 bytes: field 5\n    FUN_004e51d0(param_1 + 0x38);      // 4 bytes: field 6\n    FUN_004e51d0(param_1 + 0x40);      // 4 bytes: field 7\n    FUN_004e51d0(param_1 + 0x48);      // 4 bytes: field 8\n    FUN_004e51d0(param_1 + 0x50);      // 4 bytes: field 9\n    return;\n}\n</code></pre> <pre><code>Medic Model Wire Format (36 bytes):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset  \u2502 Size \u2502 Reader Func    \u2502 Description                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0-3     \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 1 (fixed-point \u2192 double)            \u2502\n\u2502 4-7     \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 2 (fixed-point \u2192 double)            \u2502\n\u2502 8-11    \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 3 (fixed-point \u2192 double)            \u2502\n\u2502 12-15   \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 4 (fixed-point \u2192 double)            \u2502\n\u2502 16-19   \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 5 (fixed-point \u2192 double)            \u2502\n\u2502 20-23   \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 6 (fixed-point \u2192 double)            \u2502\n\u2502 24-27   \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 7 (fixed-point \u2192 double)            \u2502\n\u2502 28-31   \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 8 (fixed-point \u2192 double)            \u2502\n\u2502 32-35   \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 9 (fixed-point \u2192 double)            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nTotal: 9 \u00d7 4 = 36 bytes\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html#vehicle-model-3-bomber-44-bytes","title":"Vehicle Model 3: Bomber (44 bytes)","text":"<p>From FUN_005012d0 (lines 177793-177810):</p> <pre><code>void __thiscall FUN_005012d0(int param_1, undefined4 param_2) {\n    FUN_004e5080();                    // Initialize context\n    FUN_004e5090(param_2);             // Set context pointer\n\n    // Read 11 fixed-point doubles (44 bytes total)\n    FUN_004e51d0(param_1 + 0x10);      // 4 bytes: field 1\n    FUN_004e51d0(param_1 + 0x18);      // 4 bytes: field 2\n    FUN_004e51d0(param_1 + 0x20);      // 4 bytes: field 3\n    FUN_004e51d0(param_1 + 0x28);      // 4 bytes: field 4\n    FUN_004e51d0(param_1 + 0x30);      // 4 bytes: field 5\n    FUN_004e51d0(param_1 + 0x38);      // 4 bytes: field 6\n    FUN_004e51d0(param_1 + 0x40);      // 4 bytes: field 7\n    FUN_004e51d0(param_1 + 0x48);      // 4 bytes: field 8\n    FUN_004e51d0(param_1 + 0x50);      // 4 bytes: field 9\n    FUN_004e51d0(param_1 + 0x58);      // 4 bytes: field 10\n    FUN_004e51d0(param_1 + 0x60);      // 4 bytes: field 11\n    return;\n}\n</code></pre> <pre><code>Bomber Model Wire Format (44 bytes):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset  \u2502 Size \u2502 Reader Func    \u2502 Description                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0-3     \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 1 (fixed-point \u2192 double)            \u2502\n\u2502 4-7     \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 2 (fixed-point \u2192 double)            \u2502\n\u2502 8-11    \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 3 (fixed-point \u2192 double)            \u2502\n\u2502 12-15   \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 4 (fixed-point \u2192 double)            \u2502\n\u2502 16-19   \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 5 (fixed-point \u2192 double)            \u2502\n\u2502 20-23   \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 6 (fixed-point \u2192 double)            \u2502\n\u2502 24-27   \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 7 (fixed-point \u2192 double)            \u2502\n\u2502 28-31   \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 8 (fixed-point \u2192 double)            \u2502\n\u2502 32-35   \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 9 (fixed-point \u2192 double)            \u2502\n\u2502 36-39   \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 10 (fixed-point \u2192 double)           \u2502\n\u2502 40-43   \u2502 4    \u2502 FUN_004e51d0   \u2502 Field 11 (fixed-point \u2192 double)           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nTotal: 11 \u00d7 4 = 44 bytes\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html#section-size-calculation","title":"Section Size Calculation","text":"<pre><code>Section 5 Minimum Size (with 0 physics table entries):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Physics Tables:                                                        \u2502\n\u2502    Table 1: 4 + (0 \u00d7 28) + 4 = 8 bytes                                  \u2502\n\u2502    Table 2: 4 + (0 \u00d7 28) + 4 = 8 bytes                                  \u2502\n\u2502    Table 3: 4 + (0 \u00d7 28) + 4 = 8 bytes                                  \u2502\n\u2502    Table 4: 4 + (0 \u00d7 28) + 4 = 8 bytes                                  \u2502\n\u2502    Subtotal: 32 bytes                                                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Vehicle Models:                                                        \u2502\n\u2502    Tank Model:  7 \u00d7 4 = 28 bytes                                        \u2502\n\u2502    Medic Model: 9 \u00d7 4 = 36 bytes                                        \u2502\n\u2502    Bomber Model: 11 \u00d7 4 = 44 bytes                                      \u2502\n\u2502    Subtotal: 108 bytes                                                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  TOTAL MINIMUM: 32 + 108 = 140 bytes                                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html#data-flow-diagram","title":"Data Flow Diagram","text":"<pre><code>Section 5 Reading Order:\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  FUN_004df690 - Physics Tables                                          \u2502\n\u2502                                                                         \u2502\n\u2502  FUN_004df5c0(0):                                                       \u2502\n\u2502    \u251c\u2500\u2500 FUN_004df500() \u2192 Physics Table 1                                \u2502\n\u2502    \u2502   [count:4][entries:N\u00d728][final_float:4]                          \u2502\n\u2502    \u2514\u2500\u2500 FUN_004df500() \u2192 Physics Table 2                                \u2502\n\u2502        [count:4][entries:N\u00d728][final_float:4]                          \u2502\n\u2502                                                                         \u2502\n\u2502  FUN_004df5c0(1):                                                       \u2502\n\u2502    \u251c\u2500\u2500 FUN_004df500() \u2192 Physics Table 3                                \u2502\n\u2502    \u2502   [count:4][entries:N\u00d728][final_float:4]                          \u2502\n\u2502    \u2514\u2500\u2500 FUN_004df500() \u2192 Physics Table 4                                \u2502\n\u2502        [count:4][entries:N\u00d728][final_float:4]                          \u2502\n\u2502                                                                         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Vehicle Model Loop (DAT_005c41c8 linked list, registration order)      \u2502\n\u2502                                                                         \u2502\n\u2502  Model 1: Tank_Model::receive (FUN_004f94c0)                           \u2502\n\u2502    [field1:4][field2:4][field3:4][field4:4][field5:4][field6:4]        \u2502\n\u2502    [field7:4]                                                          \u2502\n\u2502    = 28 bytes                                                          \u2502\n\u2502                                                                         \u2502\n\u2502  Model 2: Medic_Model::receive (FUN_004f6860)                          \u2502\n\u2502    [field1:4][field2:4][field3:4][field4:4][field5:4][field6:4]        \u2502\n\u2502    [field7:4][field8:4][field9:4]                                      \u2502\n\u2502    = 36 bytes                                                          \u2502\n\u2502                                                                         \u2502\n\u2502  Model 3: Bomber_Model::receive (FUN_005012d0)                         \u2502\n\u2502    [field1:4][field2:4][field3:4][field4:4][field5:4][field6:4]        \u2502\n\u2502    [field7:4][field8:4][field9:4][field10:4][field11:4]                \u2502\n\u2502    = 44 bytes                                                          \u2502\n\u2502                                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nMinimum Total: 32 + 28 + 36 + 44 = 140 bytes\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html#building-section-5-in-python","title":"Building Section 5 in Python","text":"<pre><code>import struct\n\ndef encode_fixed_point(float_value):\n    \"\"\"Convert a float to fixed-point format (4 bytes big-endian).\"\"\"\n    wire_value = int(float_value * 65536)\n    return struct.pack('&gt;i', wire_value)\n\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n# PHYSICS TABLES\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\ndef create_physics_table_entry(float3_a=(0.0, 0.0, 0.0), \n                                float3_b=(0.0, 0.0, 0.0), \n                                bool_flag=False):\n    \"\"\"\n    Create a single physics table entry (28 bytes).\n\n    Args:\n        float3_a: First 3D vector (x, y, z)\n        float3_b: Second 3D vector (x, y, z)\n        bool_flag: Boolean flag\n\n    Returns:\n        28 bytes of entry data\n    \"\"\"\n    data = bytearray()\n\n    # First float3 (12 bytes)\n    for f in float3_a:\n        data.extend(encode_fixed_point(f))\n\n    # Second float3 (12 bytes)\n    for f in float3_b:\n        data.extend(encode_fixed_point(f))\n\n    # Bool flag as uint32 (4 bytes)\n    data.extend(struct.pack('&gt;I', 1 if bool_flag else 0))\n\n    assert len(data) == 28, f\"Entry should be 28 bytes, got {len(data)}\"\n    return bytes(data)\n\n\ndef create_physics_table(entries=None, final_float=1.0):\n    \"\"\"\n    Create a single physics table.\n\n    Args:\n        entries: List of (float3_a, float3_b, bool_flag) tuples, or None for empty\n        final_float: Final float value at end of table\n\n    Returns:\n        bytes - Physics table data (minimum 8 bytes if empty)\n    \"\"\"\n    data = bytearray()\n\n    if entries is None:\n        entries = []\n\n    # Entry count (4 bytes, uint32 big-endian)\n    data.extend(struct.pack('&gt;I', len(entries)))\n\n    # Entry data (28 bytes each)\n    for float3_a, float3_b, bool_flag in entries:\n        data.extend(create_physics_table_entry(float3_a, float3_b, bool_flag))\n\n    # Final float (4 bytes, fixed-point)\n    data.extend(encode_fixed_point(final_float))\n\n    expected_size = 4 + (len(entries) * 28) + 4\n    assert len(data) == expected_size, f\"Table should be {expected_size} bytes, got {len(data)}\"\n    return bytes(data)\n\n\ndef create_all_physics_tables():\n    \"\"\"\n    Create all 4 physics tables (32 bytes minimum if all empty).\n\n    Returns:\n        bytes - All physics tables data\n    \"\"\"\n    data = bytearray()\n\n    # FUN_004df5c0(0) - first pair\n    data.extend(create_physics_table())  # Table 1\n    data.extend(create_physics_table())  # Table 2\n\n    # FUN_004df5c0(1) - second pair\n    data.extend(create_physics_table())  # Table 3\n    data.extend(create_physics_table())  # Table 4\n\n    return bytes(data)\n\n\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n# VEHICLE MODELS\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\ndef create_tank_model(fields=None):\n    \"\"\"\n    Create Tank model data (28 bytes = 7 fields).\n\n    Args:\n        fields: List of 7 float values, or None for defaults (all 1.0)\n\n    Returns:\n        28 bytes of Tank model data\n    \"\"\"\n    if fields is None:\n        fields = [1.0] * 7\n\n    assert len(fields) == 7, f\"Tank model needs 7 fields, got {len(fields)}\"\n\n    data = bytearray()\n    for value in fields:\n        data.extend(encode_fixed_point(value))\n\n    assert len(data) == 28, f\"Tank model should be 28 bytes, got {len(data)}\"\n    return bytes(data)\n\n\ndef create_medic_model(fields=None):\n    \"\"\"\n    Create Medic/Scout model data (36 bytes = 9 fields).\n\n    Args:\n        fields: List of 9 float values, or None for defaults (all 1.0)\n\n    Returns:\n        36 bytes of Medic model data\n    \"\"\"\n    if fields is None:\n        fields = [1.0] * 9\n\n    assert len(fields) == 9, f\"Medic model needs 9 fields, got {len(fields)}\"\n\n    data = bytearray()\n    for value in fields:\n        data.extend(encode_fixed_point(value))\n\n    assert len(data) == 36, f\"Medic model should be 36 bytes, got {len(data)}\"\n    return bytes(data)\n\n\ndef create_bomber_model(fields=None):\n    \"\"\"\n    Create Bomber model data (44 bytes = 11 fields).\n\n    Args:\n        fields: List of 11 float values, or None for defaults (all 1.0)\n\n    Returns:\n        44 bytes of Bomber model data\n    \"\"\"\n    if fields is None:\n        fields = [1.0] * 11\n\n    assert len(fields) == 11, f\"Bomber model needs 11 fields, got {len(fields)}\"\n\n    data = bytearray()\n    for value in fields:\n        data.extend(encode_fixed_point(value))\n\n    assert len(data) == 44, f\"Bomber model should be 44 bytes, got {len(data)}\"\n    return bytes(data)\n\n\ndef create_all_vehicle_models():\n    \"\"\"\n    Create all 3 vehicle models (108 bytes total).\n    Order: Tank, Medic, Bomber (registration order).\n\n    Returns:\n        bytes - All vehicle model data\n    \"\"\"\n    data = bytearray()\n\n    data.extend(create_tank_model())    # 28 bytes\n    data.extend(create_medic_model())   # 36 bytes\n    data.extend(create_bomber_model())  # 44 bytes\n\n    assert len(data) == 108, f\"Vehicle models should be 108 bytes, got {len(data)}\"\n    return bytes(data)\n\n\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n# SECTION 5 COMPLETE\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\ndef create_behavior_section_5():\n    \"\"\"\n    Create the complete Section 5 data for BEHAVIOR packet.\n\n    Returns:\n        bytes - Section 5 data (minimum 140 bytes)\n    \"\"\"\n    data = bytearray()\n\n    # Part 1: Physics tables (32 bytes minimum)\n    data.extend(create_all_physics_tables())\n\n    # Part 2: Vehicle models (108 bytes)\n    data.extend(create_all_vehicle_models())\n\n    # Minimum: 32 + 108 = 140 bytes\n    return bytes(data)\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html#simplified-version-all-defaults","title":"Simplified Version (All Defaults)","text":"<p>For initial testing, you can use this minimal implementation:</p> <pre><code>def create_empty_section_5():\n    \"\"\"\n    Create minimum valid Section 5 (140 bytes).\n    All physics tables empty, all vehicle model fields = 1.0.\n    \"\"\"\n    data = bytearray()\n\n    # 4 empty physics tables (8 bytes each = 32 bytes)\n    for _ in range(4):\n        data.extend(struct.pack('&gt;I', 0))       # count = 0\n        data.extend(encode_fixed_point(1.0))    # final float\n\n    # 3 vehicle models with default values (108 bytes)\n    # Tank: 7 fields\n    for _ in range(7):\n        data.extend(encode_fixed_point(1.0))\n    # Medic: 9 fields\n    for _ in range(9):\n        data.extend(encode_fixed_point(1.0))\n    # Bomber: 11 fields\n    for _ in range(11):\n        data.extend(encode_fixed_point(1.0))\n\n    assert len(data) == 140, f\"Section 5 should be 140 bytes, got {len(data)}\"\n    return bytes(data)\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html#example-section-5-bytes-minimum-valid","title":"Example Section 5 Bytes (Minimum Valid)","text":"<pre><code>Section 5 (140 bytes) with empty physics tables and default model values:\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\nPHYSICS TABLES (32 bytes):\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nTable 1 (8 bytes):\n  00 00 00 00              Count: 0 entries\n  00 01 00 00              Final float: 1.0\n\nTable 2 (8 bytes):\n  00 00 00 00              Count: 0 entries\n  00 01 00 00              Final float: 1.0\n\nTable 3 (8 bytes):\n  00 00 00 00              Count: 0 entries\n  00 01 00 00              Final float: 1.0\n\nTable 4 (8 bytes):\n  00 00 00 00              Count: 0 entries\n  00 01 00 00              Final float: 1.0\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\nVEHICLE MODELS (108 bytes):\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nTank Model (28 bytes):\n  00 01 00 00              Field 1: 1.0\n  00 01 00 00              Field 2: 1.0\n  00 01 00 00              Field 3: 1.0\n  00 01 00 00              Field 4: 1.0\n  00 01 00 00              Field 5: 1.0\n  00 01 00 00              Field 6: 1.0\n  00 01 00 00              Field 7: 1.0\n\nMedic Model (36 bytes):\n  00 01 00 00              Field 1: 1.0\n  00 01 00 00              Field 2: 1.0\n  00 01 00 00              Field 3: 1.0\n  00 01 00 00              Field 4: 1.0\n  00 01 00 00              Field 5: 1.0\n  00 01 00 00              Field 6: 1.0\n  00 01 00 00              Field 7: 1.0\n  00 01 00 00              Field 8: 1.0\n  00 01 00 00              Field 9: 1.0\n\nBomber Model (44 bytes):\n  00 01 00 00              Field 1: 1.0\n  00 01 00 00              Field 2: 1.0\n  00 01 00 00              Field 3: 1.0\n  00 01 00 00              Field 4: 1.0\n  00 01 00 00              Field 5: 1.0\n  00 01 00 00              Field 6: 1.0\n  00 01 00 00              Field 7: 1.0\n  00 01 00 00              Field 8: 1.0\n  00 01 00 00              Field 9: 1.0\n  00 01 00 00              Field 10: 1.0\n  00 01 00 00              Field 11: 1.0\n</code></pre> <p>Full Hex Dump (140 bytes): <pre><code>00 00 00 00 00 01 00 00 00 00 00 00 00 01 00 00\n00 00 00 00 00 01 00 00 00 00 00 00 00 01 00 00\n00 01 00 00 00 01 00 00 00 01 00 00 00 01 00 00\n00 01 00 00 00 01 00 00 00 01 00 00 00 01 00 00\n00 01 00 00 00 01 00 00 00 01 00 00 00 01 00 00\n00 01 00 00 00 01 00 00 00 01 00 00 00 01 00 00\n00 01 00 00 00 01 00 00 00 01 00 00 00 01 00 00\n00 01 00 00 00 01 00 00 00 01 00 00 00 01 00 00\n00 01 00 00 00 01 00 00 00 01 00 00\n</code></pre></p>"},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html#vehicle-model-summary","title":"Vehicle Model Summary","text":"Model Handler Function Field Count Wire Size Tank FUN_004f94c0 7 28 bytes Medic/Scout FUN_004f6860 9 36 bytes Bomber FUN_005012d0 11 44 bytes Total 27 108 bytes"},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html#common-mistakes","title":"Common Mistakes","text":"Mistake Symptom Fix Missing Section 5 entirely Client reads garbage, corrupted physics Add 140+ bytes of Section 5 data Wrong physics table count Data misalignment Send exactly 4 physics tables Wrong vehicle model order Tank/Medic/Bomber params swapped Order: Tank \u2192 Medic \u2192 Bomber Missing final float in tables Off-by-4 bytes per table Each table needs 4-byte final float Little-endian encoding Garbled values Use big-endian (<code>&gt;I</code>, <code>&gt;i</code>) Using 8-byte doubles Extra bytes corrupt data Fixed-point values are 4 bytes Wrong vehicle model field count Model data truncated/extended Tank=7, Medic=9, Bomber=11"},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html#verification-checklist","title":"Verification Checklist","text":"<p>Before finalizing the BEHAVIOR packet, verify Section 5:</p> <ul> <li>[ ] Exactly 4 physics tables</li> <li>[ ] Each physics table has: count (4 bytes) + entries (N\u00d728 bytes) + final float (4 bytes)</li> <li>[ ] Physics table entries: 12 + 12 + 4 = 28 bytes each</li> <li>[ ] Exactly 3 vehicle models in order: Tank, Medic, Bomber</li> <li>[ ] Tank model: exactly 28 bytes (7 fields)</li> <li>[ ] Medic model: exactly 36 bytes (9 fields)</li> <li>[ ] Bomber model: exactly 44 bytes (11 fields)</li> <li>[ ] Total Section 5: minimum 140 bytes</li> <li>[ ] All multi-byte values are big-endian</li> <li>[ ] All float values use fixed-point encoding (\u00d7 65536)</li> </ul>"},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html#section-summary","title":"Section Summary","text":"Property Value Section Number 5 Handler Function FUN_004e9630 Physics Tables 4 (read via FUN_004df690) Vehicle Models 3 (Tank, Medic, Bomber) Minimum Section Size 140 bytes Position After Vehicle Type Data (offset 2,975) Position Before Packet Finalization (byte alignment)"},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html#cumulative-offset-after-section-5","title":"Cumulative Offset After Section 5","text":"<pre><code>After Section 5 (Complete BEHAVIOR Payload):\n  Fixed Header:              95 bytes\n  Entity Weapon Data:        2,340 bytes\n  Entity Core Stats:         468 bytes\n  Vehicle Type Data:         72 bytes\n  Physics Tables + Models:   140 bytes (minimum)\n  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  TOTAL MINIMUM PAYLOAD:     3,115 bytes\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html#complete-behavior-packet-size","title":"Complete BEHAVIOR Packet Size","text":"<pre><code>Complete BEHAVIOR Packet:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    TYPE      \u2502   LENGTH     \u2502              PAYLOAD                        \u2502\n\u2502   (1 byte)   \u2502 (2 bytes BE) \u2502           (3,115+ bytes)                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502     0x24     \u2502    varies    \u2502  Section 1 + 2 + 3 + 4 + 5                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nMinimum total wire size: 1 + 2 + 3,115 = 3,118 bytes\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-5-physics-tables.html#after-behavior-byte-alignment","title":"After BEHAVIOR: Byte Alignment","text":"<p>After Section 5, the client calls <code>FUN_00509dc0</code> for byte alignment. This function:</p> <ol> <li>Checks if the bit stream is byte-aligned</li> <li>If not, reads 0-7 padding bits to reach a byte boundary</li> </ol> <p>For a server sending byte-aligned data, no additional padding is needed. The client will simply verify alignment and continue.</p> <pre><code>// From FUN_00509410 (called by FUN_00509dc0)\nvoid __fastcall FUN_00509410(int param_1) {\n    if (**(int **)(param_1 + 0x18) != 0) {\n        iVar1 = FUN_004dc7d0(0);\n        if (*(int *)(iVar1 + 8) != 0) {\n            // Read padding bits: 8 - current_bit_position\n            FUN_00508ba0(param_1, iVar1, 0, 8 - *(int *)(iVar1 + 8));\n        }\n    }\n}\n</code></pre> <p>Note: If you're sending complete bytes (which you should be), the bit position will be 0 and no padding is needed.</p> <p>Previous: Part 4-4: BEHAVIOR - Vehicle Type Data Next: Part 5: TEAM_INFO Packet</p>"},{"location":"part-4-behavior-packet/part-4-6-packet-finalization.html","title":"Wulfram 2 Server Implementation Guide","text":""},{"location":"part-4-behavior-packet/part-4-6-packet-finalization.html#part-4-6-behavior-packet-packet-finalization-byte-alignment","title":"Part 4-6: BEHAVIOR Packet - Packet Finalization &amp; Byte Alignment","text":""},{"location":"part-4-behavior-packet/part-4-6-packet-finalization.html#overview","title":"Overview","text":"<p>After all five data sections of the BEHAVIOR packet have been read, the client performs a byte alignment step to ensure the internal bit stream is properly synchronized. While this step is typically transparent for server implementations, understanding it is crucial for debugging protocol mismatches.</p> <pre><code>Position in BEHAVIOR Packet:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  SECTION 1: Fixed Header (95 bytes)                        \u2713 Complete  \u2502\n\u2502  SECTION 2: Entity Weapon Data (2,340 bytes)               \u2713 Complete  \u2502\n\u2502  SECTION 3: Entity Core Stats (468 bytes)                  \u2713 Complete  \u2502\n\u2502  SECTION 4: Vehicle Type Data (72 bytes)                   \u2713 Complete  \u2502\n\u2502  SECTION 5: Physics Tables + Vehicle Models (140+ bytes)   \u2713 Complete  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  PACKET FINALIZATION: Byte Alignment (0-7 bits)            \u25c4 YOU ARE   \u2502\n\u2502                       Ensures bit stream is byte-aligned       HERE    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-6-packet-finalization.html#why-byte-alignment-exists","title":"Why Byte Alignment Exists","text":"<p>Wulfram 2 internally uses a bit-oriented buffer system that can read and write arbitrary numbers of bits. While the BEHAVIOR packet sends byte-aligned data (8, 16, 32 bits), the internal bit counter may become misaligned if:</p> <ol> <li>Any sub-byte reads occurred (e.g., boolean flags)</li> <li>Protocol errors caused partial reads</li> <li>The packet structure changed between client/server versions</li> </ol> <p>The byte alignment step acts as a synchronization checkpoint that: - Verifies the packet was read correctly - Discards any residual bits before the next packet - Provides error detection for protocol mismatches</p>"},{"location":"part-4-behavior-packet/part-4-6-packet-finalization.html#the-handler-code","title":"The Handler Code","text":"<p>From the end of FUN_0046dc00 (BEHAVIOR handler), line 77982:</p> <pre><code>void FUN_0046dc00(param_1, param_2, param_3) {\n    // ... (Sections 1-5 reading) ...\n\n    FUN_004e2f90(param_3);   // Section 2: Entity weapon data\n    FUN_004e4a80(param_3);   // Section 3: Entity core stats\n    FUN_004e5ce0(param_3);   // Section 4: Vehicle type data\n    FUN_004e9630(param_3);   // Section 5: Physics + vehicle models\n\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    // PACKET FINALIZATION: Byte alignment\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    FUN_00509dc0(param_3, param_2);    // Align bit stream\n}\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-6-packet-finalization.html#fun_00509dc0-alignment-entry-point","title":"FUN_00509dc0: Alignment Entry Point","text":"<p>From FUN_00509dc0 (lines 185486-185491):</p> <pre><code>void FUN_00509dc0(void) {\n    FUN_00509410();\n    return;\n}\n</code></pre> <p>This is a simple wrapper that calls the actual alignment function.</p>"},{"location":"part-4-behavior-packet/part-4-6-packet-finalization.html#fun_00509410-alignment-implementation","title":"FUN_00509410: Alignment Implementation","text":"<p>From FUN_00509410 (lines 184780-184792):</p> <pre><code>void __fastcall FUN_00509410(int param_1) {\n    int iVar1;\n\n    // Check if there's data remaining in the bit stream\n    if (**(int **)(param_1 + 0x18) != 0) {\n\n        // Get current bit buffer context\n        iVar1 = FUN_004dc7d0(0);\n\n        // Check if bit position is non-zero (not byte-aligned)\n        if (*(int *)(iVar1 + 8) != 0) {\n\n            // Read padding bits to reach byte boundary\n            // Formula: 8 - current_bit_position\n            FUN_00508ba0(param_1, iVar1, 0, 8 - *(int *)(iVar1 + 8));\n        }\n    }\n    return;\n}\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-6-packet-finalization.html#the-bit-stream-context-structure","title":"The Bit Stream Context Structure","text":"<p>The client maintains a bit buffer context for reading packet data:</p> <pre><code>Bit Buffer Context Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset  \u2502 Size \u2502 Description                                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0x00    \u2502 4    \u2502 Pointer to raw data buffer                              \u2502\n\u2502 0x04    \u2502 4    \u2502 Current byte position                                   \u2502\n\u2502 0x08    \u2502 4    \u2502 Current bit position within byte (0-7)                  \u2502\n\u2502 0x0C    \u2502 4    \u2502 Byte offset (for multi-buffer scenarios)                \u2502\n\u2502 0x10    \u2502 4    \u2502 Bit offset within current byte                          \u2502\n\u2502 0x14    \u2502 4    \u2502 Total bits read/written                                 \u2502\n\u2502 0x18    \u2502 4    \u2502 Total bits available in buffer                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>The key field is offset 0x08 (bit position within byte): - If 0: Already byte-aligned, no padding needed - If 1-7: Must read <code>8 - bit_position</code> padding bits</p>"},{"location":"part-4-behavior-packet/part-4-6-packet-finalization.html#how-alignment-works","title":"How Alignment Works","text":"<pre><code>Byte Alignment Process:\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nCase 1: Already Aligned (bit_position = 0)\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Last byte read:    [\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588]                                         \u2502\n\u2502  Bit position:               ^ = 0 (aligned)                           \u2502\n\u2502  Action:            No padding needed                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nCase 2: Not Aligned (bit_position = 3)\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Last byte read:    [\u2588\u2588\u2588.....] [next packet...]                        \u2502\n\u2502  Bit position:         ^ = 3 (not aligned)                             \u2502\n\u2502  Padding bits:      8 - 3 = 5 bits                                     \u2502\n\u2502  Action:            Read 5 padding bits (value ignored)                \u2502\n\u2502  After alignment:   [\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588] [next packet...]                        \u2502\n\u2502  Bit position:               ^ = 0 (now aligned)                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nCase 3: Not Aligned (bit_position = 7)\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Last byte read:    [\u2588\u2588\u2588\u2588\u2588\u2588\u2588.] [next packet...]                        \u2502\n\u2502  Bit position:              ^ = 7 (not aligned)                        \u2502\n\u2502  Padding bits:      8 - 7 = 1 bit                                      \u2502\n\u2502  Action:            Read 1 padding bit (value ignored)                 \u2502\n\u2502  After alignment:   [\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588] [next packet...]                        \u2502\n\u2502  Bit position:               ^ = 0 (now aligned)                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-6-packet-finalization.html#fun_00508ba0-the-bit-skip-function","title":"FUN_00508ba0: The Bit Skip Function","text":"<p>From FUN_00508ba0 (lines 184269-184292):</p> <pre><code>void FUN_00508ba0(int param_1, undefined4 *param_2, int param_3, int param_4) {\n    int iVar1;\n\n    // Calculate total bits to skip: (param_3 * 8) + param_4\n    param_4 = param_4 + param_3 * 8;\n\n    // Calculate byte advancement\n    iVar1 = param_2[2] + param_4 &gt;&gt; 3;\n\n    // Update byte position\n    param_2[1] = param_2[1] + iVar1;\n\n    // Update bit position within byte (modulo 8)\n    param_2[2] = param_2[2] + param_4 + iVar1 * -8;\n\n    // Update bits consumed counter\n    param_2[6] = param_2[6] + param_4;\n\n    // Update remaining bits\n    *(int *)(param_1 + 0x1c) = *(int *)(param_1 + 0x1c) - param_4;\n\n    // Check if buffer is exhausted\n    if (param_2[6] == param_2[5]) {\n        // Free the buffer if fully consumed\n        // ...\n    }\n    return;\n}\n</code></pre> <p>When called from <code>FUN_00509410</code>, the parameters are: - <code>param_3 = 0</code> (no full bytes) - <code>param_4 = 8 - bit_position</code> (remaining bits in current byte)</p>"},{"location":"part-4-behavior-packet/part-4-6-packet-finalization.html#for-server-implementers-what-this-means","title":"For Server Implementers: What This Means","text":""},{"location":"part-4-behavior-packet/part-4-6-packet-finalization.html#good-news-usually-nothing-to-do","title":"Good News: Usually Nothing to Do","text":"<p>If your server sends byte-aligned data (which it should), the client's bit position will always be 0 at the end of BEHAVIOR processing, and no padding is needed.</p> <p>All standard Wulfram 2 data types are byte-aligned: - <code>uint8</code>: 8 bits (1 byte) - <code>uint16</code>: 16 bits (2 bytes) - <code>uint32</code>: 32 bits (4 bytes) - <code>fixed-point</code>: 32 bits (4 bytes) - Strings: Length prefix (2 bytes) + data (N bytes)</p>"},{"location":"part-4-behavior-packet/part-4-6-packet-finalization.html#when-alignment-matters","title":"When Alignment Matters","text":"<p>Alignment becomes relevant when:</p> <ol> <li> <p>Debugging Protocol Mismatches: If your packet is the wrong size, the client may end up with a non-zero bit position, and the alignment step will consume bits from the next packet.</p> </li> <li> <p>Custom Extensions: If you ever add sub-byte fields (unlikely), you'd need to add explicit padding.</p> </li> <li> <p>Error Detection: A non-zero bit position at alignment time could indicate a structural error in your packet.</p> </li> </ol>"},{"location":"part-4-behavior-packet/part-4-6-packet-finalization.html#protocol-mismatch-detection","title":"Protocol Mismatch Detection","text":"<p>The client's bit reading function (<code>FUN_00509050</code>) includes error detection:</p> <pre><code>// From FUN_00509050 (lines 184570-184575)\nif (**(int **)(param_1 + 0x18) == 0) {\n    _sprintf(&amp;DAT_005d5f10,\n             \"Mem_buff::retrieve_bits out of hunks while reading [%s]\",\n             DAT_005d5f08);  // Contains \"BEHAVIOR\"\n    FUN_0050a860(4, &amp;DAT_005d5f10,\n                 \"This is most likely a protocol missmatch\",\n                 *(undefined4 *)(param_1 + 4));\n    return 0;\n}\n</code></pre> <p>This error means: The client tried to read more data than the packet contains.</p> <p>Common causes: 1. Wrong section sizes: Missing or undersized sections 2. Wrong field counts: Incorrect number of entities/weapons/vehicles 3. Wrong data types: Using 2-byte values where 4-byte expected 4. Byte order errors: Little-endian instead of big-endian</p>"},{"location":"part-4-behavior-packet/part-4-6-packet-finalization.html#packet-size-validation","title":"Packet Size Validation","text":"<p>The byte alignment step indirectly validates packet size:</p> <pre><code>Packet Size Scenarios:\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nCORRECT: Packet exactly matches expected size\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Sent:     [Section1][Section2][Section3][Section4][Section5]          \u2502\n\u2502  Expected: [Section1][Section2][Section3][Section4][Section5]          \u2502\n\u2502  Result:   \u2713 All sections read correctly                               \u2502\n\u2502            \u2713 Bit position = 0 at alignment                             \u2502\n\u2502            \u2713 Client ready for next packet                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nERROR: Packet too small\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Sent:     [Section1][Section2][Section3][Section4]  (missing Sec 5)   \u2502\n\u2502  Expected: [Section1][Section2][Section3][Section4][Section5]          \u2502\n\u2502  Result:   \u2717 Client runs out of data reading Section 5                 \u2502\n\u2502            \u2717 Error: \"out of hunks while reading [BEHAVIOR]\"            \u2502\n\u2502            \u2717 \"This is most likely a protocol missmatch\"                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nERROR: Packet too large\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Sent:     [Section1][Section2][Section3][Section4][Section5][EXTRA]   \u2502\n\u2502  Expected: [Section1][Section2][Section3][Section4][Section5]          \u2502\n\u2502  Result:   \u26a0 All sections read correctly                               \u2502\n\u2502            \u26a0 Extra bytes remain in buffer                              \u2502\n\u2502            \u26a0 May corrupt next packet parsing                           \u2502\n\u2502            \u26a0 Could cause delayed errors                                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-6-packet-finalization.html#server-implementation-no-explicit-alignment-needed","title":"Server Implementation: No Explicit Alignment Needed","text":"<p>For your server, you do NOT need to add any alignment bytes or padding to the BEHAVIOR packet. The standard sections are all byte-aligned:</p> <pre><code>def create_behavior_packet(section_1, section_2, section_3, section_4, section_5):\n    \"\"\"\n    Assemble the complete BEHAVIOR packet.\n\n    All sections are byte-aligned - no padding needed!\n    \"\"\"\n    payload = bytearray()\n\n    payload.extend(section_1)   # 95 bytes (byte-aligned)\n    payload.extend(section_2)   # 2340 bytes (byte-aligned)\n    payload.extend(section_3)   # 468 bytes (byte-aligned)\n    payload.extend(section_4)   # 72 bytes (byte-aligned)\n    payload.extend(section_5)   # 140+ bytes (byte-aligned)\n\n    # NO PADDING NEEDED - total is already byte-aligned\n\n    # Create packet frame\n    packet = bytearray()\n    packet.append(0x24)  # BEHAVIOR packet type\n    packet.extend(struct.pack('&gt;H', len(payload)))  # Length\n    packet.extend(payload)\n\n    return bytes(packet)\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-6-packet-finalization.html#debugging-alignment-issues","title":"Debugging Alignment Issues","text":"<p>If you encounter alignment-related errors, check:</p>"},{"location":"part-4-behavior-packet/part-4-6-packet-finalization.html#1-total-packet-size","title":"1. Total Packet Size","text":"<pre><code>def verify_behavior_packet_size(packet):\n    \"\"\"Verify BEHAVIOR packet has correct minimum size.\"\"\"\n    payload_length = struct.unpack('&gt;H', packet[1:3])[0]\n\n    expected_minimum = 95 + 2340 + 468 + 72 + 140  # = 3115 bytes\n\n    if payload_length &lt; expected_minimum:\n        print(f\"ERROR: Payload {payload_length} bytes, expected &gt;= {expected_minimum}\")\n\n        # Calculate where the shortfall is\n        remaining = payload_length\n        sections = [\n            (\"Fixed Header\", 95),\n            (\"Entity Weapon Data\", 2340),\n            (\"Entity Core Stats\", 468),\n            (\"Vehicle Type Data\", 72),\n            (\"Physics + Models\", 140),\n        ]\n\n        for name, size in sections:\n            if remaining &gt;= size:\n                remaining -= size\n                print(f\"  \u2713 {name}: {size} bytes OK\")\n            else:\n                print(f\"  \u2717 {name}: Expected {size} bytes, only {remaining} remaining!\")\n                break\n    else:\n        print(f\"OK: Payload {payload_length} bytes (minimum {expected_minimum})\")\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-6-packet-finalization.html#2-section-boundaries","title":"2. Section Boundaries","text":"<p>Verify each section starts at the correct offset:</p> <pre><code>Section Offsets (within payload):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Section 1 (Fixed Header):       Offset 0      (95 bytes)              \u2502\n\u2502  Section 2 (Entity Weapon):      Offset 95     (2340 bytes)            \u2502\n\u2502  Section 3 (Entity Core Stats):  Offset 2435   (468 bytes)             \u2502\n\u2502  Section 4 (Vehicle Type):       Offset 2903   (72 bytes)              \u2502\n\u2502  Section 5 (Physics + Models):   Offset 2975   (140+ bytes)            \u2502\n\u2502  End of minimum packet:          Offset 3115                           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-6-packet-finalization.html#3-byte-order","title":"3. Byte Order","text":"<p>Verify all multi-byte values use big-endian encoding:</p> <pre><code># CORRECT\nstruct.pack('&gt;I', value)  # Big-endian (network byte order)\n\n# WRONG\nstruct.pack('&lt;I', value)  # Little-endian (x86 native)\nstruct.pack('I', value)   # Platform-dependent (BAD!)\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-6-packet-finalization.html#summary-byte-alignment","title":"Summary: Byte Alignment","text":"Aspect Details Handler Function FUN_00509dc0 \u2192 FUN_00509410 Purpose Align bit stream to byte boundary Padding Bits 0-7 bits (calculated as <code>8 - current_bit_position</code>) Server Action None required - all sections are byte-aligned When It Matters Debugging protocol mismatches Error Indicator Non-zero bit position suggests structural issues"},{"location":"part-4-behavior-packet/part-4-6-packet-finalization.html#complete-behavior-packet-structure","title":"Complete BEHAVIOR Packet Structure","text":"<pre><code>Complete BEHAVIOR Packet:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  PACKET HEADER                                                           \u2502\n\u2502  \u251c\u2500 Type: 0x24 (1 byte)                                                 \u2502\n\u2502  \u2514\u2500 Length: payload size (2 bytes, big-endian)                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  PAYLOAD                                                                 \u2502\n\u2502  \u251c\u2500 Section 1: Fixed Header              (95 bytes)      Offset: 0      \u2502\n\u2502  \u251c\u2500 Section 2: Entity Weapon Data        (2,340 bytes)   Offset: 95     \u2502\n\u2502  \u251c\u2500 Section 3: Entity Core Stats         (468 bytes)     Offset: 2,435  \u2502\n\u2502  \u251c\u2500 Section 4: Vehicle Type Data         (72 bytes)      Offset: 2,903  \u2502\n\u2502  \u2514\u2500 Section 5: Physics Tables + Models   (140+ bytes)    Offset: 2,975  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  BYTE ALIGNMENT                                                          \u2502\n\u2502  \u2514\u2500 (Implicit - no wire bytes if already aligned)                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nMinimum total size:\n  Header:  3 bytes (type + length)\n  Payload: 3,115 bytes\n  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  Total:   3,118 bytes minimum\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-6-packet-finalization.html#quick-reference-behavior-packet-sizes","title":"Quick Reference: BEHAVIOR Packet Sizes","text":"Component Size Cumulative Offset Packet Header 3 bytes - Section 1: Fixed Header 95 bytes 0 Section 2: Entity Weapon Data 2,340 bytes 95 Section 3: Entity Core Stats 468 bytes 2,435 Section 4: Vehicle Type Data 72 bytes 2,903 Section 5: Physics + Models 140+ bytes 2,975 Total Payload (minimum) 3,115 bytes 3,115 Total Packet (minimum) 3,118 bytes -"},{"location":"part-4-behavior-packet/part-4-6-packet-finalization.html#what-happens-next","title":"What Happens Next?","text":"<p>After successfully processing the BEHAVIOR packet:</p> <ol> <li>The client's bit stream is byte-aligned</li> <li>The client has received all game configuration data</li> <li>The client is ready for the next packet (TEAM_INFO)</li> <li>The game can proceed to team selection</li> </ol> <p>In Part 4-7, we'll provide an overview of the post-BEHAVIOR packet flow and what the client expects next.</p> <p>Previous: Part 4-5: BEHAVIOR - Physics Tables + Vehicle Models Next: Part 4-7: Post-BEHAVIOR Flow Overview</p>"},{"location":"part-4-behavior-packet/part-4-7-post-behavior-flow.html","title":"Wulfram 2 Server Implementation Guide","text":""},{"location":"part-4-behavior-packet/part-4-7-post-behavior-flow.html#part-4-7-post-behavior-flow-overview","title":"Part 4-7: Post-BEHAVIOR Flow Overview","text":""},{"location":"part-4-behavior-packet/part-4-7-post-behavior-flow.html#overview","title":"Overview","text":"<p>After successfully processing the BEHAVIOR packet, the client has received all game configuration data but is not yet in the game. This document provides a high-level overview of the packet flow that transitions the client from post-BEHAVIOR through team selection and into active gameplay.</p> <pre><code>BEHAVIOR Packet Complete\n         \u2551\n         \u2551 Client has: weapon data, entity stats, vehicle types,\n         \u2551             physics tables, vehicle model parameters\n         \u2551\n         \u2551 Client needs: team info, player assignment, world state\n         \u2551\n         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   POST-BEHAVIOR PACKET FLOW                             \u2502\n\u2502                                                                         \u2502\n\u2502  PHASE 2B: TEAM SELECTION SETUP                                         \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                      \u2502\n\u2502  Server \u2500\u2500\u25ba TEAM_INFO (0x28)                                           \u2502\n\u2502             Client now shows team selection screen                      \u2502\n\u2502                                                                         \u2502\n\u2502  PHASE 3: GAME ENTRY                                                    \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                                    \u2502\n\u2502  Client \u2500\u2500\u25ba REINCARNATE (0x25)   Player chooses team                   \u2502\n\u2502  Server \u2500\u2500\u25ba REINCARNATE (0x25)   Server confirms/responds              \u2502\n\u2502  Server \u2500\u2500\u25ba PLAYER (0x17)        Assigns player to entity    CRITICAL! \u2502\n\u2502  Server \u2500\u2500\u25ba GAME_CLOCK (0x2F)    Synchronizes game time                \u2502\n\u2502  Server \u2500\u2500\u25ba ADD_TO_ROSTER (0x1A) Adds player to team roster            \u2502\n\u2502                                                                         \u2502\n\u2502  PHASE 4: ACTIVE GAMEPLAY                                               \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                               \u2502\n\u2502  Client \u2500\u2500\u25ba WANT_UPDATES (0x39)  Requests game state updates           \u2502\n\u2502  Server \u2500\u2500\u25ba UPDATE_ARRAY (0x0E)  Sends entity positions/states         \u2502\n\u2502  Server \u2500\u2500\u25ba WORLD_STATS (0x16)   Map/world information                 \u2502\n\u2502             ... bidirectional game traffic ...                          \u2502\n\u2502                                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-7-post-behavior-flow.html#packet-type-quick-reference","title":"Packet Type Quick Reference","text":"Packet Name Type ID Direction Purpose TEAM_INFO 0x28 Server\u2192Client Team names/colors for selection screen REINCARNATE 0x25 Bidirectional Team/spawn selection and responses PLAYER 0x17 Server\u2192Client CRITICAL - Assigns player to entity WORLD_STATS 0x16 Server\u2192Client Map name and world parameters GAME_CLOCK 0x2F Server\u2192Client Game time synchronization ADD_TO_ROSTER 0x1A Server\u2192Client Adds player to team roster REMOVE_FROM_ROSTER 0x1B Server\u2192Client Removes player from roster WANT_UPDATES 0x39 Client\u2192Server Client requests state updates UPDATE_ARRAY 0x0E Server\u2192Client Entity state updates (positions, etc.) BIRTH_NOTICE 0x1E Server\u2192Client Entity spawned notification DEATH_NOTICE 0x1D Server\u2192Client Entity destroyed notification"},{"location":"part-4-behavior-packet/part-4-7-post-behavior-flow.html#phase-2b-team-selection-setup","title":"Phase 2B: Team Selection Setup","text":"<p>After BEHAVIOR, the server must send TEAM_INFO to display the team selection screen.</p> <pre><code>SERVER                                     CLIENT\n   \u2502                                          \u2502\n   \u2502  (BEHAVIOR processed successfully)       \u2502\n   \u2502                                          \u2502\n   \u2502\u2500\u2500\u2500\u2500\u2500 TEAM_INFO (0x28) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n   \u2502      - Team 1 info (ID, names, colors)   \u2502\n   \u2502      - Team 2 info (ID, names, colors)   \u2502\n   \u2502                                          \u2502\n   \u2502                                          \u2502 Client shows\n   \u2502                                          \u2502 TEAM SELECTION\n   \u2502                                          \u2502 screen\n   \u2502                                          \u2502\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-7-post-behavior-flow.html#team_info-packet-structure-0x28","title":"TEAM_INFO Packet Structure (0x28)","text":"<p>From FUN_0046df00 (lines 78024-78077):</p> <pre><code>void FUN_0046df00(param_1, param_2, param_3) {\n    FUN_00509db0(\"TEAM_INFO\", param_3);\n\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    // TEAM 1 DATA\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    FUN_005092e0(&amp;local_2a);     // 1 byte:  Team 1 ID\n    FUN_00509340(&amp;local_24);     // String:  Team 1 name\n    FUN_00509340(&amp;local_28);     // String:  Team 1 color name\n    FUN_00509340(&amp;local_20);     // String:  Team 1 adjective\n    FUN_00509340(&amp;local_1c);     // String:  Team 1 noun\n    FUN_00509340(&amp;local_18);     // String:  Team 1 possessive\n\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    // TEAM 2 DATA\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    FUN_005092e0(&amp;local_29);     // 1 byte:  Team 2 ID\n    FUN_00509340(&amp;local_10);     // String:  Team 2 name\n    FUN_00509340(&amp;local_14);     // String:  Team 2 color name\n    FUN_00509340(&amp;local_c);      // String:  Team 2 adjective\n    FUN_00509340(&amp;local_8);      // String:  Team 2 noun\n    FUN_00509340(&amp;local_4);      // String:  Team 2 possessive\n\n    FUN_00509dc0(param_3, param_2);  // Byte alignment\n\n    // Creates team data structures with ID, strings, and flag=1/2\n}\n</code></pre> <pre><code>TEAM_INFO Wire Format:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset  \u2502 Content                                                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0       \u2502 Team 1 ID (1 byte)                                          \u2502\n\u2502 1       \u2502 Team 1 Name (length-prefixed string)                        \u2502\n\u2502 varies  \u2502 Team 1 Color Name (length-prefixed string)                  \u2502\n\u2502 varies  \u2502 Team 1 Adjective (length-prefixed string)                   \u2502\n\u2502 varies  \u2502 Team 1 Noun (length-prefixed string)                        \u2502\n\u2502 varies  \u2502 Team 1 Possessive (length-prefixed string)                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 varies  \u2502 Team 2 ID (1 byte)                                          \u2502\n\u2502 varies  \u2502 Team 2 Name (length-prefixed string)                        \u2502\n\u2502 varies  \u2502 Team 2 Color Name (length-prefixed string)                  \u2502\n\u2502 varies  \u2502 Team 2 Adjective (length-prefixed string)                   \u2502\n\u2502 varies  \u2502 Team 2 Noun (length-prefixed string)                        \u2502\n\u2502 varies  \u2502 Team 2 Possessive (length-prefixed string)                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Example team strings: - Team 1: ID=1, \"Red Team\", \"Red\", \"Red\", \"Reds\", \"Red's\" - Team 2: ID=2, \"Blue Team\", \"Blue\", \"Blue\", \"Blues\", \"Blue's\"</p>"},{"location":"part-4-behavior-packet/part-4-7-post-behavior-flow.html#phase-3-game-entry","title":"Phase 3: Game Entry","text":"<p>When the player selects a team, the client sends REINCARNATE. The server must respond with several packets to complete game entry.</p> <pre><code>SERVER                                     CLIENT\n   \u2502                                          \u2502\n   \u2502                                          \u2502 Player clicks\n   \u2502                                          \u2502 \"Join Red Team\"\n   \u2502                                          \u2502\n   \u2502\u25c4\u2500\u2500\u2500\u2500 REINCARNATE (0x25) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n   \u2502      - Sub-type (team choice)            \u2502\n   \u2502      - Optional message                  \u2502\n   \u2502                                          \u2502\n   \u2502\u2500\u2500\u2500\u2500\u2500 REINCARNATE (0x25) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n   \u2502      - Sub-type (confirmation/status)    \u2502\n   \u2502      - Status message                    \u2502\n   \u2502                                          \u2502\n   \u2502\u2500\u2500\u2500\u2500\u2500 PLAYER (0x17) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502  \u25c4\u2500\u2500 CRITICAL!\n   \u2502      - Entity ID (player's tank)         \u2502\n   \u2502      - Active flag                       \u2502\n   \u2502                                          \u2502\n   \u2502\u2500\u2500\u2500\u2500\u2500 GAME_CLOCK (0x2F) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n   \u2502      - Game time sync                    \u2502\n   \u2502                                          \u2502\n   \u2502\u2500\u2500\u2500\u2500\u2500 ADD_TO_ROSTER (0x1A) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n   \u2502      - Player added to team roster       \u2502\n   \u2502                                          \u2502\n   \u2502                                          \u2502 Client enters\n   \u2502                                          \u2502 GAMEPLAY state\n   \u2502                                          \u2502\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-7-post-behavior-flow.html#reincarnate-packet-0x25","title":"REINCARNATE Packet (0x25)","text":"<p>The REINCARNATE packet is bidirectional and handles multiple functions: - Client \u2192 Server: Team selection, spawn requests - Server \u2192 Client: Confirmations, status messages, team changes</p> <p>From FUN_0046e280 (lines 78119-78219):</p> <pre><code>void FUN_0046e280(param_1, param_2, param_3) {\n    FUN_00509db0(\"REINCARNATE\", param_3);\n    FUN_005092e0(local_f);       // 1 byte: Sub-type\n    FUN_00509340(&amp;local_c);      // String: Message (optional)\n    FUN_00509dc0(param_3, param_2);\n\n    switch(local_f[0]) {\n        case 0x02: iVar4 = 0x11; break;  // Team assignment\n        case 0x04: iVar4 = 0x11; break;  // Spawn type 1\n        case 0x05: iVar4 = 0x11; break;  // Spawn type 2\n        // ... more sub-types ...\n        case 0x0B: iVar4 = 6; break;     // Status change\n        case 0x0C: iVar4 = 0xf; break;   // Another status\n        // ...\n    }\n    // Process based on sub-type\n}\n</code></pre> <pre><code>REINCARNATE Wire Format:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset  \u2502 Content                                                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0       \u2502 Sub-type (1 byte)                                           \u2502\n\u2502 1       \u2502 Message (length-prefixed string, can be empty)              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-7-post-behavior-flow.html#reincarnate-sub-types","title":"REINCARNATE Sub-Types","text":"Sub-Type Hex Direction Description 0 0x00 C\u2192S Initial/default 1 0x01 C\u2192S Join team 1 2 0x02 S\u2192C Team assignment response 3 0x03 C\u2192S Join team 2 4-10 0x04-0x0A S\u2192C Various spawn/status responses 11 0x0B S\u2192C Status change 12 0x0C S\u2192C Another status 13 0x0D S\u2192C Conditional status 14 0x0E S\u2192C Team-specific status 17 0x11 S\u2192C Generic status 18 0x12 S\u2192C Message display"},{"location":"part-4-behavior-packet/part-4-7-post-behavior-flow.html#player-packet-0x17-critical","title":"PLAYER Packet (0x17) - CRITICAL","text":"<p>This is the most important packet for game entry! Without it, the client cannot transition from team selection to gameplay.</p> <p>From FUN_0046d1f0 (lines 77607-77624):</p> <pre><code>void FUN_0046d1f0(param_1, param_2, param_3) {\n    FUN_00509db0(\"PLAYER\", param_3);\n    FUN_00509310(&amp;local_4);      // 4 bytes: Entity ID (player's vehicle)\n    FUN_005092e0(&amp;local_5);      // 1 byte:  Active flag\n    FUN_00509dc0(param_3, param_2);\n\n    // Set player state\n    DAT_005b8393 = local_5 != '\\0';  // Player active\n    DAT_005b83e4 = local_4;          // Player's entity ID\n\n    FUN_00443a10();  // Initialize player systems\n    FUN_00417ae0();  // Transition to gameplay state\n}\n</code></pre> <pre><code>PLAYER Wire Format:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset  \u2502 Content                                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0-3     \u2502 Entity ID (4 bytes, uint32 big-endian)            \u2502\n\u2502 4       \u2502 Active flag (1 byte, 0x00=inactive, 0x01=active)  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nTotal: 5 bytes payload\n</code></pre> <p>Example: <pre><code>PLAYER packet assigning entity ID 12345 as active:\n  17 00 05 00 00 30 39 01\n  \u2502  \u2514\u2500\u2500\u252c\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518 \u2502\n  \u2502     \u2502         \u2502      \u2514\u2500 Active = true\n  \u2502     \u2502         \u2514\u2500 Entity ID = 12345 (0x3039)\n  \u2502     \u2514\u2500 Length = 5 bytes\n  \u2514\u2500 Type = 0x17 (PLAYER)\n</code></pre></p>"},{"location":"part-4-behavior-packet/part-4-7-post-behavior-flow.html#game_clock-packet-0x2f","title":"GAME_CLOCK Packet (0x2F)","text":"<p>Synchronizes the client's game clock with the server.</p> <p>From FUN_0046e680 (lines 78224-78262):</p> <pre><code>void FUN_0046e680(param_1, param_2, param_3) {\n    FUN_00509db0(\"GAME_CLOCK\", param_3);\n    FUN_00509310(&amp;local_c);      // 4 bytes: Game time\n    FUN_005092e0(&amp;local_d);      // 1 byte:  Time state flag\n    FUN_00509310(&amp;local_4);      // 4 bytes: Additional time value\n    FUN_00509310(&amp;local_8);      // 4 bytes: Another time value\n    FUN_00509dc0(param_3, param_2);\n\n    // Apply time synchronization\n}\n</code></pre> <pre><code>GAME_CLOCK Wire Format:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset  \u2502 Content                                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0-3     \u2502 Game time (4 bytes, uint32 big-endian)            \u2502\n\u2502 4       \u2502 Time state flag (1 byte)                          \u2502\n\u2502 5-8     \u2502 Additional time value (4 bytes)                   \u2502\n\u2502 9-12    \u2502 Another time value (4 bytes)                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nTotal: 13 bytes payload\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-7-post-behavior-flow.html#world_stats-packet-0x16","title":"WORLD_STATS Packet (0x16)","text":"<p>Provides world/map information to the client.</p> <p>From FUN_0046cf60 (lines 77500-77523):</p> <pre><code>void FUN_0046cf60(param_1, param_2, param_3) {\n    FUN_00509db0(\"WORLD_STATS\", param_3);\n    FUN_00509340(&amp;local_c);      // String: Map name\n    FUN_005092e0(&amp;local_d);      // 1 byte:  Unknown\n    FUN_005092e0(&amp;local_e);      // 1 byte:  World type/mode\n    FUN_00509310(&amp;local_8);      // 4 bytes: Scale factor (fixed-point)\n    FUN_00509dc0(param_3, param_2);\n\n    // After processing, client sends WANT_UPDATES\n    iVar1 = FUN_00509cf0(\"WANT_UPDATES\", 0x39, 0, 1);\n    if (iVar1 != 0) {\n        thunk_FUN_00509520(1);   // Write: 4 bytes (value 1)\n        FUN_0050a340(iVar1);     // Send packet\n    }\n}\n</code></pre> <p>Important: After receiving WORLD_STATS, the client automatically sends WANT_UPDATES!</p> <pre><code>WORLD_STATS Wire Format:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset  \u2502 Content                                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0       \u2502 Map name (length-prefixed string)                 \u2502\n\u2502 varies  \u2502 Unknown byte (1 byte)                             \u2502\n\u2502 varies  \u2502 World type/mode (1 byte)                          \u2502\n\u2502 varies  \u2502 Scale factor (4 bytes, fixed-point)               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-7-post-behavior-flow.html#want_updates-packet-0x39","title":"WANT_UPDATES Packet (0x39)","text":"<p>Client request for game state updates. Sent automatically after WORLD_STATS.</p> <pre><code>WANT_UPDATES Wire Format:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset  \u2502 Content                                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0-3     \u2502 Update flags (4 bytes, uint32 big-endian)         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nTotal: 4 bytes payload\n</code></pre> <p>Typically sent with value 1 to request all updates.</p>"},{"location":"part-4-behavior-packet/part-4-7-post-behavior-flow.html#roster-packets","title":"Roster Packets","text":""},{"location":"part-4-behavior-packet/part-4-7-post-behavior-flow.html#add_to_roster-0x1a","title":"ADD_TO_ROSTER (0x1A)","text":"<p>Notifies the client that a player has joined a team. This packet contains comprehensive player information and stats.</p> <p>From FUN_0046d5d0 (lines 77724-77759):</p> <pre><code>void FUN_0046d5d0(param_1, param_2, param_3) {\n    FUN_00509db0();                        // \"ADD_TO_ROSTER\"\n    FUN_00509310(&amp;local_c);                // 4 bytes: Player ID\n    FUN_00509310(&amp;local_10);               // 4 bytes: Entity ID\n    FUN_005092f0(local_24);                // 2 bytes: Team ID\n    FUN_005092f0(local_28);                // 2 bytes: Status/flags\n    FUN_00509340(local_20);                // String:  Player name\n    FUN_00509340(&amp;local_18);               // String:  Clan tag\n    FUN_005092f0(local_2c);                // 2 bytes: Kills\n    FUN_005092f0(local_30);                // 2 bytes: Deaths\n    FUN_004e51d0(&amp;local_8);                // 4 bytes: Score (fixed-point)\n    FUN_00509310(&amp;local_14);               // 4 bytes: Additional ID\n    FUN_00509dc0();                        // Byte alignment\n\n    // Add player to roster via FUN_00475b90\n}\n</code></pre> <pre><code>ADD_TO_ROSTER Wire Format:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset  \u2502 Size \u2502 Content                                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0-3     \u2502 4    \u2502 Player ID (uint32 big-endian)                     \u2502\n\u2502 4-7     \u2502 4    \u2502 Entity ID (uint32 big-endian)                     \u2502\n\u2502 8-9     \u2502 2    \u2502 Team ID (uint16 big-endian)                       \u2502\n\u2502 10-11   \u2502 2    \u2502 Status/flags (uint16 big-endian)                  \u2502\n\u2502 12+     \u2502 var  \u2502 Player name (length-prefixed string)              \u2502\n\u2502 varies  \u2502 var  \u2502 Clan tag (length-prefixed string, can be empty)   \u2502\n\u2502 varies  \u2502 2    \u2502 Kills (uint16 big-endian)                         \u2502\n\u2502 varies  \u2502 2    \u2502 Deaths (uint16 big-endian)                        \u2502\n\u2502 varies  \u2502 4    \u2502 Score (fixed-point)                               \u2502\n\u2502 varies  \u2502 4    \u2502 Additional ID (uint32 big-endian)                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Note: See Part 6 for complete Python implementation and example wire bytes.</p>"},{"location":"part-4-behavior-packet/part-4-7-post-behavior-flow.html#remove_from_roster-0x1b","title":"REMOVE_FROM_ROSTER (0x1B)","text":"<p>Notifies the client that a player has left a team.</p> <pre><code>REMOVE_FROM_ROSTER Wire Format:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset  \u2502 Content                                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0-3     \u2502 Player ID (4 bytes, uint32 big-endian)            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nTotal: 4 bytes payload\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-7-post-behavior-flow.html#complete-game-entry-sequence","title":"Complete Game Entry Sequence","text":"<p>Here's the full sequence from BEHAVIOR completion to gameplay:</p> <pre><code>\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\nCOMPLETE POST-BEHAVIOR SEQUENCE\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nSERVER                                     CLIENT\n   \u2502                                          \u2502\n   \u2502  \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550  \u2502\n   \u2502  PHASE 2B: TEAM SELECTION SETUP          \u2502\n   \u2502  \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550  \u2502\n   \u2502                                          \u2502\n   \u2502\u2500\u2500\u2500\u2500\u2500 TEAM_INFO (0x28) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502  Team data\n   \u2502                                          \u2502\n   \u2502                                          \u2502  [Client shows\n   \u2502                                          \u2502   team selection]\n   \u2502                                          \u2502\n   \u2502  \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550  \u2502\n   \u2502  PHASE 3: GAME ENTRY                     \u2502\n   \u2502  \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550  \u2502\n   \u2502                                          \u2502\n   \u2502\u25c4\u2500\u2500\u2500\u2500 REINCARNATE (0x25) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502  Player selects team\n   \u2502      sub_type=1 (join team 1)            \u2502\n   \u2502                                          \u2502\n   \u2502\u2500\u2500\u2500\u2500\u2500 REINCARNATE (0x25) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502  Confirm team\n   \u2502      sub_type=2, message=\"Welcome\"       \u2502\n   \u2502                                          \u2502\n   \u2502\u2500\u2500\u2500\u2500\u2500 PLAYER (0x17) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502  \u2605 CRITICAL \u2605\n   \u2502      entity_id=12345, active=true        \u2502  Assigns player entity\n   \u2502                                          \u2502\n   \u2502\u2500\u2500\u2500\u2500\u2500 GAME_CLOCK (0x2F) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502  Time sync\n   \u2502      game_time, flags, values            \u2502\n   \u2502                                          \u2502\n   \u2502\u2500\u2500\u2500\u2500\u2500 ADD_TO_ROSTER (0x1A) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502  Add to team roster\n   \u2502      player_id, entity_id, team,         \u2502  (includes stats)\n   \u2502      name, clan, kills, deaths, score    \u2502\n   \u2502                                          \u2502\n   \u2502\u2500\u2500\u2500\u2500\u2500 WORLD_STATS (0x16) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502  Map/world info\n   \u2502      map_name, type, scale               \u2502\n   \u2502                                          \u2502\n   \u2502\u25c4\u2500\u2500\u2500\u2500 WANT_UPDATES (0x39) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502  (Auto-sent by client)\n   \u2502      flags=1                             \u2502\n   \u2502                                          \u2502\n   \u2502  \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550  \u2502\n   \u2502  PHASE 4: ACTIVE GAMEPLAY                \u2502\n   \u2502  \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550  \u2502\n   \u2502                                          \u2502\n   \u2502\u2500\u2500\u2500\u2500\u2500 UPDATE_ARRAY (0x0E) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502  Entity states\n   \u2502\u2500\u2500\u2500\u2500\u2500 BIRTH_NOTICE (0x1E) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502  Spawned entities\n   \u2502\u25c4\u2500\u2500\u2500\u25ba [Game traffic continues...]         \u2502\n   \u2502                                          \u2502\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n</code></pre>"},{"location":"part-4-behavior-packet/part-4-7-post-behavior-flow.html#common-issues-and-solutions","title":"Common Issues and Solutions","text":""},{"location":"part-4-behavior-packet/part-4-7-post-behavior-flow.html#issue-client-stuck-at-team-select","title":"Issue: Client Stuck at Team Select","text":"<p>Symptom: Team selection screen shows but clicking a team does nothing.</p> <p>Causes: 1. Server not receiving REINCARNATE from client 2. Server not responding with PLAYER packet</p> <p>Solution:  - Ensure you're listening for REINCARNATE (0x25) packets - Send PLAYER packet after team selection confirmation</p>"},{"location":"part-4-behavior-packet/part-4-7-post-behavior-flow.html#issue-client-shows-team-select-but-cant-progress","title":"Issue: Client Shows Team Select But Can't Progress","text":"<p>Symptom: Team selection works but game never starts.</p> <p>Causes: 1. Missing PLAYER packet (most common!) 2. Entity ID in PLAYER packet is invalid 3. Active flag set to 0</p> <p>Solution: <pre><code># Send PLAYER packet with valid entity ID\nentity_id = 12345  # Must be valid entity in your game state\nactive = True\nplayer_packet = make_packet(0x17, struct.pack('&gt;I', entity_id) + bytes([0x01 if active else 0x00]))\nsend(player_packet)\n</code></pre></p>"},{"location":"part-4-behavior-packet/part-4-7-post-behavior-flow.html#issue-player-joins-but-cant-moveact","title":"Issue: Player Joins But Can't Move/Act","text":"<p>Symptom: Client enters game but controls don't work.</p> <p>Causes: 1. BEHAVIOR packet was malformed (especially Section 5) 2. Entity ID doesn't exist in world state 3. UPDATE_ARRAY not being sent</p> <p>Solution: - Verify BEHAVIOR packet is complete (3,115+ bytes) - Ensure entity exists before assigning via PLAYER - Start sending UPDATE_ARRAY packets after WANT_UPDATES</p>"},{"location":"part-4-behavior-packet/part-4-7-post-behavior-flow.html#issue-other-players-dont-see-new-player","title":"Issue: Other Players Don't See New Player","text":"<p>Symptom: Player joins but isn't visible to others.</p> <p>Causes: 1. ADD_TO_ROSTER not sent to other clients 2. BIRTH_NOTICE not broadcast</p> <p>Solution: - Send ADD_TO_ROSTER to all connected clients - Broadcast BIRTH_NOTICE for the new player's entity</p>"},{"location":"part-4-behavior-packet/part-4-7-post-behavior-flow.html#issue-player-not-shown-in-team-roster","title":"Issue: Player Not Shown in Team Roster","text":"<p>Symptom: Player joins but doesn't appear in scoreboard/roster.</p> <p>Causes: 1. ADD_TO_ROSTER not sent, or sent with wrong format 2. Missing required fields (entity_id, team_id, etc.)</p> <p>Solution: <pre><code># Send ADD_TO_ROSTER with all required fields\nroster = create_add_to_roster_packet(\n    player_id=1,\n    entity_id=12345,\n    team_id=1,        # Must match the team they joined!\n    player_name=\"Player1\"\n)\nconn.send(roster)\n</code></pre></p> <p>Note: See Part 6 for the complete <code>create_add_to_roster_packet()</code> implementation.</p>"},{"location":"part-4-behavior-packet/part-4-7-post-behavior-flow.html#packet-order-summary","title":"Packet Order Summary","text":"<p>Minimum required sequence for game entry:</p> Step Packet Direction Required? 1 TEAM_INFO S\u2192C Yes 2 REINCARNATE C\u2192S Yes (player action) 3 REINCARNATE S\u2192C Recommended 4 PLAYER S\u2192C YES - CRITICAL 5 GAME_CLOCK S\u2192C Recommended 6 ADD_TO_ROSTER S\u2192C Recommended 7 WORLD_STATS S\u2192C Yes (triggers WANT_UPDATES) 8 WANT_UPDATES C\u2192S Auto (from client) 9 UPDATE_ARRAY S\u2192C Yes (for gameplay)"},{"location":"part-4-behavior-packet/part-4-7-post-behavior-flow.html#whats-next","title":"What's Next?","text":"<p>In Part 5, we'll dive into the details of the TEAM_INFO packet structure and implementation, which is the first packet needed after BEHAVIOR to show the team selection screen.</p>"},{"location":"part-4-behavior-packet/part-4-7-post-behavior-flow.html#quick-reference-packet-type-ids","title":"Quick Reference: Packet Type IDs","text":"<pre><code>Post-BEHAVIOR Packet Types:\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nPhase 2B (Team Setup):\n  0x28  TEAM_INFO           Team names/colors for selection\n\nPhase 3 (Game Entry):\n  0x25  REINCARNATE         Team selection and responses\n  0x17  PLAYER              \u2605 Assigns player to entity\n  0x2F  GAME_CLOCK          Time synchronization\n  0x1A  ADD_TO_ROSTER       Add player to team list\n  0x1B  REMOVE_FROM_ROSTER  Remove player from list\n  0x16  WORLD_STATS         Map and world parameters\n\nPhase 4 (Gameplay):\n  0x39  WANT_UPDATES        Client requests state updates\n  0x0E  UPDATE_ARRAY        Entity state updates\n  0x0D  TRANSIENT_ARRAY     Temporary/projectile updates\n  0x1E  BIRTH_NOTICE        Entity spawned\n  0x1D  DEATH_NOTICE        Entity destroyed\n  0x1F  COMM_MESSAGE        Chat messages\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n</code></pre> <p>Previous: Part 4-6: BEHAVIOR Packet - Packet Finalization Next: Part 5: TEAM_INFO Packet</p>"},{"location":"part-5-team-info/index.html","title":"Wulfram 2 Server Implementation Guide","text":""},{"location":"part-5-team-info/index.html#part-5-team_info-packet","title":"Part 5: TEAM_INFO Packet","text":""},{"location":"part-5-team-info/index.html#overview","title":"Overview","text":"<p>The TEAM_INFO packet (0x28) is sent immediately after the BEHAVIOR packet to provide the client with team information needed to display the team selection screen. Without this packet, the client will remain stuck waiting for game configuration data.</p> <pre><code>Position in Connection Flow:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  PHASE 2: AUTHENTICATION                                                \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500          \u2502\n\u2502  Server \u2500\u2500\u25ba LOGIN_STATUS (0x22)              Status=8 (success)         \u2502\n\u2502  Server \u2500\u2500\u25ba BEHAVIOR (0x24)                  Game configuration         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  PHASE 2B: TEAM SELECTION SETUP                          \u25c4 YOU ARE      \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                     HERE       \u2502\n\u2502  Server \u2500\u2500\u25ba TEAM_INFO (0x28)                 Team data for selection    \u2502\n\u2502                                                                         \u2502\n\u2502             Client now shows TEAM SELECTION screen                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  PHASE 3: GAME ENTRY                                                    \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                                    \u2502\n\u2502  Client \u2500\u2500\u25ba REINCARNATE (0x25)               Player chooses team        \u2502\n\u2502  Server \u2500\u2500\u25ba PLAYER (0x17)                    Assigns player entity      \u2502\n\u2502  ...                                                                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-5-team-info/index.html#the-handler-code","title":"The Handler Code","text":"<p>From FUN_0046dfb0 (lines 78006-78077):</p> <pre><code>void FUN_0046dfb0(undefined4 param_1, undefined4 param_2, undefined4 param_3) {\n    undefined1 *puVar1;\n    undefined1 *puVar2;\n    char *pcVar3;\n    undefined1 local_2a;         // Team 1 ID\n    undefined1 local_29;         // Team 2 ID\n    char *local_28;              // Team 1 color name\n    char *local_24;              // Team 1 name\n    char *local_20;              // Team 1 adjective\n    char *local_1c;              // Team 1 noun\n    char *local_18;              // Team 1 possessive\n    char *local_14;              // Team 2 color name\n    char *local_10;              // Team 2 name\n    char *local_c;               // Team 2 adjective\n    char *local_8;               // Team 2 noun\n    char *local_4;               // Team 2 possessive\n\n    FUN_00509db0(\"TEAM_INFO\", param_3);    // Set packet name for error messages\n\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    // TEAM 1 DATA\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    FUN_005092e0(&amp;local_2a);      // 1 byte:  Team 1 ID\n    FUN_00509340(&amp;local_24);      // String:  Team 1 name\n    FUN_00509340(&amp;local_28);      // String:  Team 1 color name\n    FUN_00509340(&amp;local_20);      // String:  Team 1 adjective\n    FUN_00509340(&amp;local_1c);      // String:  Team 1 noun\n    FUN_00509340(&amp;local_18);      // String:  Team 1 possessive\n\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    // TEAM 2 DATA\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    FUN_005092e0(&amp;local_29);      // 1 byte:  Team 2 ID\n    FUN_00509340(&amp;local_10);      // String:  Team 2 name\n    FUN_00509340(&amp;local_14);      // String:  Team 2 color name\n    FUN_00509340(&amp;local_c);       // String:  Team 2 adjective\n    FUN_00509340(&amp;local_8);       // String:  Team 2 noun\n    FUN_00509340(&amp;local_4);       // String:  Team 2 possessive\n\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    // BYTE ALIGNMENT\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    FUN_00509dc0(param_3, param_2);    // Align bit stream to byte boundary\n\n    // ... Creates team structures with flag values 1 and 2 ...\n    // ... Also creates \"Neutral\" team via FUN_00417c90() ...\n}\n</code></pre>"},{"location":"part-5-team-info/index.html#packet-registration","title":"Packet Registration","text":"<p>The TEAM_INFO packet handler is registered at startup:</p> <pre><code>// From line 77053\nFUN_00509b40(0x28, FUN_0046dfb0);    // Register type 0x28 \u2192 TEAM_INFO handler\n</code></pre>"},{"location":"part-5-team-info/index.html#understanding-the-reader-functions","title":"Understanding the Reader Functions","text":"Function Bits Read Wire Bytes Description <code>FUN_005092e0</code> 8 bits 1 byte Reads team ID (uint8) <code>FUN_00509340</code> variable 2 + N bytes Reads length-prefixed string <code>FUN_00509dc0</code> 0-7 bits 0 bytes Byte alignment (padding)"},{"location":"part-5-team-info/index.html#team_info-wire-format","title":"TEAM_INFO Wire Format","text":"<pre><code>TEAM_INFO Packet Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TYPE    \u2502   LENGTH     \u2502   PAYLOAD                                       \u2502\n\u2502  0x28    \u2502  (2 bytes)   \u2502   (variable - team data)                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n   1 byte     2 bytes BE         N bytes\n\nPayload Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TEAM 1 DATA                                                                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Offset  \u2502 Content                                                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0       \u2502 Team 1 ID (1 byte, uint8)                                        \u2502\n\u2502 1       \u2502 Team 1 Name (length-prefixed string)                             \u2502\n\u2502 varies  \u2502 Team 1 Color Name (length-prefixed string)                       \u2502\n\u2502 varies  \u2502 Team 1 Adjective (length-prefixed string)                        \u2502\n\u2502 varies  \u2502 Team 1 Noun (length-prefixed string)                             \u2502\n\u2502 varies  \u2502 Team 1 Possessive (length-prefixed string)                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  TEAM 2 DATA                                                                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 varies  \u2502 Team 2 ID (1 byte, uint8)                                        \u2502\n\u2502 varies  \u2502 Team 2 Name (length-prefixed string)                             \u2502\n\u2502 varies  \u2502 Team 2 Color Name (length-prefixed string)                       \u2502\n\u2502 varies  \u2502 Team 2 Adjective (length-prefixed string)                        \u2502\n\u2502 varies  \u2502 Team 2 Noun (length-prefixed string)                             \u2502\n\u2502 varies  \u2502 Team 2 Possessive (length-prefixed string)                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-5-team-info/index.html#string-fields-explained","title":"String Fields Explained","text":"<p>Each team has five string fields used in different UI contexts:</p> Field Purpose Example (Red Team) Example (Blue Team) Name Full team name \"Red Team\" \"Blue Team\" Color Name Color identifier \"Red\" \"Blue\" Adjective Describes team members \"Red\" \"Blue\" Noun Collective noun \"Reds\" \"Blues\" Possessive Ownership form \"Red's\" \"Blue's\" <p>These strings are used to construct game messages like: - \"You joined the Red Team\" (Name) - \"A Red tank is approaching\" (Adjective) - \"The Reds are winning\" (Noun) - \"That's Red's territory\" (Possessive)</p>"},{"location":"part-5-team-info/index.html#length-prefixed-string-format","title":"Length-Prefixed String Format","text":"<p>Each string in TEAM_INFO uses the standard Wulfram 2 string format:</p> <pre><code>Length-Prefixed String:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  STRING_LENGTH  \u2502  STRING DATA (with null terminator)      \u2502\n\u2502  (2 bytes BE)   \u2502  (LENGTH bytes)                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nExample: \"Red Team\"\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     00 09       \u2502  52 65 64 20 54 65 61 6D 00               \u2502\n\u2502     (9)         \u2502  R  e  d     T  e  a  m  \\0               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Important: The length includes the null terminator!</p>"},{"location":"part-5-team-info/index.html#data-flow-diagram","title":"Data Flow Diagram","text":"<pre><code>TEAM_INFO Reading Order:\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TEAM 1                                                                 \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500                                                                \u2502\n\u2502  [ID:1]  [Name:var]  [Color:var]  [Adj:var]  [Noun:var]  [Poss:var]    \u2502\n\u2502    \u2502         \u2502           \u2502           \u2502          \u2502            \u2502          \u2502\n\u2502  uint8    string      string      string     string       string        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                    \u2502\n                                    \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TEAM 2                                                                 \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500                                                                \u2502\n\u2502  [ID:1]  [Name:var]  [Color:var]  [Adj:var]  [Noun:var]  [Poss:var]    \u2502\n\u2502    \u2502         \u2502           \u2502           \u2502          \u2502            \u2502          \u2502\n\u2502  uint8    string      string      string     string       string        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n</code></pre>"},{"location":"part-5-team-info/index.html#internal-team-structure","title":"Internal Team Structure","text":"<p>After reading TEAM_INFO, the client creates internal team structures:</p> <pre><code>Team Structure (0x1C = 28 bytes):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset  \u2502 Size \u2502 Description                                             \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0x00    \u2502 1    \u2502 Team ID (from packet)                                   \u2502\n\u2502 0x04    \u2502 4    \u2502 Pointer to team name string                             \u2502\n\u2502 0x08    \u2502 4    \u2502 Pointer to color name string                            \u2502\n\u2502 0x0C    \u2502 4    \u2502 Pointer to adjective string                             \u2502\n\u2502 0x10    \u2502 4    \u2502 Pointer to noun string                                  \u2502\n\u2502 0x14    \u2502 4    \u2502 Pointer to possessive string                            \u2502\n\u2502 0x18    \u2502 4    \u2502 Team flag (1 for team 1, 2 for team 2)                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Note: A third \"Neutral\" team is also created internally with: - Color name = \"Neutral\" - Flag = 0</p>"},{"location":"part-5-team-info/index.html#building-team_info-in-python","title":"Building TEAM_INFO in Python","text":"<pre><code>import struct\n\ndef encode_string(text):\n    \"\"\"\n    Encode a string for Wulfram 2 protocol.\n    Format: [length:2 bytes BE][string data with null terminator]\n    \"\"\"\n    string_bytes = text.encode('utf-8') + b'\\x00'\n    length = struct.pack('&gt;H', len(string_bytes))\n    return length + string_bytes\n\ndef create_team_data(team_id, name, color_name, adjective, noun, possessive):\n    \"\"\"\n    Create the data block for a single team.\n\n    Args:\n        team_id: Team identifier (1 or 2, uint8)\n        name: Full team name (e.g., \"Red Team\")\n        color_name: Color identifier (e.g., \"Red\")\n        adjective: Adjective form (e.g., \"Red\")\n        noun: Collective noun (e.g., \"Reds\")\n        possessive: Possessive form (e.g., \"Red's\")\n\n    Returns:\n        Bytes containing the team data\n    \"\"\"\n    data = bytearray()\n\n    # Team ID (1 byte)\n    data.append(team_id &amp; 0xFF)\n\n    # Five length-prefixed strings\n    data.extend(encode_string(name))\n    data.extend(encode_string(color_name))\n    data.extend(encode_string(adjective))\n    data.extend(encode_string(noun))\n    data.extend(encode_string(possessive))\n\n    return bytes(data)\n\ndef create_team_info_packet():\n    \"\"\"\n    Create a complete TEAM_INFO packet (0x28).\n\n    Returns:\n        Complete packet bytes ready to send\n    \"\"\"\n    payload = bytearray()\n\n    # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    # TEAM 1 DATA\n    # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    payload.extend(create_team_data(\n        team_id=1,\n        name=\"Red Team\",\n        color_name=\"Red\",\n        adjective=\"Red\",\n        noun=\"Reds\",\n        possessive=\"Red's\"\n    ))\n\n    # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    # TEAM 2 DATA\n    # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    payload.extend(create_team_data(\n        team_id=2,\n        name=\"Blue Team\",\n        color_name=\"Blue\",\n        adjective=\"Blue\",\n        noun=\"Blues\",\n        possessive=\"Blue's\"\n    ))\n\n    # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    # BUILD PACKET FRAME\n    # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    packet = bytearray()\n    packet.append(0x28)  # Packet type: TEAM_INFO\n    packet.extend(struct.pack('&gt;H', len(payload)))  # Length (big-endian)\n    packet.extend(payload)\n\n    return bytes(packet)\n\ndef make_packet(packet_type, payload):\n    \"\"\"Wrap payload in a complete packet frame\"\"\"\n    return bytes([packet_type]) + struct.pack('&gt;H', len(payload)) + payload\n</code></pre>"},{"location":"part-5-team-info/index.html#configurable-team-builder","title":"Configurable Team Builder","text":"<p>For servers that want customizable team names and colors:</p> <pre><code>def create_team_info_packet_custom(team1_config, team2_config):\n    \"\"\"\n    Create a TEAM_INFO packet with custom team configurations.\n\n    Args:\n        team1_config: dict with keys: id, name, color, adjective, noun, possessive\n        team2_config: dict with keys: id, name, color, adjective, noun, possessive\n\n    Returns:\n        Complete packet bytes ready to send\n\n    Example:\n        team1 = {\n            'id': 1,\n            'name': 'Alpha Squadron',\n            'color': 'Green',\n            'adjective': 'Alpha',\n            'noun': 'Alphas',\n            'possessive': \"Alpha's\"\n        }\n        team2 = {\n            'id': 2,\n            'name': 'Omega Force',\n            'color': 'Purple',\n            'adjective': 'Omega',\n            'noun': 'Omegas',\n            'possessive': \"Omega's\"\n        }\n        packet = create_team_info_packet_custom(team1, team2)\n    \"\"\"\n    payload = bytearray()\n\n    # Team 1\n    payload.extend(create_team_data(\n        team_id=team1_config['id'],\n        name=team1_config['name'],\n        color_name=team1_config['color'],\n        adjective=team1_config['adjective'],\n        noun=team1_config['noun'],\n        possessive=team1_config['possessive']\n    ))\n\n    # Team 2\n    payload.extend(create_team_data(\n        team_id=team2_config['id'],\n        name=team2_config['name'],\n        color_name=team2_config['color'],\n        adjective=team2_config['adjective'],\n        noun=team2_config['noun'],\n        possessive=team2_config['possessive']\n    ))\n\n    # Build packet frame\n    return make_packet(0x28, payload)\n</code></pre>"},{"location":"part-5-team-info/index.html#example-packet-bytes","title":"Example Packet Bytes","text":"<p>Using standard \"Red Team\" vs \"Blue Team\" configuration:</p> <pre><code>TEAM_INFO Packet Construction:\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nTeam 1 Data (Red Team):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  ID:         01                              (Team ID: 1)\n  Name:       00 09 52 65 64 20 54 65 61 6D 00   \"Red Team\\0\" (9 bytes)\n  Color:      00 04 52 65 64 00                  \"Red\\0\" (4 bytes)\n  Adjective:  00 04 52 65 64 00                  \"Red\\0\" (4 bytes)\n  Noun:       00 05 52 65 64 73 00               \"Reds\\0\" (5 bytes)\n  Possessive: 00 06 52 65 64 27 73 00            \"Red's\\0\" (6 bytes)\n\nTeam 1 size: 1 + 11 + 6 + 6 + 7 + 8 = 39 bytes\n\nTeam 2 Data (Blue Team):\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  ID:         02                              (Team ID: 2)\n  Name:       00 0A 42 6C 75 65 20 54 65 61 6D 00   \"Blue Team\\0\" (10 bytes)\n  Color:      00 05 42 6C 75 65 00                  \"Blue\\0\" (5 bytes)\n  Adjective:  00 05 42 6C 75 65 00                  \"Blue\\0\" (5 bytes)\n  Noun:       00 06 42 6C 75 65 73 00               \"Blues\\0\" (6 bytes)\n  Possessive: 00 07 42 6C 75 65 27 73 00            \"Blue's\\0\" (7 bytes)\n\nTeam 2 size: 1 + 12 + 7 + 7 + 8 + 9 = 44 bytes\n\nTotal payload: 39 + 44 = 83 bytes\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nComplete Packet:\n  Type:    28                                 (TEAM_INFO)\n  Length:  00 53                              (83 bytes)\n  Payload: [Team 1 data][Team 2 data]\n\nTotal packet size: 1 + 2 + 83 = 86 bytes\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n</code></pre>"},{"location":"part-5-team-info/index.html#full-hex-dump-example","title":"Full Hex Dump Example","text":"<pre><code>Complete TEAM_INFO packet (86 bytes):\n\n28 00 53 01 00 09 52 65 64 20 54 65 61 6D 00 00\n04 52 65 64 00 00 04 52 65 64 00 00 05 52 65 64\n73 00 00 06 52 65 64 27 73 00 02 00 0A 42 6C 75\n65 20 54 65 61 6D 00 00 05 42 6C 75 65 00 00 05\n42 6C 75 65 00 00 06 42 6C 75 65 73 00 00 07 42\n6C 75 65 27 73 00\n\nBreakdown:\nOffset 0:      28                      Type: TEAM_INFO\nOffset 1-2:    00 53                   Length: 83 bytes\nOffset 3:      01                      Team 1 ID: 1\nOffset 4-14:   00 09 \"Red Team\\0\"      Team 1 Name\nOffset 15-20:  00 04 \"Red\\0\"           Team 1 Color\nOffset 21-26:  00 04 \"Red\\0\"           Team 1 Adjective\nOffset 27-33:  00 05 \"Reds\\0\"          Team 1 Noun\nOffset 34-41:  00 06 \"Red's\\0\"         Team 1 Possessive\nOffset 42:     02                      Team 2 ID: 2\nOffset 43-54:  00 0A \"Blue Team\\0\"     Team 2 Name\nOffset 55-61:  00 05 \"Blue\\0\"          Team 2 Color\nOffset 62-68:  00 05 \"Blue\\0\"          Team 2 Adjective\nOffset 69-76:  00 06 \"Blues\\0\"         Team 2 Noun\nOffset 77-85:  00 07 \"Blue's\\0\"        Team 2 Possessive\n</code></pre>"},{"location":"part-5-team-info/index.html#server-integration-example","title":"Server Integration Example","text":"<p>Here's how to integrate TEAM_INFO into your server's connection flow:</p> <pre><code>class Wulfram2Server:\n    PACKET_TEAM_INFO = 0x28\n\n    def send_team_info(self, conn):\n        \"\"\"\n        Send TEAM_INFO packet after BEHAVIOR.\n        This triggers the team selection screen on the client.\n        \"\"\"\n        packet = create_team_info_packet()\n        conn.send(packet)\n        print(f\"TX: {packet.hex(' ')}\")\n        print(\"TEAM_INFO sent - client should show team selection screen\")\n\n    def complete_login_sequence(self, conn):\n        \"\"\"\n        Complete sequence after LOGIN_STATUS success.\n        \"\"\"\n        # 1. Send LOGIN_STATUS with status=8 (success)\n        login_status = make_packet(0x22, bytes([0x01, 0x08]))\n        conn.send(login_status)\n\n        # 2. Send BEHAVIOR packet (see Part 4)\n        behavior = create_behavior_packet()  # From Part 4\n        conn.send(behavior)\n\n        # 3. Send TEAM_INFO packet\n        self.send_team_info(conn)\n\n        # Client will now show team selection screen!\n</code></pre>"},{"location":"part-5-team-info/index.html#what-happens-after-team_info","title":"What Happens After TEAM_INFO","text":"<p>After receiving TEAM_INFO, the client:</p> <ol> <li>Creates team structures for both teams</li> <li>Creates a \"Neutral\" team with flag=0</li> <li>Displays the team selection screen</li> <li>Waits for player input to choose a team</li> </ol> <p>When the player clicks a team button, the client sends a REINCARNATE (0x25) packet to join that team.</p> <pre><code>CLIENT STATE AFTER TEAM_INFO:\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         TEAM SELECTION SCREEN                           \u2502\n\u2502                                                                         \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                 \u2502\n\u2502   \u2502                 \u2502              \u2502                 \u2502                 \u2502\n\u2502   \u2502   RED TEAM      \u2502              \u2502   BLUE TEAM     \u2502                 \u2502\n\u2502   \u2502                 \u2502              \u2502                 \u2502                 \u2502\n\u2502   \u2502  [JOIN REDS]    \u2502              \u2502  [JOIN BLUES]   \u2502                 \u2502\n\u2502   \u2502                 \u2502              \u2502                 \u2502                 \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                 \u2502\n\u2502                                                                         \u2502\n\u2502                        Player count: 0 vs 0                             \u2502\n\u2502                                                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nNext packet: Client sends REINCARNATE (0x25) when player clicks a button\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n</code></pre>"},{"location":"part-5-team-info/index.html#troubleshooting","title":"Troubleshooting","text":""},{"location":"part-5-team-info/index.html#problem-client-stuck-after-behavior-no-team-selection","title":"Problem: Client Stuck After BEHAVIOR, No Team Selection","text":"<p>Cause: TEAM_INFO packet not sent.</p> <p>Solution: Send TEAM_INFO immediately after BEHAVIOR:</p> <pre><code># After sending BEHAVIOR...\nteam_info = create_team_info_packet()\nconn.send(team_info)\n</code></pre>"},{"location":"part-5-team-info/index.html#problem-team-names-show-as-garbage","title":"Problem: Team Names Show as Garbage","text":"<p>Cause: Strings not properly length-prefixed, or wrong byte order.</p> <p>Solution: Verify string encoding:</p> <pre><code># WRONG - missing length prefix\ndata = b\"Red Team\\x00\"  # \u2190 WRONG!\n\n# CORRECT - with length prefix\ndata = encode_string(\"Red Team\")  # Returns: b'\\x00\\x09Red Team\\x00'\n</code></pre>"},{"location":"part-5-team-info/index.html#problem-client-crashes-after-team_info","title":"Problem: Client Crashes After TEAM_INFO","text":"<p>Cause: Missing strings or wrong number of strings per team.</p> <p>Solution: Each team MUST have exactly 5 strings in this order: 1. Name 2. Color Name 3. Adjective 4. Noun 5. Possessive</p>"},{"location":"part-5-team-info/index.html#problem-team-selection-buttons-dont-work","title":"Problem: Team Selection Buttons Don't Work","text":"<p>Cause: This is a Phase 3 (REINCARNATE) issue, not TEAM_INFO.</p> <p>Solution: Ensure your server handles incoming REINCARNATE (0x25) packets after team selection.</p>"},{"location":"part-5-team-info/index.html#common-mistakes","title":"Common Mistakes","text":"Mistake Symptom Fix Not sending TEAM_INFO Client stuck after BEHAVIOR Send TEAM_INFO after BEHAVIOR Wrong packet type Client ignores packet Use <code>0x28</code> for TEAM_INFO Missing length prefix String parse error/crash Use <code>encode_string()</code> for all strings Wrong string count Client crash Include all 5 strings per team Forgetting null terminator String parsing issues Include <code>\\x00</code> in string data Little-endian length Wrong string lengths Use big-endian (<code>&gt;H</code>) for length Sending before BEHAVIOR Out-of-order error Always send BEHAVIOR first"},{"location":"part-5-team-info/index.html#verification-checklist","title":"Verification Checklist","text":"<p>Before sending TEAM_INFO, verify:</p> <ul> <li>[ ] BEHAVIOR packet was sent successfully</li> <li>[ ] Packet type is <code>0x28</code></li> <li>[ ] Team 1 has: ID (1 byte) + 5 length-prefixed strings</li> <li>[ ] Team 2 has: ID (1 byte) + 5 length-prefixed strings</li> <li>[ ] All strings use big-endian length prefix</li> <li>[ ] All strings include null terminator in length</li> <li>[ ] Total payload length matches header</li> </ul>"},{"location":"part-5-team-info/index.html#section-summary","title":"Section Summary","text":"Property Value Packet Type 0x28 Handler Function FUN_0046dfb0 Teams per Packet 2 (fixed) Strings per Team 5 (name, color, adjective, noun, possessive) Variable Size Yes (depends on string lengths) Follows BEHAVIOR (0x24) Triggers Team selection screen display"},{"location":"part-5-team-info/index.html#quick-reference-payload-size-calculation","title":"Quick Reference: Payload Size Calculation","text":"<pre><code>TEAM_INFO Payload Size Formula:\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nFor each team:\n  1 byte (Team ID)\n  + (2 + len(name) + 1) bytes\n  + (2 + len(color) + 1) bytes\n  + (2 + len(adjective) + 1) bytes\n  + (2 + len(noun) + 1) bytes\n  + (2 + len(possessive) + 1) bytes\n\nTotal payload = Team 1 size + Team 2 size\n\nExample with \"Red Team\" / \"Blue Team\":\n  Team 1: 1 + 11 + 6 + 6 + 7 + 8 = 39 bytes\n  Team 2: 1 + 12 + 7 + 7 + 8 + 9 = 44 bytes\n  Total:  83 bytes\n\nPacket total = 1 (type) + 2 (length) + payload = 86 bytes\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n</code></pre>"},{"location":"part-5-team-info/index.html#complete-connection-flow-summary","title":"Complete Connection Flow Summary","text":"<pre><code>FULL CONNECTION SEQUENCE (Phases 1-2B):\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nPHASE 1: HANDSHAKE\n  Server \u2192 HELLO sub=0 (version: 0x4E89)\n  Server \u2192 HELLO sub=1 (UDP port, interfaces)\n  Server \u2192 HELLO sub=2 (server name)\n\nPHASE 2: AUTHENTICATION\n  Client \u2192 LOGIN (username, password)\n  Server \u2192 LOGIN_STATUS (flag=1, status=8)\n  Server \u2192 BEHAVIOR (3,115+ bytes of game config)\n\nPHASE 2B: TEAM SELECTION SETUP\n  Server \u2192 TEAM_INFO (team data)              \u25c4\u2500\u2500 THIS DOCUMENT\n\n  \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  Client now displays TEAM SELECTION screen\n  \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nPHASE 3: GAME ENTRY (covered in next document)\n  Client \u2192 REINCARNATE (team choice)\n  Server \u2192 PLAYER (entity assignment)\n  ...\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n</code></pre>"},{"location":"part-5-team-info/index.html#whats-next","title":"What's Next?","text":"<p>After TEAM_INFO, the client displays the team selection screen and waits for player input. When the player selects a team, the client sends a REINCARNATE packet. In Part 6, we'll cover the REINCARNATE packet and the complete game entry sequence.</p> <p>Previous: Part 4-7: Post-BEHAVIOR Flow Overview Next: Part 6: REINCARNATE &amp; Game Entry</p>"},{"location":"part-6-reincarnate/index.html","title":"Wulfram 2 Server Implementation Guide","text":""},{"location":"part-6-reincarnate/index.html#part-6-reincarnate-game-entry","title":"Part 6: REINCARNATE &amp; Game Entry","text":""},{"location":"part-6-reincarnate/index.html#overview","title":"Overview","text":"<p>After receiving TEAM_INFO, the client displays the team selection screen. When the player clicks a team button, the client sends a REINCARNATE (0x25) packet. The server must respond with several packets to complete game entry and transition the client from team selection to active gameplay.</p> <pre><code>Position in Connection Flow:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  PHASE 2B: TEAM SELECTION SETUP                                         \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                \u2502\n\u2502  Server \u2500\u2500\u25ba TEAM_INFO (0x28)                 Team data for selection    \u2502\n\u2502             Client now shows TEAM SELECTION screen                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  PHASE 3: GAME ENTRY                                     \u25c4 YOU ARE      \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                         HERE       \u2502\n\u2502  Client \u2500\u2500\u25ba REINCARNATE (0x25)               Player chooses team        \u2502\n\u2502  Server \u2500\u2500\u25ba REINCARNATE (0x25)               Server confirms            \u2502\n\u2502  Server \u2500\u2500\u25ba PLAYER (0x17)                    \u2605 CRITICAL! Entity assign  \u2502\n\u2502  Server \u2500\u2500\u25ba GAME_CLOCK (0x2F)                Time synchronization       \u2502\n\u2502  Server \u2500\u2500\u25ba ADD_TO_ROSTER (0x1A)             Add to team roster         \u2502\n\u2502  Server \u2500\u2500\u25ba WORLD_STATS (0x16)               Map info \u2192 triggers client \u2502\n\u2502             Client sends WANT_UPDATES (0x39) automatically              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  PHASE 4: ACTIVE GAMEPLAY                                               \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                               \u2502\n\u2502  Server \u2500\u2500\u25ba UPDATE_ARRAY (0x0E)              Entity state updates       \u2502\n\u2502  ...bidirectional game traffic...                                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-6-reincarnate/index.html#critical-concept-the-player-packet","title":"Critical Concept: The PLAYER Packet","text":"<p>The PLAYER packet (0x17) is the most important packet for game entry. Without it, the client remains stuck at team selection, even if all other packets are sent correctly.</p> <p>The PLAYER packet assigns the client to a specific entity (their vehicle) in the game world. Until the client receives this packet, it has no entity to control and cannot enter gameplay.</p>"},{"location":"part-6-reincarnate/index.html#section-1-reincarnate-packet-0x25","title":"Section 1: REINCARNATE Packet (0x25)","text":""},{"location":"part-6-reincarnate/index.html#packet-registration","title":"Packet Registration","text":"<pre><code>// From line 77057\nFUN_00509b40(0x25, FUN_0046e280);    // Register type 0x25 \u2192 REINCARNATE handler\n</code></pre>"},{"location":"part-6-reincarnate/index.html#overview_1","title":"Overview","text":"<p>REINCARNATE is a bidirectional packet used for: - Client \u2192 Server: Team selection, spawn requests, respawn requests - Server \u2192 Client: Confirmations, status messages, team changes</p>"},{"location":"part-6-reincarnate/index.html#the-handler-code-server-client","title":"The Handler Code (Server \u2192 Client)","text":"<p>From FUN_0046e280 (lines 78119-78219):</p> <pre><code>void FUN_0046e280(undefined4 param_1, undefined4 param_2, undefined4 param_3) {\n    char local_f[3];\n    char *local_c;\n\n    FUN_004e5080();                        // Initialize context\n    local_c = (char *)0x0;\n    FUN_00509db0(\"REINCARNATE\", param_3);  // Set packet name\n\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    // READ PACKET DATA\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    FUN_005092e0(local_f);                 // 1 byte:  Sub-type\n    FUN_00509340(&amp;local_c);                // String:  Message (optional)\n    FUN_00509dc0(param_3, param_2);        // Byte alignment\n\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    // PROCESS BASED ON SUB-TYPE\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    switch(local_f[0]) {\n        case 0x02: iVar4 = 0x11; break;    // Team assignment confirm\n        case 0x04: iVar4 = 0x11; break;    // Spawn response\n        case 0x05: iVar4 = 0x11; break;\n        case 0x06: iVar4 = 0x11; break;\n        case 0x07: iVar4 = 0x11; break;\n        case 0x08: iVar4 = 0x11; break;\n        case 0x09: iVar4 = 0x11; break;\n        case 0x0A: iVar4 = 0x11; break;\n        case 0x0B: iVar4 = 6; break;       // Status change\n        case 0x0C: iVar4 = 0x0f; break;\n        case 0x0D: iVar4 = 0x0b; break;\n        case 0x0E: /* team-specific */ break;\n        case 0x0F: iVar4 = 0x11; break;\n        case 0x10: iVar4 = 0x11; break;\n        case 0x11: iVar4 = 6; break;\n        case 0x12: iVar4 = 0x11; /* message display */ break;\n        default:   iVar4 = 0x13; break;\n    }\n\n    // Store sub-type for client state machine\n    DAT_005b86a8 = (int)local_f[0];\n\n    if (local_c != (char *)0x0) {\n        _free(local_c);\n    }\n}\n</code></pre>"},{"location":"part-6-reincarnate/index.html#wire-format","title":"Wire Format","text":"<pre><code>REINCARNATE Packet Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TYPE    \u2502   LENGTH     \u2502   PAYLOAD                                       \u2502\n\u2502  0x25    \u2502  (2 bytes)   \u2502   (sub-type + message)                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n   1 byte     2 bytes BE         variable\n\nPayload Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset  \u2502 Content                                                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0       \u2502 Sub-type (1 byte)                                               \u2502\n\u2502 1       \u2502 Message (length-prefixed string, can be empty)                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-6-reincarnate/index.html#sub-type-reference","title":"Sub-Type Reference","text":""},{"location":"part-6-reincarnate/index.html#client-server-sub-types","title":"Client \u2192 Server Sub-Types","text":"Sub-Type Hex Description 0 0x00 Initial/default request 1 0x01 Join Team 1 (Red) 3 0x03 Join Team 2 (Blue)"},{"location":"part-6-reincarnate/index.html#server-client-sub-types","title":"Server \u2192 Client Sub-Types","text":"Sub-Type Hex Description Client Action 2 0x02 Team assignment confirmed Update UI state 4-10 0x04-0x0A Various spawn/status responses Process spawn 11 0x0B Status change Update status display 12 0x0C Mode change Update game mode 13 0x0D Conditional status Context-dependent 14 0x0E Team-specific status Team-based logic 15-16 0x0F-0x10 Additional status Update state 17 0x11 Generic response General acknowledgment 18 0x12 Message display Show message to player"},{"location":"part-6-reincarnate/index.html#what-the-client-sends-team-selection","title":"What the Client Sends (Team Selection)","text":"<p>When the player clicks \"Join Team 1\" or \"Join Team 2\":</p> <pre><code>// From FUN_0046bc90 (lines 76821-76834)\nvoid FUN_0046bc90(char param_1) {\n    int iVar1;\n\n    iVar1 = FUN_00509cf0(\"REINCARNATE\", 0x25, 0, 2);\n    if (iVar1 != 0) {\n        thunk_FUN_00509440(1);        // Write sub-type: 1 (join team 1)\n        FUN_00509520((int)param_1);   // Write team parameter\n        FUN_00509520(0);              // Write additional param\n        FUN_0050a340(iVar1);          // Send packet\n    }\n}\n</code></pre>"},{"location":"part-6-reincarnate/index.html#section-2-player-packet-0x17-critical","title":"Section 2: PLAYER Packet (0x17) - CRITICAL","text":""},{"location":"part-6-reincarnate/index.html#packet-registration_1","title":"Packet Registration","text":"<pre><code>// From line 77038\nFUN_00509b40(0x17, FUN_0046d1f0);    // Register type 0x17 \u2192 PLAYER handler\n</code></pre>"},{"location":"part-6-reincarnate/index.html#the-handler-code","title":"The Handler Code","text":"<p>From FUN_0046d1f0 (lines 77607-77621):</p> <pre><code>void FUN_0046d1f0(undefined4 param_1, undefined4 param_2, undefined4 param_3) {\n    char local_5;\n    undefined4 local_4;\n\n    FUN_00509db0(\"PLAYER\", param_3);       // Set packet name\n    FUN_00509310(&amp;local_4);                // 4 bytes: Entity ID\n    FUN_005092e0(&amp;local_5);                // 1 byte:  Active flag\n    FUN_00509dc0(param_3, param_2);        // Byte alignment\n\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    // CRITICAL: These assignments enable gameplay!\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    DAT_005b8393 = local_5 != '\\0';        // Player is active\n    DAT_005b83e4 = local_4;                // Player's entity ID\n\n    FUN_00443a10();                        // Initialize player systems\n    FUN_00417ae0();                        // Transition to gameplay state!\n}\n</code></pre>"},{"location":"part-6-reincarnate/index.html#wire-format_1","title":"Wire Format","text":"<pre><code>PLAYER Packet Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TYPE    \u2502   LENGTH     \u2502   PAYLOAD                                       \u2502\n\u2502  0x17    \u2502   00 05      \u2502   [Entity ID][Active]                           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n   1 byte     2 bytes          5 bytes\n\nPayload Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset  \u2502 Size \u2502 Description                                              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0-3     \u2502 4    \u2502 Entity ID (uint32 big-endian) - player's vehicle        \u2502\n\u2502 4       \u2502 1    \u2502 Active flag (0x00=inactive, 0x01=active)                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nTotal payload: 5 bytes\nTotal packet: 8 bytes\n</code></pre>"},{"location":"part-6-reincarnate/index.html#why-this-packet-is-critical","title":"Why This Packet Is Critical","text":"<p>The PLAYER packet does two essential things:</p> <ol> <li>Assigns an entity ID to the player - this is the vehicle/unit they control</li> <li>Triggers the gameplay transition via FUN_00417ae0()</li> </ol> <p>Without this packet, even if the server sends all other packets correctly, the client will: - Remain at team selection - Have no entity to control - Never enter the game world</p>"},{"location":"part-6-reincarnate/index.html#section-3-game_clock-packet-0x2f","title":"Section 3: GAME_CLOCK Packet (0x2F)","text":""},{"location":"part-6-reincarnate/index.html#packet-registration_2","title":"Packet Registration","text":"<pre><code>// From line 77060\nFUN_00509b40(0x2F, FUN_0046e680);    // Register type 0x2F \u2192 GAME_CLOCK handler\n</code></pre>"},{"location":"part-6-reincarnate/index.html#the-handler-code_1","title":"The Handler Code","text":"<p>From FUN_0046e680 (lines 78224-78262):</p> <pre><code>void FUN_0046e680(undefined4 param_1, undefined4 param_2, undefined4 param_3) {\n    char local_d;\n    undefined4 local_c;\n    undefined4 local_8;\n    undefined4 local_4;\n\n    FUN_00509db0(\"GAME_CLOCK\", param_3);   // Set packet name\n    FUN_00509310(&amp;local_c);                // 4 bytes: Game time\n    FUN_005092e0(&amp;local_d);                // 1 byte:  Time state flag\n    FUN_00509310(&amp;local_4);                // 4 bytes: Round time remaining\n    FUN_00509310(&amp;local_8);                // 4 bytes: Additional time value\n    FUN_00509dc0(param_3, param_2);        // Byte alignment\n\n    // Synchronize client clock with server\n    FUN_004eae70(local_c, /* ... */, local_d != '\\0');\n    FUN_004e6f30(local_8);\n    DAT_00677f38 = local_4;\n    DAT_00679068 = local_d == '\\0';\n}\n</code></pre>"},{"location":"part-6-reincarnate/index.html#wire-format_2","title":"Wire Format","text":"<pre><code>GAME_CLOCK Packet Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TYPE    \u2502   LENGTH     \u2502   PAYLOAD                                       \u2502\n\u2502  0x2F    \u2502   00 0D      \u2502   [time data]                                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n   1 byte     2 bytes          13 bytes\n\nPayload Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset  \u2502 Size \u2502 Description                                              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0-3     \u2502 4    \u2502 Game time (uint32 big-endian, milliseconds or ticks)    \u2502\n\u2502 4       \u2502 1    \u2502 Time state flag (0x00=paused, 0x01=running)             \u2502\n\u2502 5-8     \u2502 4    \u2502 Round time remaining (uint32 big-endian)                \u2502\n\u2502 9-12    \u2502 4    \u2502 Additional time value (uint32 big-endian)               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nTotal payload: 13 bytes\nTotal packet: 16 bytes\n</code></pre>"},{"location":"part-6-reincarnate/index.html#section-4-world_stats-packet-0x16","title":"Section 4: WORLD_STATS Packet (0x16)","text":""},{"location":"part-6-reincarnate/index.html#packet-registration_3","title":"Packet Registration","text":"<pre><code>// From line 77037\nFUN_00509b40(0x16, FUN_0046cf50);    // Register type 0x16 \u2192 WORLD_STATS handler\n</code></pre>"},{"location":"part-6-reincarnate/index.html#the-handler-code_2","title":"The Handler Code","text":"<p>From FUN_0046cf50 (lines 77497-77523):</p> <pre><code>void FUN_0046cf50(undefined4 param_1, undefined4 param_2, undefined4 param_3) {\n    int iVar1;\n    char local_e;\n    undefined1 local_d;\n    void *local_c;\n    undefined4 local_8;\n    float local_4;\n\n    FUN_00509db0(\"WORLD_STATS\", param_3);  // Set packet name\n    FUN_00509340(&amp;local_c);                // String: Map name\n    FUN_005092e0(&amp;local_d);                // 1 byte:  Unknown flag\n    FUN_005092e0(&amp;local_e);                // 1 byte:  World type/mode\n    FUN_00509310(&amp;local_8);                // 4 bytes: Scale factor (fixed-point)\n    FUN_00509dc0(param_3, param_2);        // Byte alignment\n\n    // Convert fixed-point scale to float\n    local_4 = (float)FUN_004dc620(local_8);\n\n    // Apply world settings\n    FUN_00419390(0);\n    FUN_004b9eb0((int)local_e, local_4);\n    _free(local_c);\n\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    // IMPORTANT: Client automatically sends WANT_UPDATES!\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    iVar1 = FUN_00509cf0(\"WANT_UPDATES\", 0x39, 0, 1);\n    if (iVar1 != 0) {\n        thunk_FUN_00509520(1);             // Write flags: 1\n        FUN_0050a340(iVar1);               // Send packet\n    }\n}\n</code></pre>"},{"location":"part-6-reincarnate/index.html#wire-format_3","title":"Wire Format","text":"<pre><code>WORLD_STATS Packet Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TYPE    \u2502   LENGTH     \u2502   PAYLOAD                                       \u2502\n\u2502  0x16    \u2502  (2 bytes)   \u2502   [map data]                                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n   1 byte     2 bytes          variable\n\nPayload Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset  \u2502 Content                                                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0       \u2502 Map name (length-prefixed string)                               \u2502\n\u2502 varies  \u2502 Unknown flag (1 byte)                                           \u2502\n\u2502 varies  \u2502 World type/mode (1 byte)                                        \u2502\n\u2502 varies  \u2502 Scale factor (4 bytes, fixed-point)                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-6-reincarnate/index.html#important-behavior","title":"Important Behavior","text":"<p>After receiving WORLD_STATS, the client automatically sends a WANT_UPDATES (0x39) packet to request game state updates. Your server should be prepared to receive this.</p>"},{"location":"part-6-reincarnate/index.html#section-5-add_to_roster-packet-0x1a","title":"Section 5: ADD_TO_ROSTER Packet (0x1A)","text":""},{"location":"part-6-reincarnate/index.html#packet-registration_4","title":"Packet Registration","text":"<pre><code>// From line 77042\nFUN_00509b40(0x1A, FUN_0046d5d0);    // Register type 0x1A \u2192 ADD_TO_ROSTER handler\n</code></pre>"},{"location":"part-6-reincarnate/index.html#the-handler-code_3","title":"The Handler Code","text":"<p>From FUN_0046d5d0 (lines 77724-77759):</p> <pre><code>void FUN_0046d5d0(undefined4 param_1, undefined4 param_2, undefined4 param_3) {\n    undefined2 local_30[2];      // Deaths\n    undefined2 local_2c[2];      // Kills\n    undefined2 local_28[2];      // Some stat\n    undefined2 local_24[2];      // Team ID\n    void *local_20[2];           // Player name\n    undefined4 local_18;         // Clan/tag string\n    undefined4 local_14;         // Some ID\n    undefined4 local_10;         // Entity ID\n    undefined4 local_c;          // Player ID\n    undefined8 local_8;          // Score (fixed-point double)\n\n    FUN_004e5080();\n    FUN_004e5090(param_3);\n    FUN_00509db0();                        // \"ADD_TO_ROSTER\"\n    FUN_00509310(&amp;local_c);                // 4 bytes: Player ID\n    FUN_00509310(&amp;local_10);               // 4 bytes: Entity ID\n    FUN_005092f0(local_24);                // 2 bytes: Team ID\n    FUN_005092f0(local_28);                // 2 bytes: Some stat\n    FUN_00509340(local_20);                // String:  Player name\n    FUN_00509340(&amp;local_18);               // String:  Clan tag\n    FUN_005092f0(local_2c);                // 2 bytes: Kills\n    FUN_005092f0(local_30);                // 2 bytes: Deaths\n    FUN_004e51d0(&amp;local_8);                // 4 bytes: Score (fixed-point)\n    FUN_00509310(&amp;local_14);               // 4 bytes: Some ID\n    FUN_00509dc0();                        // Byte alignment\n\n    // Add player to roster\n    FUN_00475b90(local_c, local_10, local_24[0], local_28[0], \n                 local_18, local_2c[0], local_30[0], local_8, local_14);\n}\n</code></pre>"},{"location":"part-6-reincarnate/index.html#wire-format_4","title":"Wire Format","text":"<pre><code>ADD_TO_ROSTER Packet Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TYPE    \u2502   LENGTH     \u2502   PAYLOAD                                       \u2502\n\u2502  0x1A    \u2502  (2 bytes)   \u2502   [roster data]                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nPayload Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset  \u2502 Size \u2502 Description                                              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0-3     \u2502 4    \u2502 Player ID (uint32 big-endian)                           \u2502\n\u2502 4-7     \u2502 4    \u2502 Entity ID (uint32 big-endian)                           \u2502\n\u2502 8-9     \u2502 2    \u2502 Team ID (uint16 big-endian)                             \u2502\n\u2502 10-11   \u2502 2    \u2502 Status/flags (uint16 big-endian)                        \u2502\n\u2502 12+     \u2502 var  \u2502 Player name (length-prefixed string)                    \u2502\n\u2502 varies  \u2502 var  \u2502 Clan tag (length-prefixed string)                       \u2502\n\u2502 varies  \u2502 2    \u2502 Kills (uint16 big-endian)                               \u2502\n\u2502 varies  \u2502 2    \u2502 Deaths (uint16 big-endian)                              \u2502\n\u2502 varies  \u2502 4    \u2502 Score (fixed-point)                                     \u2502\n\u2502 varies  \u2502 4    \u2502 Additional ID (uint32 big-endian)                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-6-reincarnate/index.html#simplified-version-for-testing","title":"Simplified Version for Testing","text":"<p>For initial testing, you can send a minimal roster entry:</p> <pre><code>def create_add_to_roster_simple(player_id, entity_id, team_id, player_name):\n    \"\"\"Create a simplified ADD_TO_ROSTER packet.\"\"\"\n    payload = bytearray()\n\n    payload.extend(struct.pack('&gt;I', player_id))     # Player ID\n    payload.extend(struct.pack('&gt;I', entity_id))     # Entity ID\n    payload.extend(struct.pack('&gt;H', team_id))       # Team ID\n    payload.extend(struct.pack('&gt;H', 0))             # Status flags\n    payload.extend(encode_string(player_name))       # Player name\n    payload.extend(encode_string(\"\"))                # Clan tag (empty)\n    payload.extend(struct.pack('&gt;H', 0))             # Kills\n    payload.extend(struct.pack('&gt;H', 0))             # Deaths\n    payload.extend(struct.pack('&gt;i', 0))             # Score (fixed-point 0.0)\n    payload.extend(struct.pack('&gt;I', 0))             # Additional ID\n\n    return make_packet(0x1A, payload)\n</code></pre>"},{"location":"part-6-reincarnate/index.html#section-6-want_updates-packet-0x39","title":"Section 6: WANT_UPDATES Packet (0x39)","text":""},{"location":"part-6-reincarnate/index.html#overview_2","title":"Overview","text":"<p>WANT_UPDATES is a Client \u2192 Server packet that the client sends automatically after receiving WORLD_STATS. It signals that the client is ready to receive game state updates.</p>"},{"location":"part-6-reincarnate/index.html#what-the-client-sends","title":"What the Client Sends","text":"<pre><code>// From FUN_0046cf50 (lines 77518-77522)\niVar1 = FUN_00509cf0(\"WANT_UPDATES\", 0x39, 0, 1);\nif (iVar1 != 0) {\n    thunk_FUN_00509520(1);         // Write flags: 1\n    FUN_0050a340(iVar1);           // Send packet\n}\n</code></pre>"},{"location":"part-6-reincarnate/index.html#wire-format_5","title":"Wire Format","text":"<pre><code>WANT_UPDATES Packet (Client \u2192 Server):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TYPE    \u2502   LENGTH     \u2502   PAYLOAD                                       \u2502\n\u2502  0x39    \u2502   00 04      \u2502   [flags]                                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nPayload Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset  \u2502 Size \u2502 Description                                              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0-3     \u2502 4    \u2502 Update flags (uint32 big-endian, typically 1)           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nTotal payload: 4 bytes\nTotal packet: 7 bytes\n</code></pre>"},{"location":"part-6-reincarnate/index.html#server-response","title":"Server Response","text":"<p>After receiving WANT_UPDATES, your server should begin sending: - UPDATE_ARRAY (0x0E) - Entity positions and states - BIRTH_NOTICE (0x1E) - New entity spawns - Other gameplay packets as needed</p>"},{"location":"part-6-reincarnate/index.html#complete-game-entry-implementation","title":"Complete Game Entry Implementation","text":""},{"location":"part-6-reincarnate/index.html#python-implementation","title":"Python Implementation","text":"<pre><code>import struct\n\ndef encode_string(text):\n    \"\"\"Encode a length-prefixed, null-terminated string.\"\"\"\n    string_bytes = text.encode('utf-8') + b'\\x00'\n    return struct.pack('&gt;H', len(string_bytes)) + string_bytes\n\ndef encode_fixed_point(float_value):\n    \"\"\"Convert a float to fixed-point format (4 bytes big-endian).\"\"\"\n    wire_value = int(float_value * 65536)\n    return struct.pack('&gt;i', wire_value)\n\ndef make_packet(packet_type, payload):\n    \"\"\"Wrap payload in a complete packet frame.\"\"\"\n    return bytes([packet_type]) + struct.pack('&gt;H', len(payload)) + payload\n\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n# PACKET CREATORS\n# \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\ndef create_reincarnate_response(sub_type, message=\"\"):\n    \"\"\"\n    Create a REINCARNATE response packet (Server \u2192 Client).\n\n    Args:\n        sub_type: Response sub-type (e.g., 0x02 for team confirm)\n        message: Optional message to display\n\n    Returns:\n        Complete packet bytes\n    \"\"\"\n    payload = bytearray()\n    payload.append(sub_type &amp; 0xFF)          # Sub-type\n    payload.extend(encode_string(message))    # Message (can be empty)\n\n    return make_packet(0x25, payload)\n\ndef create_player_packet(entity_id, active=True):\n    \"\"\"\n    Create a PLAYER packet (0x17) - CRITICAL for game entry!\n\n    Args:\n        entity_id: The entity ID to assign to the player\n        active: Whether the player is active (True = in game)\n\n    Returns:\n        Complete packet bytes\n    \"\"\"\n    payload = bytearray()\n    payload.extend(struct.pack('&gt;I', entity_id))  # Entity ID (4 bytes BE)\n    payload.append(0x01 if active else 0x00)      # Active flag (1 byte)\n\n    return make_packet(0x17, payload)\n\ndef create_game_clock_packet(game_time=0, running=True, round_time=3600000, extra=0):\n    \"\"\"\n    Create a GAME_CLOCK packet (0x2F).\n\n    Args:\n        game_time: Current game time in milliseconds\n        running: Whether game time is running (vs paused)\n        round_time: Time remaining in round (milliseconds)\n        extra: Additional time value\n\n    Returns:\n        Complete packet bytes\n    \"\"\"\n    payload = bytearray()\n    payload.extend(struct.pack('&gt;I', game_time))   # Game time\n    payload.append(0x01 if running else 0x00)      # Running flag\n    payload.extend(struct.pack('&gt;I', round_time))  # Round time remaining\n    payload.extend(struct.pack('&gt;I', extra))       # Extra value\n\n    return make_packet(0x2F, payload)\n\ndef create_world_stats_packet(map_name=\"default\", world_type=0, scale=1.0):\n    \"\"\"\n    Create a WORLD_STATS packet (0x16).\n\n    NOTE: After receiving this, client will send WANT_UPDATES (0x39)!\n\n    Args:\n        map_name: Name of the current map\n        world_type: World type/mode value\n        scale: World scale factor\n\n    Returns:\n        Complete packet bytes\n    \"\"\"\n    payload = bytearray()\n    payload.extend(encode_string(map_name))        # Map name\n    payload.append(0x00)                           # Unknown flag\n    payload.append(world_type &amp; 0xFF)              # World type\n    payload.extend(encode_fixed_point(scale))      # Scale (fixed-point)\n\n    return make_packet(0x16, payload)\n\ndef create_add_to_roster_packet(player_id, entity_id, team_id, player_name,\n                                 clan_tag=\"\", kills=0, deaths=0, score=0.0):\n    \"\"\"\n    Create an ADD_TO_ROSTER packet (0x1A).\n\n    Args:\n        player_id: Unique player ID\n        entity_id: Player's entity ID\n        team_id: Team ID (1 or 2)\n        player_name: Player's display name\n        clan_tag: Optional clan tag\n        kills: Kill count\n        deaths: Death count\n        score: Player score\n\n    Returns:\n        Complete packet bytes\n    \"\"\"\n    payload = bytearray()\n    payload.extend(struct.pack('&gt;I', player_id))   # Player ID\n    payload.extend(struct.pack('&gt;I', entity_id))   # Entity ID\n    payload.extend(struct.pack('&gt;H', team_id))     # Team ID\n    payload.extend(struct.pack('&gt;H', 0))           # Status flags\n    payload.extend(encode_string(player_name))     # Player name\n    payload.extend(encode_string(clan_tag))        # Clan tag\n    payload.extend(struct.pack('&gt;H', kills))       # Kills\n    payload.extend(struct.pack('&gt;H', deaths))      # Deaths\n    payload.extend(encode_fixed_point(score))      # Score\n    payload.extend(struct.pack('&gt;I', 0))           # Additional ID\n\n    return make_packet(0x1A, payload)\n</code></pre>"},{"location":"part-6-reincarnate/index.html#complete-game-entry-sequence","title":"Complete Game Entry Sequence","text":"<pre><code>class Wulfram2Server:\n    def handle_reincarnate(self, conn, payload):\n        \"\"\"\n        Handle REINCARNATE packet from client (team selection).\n        \"\"\"\n        sub_type = payload[0]\n\n        print(f\"Received REINCARNATE sub_type={sub_type}\")\n\n        # Client is requesting to join a team\n        if sub_type in (0x00, 0x01, 0x03):\n            # Determine which team they want\n            if sub_type == 0x01:\n                team_id = 1  # Red team\n            elif sub_type == 0x03:\n                team_id = 2  # Blue team\n            else:\n                team_id = 1  # Default to team 1\n\n            # Complete the game entry sequence\n            self.complete_game_entry(conn, team_id)\n\n    def complete_game_entry(self, conn, team_id, player_name=\"Player\"):\n        \"\"\"\n        Complete the game entry sequence after team selection.\n\n        This sends all packets needed to transition the client\n        from team selection to active gameplay.\n        \"\"\"\n        # Generate IDs for this player\n        player_id = 1          # Unique player ID\n        entity_id = 12345      # Entity ID for player's vehicle\n\n        # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        # Step 1: REINCARNATE response (confirm team selection)\n        # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        reincarnate = create_reincarnate_response(0x02, \"Welcome!\")\n        conn.send(reincarnate)\n        print(\"Sent REINCARNATE response\")\n\n        # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        # Step 2: PLAYER packet - CRITICAL! Assigns entity to player\n        # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        player = create_player_packet(entity_id, active=True)\n        conn.send(player)\n        print(f\"Sent PLAYER packet (entity_id={entity_id})\")\n\n        # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        # Step 3: GAME_CLOCK - Synchronize game time\n        # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        game_clock = create_game_clock_packet(\n            game_time=0,\n            running=True,\n            round_time=3600000,  # 1 hour\n            extra=0\n        )\n        conn.send(game_clock)\n        print(\"Sent GAME_CLOCK\")\n\n        # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        # Step 4: ADD_TO_ROSTER - Add player to team roster\n        # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        roster = create_add_to_roster_packet(\n            player_id=player_id,\n            entity_id=entity_id,\n            team_id=team_id,\n            player_name=player_name\n        )\n        conn.send(roster)\n        print(f\"Sent ADD_TO_ROSTER (team={team_id})\")\n\n        # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        # Step 5: WORLD_STATS - Map info (triggers WANT_UPDATES!)\n        # \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n        world_stats = create_world_stats_packet(\n            map_name=\"TestMap\",\n            world_type=0,\n            scale=1.0\n        )\n        conn.send(world_stats)\n        print(\"Sent WORLD_STATS - client will send WANT_UPDATES\")\n\n        # Client is now in gameplay state!\n        print(\"Game entry complete - client should be in game!\")\n</code></pre>"},{"location":"part-6-reincarnate/index.html#example-wire-bytes","title":"Example Wire Bytes","text":""},{"location":"part-6-reincarnate/index.html#reincarnate-response-sub_type0x02-messagewelcome","title":"REINCARNATE Response (sub_type=0x02, message=\"Welcome!\")","text":"<pre><code>Hex: 25 00 0C 02 00 09 57 65 6C 63 6F 6D 65 21 00\n\nBreakdown:\n  25          Type: REINCARNATE\n  00 0C       Length: 12 bytes\n  02          Sub-type: 0x02 (team confirm)\n  00 09       String length: 9 bytes\n  57 65 6C 63 6F 6D 65 21 00   \"Welcome!\\0\"\n</code></pre>"},{"location":"part-6-reincarnate/index.html#player-packet-entity_id12345-activetrue","title":"PLAYER Packet (entity_id=12345, active=true)","text":"<pre><code>Hex: 17 00 05 00 00 30 39 01\n\nBreakdown:\n  17          Type: PLAYER\n  00 05       Length: 5 bytes\n  00 00 30 39 Entity ID: 12345 (0x3039)\n  01          Active: true\n</code></pre>"},{"location":"part-6-reincarnate/index.html#game_clock-packet","title":"GAME_CLOCK Packet","text":"<pre><code>Hex: 2F 00 0D 00 00 00 00 01 00 36 EE 80 00 00 00 00\n\nBreakdown:\n  2F          Type: GAME_CLOCK\n  00 0D       Length: 13 bytes\n  00 00 00 00 Game time: 0\n  01          Running: true\n  00 36 EE 80 Round time: 3600000 (1 hour in ms)\n  00 00 00 00 Extra: 0\n</code></pre>"},{"location":"part-6-reincarnate/index.html#world_stats-packet-map_nametestmap-scale10","title":"WORLD_STATS Packet (map_name=\"TestMap\", scale=1.0)","text":"<pre><code>Hex: 16 00 0F 00 08 54 65 73 74 4D 61 70 00 00 00 00 01 00 00\n\nBreakdown:\n  16          Type: WORLD_STATS\n  00 0F       Length: 15 bytes\n  00 08       String length: 8 bytes\n  54 65 73 74 4D 61 70 00   \"TestMap\\0\"\n  00          Unknown flag\n  00          World type\n  00 01 00 00 Scale: 1.0 (fixed-point)\n</code></pre>"},{"location":"part-6-reincarnate/index.html#complete-flow-diagram","title":"Complete Flow Diagram","text":"<pre><code>GAME ENTRY SEQUENCE:\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nSERVER                                     CLIENT\n   \u2502                                          \u2502\n   \u2502  (TEAM_INFO received, showing selection) \u2502\n   \u2502                                          \u2502\n   \u2502\u25c4\u2500\u2500\u2500\u2500 REINCARNATE (0x25) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502  Player clicks \"Join Red\"\n   \u2502      sub_type=1                          \u2502\n   \u2502                                          \u2502\n   \u2502\u2500\u2500\u2500\u2500\u2500 REINCARNATE (0x25) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502  Confirm team\n   \u2502      sub_type=2, message=\"Welcome!\"      \u2502\n   \u2502                                          \u2502\n   \u2502\u2500\u2500\u2500\u2500\u2500 PLAYER (0x17) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502  \u2605\u2605\u2605 CRITICAL! \u2605\u2605\u2605\n   \u2502      entity_id=12345, active=true        \u2502  Assigns player entity\n   \u2502                                          \u2502\n   \u2502\u2500\u2500\u2500\u2500\u2500 GAME_CLOCK (0x2F) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502  Sync game time\n   \u2502      time=0, running=true                \u2502\n   \u2502                                          \u2502\n   \u2502\u2500\u2500\u2500\u2500\u2500 ADD_TO_ROSTER (0x1A) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502  Add to team roster\n   \u2502      player_id, team=1, name             \u2502\n   \u2502                                          \u2502\n   \u2502\u2500\u2500\u2500\u2500\u2500 WORLD_STATS (0x16) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502  Map information\n   \u2502      map_name=\"TestMap\"                  \u2502\n   \u2502                                          \u2502\n   \u2502\u25c4\u2500\u2500\u2500\u2500 WANT_UPDATES (0x39) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502  (Auto-sent by client)\n   \u2502      flags=1                             \u2502\n   \u2502                                          \u2502\n   \u2502  \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550 \u2502\n   \u2502  CLIENT NOW IN GAMEPLAY STATE            \u2502\n   \u2502  \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550 \u2502\n   \u2502                                          \u2502\n   \u2502\u2500\u2500\u2500\u2500\u2500 UPDATE_ARRAY (0x0E) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502  Begin game updates\n   \u2502\u2500\u2500\u2500\u2500\u2500 BIRTH_NOTICE (0x1E) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502  Entity spawns\n   \u2502\u25c4\u2500\u2500\u2500\u25ba [Bidirectional game traffic]        \u2502\n   \u2502                                          \u2502\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n</code></pre>"},{"location":"part-6-reincarnate/index.html#troubleshooting","title":"Troubleshooting","text":""},{"location":"part-6-reincarnate/index.html#problem-client-stuck-at-team-selection-after-clicking-team","title":"Problem: Client Stuck at Team Selection After Clicking Team","text":"<p>Cause: PLAYER packet not sent, or sent with invalid entity ID.</p> <p>Solution:  <pre><code># Make sure you send PLAYER immediately after REINCARNATE response\nplayer = create_player_packet(entity_id=12345, active=True)\nconn.send(player)\n</code></pre></p>"},{"location":"part-6-reincarnate/index.html#problem-client-enters-game-but-cant-move","title":"Problem: Client Enters Game But Can't Move","text":"<p>Cause: Entity ID doesn't exist, or BEHAVIOR packet was malformed.</p> <p>Solution: - Verify the entity_id in PLAYER packet corresponds to a valid entity - Check BEHAVIOR packet was sent correctly (especially Section 5)</p>"},{"location":"part-6-reincarnate/index.html#problem-client-disconnects-after-world_stats","title":"Problem: Client Disconnects After WORLD_STATS","text":"<p>Cause: Server not handling WANT_UPDATES (0x39) packet.</p> <p>Solution: - Add handler for packet type 0x39 - Begin sending UPDATE_ARRAY packets after receiving WANT_UPDATES</p>"},{"location":"part-6-reincarnate/index.html#problem-player-not-shown-in-team-roster","title":"Problem: Player Not Shown in Team Roster","text":"<p>Cause: ADD_TO_ROSTER not sent, or sent with wrong team ID.</p> <p>Solution: <pre><code>roster = create_add_to_roster_packet(\n    player_id=1,\n    entity_id=12345,\n    team_id=1,  # Must match the team they joined!\n    player_name=\"Player1\"\n)\nconn.send(roster)\n</code></pre></p>"},{"location":"part-6-reincarnate/index.html#common-mistakes","title":"Common Mistakes","text":"Mistake Symptom Fix Missing PLAYER packet Stuck at team selection Send PLAYER after REINCARNATE Entity ID = 0 Client may crash Use valid non-zero entity ID Active flag = 0 Player can't control entity Set active = 0x01 Wrong team_id in roster Player on wrong team Match team_id to selection Missing WORLD_STATS No WANT_UPDATES received Send WORLD_STATS to trigger Not handling WANT_UPDATES Client hangs Implement 0x39 handler"},{"location":"part-6-reincarnate/index.html#verification-checklist","title":"Verification Checklist","text":"<p>Before moving to active gameplay, verify:</p> <ul> <li>[ ] Server receives REINCARNATE from client when team clicked</li> <li>[ ] Server sends REINCARNATE response (sub_type=0x02)</li> <li>[ ] Server sends PLAYER packet (CRITICAL!)</li> <li>[ ] Entity ID in PLAYER is non-zero and valid</li> <li>[ ] Active flag in PLAYER is 0x01</li> <li>[ ] Server sends GAME_CLOCK</li> <li>[ ] Server sends ADD_TO_ROSTER with correct team</li> <li>[ ] Server sends WORLD_STATS (triggers WANT_UPDATES)</li> <li>[ ] Server receives WANT_UPDATES from client</li> <li>[ ] Server begins sending UPDATE_ARRAY packets</li> </ul>"},{"location":"part-6-reincarnate/index.html#quick-reference-packet-summary","title":"Quick Reference: Packet Summary","text":"Packet Type Direction Payload Size Critical? REINCARNATE 0x25 Both Variable Yes PLAYER 0x17 S\u2192C 5 bytes \u2605 CRITICAL GAME_CLOCK 0x2F S\u2192C 13 bytes Recommended ADD_TO_ROSTER 0x1A S\u2192C Variable Recommended WORLD_STATS 0x16 S\u2192C Variable Yes WANT_UPDATES 0x39 C\u2192S 4 bytes Auto (client)"},{"location":"part-6-reincarnate/index.html#minimum-required-packets-for-game-entry","title":"Minimum Required Packets for Game Entry","text":"<p>At absolute minimum, to get a client from team selection to gameplay:</p> <ol> <li>REINCARNATE (0x25) - Response to team selection</li> <li>PLAYER (0x17) - REQUIRED - Assign entity to player</li> <li>WORLD_STATS (0x16) - Triggers client state transition</li> </ol> <p>The other packets (GAME_CLOCK, ADD_TO_ROSTER) are recommended but the game can technically start without them.</p>"},{"location":"part-6-reincarnate/index.html#whats-next","title":"What's Next?","text":"<p>After WORLD_STATS, the client sends WANT_UPDATES and enters active gameplay. In Part 7, we'll cover the UPDATE_ARRAY packet and the continuous game state synchronization required for gameplay.</p> <p>Previous: Part 5: TEAM_INFO Packet Next: Part 7: UPDATE_ARRAY &amp; Game State</p>"},{"location":"part-7-update-array/index.html","title":"Wulfram 2 Server Implementation Guide","text":""},{"location":"part-7-update-array/index.html#part-7-update_array-game-state","title":"Part 7: UPDATE_ARRAY &amp; Game State","text":""},{"location":"part-7-update-array/index.html#overview","title":"Overview","text":"<p>Once the client enters gameplay (after receiving PLAYER and WORLD_STATS), the server must continuously send UPDATE_ARRAY (0x0E) packets to update entity positions, states, and other dynamic game data. This is the primary packet for maintaining game state synchronization between server and all connected clients.</p> <pre><code>Position in Connection Flow:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  PHASE 3: GAME ENTRY                                                    \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                                    \u2502\n\u2502  ... PLAYER, GAME_CLOCK, WORLD_STATS sent ...                          \u2502\n\u2502  Client sends WANT_UPDATES (0x39) automatically                         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  PHASE 4: ACTIVE GAMEPLAY                                \u25c4 YOU ARE      \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                    HERE       \u2502\n\u2502  Server \u2500\u2500\u25ba UPDATE_ARRAY (0x0E)              Entity state updates       \u2502\n\u2502  Server \u2500\u2500\u25ba BIRTH_NOTICE (0x1E)              New entity spawns          \u2502\n\u2502  Server \u2500\u2500\u25ba DELETE_OBJECT (0x15)             Entity removals            \u2502\n\u2502  Server \u2500\u2500\u25ba TRANSIENT_ARRAY (0x0D)           Projectiles/effects        \u2502\n\u2502  Client \u2500\u2500\u25ba ACTION_UPDATE (0x0A)             Player inputs              \u2502\n\u2502             ... continuous bidirectional traffic ...                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-7-update-array/index.html#critical-concept-bit-stream-format","title":"Critical Concept: Bit-Stream Format","text":"<p>The UPDATE_ARRAY packet uses a bit-stream format where field sizes are configured by the BEHAVIOR packet. This means:</p> <ol> <li>Field widths are NOT fixed - they depend on values sent in BEHAVIOR</li> <li>Data is packed at the bit level, not byte level</li> <li>The client uses DAT_00678134 (BEHAVIOR config) to know how to parse</li> </ol> <p>This is why BEHAVIOR must be sent correctly before gameplay!</p>"},{"location":"part-7-update-array/index.html#section-1-update_array-packet-0x0e","title":"Section 1: UPDATE_ARRAY Packet (0x0E)","text":""},{"location":"part-7-update-array/index.html#packet-registration","title":"Packet Registration","text":"<pre><code>// From line 77032\nFUN_00509b40(0x0E, FUN_0046cca0);    // Register type 0x0E \u2192 UPDATE_ARRAY handler\n</code></pre>"},{"location":"part-7-update-array/index.html#the-handler-code","title":"The Handler Code","text":"<p>From FUN_0046cca0 (lines 77435-77442):</p> <pre><code>void FUN_0046cca0(undefined4 param_1, undefined4 param_2, undefined4 param_3) {\n    FUN_00509db0(\"UPDATE_ARRAY\", param_3);  // Set packet name\n    FUN_0047d760(0, 0, param_3);            // Parse update data\n    FUN_00509dc0(param_3, param_2);         // Byte alignment\n    return;\n}\n</code></pre> <p>The actual parsing happens in FUN_0047d760, which is a complex 270+ line function.</p>"},{"location":"part-7-update-array/index.html#the-parsing-function-fun_0047d760","title":"The Parsing Function (FUN_0047d760)","text":"<p>From FUN_0047d760 (lines 88119-88391), simplified and annotated:</p> <pre><code>void FUN_0047d760(char param_1, int param_2, undefined4 param_3) {\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    // HEADER: Read timestamp and entity count\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    FUN_00509310();                    // Read 4 bytes: Timestamp\n    _DAT_0067d0c4 = local_d0;          // Store timestamp\n\n    FUN_00509320(8, &amp;local_c4);        // Read 8 bits: Entity count\n\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    // LOOP: Process each entity update\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    for (int i = 0; i &lt; entity_count; i++) {\n        // Read entity ID using BEHAVIOR-configured bit width\n        FUN_00509310();                // 4 bytes: Entity ID\n\n        // Read presence flags (1 bit each, packed)\n        FUN_00509320(1, &amp;local_a0);    // Has extended data?\n        FUN_00509320(10, &amp;local_dc);   // 10 presence flags\n\n        // Parse based on presence flags (bit mask)\n        if (flags &amp; 0x001) {  // Bit 0: Full entity data\n            // Entity type, team, spawn info\n            FUN_00509320(*DAT_00678134, &amp;entity_type);\n            FUN_00509320(DAT_00678134[0x20], &amp;team_id);\n            FUN_00509320(DAT_00678134[0x30], &amp;spawn_param1);\n            FUN_00509320(DAT_00678134[0x30], &amp;spawn_param2);\n        }\n\n        if (flags &amp; 0x002) {  // Bit 1: Position X\n            FUN_0047cfa0(...);  // Read position component\n        }\n\n        if (flags &amp; 0x004) {  // Bit 2: Position Y\n            FUN_0047cfa0(...);  // Read position component\n        }\n\n        if (flags &amp; 0x008) {  // Bit 3: Position Z\n            FUN_0047cfa0(...);  // Read position component\n        }\n\n        if (flags &amp; 0x010) {  // Bit 4: Velocity/Orientation set 1\n            FUN_0047cfa0(...);\n        }\n\n        if (flags &amp; 0x020) {  // Bit 5: Speed/movement\n            FUN_00509320(DAT_00678134[0x50], &amp;speed);\n        }\n\n        if (flags &amp; 0x040) {  // Bit 6: Weapon state\n            FUN_0047d110(param_3);  // Read weapon data\n        }\n\n        if (flags &amp; 0x080) {  // Bit 7: Health/damage\n            FUN_00509320(DAT_00678134[0x80], &amp;health);\n        }\n\n        if (flags &amp; 0x100) {  // Bit 8: Target/aim\n            FUN_00509310();  // Read target data\n        }\n\n        if (flags &amp; 0x200) {  // Bit 9: Extended state\n            // Additional state data\n        }\n\n        // Apply updates to entity\n        FUN_0047d2f0(local_a8, local_bc, _Memory, local_b0);\n    }\n}\n</code></pre>"},{"location":"part-7-update-array/index.html#section-2-wire-format","title":"Section 2: Wire Format","text":""},{"location":"part-7-update-array/index.html#packet-structure-overview","title":"Packet Structure Overview","text":"<pre><code>UPDATE_ARRAY Packet Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TYPE    \u2502   LENGTH     \u2502   PAYLOAD (bit-stream)                          \u2502\n\u2502  0x0E    \u2502  (2 bytes)   \u2502   [header][entity updates...]                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n   1 byte     2 bytes BE         variable (bit-packed)\n</code></pre>"},{"location":"part-7-update-array/index.html#payload-header","title":"Payload Header","text":"<pre><code>UPDATE_ARRAY Header:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset  \u2502 Size   \u2502 Description                                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0-3     \u2502 32 bits\u2502 Timestamp (uint32 big-endian)                          \u2502\n\u2502 4       \u2502 8 bits \u2502 Entity count (number of entity updates in packet)     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nTotal header: 5 bytes (40 bits)\n</code></pre>"},{"location":"part-7-update-array/index.html#per-entity-update-structure","title":"Per-Entity Update Structure","text":"<p>Each entity update has the following structure:</p> <pre><code>Entity Update Structure (variable length, bit-packed):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  ENTITY ID (4 bytes / 32 bits)                                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  EXTENDED FLAG (1 bit)                                                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  PRESENCE FLAGS (10 bits) - indicates which fields follow               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  FIELD DATA (variable) - only fields indicated by presence flags        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-7-update-array/index.html#presence-flags-10-bits","title":"Presence Flags (10 bits)","text":"Bit Mask Field Description 0 0x001 Full Data Entity type, team, spawn params 1 0x002 Position X X coordinate data 2 0x004 Position Y Y coordinate data 3 0x008 Position Z Z coordinate data 4 0x010 Velocity Velocity/orientation set 5 0x020 Speed Movement speed 6 0x040 Weapon Weapon state data 7 0x080 Health Health/damage value 8 0x100 Target Targeting data 9 0x200 Extended Additional state"},{"location":"part-7-update-array/index.html#section-3-behavior-configured-bit-widths","title":"Section 3: BEHAVIOR-Configured Bit Widths","text":"<p>The bit widths used in UPDATE_ARRAY come from the BEHAVIOR packet and are stored in DAT_00678134. Here's the mapping:</p> <pre><code>Bit Width Configuration (from BEHAVIOR):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Config Offset      \u2502 Used For                                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 DAT_00678134[0x00] \u2502 Entity type index bit width                        \u2502\n\u2502 DAT_00678134[0x20] \u2502 Team ID bit width                                  \u2502\n\u2502 DAT_00678134[0x30] \u2502 Spawn parameter bit width                          \u2502\n\u2502 DAT_00678134[0x40] \u2502 Position component base bit width                  \u2502\n\u2502 DAT_00678134[0x50] \u2502 Speed value bit width                              \u2502\n\u2502 DAT_00678134[0x80] \u2502 Health value bit width                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-7-update-array/index.html#position-data-format","title":"Position Data Format","text":"<p>Position components use a more complex format that combines a base value with additional precision bits:</p> <pre><code>// From FUN_0047cfa0 (lines 87727-87758)\nvoid FUN_0047cfa0(int param_1, int param_2, ...) {\n    // Read base component value\n    iVar1 = *(int *)(entity_type * 0x40 + param_1);      // Base width\n    iVar2 = *(int *)(entity_type * 0x40 + 4 + param_1);  // Extra width\n\n    FUN_00509320(iVar1, &amp;local_10);  // Read base value\n    iVar2 = iVar2 + local_10;        // Calculate total width\n\n    // Read X, Y, Z with calculated width\n    FUN_00509320(iVar2, &amp;local_c);   // X\n    FUN_00509320(iVar2, &amp;local_8);   // Y\n    FUN_00509320(iVar2, &amp;local_4);   // Z\n\n    // Convert from fixed-point\n    *param_5 = (float)FUN_004f8f40(iVar2, local_c);\n    *param_6 = (float)FUN_004f8f40(iVar2, local_8);\n    *param_7 = (float)FUN_004f8f40(iVar2, local_4);\n}\n</code></pre>"},{"location":"part-7-update-array/index.html#section-4-related-packets","title":"Section 4: Related Packets","text":""},{"location":"part-7-update-array/index.html#birth_notice-0x1e","title":"BIRTH_NOTICE (0x1E)","text":"<p>Sent when a new entity spawns in the world.</p> <p>Handler: FUN_0046d880 (lines 77796-77819)</p> <pre><code>void FUN_0046d880(param_1, param_2, param_3) {\n    FUN_00509db0(\"BIRTH_NOTICE\", param_3);\n    FUN_00509310(&amp;local_4);     // 4 bytes: Entity ID\n    FUN_00509310(&amp;local_8);     // 4 bytes: Birth time/flags\n    FUN_00509dc0(param_3, param_2);\n\n    // Find entity and mark as spawned\n    // Sets entity flags at offset 0x3c and 0x40\n}\n</code></pre> <p>Wire Format: <pre><code>BIRTH_NOTICE Payload:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset  \u2502 Size \u2502 Description                                              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0-3     \u2502 4    \u2502 Entity ID (uint32 big-endian)                           \u2502\n\u2502 4-7     \u2502 4    \u2502 Birth data/timestamp (uint32 big-endian)                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nTotal: 8 bytes payload\n</code></pre></p>"},{"location":"part-7-update-array/index.html#delete_object-0x15","title":"DELETE_OBJECT (0x15)","text":"<p>Sent when entities are removed from the world.</p> <p>Handler: FUN_0046d4b0 (lines 77679-77719)</p> <pre><code>void FUN_0046d4b0(param_1, param_2, param_3) {\n    FUN_00509db0(\"DELETE_OBJECT\", param_3);\n    FUN_00509310(&amp;local_4);     // 4 bytes: Timestamp\n    FUN_005092e0(&amp;local_e);     // 1 byte:  Deletion count\n\n    for (i = 0; i &lt; deletion_count; i++) {\n        FUN_00509310(&amp;local_c);     // 4 bytes: Entity ID\n        FUN_005092e0(&amp;local_d);     // 1 byte:  Deletion flags\n\n        // Play destruction effect if flags set\n        // Remove entity from world\n        FUN_00419310();\n    }\n\n    FUN_00509dc0(param_3, param_2);\n}\n</code></pre> <p>Wire Format: <pre><code>DELETE_OBJECT Payload:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset  \u2502 Size \u2502 Description                                              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0-3     \u2502 4    \u2502 Timestamp (uint32 big-endian)                           \u2502\n\u2502 4       \u2502 1    \u2502 Deletion count                                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502         \u2502      \u2502 Per deletion (repeated 'count' times):                  \u2502\n\u2502 varies  \u2502 4    \u2502   Entity ID (uint32 big-endian)                         \u2502\n\u2502 varies  \u2502 1    \u2502   Deletion flags (show explosion, etc.)                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre></p>"},{"location":"part-7-update-array/index.html#transient_array-0x0d","title":"TRANSIENT_ARRAY (0x0D)","text":"<p>Sent for temporary entities like projectiles, effects, and particles.</p> <p>Registration: Line 77031 - <code>FUN_00509b40(0x0D, FUN_0046cc10)</code></p> <p>Similar structure to UPDATE_ARRAY but for short-lived entities that don't need full entity management.</p>"},{"location":"part-7-update-array/index.html#section-5-implementation-strategy","title":"Section 5: Implementation Strategy","text":""},{"location":"part-7-update-array/index.html#simplified-update_array-for-testing","title":"Simplified UPDATE_ARRAY for Testing","text":"<p>For initial testing, you can create a simplified UPDATE_ARRAY that sends minimal data:</p> <pre><code>import struct\nimport io\n\nclass BitWriter:\n    \"\"\"Write data at the bit level.\"\"\"\n\n    def __init__(self):\n        self.buffer = bytearray()\n        self.current_byte = 0\n        self.bit_position = 0\n\n    def write_bits(self, value, num_bits):\n        \"\"\"Write a value using the specified number of bits.\"\"\"\n        for i in range(num_bits - 1, -1, -1):\n            bit = (value &gt;&gt; i) &amp; 1\n            self.current_byte = (self.current_byte &lt;&lt; 1) | bit\n            self.bit_position += 1\n\n            if self.bit_position == 8:\n                self.buffer.append(self.current_byte)\n                self.current_byte = 0\n                self.bit_position = 0\n\n    def write_uint32(self, value):\n        \"\"\"Write a 32-bit value (byte-aligned).\"\"\"\n        self.flush()  # Align to byte boundary first\n        self.buffer.extend(struct.pack('&gt;I', value))\n\n    def write_fixed_point(self, float_value, num_bits):\n        \"\"\"Write a fixed-point value.\"\"\"\n        max_val = (1 &lt;&lt; num_bits) - 1\n        # Scale float to integer range\n        int_val = int(float_value * 65536) &amp; max_val\n        self.write_bits(int_val, num_bits)\n\n    def flush(self):\n        \"\"\"Pad remaining bits to byte boundary.\"\"\"\n        if self.bit_position &gt; 0:\n            self.current_byte &lt;&lt;= (8 - self.bit_position)\n            self.buffer.append(self.current_byte)\n            self.current_byte = 0\n            self.bit_position = 0\n\n    def get_bytes(self):\n        \"\"\"Get the final byte array.\"\"\"\n        self.flush()\n        return bytes(self.buffer)\n\n\ndef create_update_array_simple(timestamp, entities):\n    \"\"\"\n    Create a simplified UPDATE_ARRAY packet.\n\n    Args:\n        timestamp: Current game timestamp\n        entities: List of (entity_id, x, y, z) tuples\n\n    Returns:\n        Complete packet bytes\n    \"\"\"\n    writer = BitWriter()\n\n    # Header\n    writer.write_uint32(timestamp)\n    writer.write_bits(len(entities), 8)  # Entity count\n\n    for entity_id, x, y, z in entities:\n        # Entity ID (32 bits)\n        writer.write_uint32(entity_id)\n\n        # Extended flag (1 bit) - not extended\n        writer.write_bits(0, 1)\n\n        # Presence flags (10 bits) - only position bits set (0x00E)\n        # Bits 1, 2, 3 = X, Y, Z position\n        writer.write_bits(0x00E, 10)\n\n        # Position data (simplified - using fixed bit widths)\n        # In real implementation, use BEHAVIOR-configured widths\n        writer.write_fixed_point(x, 16)\n        writer.write_fixed_point(y, 16)\n        writer.write_fixed_point(z, 16)\n\n    payload = writer.get_bytes()\n\n    # Create packet frame\n    return bytes([0x0E]) + struct.pack('&gt;H', len(payload)) + payload\n</code></pre>"},{"location":"part-7-update-array/index.html#full-implementation-notes","title":"Full Implementation Notes","text":"<p>For a complete implementation:</p> <ol> <li>Track BEHAVIOR configuration: Store the bit widths from BEHAVIOR packet</li> <li>Entity management: Maintain a server-side entity list with positions, states</li> <li>Delta compression: Only send fields that changed (using presence flags)</li> <li>Tick rate: Send UPDATE_ARRAY at regular intervals (e.g., 20-60 Hz)</li> </ol> <pre><code>class GameState:\n    def __init__(self):\n        self.entities = {}  # entity_id -&gt; EntityState\n        self.timestamp = 0\n        self.behavior_config = None  # From BEHAVIOR packet\n\n    def create_update_packet(self):\n        \"\"\"Create UPDATE_ARRAY with all active entities.\"\"\"\n        self.timestamp += 1\n\n        # Build entity list\n        entity_updates = []\n        for entity_id, state in self.entities.items():\n            if state.active:\n                entity_updates.append((\n                    entity_id,\n                    state.x, state.y, state.z\n                ))\n\n        return create_update_array_simple(self.timestamp, entity_updates)\n</code></pre>"},{"location":"part-7-update-array/index.html#section-6-server-game-loop","title":"Section 6: Server Game Loop","text":""},{"location":"part-7-update-array/index.html#basic-game-loop-structure","title":"Basic Game Loop Structure","text":"<pre><code>import time\nimport threading\n\nclass Wulfram2Server:\n    def __init__(self):\n        self.game_state = GameState()\n        self.clients = []\n        self.running = False\n        self.tick_rate = 20  # Updates per second\n\n    def start_game_loop(self):\n        \"\"\"Start the game update loop.\"\"\"\n        self.running = True\n\n        tick_time = 1.0 / self.tick_rate\n\n        while self.running:\n            start = time.time()\n\n            # Update game state\n            self.update_game_state()\n\n            # Send updates to all clients\n            update_packet = self.game_state.create_update_packet()\n            for client in self.clients:\n                if client.in_game:\n                    client.send(update_packet)\n\n            # Sleep to maintain tick rate\n            elapsed = time.time() - start\n            if elapsed &lt; tick_time:\n                time.sleep(tick_time - elapsed)\n\n    def update_game_state(self):\n        \"\"\"Update all entity positions, handle physics, etc.\"\"\"\n        for entity_id, entity in self.game_state.entities.items():\n            # Apply velocity\n            entity.x += entity.vx * (1.0 / self.tick_rate)\n            entity.y += entity.vy * (1.0 / self.tick_rate)\n            entity.z += entity.vz * (1.0 / self.tick_rate)\n\n            # Apply gravity, collisions, etc.\n            # ...\n</code></pre>"},{"location":"part-7-update-array/index.html#handling-client-input","title":"Handling Client Input","text":"<p>When clients send ACTION_UPDATE (0x0A), process their inputs:</p> <pre><code>def handle_action_update(self, client, payload):\n    \"\"\"Handle player input from client.\"\"\"\n    # Parse the action data\n    # ... parse bit-stream similar to UPDATE_ARRAY\n\n    # Apply to player's entity\n    entity = self.game_state.entities.get(client.entity_id)\n    if entity:\n        entity.target_velocity = parsed_velocity\n        entity.weapon_state = parsed_weapon\n        # etc.\n</code></pre>"},{"location":"part-7-update-array/index.html#section-7-packet-timing","title":"Section 7: Packet Timing","text":""},{"location":"part-7-update-array/index.html#update-frequency","title":"Update Frequency","text":"<p>The server should send UPDATE_ARRAY at a consistent rate:</p> Tick Rate Interval Use Case 10 Hz 100ms Low bandwidth, slow-paced 20 Hz 50ms Standard gameplay 30 Hz 33ms Fast-paced action 60 Hz 16ms High precision (LAN)"},{"location":"part-7-update-array/index.html#bandwidth-optimization","title":"Bandwidth Optimization","text":"<p>Use presence flags efficiently:</p> <pre><code>def calculate_presence_flags(old_state, new_state):\n    \"\"\"Only set flags for changed fields.\"\"\"\n    flags = 0\n\n    if abs(new_state.x - old_state.x) &gt; 0.01:\n        flags |= 0x002  # X changed\n    if abs(new_state.y - old_state.y) &gt; 0.01:\n        flags |= 0x004  # Y changed\n    if abs(new_state.z - old_state.z) &gt; 0.01:\n        flags |= 0x008  # Z changed\n\n    if new_state.health != old_state.health:\n        flags |= 0x080  # Health changed\n\n    # ... other fields\n\n    return flags\n</code></pre>"},{"location":"part-7-update-array/index.html#section-8-complete-example","title":"Section 8: Complete Example","text":""},{"location":"part-7-update-array/index.html#minimal-gameplay-server","title":"Minimal Gameplay Server","text":"<pre><code>import struct\nimport socket\nimport threading\nimport time\n\nclass MinimalGameServer:\n    \"\"\"\n    Minimal server that gets a client into gameplay with UPDATE_ARRAY.\n    \"\"\"\n\n    def __init__(self):\n        self.entities = {\n            1: {'x': 100.0, 'y': 0.0, 'z': 100.0},  # Player entity\n            2: {'x': 200.0, 'y': 0.0, 'z': 200.0},  # Another entity\n        }\n        self.timestamp = 0\n\n    def create_update_array(self):\n        \"\"\"Create a simple UPDATE_ARRAY packet.\"\"\"\n        self.timestamp += 1\n\n        # Simple fixed-width implementation for testing\n        payload = bytearray()\n\n        # Timestamp (4 bytes)\n        payload.extend(struct.pack('&gt;I', self.timestamp))\n\n        # Entity count (1 byte for simplicity)\n        payload.append(len(self.entities))\n\n        # For each entity, send a minimal update\n        for entity_id, state in self.entities.items():\n            # Entity ID (4 bytes)\n            payload.extend(struct.pack('&gt;I', entity_id))\n\n            # Simplified presence flags (2 bytes) - position only\n            payload.extend(struct.pack('&gt;H', 0x000E))\n\n            # Position as fixed-point (4 bytes each)\n            payload.extend(struct.pack('&gt;i', int(state['x'] * 65536)))\n            payload.extend(struct.pack('&gt;i', int(state['y'] * 65536)))\n            payload.extend(struct.pack('&gt;i', int(state['z'] * 65536)))\n\n        return bytes([0x0E]) + struct.pack('&gt;H', len(payload)) + payload\n\n    def game_loop(self, conn):\n        \"\"\"Send updates at 10 Hz.\"\"\"\n        while True:\n            # Update entity positions (simple circular motion for testing)\n            import math\n            t = self.timestamp * 0.1\n            self.entities[2]['x'] = 200.0 + math.cos(t) * 50\n            self.entities[2]['z'] = 200.0 + math.sin(t) * 50\n\n            # Send update\n            update = self.create_update_array()\n            try:\n                conn.send(update)\n            except:\n                break\n\n            time.sleep(0.1)  # 10 Hz\n</code></pre>"},{"location":"part-7-update-array/index.html#troubleshooting","title":"Troubleshooting","text":""},{"location":"part-7-update-array/index.html#problem-client-shows-wrong-positions","title":"Problem: Client Shows Wrong Positions","text":"<p>Cause: Bit widths don't match BEHAVIOR configuration.</p> <p>Solution: Use the exact bit widths configured in your BEHAVIOR packet: <pre><code># Store these from your BEHAVIOR packet\nentity_type_bits = DAT_00678134[0x00]\nteam_bits = DAT_00678134[0x20]\n# ... etc\n</code></pre></p>"},{"location":"part-7-update-array/index.html#problem-client-crashes-during-update_array","title":"Problem: Client Crashes During UPDATE_ARRAY","text":"<p>Cause: Malformed bit-stream or wrong entity count.</p> <p>Solution:  - Verify entity count matches actual entities sent - Ensure all presence flag bits have corresponding data - Check bit alignment at packet end</p>"},{"location":"part-7-update-array/index.html#problem-entities-dont-move","title":"Problem: Entities Don't Move","text":"<p>Cause: UPDATE_ARRAY not being sent, or wrong entity IDs.</p> <p>Solution: - Verify server is calling game loop - Check entity IDs match those assigned via PLAYER packet - Confirm presence flags include position bits (0x00E)</p>"},{"location":"part-7-update-array/index.html#problem-client-disconnects-after-first-update","title":"Problem: Client Disconnects After First UPDATE","text":"<p>Cause: Server not handling client packets (WANT_UPDATES, ACTION_UPDATE).</p> <p>Solution: Implement handlers for all client packet types during gameplay.</p>"},{"location":"part-7-update-array/index.html#common-mistakes","title":"Common Mistakes","text":"Mistake Symptom Fix Wrong bit widths Garbled positions Match BEHAVIOR config exactly Missing entities Player invisible Include player entity in updates No game loop Frozen game Start update thread after WANT_UPDATES Bad timestamp Time desync Increment timestamp each update Missing BIRTH_NOTICE Entities don't appear Send BIRTH_NOTICE for new entities"},{"location":"part-7-update-array/index.html#verification-checklist","title":"Verification Checklist","text":"<p>Before considering gameplay working:</p> <ul> <li>[ ] Server handles WANT_UPDATES from client</li> <li>[ ] Server starts game loop after WANT_UPDATES</li> <li>[ ] UPDATE_ARRAY sent at consistent rate</li> <li>[ ] Player's entity included in updates</li> <li>[ ] Entity positions update over time</li> <li>[ ] Client can see themselves in game world</li> <li>[ ] BIRTH_NOTICE sent for new entities</li> <li>[ ] DELETE_OBJECT sent when entities removed</li> </ul>"},{"location":"part-7-update-array/index.html#quick-reference-gameplay-packets","title":"Quick Reference: Gameplay Packets","text":"Packet Type Direction Purpose UPDATE_ARRAY 0x0E S\u2192C Entity state updates TRANSIENT_ARRAY 0x0D S\u2192C Projectiles/effects BIRTH_NOTICE 0x1E S\u2192C Entity spawned DELETE_OBJECT 0x15 S\u2192C Entity removed ACTION_UPDATE 0x0A C\u2192S Player input WANT_UPDATES 0x39 C\u2192S Request updates (auto)"},{"location":"part-7-update-array/index.html#implementation-priority","title":"Implementation Priority","text":"<p>For a minimal working game:</p> <ol> <li>UPDATE_ARRAY (0x0E) - REQUIRED - Send entity positions</li> <li>Handle WANT_UPDATES (0x39) - Trigger game loop start</li> <li>BIRTH_NOTICE (0x1E) - Required for new entity visibility</li> <li>DELETE_OBJECT (0x15) - Required for entity cleanup</li> </ol> <p>Optional but recommended: - TRANSIENT_ARRAY (0x0D) - For projectiles - ACTION_UPDATE handling (0x0A) - For player control</p>"},{"location":"part-7-update-array/index.html#whats-next","title":"What's Next?","text":"<p>Previous: Part 6: REINCARNATE &amp; Game Entry </p>"},{"location":"part-8-structures/index.html","title":"Structures","text":"<p>This section contains packet structure definitions.</p>"},{"location":"part-8-structures/index.html#contents","title":"Contents","text":"<ul> <li>Part 8.1 - ADD_TO_ROSTER</li> <li>Part 8.2 - BIRTH_NOTICE</li> <li>UPDATE_STATS</li> </ul> <p>Next: Part 9: UDP Protocol</p>"},{"location":"part-8-structures/add-to-roster.html","title":"Wulfram 2 Server Implementation Guide","text":""},{"location":"part-8-structures/add-to-roster.html#add_to_roster-packet-0x1a-complete-structure-reference","title":"ADD_TO_ROSTER Packet (0x1A) - Complete Structure Reference","text":""},{"location":"part-8-structures/add-to-roster.html#overview","title":"Overview","text":"<p>The ADD_TO_ROSTER packet (0x1A) adds a player to the team roster display. This packet is sent by the server to inform the client about players joining the game, including their stats, team assignment, and associated entity.</p> <pre><code>Position in Connection Flow:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  PHASE 3: GAME ENTRY                                                    \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                                    \u2502\n\u2502  Client \u2500\u2500\u25ba REINCARNATE (0x25)               Player chooses team        \u2502\n\u2502  Server \u2500\u2500\u25ba REINCARNATE (0x25)               Server confirms            \u2502\n\u2502  Server \u2500\u2500\u25ba PLAYER (0x17)                    \u2605 Assigns player entity    \u2502\n\u2502  Server \u2500\u2500\u25ba GAME_CLOCK (0x2F)                Time synchronization       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Server \u2500\u2500\u25ba ADD_TO_ROSTER (0x1A)             \u25c4 YOU ARE HERE             \u2502\n\u2502             Adds player to team roster display                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Server \u2500\u2500\u25ba WORLD_STATS (0x16)               Map info                   \u2502\n\u2502  Client \u2500\u2500\u25ba WANT_UPDATES (0x39)              Auto-sent by client        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-8-structures/add-to-roster.html#packet-registration","title":"Packet Registration","text":"<p>From the client initialization code:</p> <pre><code>// From line 77042\nFUN_00509b40(0x1a, FUN_0046d5d0);    // Register type 0x1A \u2192 ADD_TO_ROSTER handler\n</code></pre> <p>The packet name is registered for debugging:</p> <pre><code>// From line 94145\nFUN_0044a020(\"ADD_TO_ROSTER\", 0x1a);\n</code></pre>"},{"location":"part-8-structures/add-to-roster.html#the-handler-code","title":"The Handler Code","text":"<p>From FUN_0046d5d0 (lines 77724-77760):</p> <pre><code>void FUN_0046d5d0(undefined4 param_1, undefined4 param_2, undefined4 param_3) {\n    undefined2 local_30 [2];      // Deaths\n    undefined2 local_2c [2];      // Kills\n    undefined2 local_28 [2];      // Unknown flag\n    undefined2 local_24 [2];      // Team ID\n    void *local_20 [2];           // Player name pointer\n    undefined4 local_18;          // Clan name pointer\n    undefined4 local_14;          // Unknown uint32\n    undefined4 local_10;          // Entity ID\n    undefined4 local_c;           // Player ID\n    undefined8 local_8;           // Score (fixed-point)\n\n    FUN_004e5080();                          // Initialize context\n    local_20[0] = (void *)0x0;\n    local_18 = 0;\n    FUN_004e5090(param_3);                   // Set context pointer\n    FUN_00509db0();                          // Set packet name for errors\n\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    // READ PACKET DATA\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    FUN_00509310(&amp;local_c);                  // 4 bytes: Player ID (uint32 BE)\n    FUN_00509310(&amp;local_10);                 // 4 bytes: Entity ID (uint32 BE)\n    FUN_005092f0(local_24);                  // 2 bytes: Team ID (uint16 BE)\n    FUN_005092f0(local_28);                  // 2 bytes: Unknown flag (uint16 BE)\n    FUN_00509340(local_20);                  // String:  Player Name (length-prefixed)\n    FUN_00509340(&amp;local_18);                 // String:  Clan Name (length-prefixed)\n    FUN_005092f0(local_2c);                  // 2 bytes: Kills (uint16 BE)\n    FUN_005092f0(local_30);                  // 2 bytes: Deaths (uint16 BE)\n    FUN_004e51d0(&amp;local_8);                  // 4 bytes: Score (fixed-point)\n    FUN_00509310(&amp;local_14);                 // 4 bytes: Unknown (uint32 BE)\n    FUN_00509dc0();                          // Byte alignment\n\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    // PROCESS ROSTER ENTRY\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    FUN_00475b90(local_c, local_10, local_24[0], local_28[0], local_18, \n                 local_2c[0], local_30[0], local_8, local_14);\n\n    // Free player name string if allocated\n    if (local_20[0] != (void *)0x0) {\n        _free(local_20[0]);\n    }\n    return;\n}\n</code></pre>"},{"location":"part-8-structures/add-to-roster.html#understanding-the-reader-functions","title":"Understanding the Reader Functions","text":"Function Bits Read Wire Bytes Description <code>FUN_00509310</code> 32 bits 4 bytes Reads uint32 (big-endian) <code>FUN_005092f0</code> 16 bits 2 bytes Reads uint16 (big-endian) <code>FUN_00509340</code> variable 2 + N bytes Reads length-prefixed string <code>FUN_004e51d0</code> 32 bits 4 bytes Reads fixed-point \u2192 double <code>FUN_00509dc0</code> 0-7 bits 0 bytes Byte alignment"},{"location":"part-8-structures/add-to-roster.html#wire-format","title":"Wire Format","text":"<pre><code>ADD_TO_ROSTER Packet Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TYPE    \u2502   LENGTH     \u2502   PAYLOAD                                       \u2502\n\u2502  0x1A    \u2502  (2 bytes)   \u2502   (variable size)                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n   1 byte     2 bytes BE         N bytes\n</code></pre>"},{"location":"part-8-structures/add-to-roster.html#payload-structure","title":"Payload Structure","text":"<pre><code>ADD_TO_ROSTER Payload Layout:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset  \u2502 Size \u2502 Type           \u2502 Description                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0       \u2502 4    \u2502 uint32 BE      \u2502 Player ID                                 \u2502\n\u2502 4       \u2502 4    \u2502 uint32 BE      \u2502 Entity ID                                 \u2502\n\u2502 8       \u2502 2    \u2502 uint16 BE      \u2502 Team ID                                   \u2502\n\u2502 10      \u2502 2    \u2502 uint16 BE      \u2502 Unknown Flag                              \u2502\n\u2502 12      \u2502 var  \u2502 string         \u2502 Player Name (length-prefixed)             \u2502\n\u2502 var     \u2502 var  \u2502 string         \u2502 Clan Name (length-prefixed)               \u2502\n\u2502 var     \u2502 2    \u2502 uint16 BE      \u2502 Kills                                     \u2502\n\u2502 var+2   \u2502 2    \u2502 uint16 BE      \u2502 Deaths                                    \u2502\n\u2502 var+4   \u2502 4    \u2502 fixed-point    \u2502 Score                                     \u2502\n\u2502 var+8   \u2502 4    \u2502 uint32 BE      \u2502 Unknown (ping/status?)                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-8-structures/add-to-roster.html#field-details","title":"Field Details","text":""},{"location":"part-8-structures/add-to-roster.html#field-1-player-id-4-bytes","title":"Field 1: Player ID (4 bytes)","text":"<pre><code>Offset: 0\nSize:   4 bytes\nType:   uint32 big-endian\nReader: FUN_00509310\n\nDescription:\n  Unique identifier for the player within the game session.\n  This is NOT the entity ID - it's a separate player identifier.\n\nExample:\n  Player ID = 1\n  Wire bytes: 00 00 00 01\n</code></pre>"},{"location":"part-8-structures/add-to-roster.html#field-2-entity-id-4-bytes","title":"Field 2: Entity ID (4 bytes)","text":"<pre><code>Offset: 4\nSize:   4 bytes\nType:   uint32 big-endian\nReader: FUN_00509310\n\nDescription:\n  The entity ID of the player's vehicle/unit in the game world.\n\n  \u2605 CRITICAL: This MUST match the entity_id sent in the PLAYER packet! \u2605\n\n  If these don't match, the client won't properly associate the \n  player with their entity in the roster display.\n\nExample:\n  Entity ID = 12345 (0x3039)\n  Wire bytes: 00 00 30 39\n</code></pre>"},{"location":"part-8-structures/add-to-roster.html#field-3-team-id-2-bytes","title":"Field 3: Team ID (2 bytes)","text":"<pre><code>Offset: 8\nSize:   2 bytes\nType:   uint16 big-endian\nReader: FUN_005092f0\n\nDescription:\n  The team the player belongs to.\n\n  Values:\n    1 = Team 1 (typically Red)\n    2 = Team 2 (typically Blue)\n\n  \u2605 IMPORTANT: This MUST match the team the player selected via REINCARNATE! \u2605\n\nExample:\n  Team 1 (Red)\n  Wire bytes: 00 01\n</code></pre>"},{"location":"part-8-structures/add-to-roster.html#field-4-unknown-flag-2-bytes","title":"Field 4: Unknown Flag (2 bytes)","text":"<pre><code>Offset: 10\nSize:   2 bytes\nType:   uint16 big-endian\nReader: FUN_005092f0\n\nDescription:\n  Purpose not fully determined. Possibly:\n  - Player status flags\n  - Connection type\n  - Permissions/role\n\n  Safe default: 0\n\nExample:\n  Flag = 0\n  Wire bytes: 00 00\n</code></pre>"},{"location":"part-8-structures/add-to-roster.html#field-5-player-name-variable","title":"Field 5: Player Name (variable)","text":"<pre><code>Offset: 12\nSize:   2 + length + 1 bytes (length-prefixed string)\nType:   Length-prefixed, null-terminated string\nReader: FUN_00509340\n\nDescription:\n  The player's display name shown in the roster.\n\n  Format:\n    [length:2 bytes BE][string data][null terminator]\n\n  The length field INCLUDES the null terminator!\n\nExample:\n  Player Name = \"Baffler\"\n  Length = 8 (7 characters + 1 null)\n  Wire bytes: 00 08 42 61 66 66 6C 65 72 00\n              \u2500\u2500\u2500\u2500\u2500 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n                \u2502              \u2502\n                \u2502              \u2514\u2500 \"Baffler\\0\"\n                \u2514\u2500 Length: 8\n</code></pre>"},{"location":"part-8-structures/add-to-roster.html#field-6-clan-name-variable","title":"Field 6: Clan Name (variable)","text":"<pre><code>Offset: varies (after player name)\nSize:   2 + length + 1 bytes (length-prefixed string)\nType:   Length-prefixed, null-terminated string\nReader: FUN_00509340\n\nDescription:\n  The player's clan/guild tag. Can be empty.\n\n  For empty string, send:\n    [00 01][00]  = Length 1 + just the null terminator\n\nExample (with clan):\n  Clan Name = \"PRO\"\n  Wire bytes: 00 04 50 52 4F 00\n\nExample (no clan):\n  Clan Name = \"\"\n  Wire bytes: 00 01 00\n</code></pre>"},{"location":"part-8-structures/add-to-roster.html#field-7-kills-2-bytes","title":"Field 7: Kills (2 bytes)","text":"<pre><code>Offset: varies (after clan name)\nSize:   2 bytes\nType:   uint16 big-endian\nReader: FUN_005092f0\n\nDescription:\n  Player's kill count for the current session.\n\nExample:\n  Kills = 5\n  Wire bytes: 00 05\n</code></pre>"},{"location":"part-8-structures/add-to-roster.html#field-8-deaths-2-bytes","title":"Field 8: Deaths (2 bytes)","text":"<pre><code>Offset: varies (after kills)\nSize:   2 bytes\nType:   uint16 big-endian\nReader: FUN_005092f0\n\nDescription:\n  Player's death count for the current session.\n\nExample:\n  Deaths = 2\n  Wire bytes: 00 02\n</code></pre>"},{"location":"part-8-structures/add-to-roster.html#field-9-score-4-bytes","title":"Field 9: Score (4 bytes)","text":"<pre><code>Offset: varies (after deaths)\nSize:   4 bytes\nType:   Fixed-point (value \u00d7 65536)\nReader: FUN_004e51d0\n\nDescription:\n  Player's score as a fixed-point number.\n\n  Encoding: wire_value = int(score \u00d7 65536)\n\nExample:\n  Score = 150.5\n  Wire value = 150.5 \u00d7 65536 = 9,863,168 = 0x968000\n  Wire bytes: 00 96 80 00\n\nExample (zero score):\n  Score = 0.0\n  Wire bytes: 00 00 00 00\n</code></pre>"},{"location":"part-8-structures/add-to-roster.html#field-10-unknown-field-4-bytes","title":"Field 10: Unknown Field (4 bytes)","text":"<pre><code>Offset: varies (after score)\nSize:   4 bytes\nType:   uint32 big-endian\nReader: FUN_00509310\n\nDescription:\n  Purpose not fully determined. Possibly:\n  - Ping/latency\n  - Player status\n  - Join timestamp\n\n  Safe default: 0\n\nExample:\n  Wire bytes: 00 00 00 00\n</code></pre>"},{"location":"part-8-structures/add-to-roster.html#data-flow-diagram","title":"Data Flow Diagram","text":"<pre><code>ADD_TO_ROSTER Reading Order:\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  FIXED FIELDS (12 bytes)                                               \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                              \u2502\n\u2502  [Player ID:4][Entity ID:4][Team ID:2][Flag:2]                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                    \u2502\n                                    \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  STRING FIELDS (variable)                                              \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                              \u2502\n\u2502  [Player Name: len-prefixed string][Clan Name: len-prefixed string]   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                    \u2502\n                                    \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  STATS FIELDS (12 bytes)                                               \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                               \u2502\n\u2502  [Kills:2][Deaths:2][Score:4][Unknown:4]                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n</code></pre>"},{"location":"part-8-structures/add-to-roster.html#minimum-payload-size-calculation","title":"Minimum Payload Size Calculation","text":"<pre><code>Minimum ADD_TO_ROSTER Payload:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Player ID:      4 bytes                                                \u2502\n\u2502  Entity ID:      4 bytes                                                \u2502\n\u2502  Team ID:        2 bytes                                                \u2502\n\u2502  Unknown Flag:   2 bytes                                                \u2502\n\u2502  Player Name:    3 bytes minimum (00 01 00 = empty string)              \u2502\n\u2502  Clan Name:      3 bytes minimum (00 01 00 = empty string)              \u2502\n\u2502  Kills:          2 bytes                                                \u2502\n\u2502  Deaths:         2 bytes                                                \u2502\n\u2502  Score:          4 bytes                                                \u2502\n\u2502  Unknown:        4 bytes                                                \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500  \u2502\n\u2502  MINIMUM TOTAL:  30 bytes                                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nWith typical player name (8 chars) and no clan:\n  12 + (2+8+1) + (2+0+1) + 12 = 12 + 11 + 3 + 12 = 38 bytes\n</code></pre>"},{"location":"part-8-structures/add-to-roster.html#building-add_to_roster-in-python","title":"Building ADD_TO_ROSTER in Python","text":"<pre><code>import struct\n\ndef encode_string(text):\n    \"\"\"\n    Encode a string for Wulfram 2 protocol.\n    Format: [length:2 bytes BE][string data with null terminator]\n    \"\"\"\n    string_bytes = text.encode('utf-8') + b'\\x00'\n    return struct.pack('&gt;H', len(string_bytes)) + string_bytes\n\ndef encode_fixed_point(float_value):\n    \"\"\"Convert a float to fixed-point format (4 bytes big-endian).\"\"\"\n    wire_value = int(float_value * 65536)\n    return struct.pack('&gt;i', wire_value)\n\ndef make_packet(packet_type, payload):\n    \"\"\"Wrap payload in a complete packet frame.\"\"\"\n    return bytes([packet_type]) + struct.pack('&gt;H', len(payload)) + payload\n\ndef create_add_to_roster(player_id, entity_id, team_id, player_name,\n                         clan_name=\"\", kills=0, deaths=0, score=0.0,\n                         unknown_flag=0, unknown_field=0):\n    \"\"\"\n    Create an ADD_TO_ROSTER packet (0x1A).\n\n    Args:\n        player_id:     Unique player identifier (uint32)\n        entity_id:     Entity ID of player's vehicle (uint32)\n                       \u2605 MUST match entity_id from PLAYER packet! \u2605\n        team_id:       Team number (1 or 2)\n                       \u2605 MUST match team from REINCARNATE! \u2605\n        player_name:   Player's display name (string)\n        clan_name:     Player's clan tag (string, can be empty)\n        kills:         Kill count (uint16)\n        deaths:        Death count (uint16)\n        score:         Player score (float, sent as fixed-point)\n        unknown_flag:  Unknown field (uint16, default 0)\n        unknown_field: Unknown field (uint32, default 0)\n\n    Returns:\n        Complete ADD_TO_ROSTER packet as bytes\n    \"\"\"\n    payload = bytearray()\n\n    # Fixed fields (12 bytes)\n    payload.extend(struct.pack('&gt;I', player_id))     # 4 bytes: Player ID\n    payload.extend(struct.pack('&gt;I', entity_id))     # 4 bytes: Entity ID\n    payload.extend(struct.pack('&gt;H', team_id))       # 2 bytes: Team ID\n    payload.extend(struct.pack('&gt;H', unknown_flag))  # 2 bytes: Unknown flag\n\n    # String fields (variable)\n    payload.extend(encode_string(player_name))       # Player name\n    payload.extend(encode_string(clan_name))         # Clan name\n\n    # Stats fields (12 bytes)\n    payload.extend(struct.pack('&gt;H', kills))         # 2 bytes: Kills\n    payload.extend(struct.pack('&gt;H', deaths))        # 2 bytes: Deaths\n    payload.extend(encode_fixed_point(score))        # 4 bytes: Score\n    payload.extend(struct.pack('&gt;I', unknown_field)) # 4 bytes: Unknown\n\n    return make_packet(0x1A, bytes(payload))\n</code></pre>"},{"location":"part-8-structures/add-to-roster.html#example-usage","title":"Example Usage","text":"<pre><code># Example 1: New player joining Team 1 (Red)\nroster_packet = create_add_to_roster(\n    player_id=1,\n    entity_id=12345,      # Must match PLAYER packet!\n    team_id=1,            # Team 1 (Red)\n    player_name=\"Baffler\",\n    clan_name=\"\",         # No clan\n    kills=0,\n    deaths=0,\n    score=0.0\n)\n\n# Example 2: Player with clan and some stats\nroster_packet = create_add_to_roster(\n    player_id=2,\n    entity_id=12346,\n    team_id=2,            # Team 2 (Blue)\n    player_name=\"DrGotcha\",\n    clan_name=\"PRO\",\n    kills=5,\n    deaths=2,\n    score=150.5\n)\n</code></pre>"},{"location":"part-8-structures/add-to-roster.html#example-wire-bytes","title":"Example Wire Bytes","text":""},{"location":"part-8-structures/add-to-roster.html#example-player-baffler-joining-team-1-with-entity-12345","title":"Example: Player \"Baffler\" joining Team 1 with entity 12345","text":"<pre><code>Building the packet:\n\nFixed Fields (12 bytes):\n  Player ID:    00 00 00 01        (1)\n  Entity ID:    00 00 30 39        (12345)\n  Team ID:      00 01              (1 = Red)\n  Unknown Flag: 00 00              (0)\n\nString Fields:\n  Player Name:  00 08 42 61 66 66 6C 65 72 00    (len=8, \"Baffler\\0\")\n  Clan Name:    00 01 00                          (len=1, empty string)\n\nStats Fields (12 bytes):\n  Kills:        00 00              (0)\n  Deaths:       00 00              (0)\n  Score:        00 00 00 00        (0.0)\n  Unknown:      00 00 00 00        (0)\n\nPayload (38 bytes):\n00 00 00 01 00 00 30 39 00 01 00 00 00 08 42 61\n66 66 6C 65 72 00 00 01 00 00 00 00 00 00 00 00\n00 00 00 00\n\nComplete Packet (41 bytes):\n1A 00 26 00 00 00 01 00 00 30 39 00 01 00 00 00\n08 42 61 66 66 6C 65 72 00 00 01 00 00 00 00 00\n00 00 00 00 00 00\n\nBreakdown:\n  1A          Type: ADD_TO_ROSTER\n  00 26       Length: 38 bytes (0x0026)\n  00 00 00 01 Player ID: 1\n  00 00 30 39 Entity ID: 12345\n  00 01       Team ID: 1\n  00 00       Unknown flag: 0\n  00 08       Player name length: 8\n  42 61 66 66 6C 65 72 00   \"Baffler\\0\"\n  00 01       Clan name length: 1\n  00          \"\" (empty string, just null)\n  00 00       Kills: 0\n  00 00       Deaths: 0\n  00 00 00 00 Score: 0.0\n  00 00 00 00 Unknown: 0\n</code></pre>"},{"location":"part-8-structures/add-to-roster.html#critical-requirements","title":"Critical Requirements","text":""},{"location":"part-8-structures/add-to-roster.html#1-entity-id-must-match-player-packet","title":"1. Entity ID Must Match PLAYER Packet","text":"<pre><code>When you send:\n  PLAYER (0x17):        entity_id = 12345\n  ADD_TO_ROSTER (0x1A): entity_id = 12345  \u2190 MUST BE THE SAME!\n\nIf these don't match, the roster display won't properly link the\nplayer entry to their in-game entity.\n</code></pre>"},{"location":"part-8-structures/add-to-roster.html#2-team-id-must-match-reincarnate-selection","title":"2. Team ID Must Match REINCARNATE Selection","text":"<pre><code>When player selects Team 1 via REINCARNATE:\n  REINCARNATE response: confirms Team 1\n  ADD_TO_ROSTER:        team_id = 1  \u2190 MUST MATCH!\n\nIf the team ID is wrong, the player appears on the wrong team's roster.\n</code></pre>"},{"location":"part-8-structures/add-to-roster.html#3-broadcast-to-all-clients","title":"3. Broadcast to All Clients","text":"<pre><code>When a new player joins, you should send ADD_TO_ROSTER to:\n  - The joining player (so they see themselves)\n  - All other connected players (so they see the new player)\n\nWhen a player first connects, send them ADD_TO_ROSTER for all\nexisting players so their roster is populated.\n</code></pre>"},{"location":"part-8-structures/add-to-roster.html#related-packet-remove_from_roster-0x1b","title":"Related Packet: REMOVE_FROM_ROSTER (0x1B)","text":"<p>When a player disconnects or leaves, send REMOVE_FROM_ROSTER:</p> <pre><code>// Handler registered at line 77043\nFUN_00509b40(0x1b, &amp;LAB_0046d6f0);\n</code></pre> <p>The structure is simpler (just player/entity identification), but the full analysis of REMOVE_FROM_ROSTER is not covered in this document.</p>"},{"location":"part-8-structures/add-to-roster.html#common-mistakes","title":"Common Mistakes","text":"Mistake Symptom Fix Entity ID doesn't match PLAYER packet Player not linked to entity Use same entity_id in both packets Team ID doesn't match REINCARNATE Player on wrong team in roster Use team from selection Forgot length prefix on strings Client crash/parse error Use <code>encode_string()</code> Little-endian encoding Garbled values Use big-endian (<code>&gt;I</code>, <code>&gt;H</code>) Missing null terminator String parsing issues Include <code>\\x00</code> in string Score as raw float Wrong score display Use fixed-point encoding Only sent to joining player Others don't see new player Broadcast to all clients"},{"location":"part-8-structures/add-to-roster.html#verification-checklist","title":"Verification Checklist","text":"<p>Before sending ADD_TO_ROSTER, verify:</p> <ul> <li>[ ] Player ID is set (can be any unique value)</li> <li>[ ] Entity ID matches the PLAYER packet entity_id</li> <li>[ ] Team ID matches the team selected via REINCARNATE</li> <li>[ ] Player name is length-prefixed with null terminator</li> <li>[ ] Clan name is length-prefixed (can be empty: <code>00 01 00</code>)</li> <li>[ ] Score uses fixed-point encoding (\u00d7 65536)</li> <li>[ ] All multi-byte values are big-endian</li> <li>[ ] Packet is broadcast to all connected clients</li> </ul>"},{"location":"part-8-structures/add-to-roster.html#packet-summary","title":"Packet Summary","text":"Property Value Packet Type 0x1A Packet Name ADD_TO_ROSTER Handler Function FUN_0046d5d0 Direction Server \u2192 Client Minimum Payload Size 30 bytes Variable Fields Player Name, Clan Name Related Packets PLAYER (0x17), REINCARNATE (0x25), REMOVE_FROM_ROSTER (0x1B)"},{"location":"part-8-structures/add-to-roster.html#quick-reference-field-offsets","title":"Quick Reference: Field Offsets","text":"<pre><code>ADD_TO_ROSTER Quick Reference:\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nOffset  Size  Type          Field\n\u2500\u2500\u2500\u2500\u2500\u2500  \u2500\u2500\u2500\u2500  \u2500\u2500\u2500\u2500          \u2500\u2500\u2500\u2500\u2500\n0       4     uint32 BE     Player ID\n4       4     uint32 BE     Entity ID        \u2605 Must match PLAYER packet!\n8       2     uint16 BE     Team ID          \u2605 Must match REINCARNATE!\n10      2     uint16 BE     Unknown Flag     (use 0)\n12      var   string        Player Name      (length-prefixed)\nvar     var   string        Clan Name        (length-prefixed)\nvar     2     uint16 BE     Kills\nvar+2   2     uint16 BE     Deaths\nvar+4   4     fixed-point   Score\nvar+8   4     uint32 BE     Unknown          (use 0)\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n</code></pre> <p>Related: Part 6: REINCARNATE &amp; Game Entry</p>"},{"location":"part-8-structures/birth-notice.html","title":"Wulfram 2 Server Implementation Guide","text":""},{"location":"part-8-structures/birth-notice.html#birth_notice-packet-0x1e-complete-structure-reference","title":"BIRTH_NOTICE Packet (0x1E) - Complete Structure Reference","text":""},{"location":"part-8-structures/birth-notice.html#overview","title":"Overview","text":"<p>The BIRTH_NOTICE packet (0x1E) notifies the client that an entity has \"spawned\" or become active in the game world. When received, the client marks the entity as \"born\" and associates it with an owner (the player controlling it).</p> <p>This is a simple but important packet that activates entities after they've been created.</p> <pre><code>Purpose:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  BIRTH_NOTICE tells the client:                                         \u2502\n\u2502                                                                         \u2502\n\u2502  \"Entity X is now active and controlled by Entity Y\"                    \u2502\n\u2502                                                                         \u2502\n\u2502  \u2022 Sets the entity's \"born\" flag to TRUE                                \u2502\n\u2502  \u2022 Links the entity to its owner/controller                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-8-structures/birth-notice.html#position-in-connection-flow","title":"Position in Connection Flow","text":"<pre><code>Position in Connection Flow:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  PHASE 3: GAME ENTRY                                                    \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                                                    \u2502\n\u2502  Client \u2500\u2500\u25ba REINCARNATE (0x25)               Player chooses team        \u2502\n\u2502  Server \u2500\u2500\u25ba REINCARNATE (0x25)               Server confirms            \u2502\n\u2502  Server \u2500\u2500\u25ba PLAYER (0x17)                    Assigns player entity      \u2502\n\u2502  Server \u2500\u2500\u25ba GAME_CLOCK (0x2F)                Time synchronization       \u2502\n\u2502  Server \u2500\u2500\u25ba ADD_TO_ROSTER (0x1A)             Adds to team roster        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Server \u2500\u2500\u25ba BIRTH_NOTICE (0x1E)              \u25c4 YOU ARE HERE             \u2502\n\u2502             Activates the player's vehicle entity                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Server \u2500\u2500\u25ba WORLD_STATS (0x16)               Map info                   \u2502\n\u2502  Client \u2500\u2500\u25ba WANT_UPDATES (0x39)              Auto-sent by client        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-8-structures/birth-notice.html#packet-registration","title":"Packet Registration","text":"<p>From the client initialization code:</p> <pre><code>// From line 77046\nFUN_00509b40(0x1e, FUN_0046d880);    // Register type 0x1E \u2192 BIRTH_NOTICE handler\n</code></pre> <p>The packet name is registered for debugging:</p> <pre><code>// From line 94149\nFUN_0044a020(\"BIRTH_NOTICE\", 0x1e);\n</code></pre>"},{"location":"part-8-structures/birth-notice.html#the-handler-code","title":"The Handler Code","text":"<p>From FUN_0046d880 (lines 77796-77820):</p> <pre><code>void FUN_0046d880(undefined4 param_1, undefined4 param_2, undefined4 param_3)\n{\n    int iVar1;\n    int *piVar2;\n    undefined4 local_8;           // Owner Entity ID\n    int local_4;                  // Entity ID\n\n    FUN_00509db0(\"BIRTH_NOTICE\", param_3);    // Set packet name for errors\n\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    // READ PACKET DATA\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    FUN_00509310(&amp;local_4);       // 4 bytes: Entity ID (uint32 BE)\n    FUN_00509310(&amp;local_8);       // 4 bytes: Owner Entity ID (uint32 BE)\n    FUN_00509dc0(param_3, param_2);           // Byte alignment\n\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    // FIND ENTITY AND UPDATE FLAGS\n    // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n    piVar2 = *(int **)(DAT_00678390 + 8);     // Get entity list head\n\n    if (piVar2 != (int *)0x0) {\n        // Search for entity with matching ID\n        while (iVar1 = piVar2[2], *(int *)(iVar1 + 0xc) != local_4) {\n            piVar2 = (int *)*piVar2;          // Move to next entity\n            if (piVar2 == (int *)0x0) {\n                return;                        // Entity not found\n            }\n        }\n\n        // Entity found - update its state\n        *(undefined4 *)(iVar1 + 0x3c) = 1;    // Set \"born\" flag = TRUE\n        *(undefined4 *)(iVar1 + 0x40) = local_8;  // Set owner entity ID\n    }\n    return;\n}\n</code></pre>"},{"location":"part-8-structures/birth-notice.html#what-the-handler-does","title":"What The Handler Does","text":"<p>The handler performs these steps:</p> <ol> <li>Read Entity ID (4 bytes) - The entity being \"born\"</li> <li>Read Owner Entity ID (4 bytes) - The entity that controls/owns it</li> <li>Search Entity List - Find the entity with matching ID</li> <li>Set Born Flag - Mark entity as active (<code>entity + 0x3c = 1</code>)</li> <li>Set Owner - Link to controlling entity (<code>entity + 0x40 = owner_id</code>)</li> </ol> <pre><code>Entity Structure (relevant offsets):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset  \u2502 Description                                                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0x0C    \u2502 Entity ID (used to find entity in list)                      \u2502\n\u2502 0x3C    \u2502 Born/Active Flag (0 = not born, 1 = born/active)             \u2502\n\u2502 0x40    \u2502 Owner Entity ID (who controls this entity)                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-8-structures/birth-notice.html#wire-format","title":"Wire Format","text":"<pre><code>BIRTH_NOTICE Packet Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TYPE    \u2502   LENGTH     \u2502   PAYLOAD                                       \u2502\n\u2502  0x1E    \u2502  0x00 0x08   \u2502   (8 bytes)                                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n   1 byte     2 bytes BE         8 bytes\n</code></pre>"},{"location":"part-8-structures/birth-notice.html#payload-structure","title":"Payload Structure","text":"<pre><code>BIRTH_NOTICE Payload Layout:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset  \u2502 Size \u2502 Type           \u2502 Description                               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0       \u2502 4    \u2502 uint32 BE      \u2502 Entity ID                                 \u2502\n\u2502 4       \u2502 4    \u2502 uint32 BE      \u2502 Owner Entity ID                           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nTotal Payload Size: 8 bytes (fixed)\n</code></pre>"},{"location":"part-8-structures/birth-notice.html#field-details","title":"Field Details","text":""},{"location":"part-8-structures/birth-notice.html#field-1-entity-id-4-bytes","title":"Field 1: Entity ID (4 bytes)","text":"<pre><code>Offset: 0\nSize:   4 bytes\nType:   uint32 big-endian\nReader: FUN_00509310\n\nDescription:\n  The ID of the entity that is being \"born\" or activated.\n\n  This is typically the player's vehicle (Tank, Scout, etc.) that was\n  assigned via the PLAYER packet.\n\n  \u2605 IMPORTANT: This entity must already exist in the client's entity list! \u2605\n\n  The BIRTH_NOTICE doesn't create the entity - it activates an existing one.\n  The entity should have been created via UPDATE_ARRAY or similar packets.\n\nExample:\n  Entity ID = 12345 (0x3039)\n  Wire bytes: 00 00 30 39\n</code></pre>"},{"location":"part-8-structures/birth-notice.html#field-2-owner-entity-id-4-bytes","title":"Field 2: Owner Entity ID (4 bytes)","text":"<pre><code>Offset: 4\nSize:   4 bytes\nType:   uint32 big-endian\nReader: FUN_00509310\n\nDescription:\n  The ID of the entity that \"owns\" or controls this entity.\n\n  For a player's vehicle:\n  - Owner Entity ID = same as Entity ID (player controls themselves)\n\n  For projectiles, drones, or spawned objects:\n  - Owner Entity ID = the player entity that created/fired it\n\n  This creates a parent-child relationship:\n  - Projectile \u2192 owned by \u2192 Player who fired it\n  - Drone \u2192 owned by \u2192 Player who deployed it\n\nExample (player vehicle - self-owned):\n  Entity ID = 12345\n  Owner Entity ID = 12345  (same - player owns their own vehicle)\n  Wire bytes: 00 00 30 39\n\nExample (projectile owned by player):\n  Entity ID = 50000 (the projectile)\n  Owner Entity ID = 12345 (the player who fired it)\n  Wire bytes: 00 00 30 39\n</code></pre>"},{"location":"part-8-structures/birth-notice.html#data-flow-diagram","title":"Data Flow Diagram","text":"<pre><code>BIRTH_NOTICE Reading Order:\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nPacket:   1E 00 08 XX XX XX XX YY YY YY YY\n          \u2502  \u2514\u2500\u2500\u252c\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\n          \u2502     \u2502         \u2502           \u2502\n          \u2502     \u2502         \u2502           \u2514\u2500 Owner Entity ID (4 bytes)\n          \u2502     \u2502         \u2502\n          \u2502     \u2502         \u2514\u2500 Entity ID (4 bytes)\n          \u2502     \u2502\n          \u2502     \u2514\u2500 Payload Length: 8 bytes\n          \u2502\n          \u2514\u2500 Packet Type: BIRTH_NOTICE (0x1E)\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n</code></pre>"},{"location":"part-8-structures/birth-notice.html#building-birth_notice-in-python","title":"Building BIRTH_NOTICE in Python","text":"<pre><code>import struct\n\ndef make_packet(packet_type, payload):\n    \"\"\"Wrap payload in a complete packet frame.\"\"\"\n    return bytes([packet_type]) + struct.pack('&gt;H', len(payload)) + payload\n\ndef create_birth_notice(entity_id, owner_entity_id=None):\n    \"\"\"\n    Create a BIRTH_NOTICE packet (0x1E).\n\n    Args:\n        entity_id:       The entity being \"born\" / activated (uint32)\n        owner_entity_id: The entity that owns/controls this entity (uint32)\n                         If None, defaults to entity_id (self-owned)\n\n    Returns:\n        Complete BIRTH_NOTICE packet as bytes\n\n    Usage:\n        For player vehicles: owner = entity itself (self-owned)\n        For projectiles: owner = player who fired it\n        For drones/spawns: owner = player who deployed it\n    \"\"\"\n    if owner_entity_id is None:\n        owner_entity_id = entity_id  # Self-owned (typical for player vehicles)\n\n    payload = struct.pack('&gt;I', entity_id) + struct.pack('&gt;I', owner_entity_id)\n\n    return make_packet(0x1E, payload)\n</code></pre>"},{"location":"part-8-structures/birth-notice.html#example-usage","title":"Example Usage","text":"<pre><code># Example 1: Player spawns in their vehicle (self-owned)\n# The player's entity owns itself\nbirth_packet = create_birth_notice(\n    entity_id=12345,\n    owner_entity_id=12345    # Same as entity_id - player controls themselves\n)\n# Or simply:\nbirth_packet = create_birth_notice(entity_id=12345)  # owner defaults to self\n\n# Example 2: Player fires a projectile\n# The projectile is owned by the player who fired it\nprojectile_birth = create_birth_notice(\n    entity_id=50000,         # The projectile entity\n    owner_entity_id=12345    # The player who fired it\n)\n\n# Example 3: Player deploys a drone/turret\ndrone_birth = create_birth_notice(\n    entity_id=60000,         # The drone entity\n    owner_entity_id=12345    # The player who deployed it\n)\n</code></pre>"},{"location":"part-8-structures/birth-notice.html#example-wire-bytes","title":"Example Wire Bytes","text":""},{"location":"part-8-structures/birth-notice.html#example-player-entity-12345-spawning-self-owned","title":"Example: Player entity 12345 spawning (self-owned)","text":"<pre><code>Entity ID:       12345 (0x00003039)\nOwner Entity ID: 12345 (0x00003039)\n\nPayload (8 bytes):\n  00 00 30 39    Entity ID\n  00 00 30 39    Owner Entity ID\n\nComplete Packet (11 bytes):\n  1E 00 08 00 00 30 39 00 00 30 39\n\nBreakdown:\n  1E             Type: BIRTH_NOTICE\n  00 08          Length: 8 bytes\n  00 00 30 39    Entity ID: 12345\n  00 00 30 39    Owner Entity ID: 12345 (self-owned)\n</code></pre>"},{"location":"part-8-structures/birth-notice.html#example-projectile-entity-50000-fired-by-player-entity-12345","title":"Example: Projectile (entity 50000) fired by player (entity 12345)","text":"<pre><code>Entity ID:       50000 (0x0000C350)\nOwner Entity ID: 12345 (0x00003039)\n\nComplete Packet (11 bytes):\n  1E 00 08 00 00 C3 50 00 00 30 39\n\nBreakdown:\n  1E             Type: BIRTH_NOTICE\n  00 08          Length: 8 bytes\n  00 00 C3 50    Entity ID: 50000 (projectile)\n  00 00 30 39    Owner Entity ID: 12345 (player who fired)\n</code></pre>"},{"location":"part-8-structures/birth-notice.html#when-to-send-birth_notice","title":"When to Send BIRTH_NOTICE","text":""},{"location":"part-8-structures/birth-notice.html#during-player-spawn-sequence","title":"During Player Spawn Sequence","text":"<pre><code># Complete spawn sequence after player selects team:\n\n# 1. Confirm team selection\nconn.send(create_reincarnate_response(sub_type=0x02, message=\"Welcome!\"))\n\n# 2. Assign player to their entity\nconn.send(create_player_packet(entity_id=12345))\n\n# 3. Send game clock\nconn.send(create_game_clock())\n\n# 4. Add player to roster\nconn.send(create_add_to_roster(\n    player_id=1, \n    entity_id=12345, \n    team_id=1, \n    player_name=\"Baffler\"\n))\n\n# 5. Activate the player's entity\nconn.send(create_birth_notice(entity_id=12345))  # \u25c4 BIRTH_NOTICE\n\n# 6. Send world info (triggers WANT_UPDATES)\nconn.send(create_world_stats())\n</code></pre>"},{"location":"part-8-structures/birth-notice.html#when-entities-are-created-mid-game","title":"When Entities Are Created Mid-Game","text":"<pre><code># When a player fires a weapon that creates an entity:\nprojectile_id = allocate_entity_id()\n\n# First: Create the entity via UPDATE_ARRAY (so it exists in client's list)\n# Then: Send BIRTH_NOTICE to activate it\nconn.send(create_birth_notice(\n    entity_id=projectile_id,\n    owner_entity_id=player_entity_id\n))\n</code></pre>"},{"location":"part-8-structures/birth-notice.html#relationship-to-other-packets","title":"Relationship to Other Packets","text":"<pre><code>Entity Lifecycle:\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n1. Entity Created (via UPDATE_ARRAY or initial state)\n   \u2514\u2500 Entity exists in client's entity list but is NOT active\n\n2. BIRTH_NOTICE sent\n   \u2514\u2500 Entity marked as \"born\" (active)\n   \u2514\u2500 Entity linked to owner\n   \u2514\u2500 Entity now participates in game logic\n\n3. Entity Destroyed (via DEATH_NOTICE or similar)\n   \u2514\u2500 Entity marked as inactive/dead\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nPacket Relationships:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Packet             \u2502 Relationship to BIRTH_NOTICE                         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 PLAYER (0x17)      \u2502 Assigns entity to player - BIRTH_NOTICE activates it \u2502\n\u2502 ADD_TO_ROSTER      \u2502 Adds player to team list - uses same entity ID       \u2502\n\u2502 UPDATE_ARRAY       \u2502 Creates/updates entity data - BIRTH_NOTICE activates \u2502\n\u2502 DEATH_NOTICE       \u2502 Opposite of BIRTH_NOTICE - deactivates entity        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-8-structures/birth-notice.html#critical-requirements","title":"Critical Requirements","text":""},{"location":"part-8-structures/birth-notice.html#1-entity-must-exist-before-birth_notice","title":"1. Entity Must Exist Before BIRTH_NOTICE","text":"<pre><code>The BIRTH_NOTICE doesn't CREATE an entity - it ACTIVATES one.\n\nThe entity must already exist in the client's entity list before\nsending BIRTH_NOTICE. If the entity doesn't exist, the handler\nsimply returns without doing anything.\n\nCorrect Order:\n  1. Create entity (via UPDATE_ARRAY or initial game state)\n  2. Send BIRTH_NOTICE (activates the entity)\n\nWrong Order:\n  1. Send BIRTH_NOTICE (entity not found - does nothing!)\n  2. Create entity (entity exists but not marked as born)\n</code></pre>"},{"location":"part-8-structures/birth-notice.html#2-entity-id-must-match-player-packet","title":"2. Entity ID Must Match PLAYER Packet","text":"<pre><code>For player vehicles, the entity_id in BIRTH_NOTICE must match:\n  - PLAYER packet entity_id\n  - ADD_TO_ROSTER entity_id\n\nAll three packets should reference the same entity:\n  PLAYER:         entity_id = 12345\n  ADD_TO_ROSTER:  entity_id = 12345\n  BIRTH_NOTICE:   entity_id = 12345  \u2190 Must match!\n</code></pre>"},{"location":"part-8-structures/birth-notice.html#3-owner-entity-id-for-different-entity-types","title":"3. Owner Entity ID for Different Entity Types","text":"<pre><code>Entity Type      \u2502 Owner Entity ID\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nPlayer Vehicle   \u2502 Same as Entity ID (self-owned)\nProjectile       \u2502 Player who fired it\nDrone/Turret     \u2502 Player who deployed it\nBuilding         \u2502 Team or player who built it\nNPC/AI           \u2502 Possibly 0 or server-controlled ID\n</code></pre>"},{"location":"part-8-structures/birth-notice.html#common-mistakes","title":"Common Mistakes","text":"Mistake Symptom Fix Entity doesn't exist yet BIRTH_NOTICE has no effect Create entity first via UPDATE_ARRAY Wrong entity ID Wrong entity activated Use same ID as PLAYER packet Forgot BIRTH_NOTICE entirely Player can't control vehicle Add to spawn sequence Wrong owner for projectiles Kill credit goes to wrong player Set owner to firing player Sent before entity created Entity not marked as born Send after UPDATE_ARRAY"},{"location":"part-8-structures/birth-notice.html#verification-checklist","title":"Verification Checklist","text":"<p>Before sending BIRTH_NOTICE, verify:</p> <ul> <li>[ ] Entity exists in game state (created via UPDATE_ARRAY or similar)</li> <li>[ ] Entity ID matches the PLAYER packet (for player vehicles)</li> <li>[ ] Entity ID matches ADD_TO_ROSTER (for player vehicles)</li> <li>[ ] Owner Entity ID is set correctly:</li> <li>[ ] Self-owned for player vehicles</li> <li>[ ] Parent player for projectiles/spawns</li> <li>[ ] Values are big-endian encoded</li> <li>[ ] Packet is sent AFTER entity creation, not before</li> </ul>"},{"location":"part-8-structures/birth-notice.html#packet-summary","title":"Packet Summary","text":"Property Value Packet Type 0x1E Packet Name BIRTH_NOTICE Handler Function FUN_0046d880 Direction Server \u2192 Client Payload Size 8 bytes (fixed) Fields Entity ID, Owner Entity ID Related Packets PLAYER (0x17), UPDATE_ARRAY (0x0E), ADD_TO_ROSTER (0x1A)"},{"location":"part-8-structures/birth-notice.html#quick-reference","title":"Quick Reference","text":"<pre><code>BIRTH_NOTICE Quick Reference:\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nPacket:   1E 00 08 [Entity ID:4] [Owner Entity ID:4]\n\nOffset  Size  Type        Field\n\u2500\u2500\u2500\u2500\u2500\u2500  \u2500\u2500\u2500\u2500  \u2500\u2500\u2500\u2500        \u2500\u2500\u2500\u2500\u2500\n0       4     uint32 BE   Entity ID       (the entity being activated)\n4       4     uint32 BE   Owner Entity ID (who controls it)\n\nTotal: 8 bytes payload (always fixed)\n\nEffect on Entity Structure:\n  entity + 0x3C = 1              (born flag = TRUE)\n  entity + 0x40 = owner_id       (links to controlling entity)\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nPython One-Liner:\n  packet = b'\\x1E\\x00\\x08' + struct.pack('&gt;II', entity_id, owner_id)\n\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n</code></pre>"},{"location":"part-8-structures/birth-notice.html#complete-player-spawn-example","title":"Complete Player Spawn Example","text":"<pre><code>def spawn_player(conn, player_id, entity_id, team_id, player_name):\n    \"\"\"\n    Complete sequence to spawn a player after team selection.\n    \"\"\"\n    # 1. Confirm team selection\n    conn.send(create_reincarnate_response(\n        sub_type=0x02, \n        message=f\"Welcome to Team {team_id}!\"\n    ))\n\n    # 2. Assign player to entity\n    conn.send(create_player_packet(entity_id=entity_id))\n\n    # 3. Time sync\n    conn.send(create_game_clock())\n\n    # 4. Add to roster (visible to all players)\n    conn.send(create_add_to_roster(\n        player_id=player_id,\n        entity_id=entity_id,\n        team_id=team_id,\n        player_name=player_name\n    ))\n\n    # 5. \u2605 Activate the entity \u2605\n    conn.send(create_birth_notice(\n        entity_id=entity_id,\n        owner_entity_id=entity_id  # Self-owned\n    ))\n\n    # 6. Send world info (triggers client to send WANT_UPDATES)\n    conn.send(create_world_stats())\n\n    # Client is now ready to receive UPDATE_ARRAY and play!\n</code></pre> <p>Related: ADD_TO_ROSTER Structure Related: Part 6: REINCARNATE &amp; Game Entry</p>"},{"location":"part-8-structures/update-stats.html","title":"UPDATE_STATS (0x1C)","text":""},{"location":"part-8-structures/update-stats.html#overview","title":"Overview","text":"<p>The UPDATE_STATS packet updates player statistics in the game roster. This packet is sent from the server to clients when a player's stats change (kills, deaths, score, etc.).</p>"},{"location":"part-8-structures/update-stats.html#packet-structure","title":"Packet Structure","text":"<pre><code>UPDATE_STATS Packet Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TYPE    \u2502   LENGTH     \u2502  FIELD_1     \u2502  FIELD_2     \u2502  STATS...    \u2502\n\u2502  0x1C    \u2502  (2 bytes)   \u2502  (4 bytes)   \u2502  (4 bytes)   \u2502  (variable)  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-8-structures/update-stats.html#field-layout","title":"Field Layout","text":"Offset Size Type Description 0 1 uint8 Packet type: <code>0x1C</code> 1 2 uint16 BE Payload length 3 4 int32 BE Field 1 (possibly player_id) 7 4 int32 BE Field 2 (possibly object_id) 11 2 uint16 BE Stat field 1 13 2 uint16 BE Stat field 2 15 2 uint16 BE Stat field 3 17 2 uint16 BE Stat field 4 19 2 uint16 BE Stat field 5 21 8 fixed64 Extended stat 1 (position/score?) 29 8 fixed64 Extended stat 2 37 4 int32 BE Final field <p>Total payload size: ~38 bytes (variable)</p>"},{"location":"part-8-structures/update-stats.html#verification-from-decompiled-code","title":"Verification from Decompiled Code","text":"<pre><code>// From FUN_0046d730 (line 77776-77791)\nvoid FUN_0046d730(undefined4 param_1, undefined4 param_2, undefined4 param_3) {\n    FUN_00509db0(\"UPDATE_STATS\", param_3);\n    FUN_00509310();      // int32 - field 1\n    FUN_00509310();      // int32 - field 2  \n    FUN_005092f0();      // uint16 - stat 1\n    FUN_005092f0();      // uint16 - stat 2\n    FUN_005092f0();      // uint16 - stat 3\n    FUN_005092f0();      // uint16 - stat 4\n    FUN_005092f0();      // uint16 - stat 5\n    FUN_004e51d0();      // extended value (likely 8-byte fixed point)\n    FUN_004e51d0();      // extended value\n    FUN_00509310();      // int32 - final field\n    FUN_00509dc0(param_3, param_2);\n    FUN_00475ec0(...);   // Apply stats update\n}\n</code></pre>"},{"location":"part-8-structures/update-stats.html#python-implementation","title":"Python Implementation","text":"<pre><code>def create_update_stats(player_id, object_id, stats):\n    \"\"\"\n    Create an UPDATE_STATS packet\n\n    Args:\n        player_id: Player identifier\n        object_id: Object/entity identifier\n        stats: Dictionary with stat fields\n    \"\"\"\n    payload = b''\n    payload += struct.pack('&gt;i', player_id)\n    payload += struct.pack('&gt;i', object_id)\n    payload += struct.pack('&gt;H', stats.get('stat1', 0))\n    payload += struct.pack('&gt;H', stats.get('stat2', 0))\n    payload += struct.pack('&gt;H', stats.get('stat3', 0))\n    payload += struct.pack('&gt;H', stats.get('stat4', 0))\n    payload += struct.pack('&gt;H', stats.get('stat5', 0))\n    payload += struct.pack('&gt;q', int(stats.get('extended1', 0) * 65536))\n    payload += struct.pack('&gt;q', int(stats.get('extended2', 0) * 65536))\n    payload += struct.pack('&gt;i', stats.get('final', 0))\n\n    return make_packet(0x1C, payload)\n</code></pre>"},{"location":"part-8-structures/update-stats.html#notes","title":"Notes","text":"<ul> <li>This packet is critical for maintaining roster state</li> <li>The uint16 fields likely represent kills, deaths, assists, score components</li> <li>Extended fields may contain floating-point values encoded as 64-bit fixed point</li> <li>Further packet capture analysis needed to confirm field meanings</li> </ul> <p>Back to Structures Overview</p>"},{"location":"part-9-udp-protocol/index.html","title":"Wulfram 2 Server Implementation Guide","text":""},{"location":"part-9-udp-protocol/index.html#part-9-udp-protocol","title":"Part 9: UDP Protocol","text":""},{"location":"part-9-udp-protocol/index.html#overview","title":"Overview","text":"<p>Wulfram 2 uses UDP for low-latency game data that can tolerate occasional packet loss:</p> <ul> <li>Voice chat (VOICE packets)</li> <li>Real-time position/state updates (PRIORITY packets)  </li> <li>Weapon state synchronization (WEAPONS packets)</li> <li>Graph/telemetry data (GRAPH packets)</li> <li>Connection authentication (D_ Protocol packets)</li> </ul> <p>Important: UDP packet type codes exist in a separate namespace from TCP. Type <code>0x13</code> over TCP is HELLO, but over UDP it's GRAPH_DATA. See Part 1 for the complete comparison table.</p>"},{"location":"part-9-udp-protocol/index.html#udp-architecture-overview","title":"UDP Architecture Overview","text":"<p>Wulfram 2's UDP system has two distinct layers:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Game Data Packets                         \u2502\n\u2502  VOICE(0x0A), PRIORITY(0x0B), WEAPONS(0x0C), GRAPH(0x13)    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502              D_ Protocol Layer (Type 0x08)                   \u2502\n\u2502  D_HANDSHAKE, D_ACK, D_IGNORE, D_SET_START                  \u2502\n\u2502  (Connection auth, stream management, sequencing)           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                     UDP Transport                            \u2502\n\u2502  Raw datagrams to/from server UDP port                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Game Data Packets (0x09-0x14): Direct payload packets for game state, voice, etc.</p> <p>D_ Protocol Layer (0x08): A sub-protocol for connection management. UDP type 0x08 is a carrier frame that encapsulates D_ packets (D_HANDSHAKE, D_ACK, etc.). See Part 9.6: D_HANDSHAKE for complete details.</p>"},{"location":"part-9-udp-protocol/index.html#udp-connection-establishment","title":"UDP Connection Establishment","text":"<p>The UDP channel is established through a multi-step process:</p> <pre><code>CLIENT                                              SERVER\n   \u2502                                                   \u2502\n   \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 TCP Connection \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n   \u2502                                                   \u2502\n   \u2502\u25c4\u2500\u2500\u2500\u2500 TCP: HELLO sub=1 (UDP port info) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n   \u2502                                                   \u2502\n   \u2502     Client binds UDP socket to server port       \u2502\n   \u2502                                                   \u2502\n   \u2502\u2500\u2500\u2500\u2500\u2500 UDP[0x08]: Client sends initial packet \u2500\u2500\u2500\u2500\u25ba\u2502\n   \u2502                                                   \u2502\n   \u2502\u25c4\u2500\u2500\u2500\u2500 UDP[0x08]: D_HANDSHAKE \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n   \u2502      (D_type=3, sequence, session, streams)      \u2502\n   \u2502                                                   \u2502\n   \u2502\u2500\u2500\u2500\u2500\u2500 UDP[0x08]: D_ACK \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n   \u2502      (D_type=2, sub_type=0, sequence)            \u2502\n   \u2502                                                   \u2502\n   \u2502          UDP Channel Authenticated               \u2502\n   \u2502                                                   \u2502\n   \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 Game Data: PRIORITY, VOICE \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n   \u2502                                                   \u2502\n</code></pre> <p>Key Insight: The 0x08 packet type is NOT a simple acknowledgment\u2014it's a carrier frame for the D_ protocol. The first byte of the 0x08 payload determines the actual D_ packet type.</p>"},{"location":"part-9-udp-protocol/index.html#udp-packet-frame-structure","title":"UDP Packet Frame Structure","text":"<p>UDP packets use a simple framing with an implicit length (from the datagram):</p> <pre><code>UDP Packet Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TYPE    \u2502           PAYLOAD               \u2502\n\u2502 (1 byte) \u2502         (variable)              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>For type 0x08 (D_ Protocol), the payload has additional structure:</p> <pre><code>D_ Protocol Frame (Type 0x08):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 UDP Type \u2502 D_Type   \u2502      D_ Payload               \u2502\n\u2502   0x08   \u2502 (1 byte) \u2502      (variable)               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-9-udp-protocol/index.html#udp-packet-type-reference","title":"UDP Packet Type Reference","text":"<p>Source: Packet analysis by baffler, verified against decompiled client code.</p> Type Name Direction Description <code>0x08</code> D_ Protocol Bidirectional Carrier for D_HANDSHAKE, D_ACK, D_IGNORE, D_SET_START <code>0x09</code> ROOT C\u2192S Root/base packet <code>0x0A</code> VOICE C\u2192S Voice chat audio data <code>0x0B</code> PRIORITY S\u2192C Primary game state updates <code>0x0C</code> WEAPONS S\u2192C Weapon state synchronization <code>0x0D</code> ACK_WPNS S\u2192C Weapon acknowledgment <code>0x0E</code> PRIORITY2 S\u2192C Secondary priority updates <code>0x10</code> RESENDS S\u2192C Packet resend requests <code>0x11</code> UNKNOWN ? \u26a0\ufe0f Unidentified <code>0x12</code> GRAPH_RESPONSE S\u2192C Graph query response <code>0x13</code> GRAPH_DATA S\u2192C Telemetry/graph data <code>0x14</code> IGNORE S\u2192C Ignore instruction"},{"location":"part-9-udp-protocol/index.html#d_-protocol-sub-types-within-0x08","title":"D_ Protocol Sub-Types (within 0x08)","text":"D_Type Name Purpose <code>0x01</code> D_IGNORE Instruct receiver to ignore a stream <code>0x02</code> D_ACK Acknowledge D_ protocol packets <code>0x03</code> D_HANDSHAKE Stream configuration and authentication <code>0x04</code> D_SET_START Set stream start positions"},{"location":"part-9-udp-protocol/index.html#reference-packet-name-lookup-python","title":"Reference: Packet Name Lookup (Python)","text":"<p>Updated packet identification utility:</p> <pre><code>def get_udp_packet_name(type_byte):\n    \"\"\"Get the name of a UDP packet by its type byte\"\"\"\n    names = {\n        0x08: \"D_ Protocol (D_HANDSHAKE/D_ACK/D_IGNORE/D_SET_START)\",\n        0x09: \"ROOT (UDP)\",\n        0x0A: \"VOICE (UDP)\",\n        0x0B: \"PRIORITY (UDP)\",\n        0x0C: \"WEAPONS (UDP)\",\n        0x0D: \"ACK_WPNS (UDP)\",\n        0x0E: \"PRIORITY2 (UDP)\",\n        0x10: \"RESENDS (UDP)\",\n        0x11: \"UNKNOWN (0x11 UDP)\",\n        0x12: \"GRAPH_RESPONSE (UDP)\",\n        0x13: \"GRAPH_DATA (UDP)\",\n        0x14: \"IGNORE (UDP)\",\n    }\n    return names.get(type_byte, f\"UNKNOWN NOT LISTED (0x{type_byte:02X} UDP)\")\n\n\ndef get_d_protocol_name(d_type_byte):\n    \"\"\"Get the name of a D_ protocol packet by its type byte\"\"\"\n    names = {\n        0x01: \"D_IGNORE\",\n        0x02: \"D_ACK\", \n        0x03: \"D_HANDSHAKE\",\n        0x04: \"D_SET_START\",\n    }\n    return names.get(d_type_byte, f\"D_UNKNOWN (0x{d_type_byte:02X})\")\n\n\ndef parse_udp_packet(data):\n    \"\"\"Parse a UDP packet and identify its type\"\"\"\n    if len(data) &lt; 1:\n        return \"EMPTY\"\n\n    udp_type = data[0]\n    name = get_udp_packet_name(udp_type)\n\n    # If it's a D_ protocol packet, decode the sub-type\n    if udp_type == 0x08 and len(data) &gt;= 2:\n        d_type = data[1]\n        d_name = get_d_protocol_name(d_type)\n        return f\"{name} -&gt; {d_name}\"\n\n    return name\n</code></pre>"},{"location":"part-9-udp-protocol/index.html#detailed-packet-documentation","title":"Detailed Packet Documentation","text":""},{"location":"part-9-udp-protocol/index.html#d_-protocol-type-0x08","title":"D_ Protocol (Type 0x08)","text":"<ul> <li>D_ Protocol Overview - Frame structure and simple keepalives</li> <li>D_HANDSHAKE Deep Dive - Complete authentication protocol</li> </ul>"},{"location":"part-9-udp-protocol/index.html#game-data-packets","title":"Game Data Packets","text":"<ul> <li>VOICE (0x0A) - Voice chat transmission</li> <li>PRIORITY Updates (0x0B, 0x0E) - Real-time game state</li> <li>WEAPONS (0x0C, 0x0D) - Weapon synchronization</li> <li>GRAPH Data (0x12, 0x13) - Telemetry and debugging</li> </ul>"},{"location":"part-9-udp-protocol/index.html#quick-reference-when-to-use-each-packet","title":"Quick Reference: When to Use Each Packet","text":"Scenario Packet Type Notes Initial UDP auth 0x08 \u2192 D_HANDSHAKE (0x03) Must complete before other UDP Acknowledge D_ packets 0x08 \u2192 D_ACK (0x02) Response to D_HANDSHAKE, etc. UDP keepalive 0x08 Simple ping when idle Voice transmission 0x0A Audio data, C\u2192S Game state sync 0x0B, 0x0E Position, health, etc. S\u2192C Weapon updates 0x0C, 0x0D Weapon state, S\u2192C <p>Previous: Part 8: Structures Next: Part 10: Reference Files</p>"},{"location":"part-9-udp-protocol/d-handshake.html","title":"Part 9.6: D_HANDSHAKE Deep Dive","text":""},{"location":"part-9-udp-protocol/d-handshake.html#the-udp-connection-authentication-protocol","title":"The UDP Connection Authentication Protocol","text":""},{"location":"part-9-udp-protocol/d-handshake.html#overview","title":"Overview","text":"<p>The D_HANDSHAKE packet is a critical component of Wulfram 2's UDP connection management system. Unlike the simple UDP packets used for game data (PRIORITY, VOICE, WEAPONS), D_HANDSHAKE operates within a specialized sub-protocol that handles UDP channel authentication, stream management, and connection state synchronization.</p> <p>This document provides a comprehensive technical analysis based on direct examination of the decompiled client executable (<code>wulfram2_exe.c</code>), specifically the sender function <code>FUN_005052b0</code> (lines 181061-181131) and receiver function <code>FUN_005053f0</code> (lines 181135-181253).</p>"},{"location":"part-9-udp-protocol/d-handshake.html#the-d_-protocol-layer","title":"The D_ Protocol Layer","text":"<p>Wulfram 2 implements a layered UDP architecture:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Application Layer                     \u2502\n\u2502  (Game logic, player input, state management)           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                   Game Data Layer                        \u2502\n\u2502  PRIORITY(0x0B), VOICE(0x0A), WEAPONS(0x0C), etc.       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502              D_ Protocol Layer (Type 0x08)              \u2502\n\u2502  D_HANDSHAKE(3), D_ACK(2), D_IGNORE(1), D_SET_START(4) \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                     UDP Transport                        \u2502\n\u2502  Raw datagrams, connectionless                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>The D_ protocol packets are encapsulated within UDP type 0x08 frames. The first byte of the D_ protocol payload specifies the D_ packet type:</p> D_ Type Name Purpose 0 (Reserved) Unknown/unused 1 D_IGNORE Instructs receiver to ignore a stream 2 D_ACK Acknowledges D_ protocol packets 3 D_HANDSHAKE Stream configuration and authentication 4 D_SET_START Sets stream start positions"},{"location":"part-9-udp-protocol/d-handshake.html#d_handshake-purpose","title":"D_HANDSHAKE Purpose","text":"<p>D_HANDSHAKE serves multiple critical functions:</p> <ol> <li>UDP Channel Authentication: Verifies that UDP traffic originates from the same client that established the TCP connection</li> <li>Stream Configuration: Transfers information about available communication streams (voice channels, data streams)</li> <li>Player Session Binding: Associates player indices with their stream allocations</li> <li>Sequence Synchronization: Establishes initial sequence numbers for reliable D_ protocol messaging</li> </ol> <p>Security Note: Without proper D_HANDSHAKE validation, the server would be vulnerable to UDP spoofing attacks where malicious actors could inject fake game data or voice packets.</p>"},{"location":"part-9-udp-protocol/d-handshake.html#packet-structure","title":"Packet Structure","text":""},{"location":"part-9-udp-protocol/d-handshake.html#wire-frame-udp-type-0x08-container","title":"Wire Frame (UDP Type 0x08 Container)","text":"<pre><code>UDP Type 0x08 Frame:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 UDP Type     \u2502                D_ Protocol Payload               \u2502\n\u2502   0x08       \u2502     (D_HANDSHAKE when first byte = 0x03)        \u2502\n\u2502  (1 byte)    \u2502                 (variable)                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-9-udp-protocol/d-handshake.html#d_handshake-packet-server-client","title":"D_HANDSHAKE Packet (Server \u2192 Client)","text":"<p>Based on <code>FUN_005052b0</code> analysis:</p> <pre><code>D_HANDSHAKE Structure (Server \u2192 Client):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      FIXED HEADER (13 bytes)                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 D_Type   \u2502  Sequence    \u2502  Session_ID  \u2502  Config_Value        \u2502\n\u2502  0x03    \u2502  (4 bytes)   \u2502  (4 bytes)   \u2502  (4 bytes)           \u2502\n\u2502 (1 byte) \u2502   uint32     \u2502   uint32     \u2502   uint32             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u2502                                                                \u2502\n\u2502                    STREAM DEFINITIONS                          \u2502\n\u2502    Repeated for each stream in the server's stream list        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Stream_Name     \u2502  Stream_Value   \u2502  Stream_Index_Count      \u2502\n\u2502  (len-prefixed)  \u2502  (4 bytes)      \u2502  (implicit from entries) \u2502\n\u2502     string       \u2502   uint32        \u2502                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502    Stream_Index entries (uint32 each)                         \u2502\n\u2502    [stream_idx_0, stream_idx_1, ...]                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u2502                                                                \u2502\n\u2502                    PLAYER ENTRIES                              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Active_Player_Count (4 bytes, uint32)                         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  For each active player:                                       \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510               \u2502\n\u2502  \u2502  Player_Index (u32)  \u2502  Player_Value (u32)  \u2502               \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-9-udp-protocol/d-handshake.html#field-descriptions","title":"Field Descriptions","text":""},{"location":"part-9-udp-protocol/d-handshake.html#fixed-header-fields","title":"Fixed Header Fields","text":"Field Offset Size Type Description D_Type 0 1 uint8 Always <code>0x03</code> for D_HANDSHAKE Sequence 1 4 uint32 Monotonically increasing sequence number. Client rejects packets with sequence \u2264 last received Session_ID 5 4 uint32 Session identifier linking UDP to TCP connection Config_Value 9 4 uint32 Configuration value from server session state"},{"location":"part-9-udp-protocol/d-handshake.html#stream-definition-fields","title":"Stream Definition Fields","text":"<p>Streams represent communication channels (voice chat rooms, data channels, etc.). Each stream definition contains:</p> Field Size Type Description Stream_Name variable len-prefixed string Human-readable stream identifier (e.g., \"Beacon Stream\", \"Voice Channel 1\") Stream_Value 4 uint32 Stream-specific configuration value Stream_Indices 4 each uint32[] Array of indices this stream occupies <p>String Encoding: Stream names use length-prefixed encoding: <code>[uint16 length][bytes][null terminator]</code></p>"},{"location":"part-9-udp-protocol/d-handshake.html#player-entry-fields","title":"Player Entry Fields","text":"Field Size Type Description Active_Count 4 uint32 Number of active player entries to follow Player_Index 4 uint32 Index/slot of the player Player_Value 4 uint32 Player-specific value (possibly session or permission flags)"},{"location":"part-9-udp-protocol/d-handshake.html#decompiled-code-analysis","title":"Decompiled Code Analysis","text":""},{"location":"part-9-udp-protocol/d-handshake.html#server-sending-d_handshake-fun_005052b0","title":"Server Sending D_HANDSHAKE (FUN_005052b0)","text":"<pre><code>// Location: wulfram2_exe.c lines 181061-181131\n// Function: FUN_005052b0\n\nvoid __fastcall FUN_005052b0(int param_1)\n{\n    // Get config value from session\n    uVar1 = *(undefined4 *)(*(int *)(param_1 + 0x10) + 0x58);\n\n    // Get current timestamp/sequence\n    uVar6 = (**(code **)(*DAT_005d5ee4 + 8))();  // Timestamp function call\n\n    // Get session ID\n    uVar2 = *(undefined4 *)(*(int *)(param_1 + 4) + 0x14);\n\n    // Create D_HANDSHAKE packet (type 3, protocol mode 6 = UDP D_)\n    iVar7 = FUN_00509cf0(\"D_HANDSHAKE\", 3, *(undefined4 *)(param_1 + 8), 6);\n\n    if (iVar7 != 0) {\n        // Write fixed header\n        FUN_00509520(uVar6);    // Write sequence/timestamp (32-bit)\n        FUN_00509520(uVar2);    // Write session ID (32-bit)\n        FUN_00509520(uVar1);    // Write config value (32-bit)\n\n        // Iterate through stream linked list\n        puVar3 = *(undefined4 **)(*(int *)(param_1 + 0x10) + 0x5c);\n        while (puVar3 != NULL) {\n            puVar4 = (undefined4 *)puVar3[2];\n            puVar3 = (undefined4 *)*puVar3;  // Next in list\n\n            // Write stream name (string)\n            FUN_00509600(*puVar4);\n            // Write stream value (32-bit)\n            FUN_00509520(puVar4[1]);\n\n            // Write stream indices\n            puVar4 = (undefined4 *)puVar4[2];\n            while (puVar4 != NULL) {\n                puVar5 = (undefined4 *)*puVar4;\n                FUN_00509520(puVar4[2]);  // Write index (32-bit)\n                puVar4 = puVar5;\n            }\n        }\n\n        // Count active player entries\n        iVar10 = 0;\n        iVar9 = *(int *)(*(int *)(param_1 + 0x10) + 0x40);\n        if (0 &lt; iVar9) {\n            piVar8 = *(int **)(*(int *)(param_1 + 0x10) + 0x54);\n            do {\n                if (*piVar8 != 0) {\n                    iVar10 = iVar10 + 1;\n                }\n                piVar8 = piVar8 + 1;\n                iVar9 = iVar9 - 1;\n            } while (iVar9 != 0);\n        }\n\n        // Write active player count\n        FUN_00509520(iVar10);\n\n        // Write player entries\n        uVar11 = 0;\n        if (*(int *)(iVar9 + 0x40) != 0) {\n            do {\n                iVar9 = *(int *)(*(int *)(iVar9 + 0x54) + uVar11 * 4);\n                if (iVar9 != 0) {\n                    FUN_00509520(uVar11);   // Write player index\n                    FUN_00509520(iVar9);    // Write player value\n                }\n                iVar9 = *(int *)(param_1 + 0x10);\n                uVar11 = uVar11 + 1;\n            } while (uVar11 &lt; *(uint *)(iVar9 + 0x40));\n        }\n\n        // Send the packet\n        FUN_0050a340(iVar7);\n\n        // Register callback for acknowledgment handling\n        FUN_00504b60(*(undefined4 *)(*(int *)(param_1 + 4) + 0xb4), 3, &amp;LAB_00504580);\n    }\n}\n</code></pre>"},{"location":"part-9-udp-protocol/d-handshake.html#client-receiving-d_handshake-fun_005053f0","title":"Client Receiving D_HANDSHAKE (FUN_005053f0)","text":"<pre><code>// Location: wulfram2_exe.c lines 181135-181253\n// Function: FUN_005053f0\n\nvoid FUN_005053f0(int param_1, void *param_2, undefined4 param_3)\n{\n    // Begin parsing D_HANDSHAKE\n    FUN_00509db0(\"D_HANDSHAKE\", param_3);  // Log/debug\n\n    // Read sequence number\n    FUN_00509310(&amp;local_78);  // Read uint32 sequence\n\n    // Validate sequence (anti-replay protection)\n    if (local_78 &lt; *(uint *)(iVar4 + 0x4c)) {\n        // Old packet, discard\n        FUN_005099b0(uVar1);\n        FUN_00509dc0(param_3, param_2);\n        return;\n    }\n\n    // Update last sequence\n    *(uint *)(iVar4 + 0x4c) = local_78;\n\n    // Check if already handshaked\n    if (*(char *)(iVar4 + 0x51) == '\\0') {\n        // Read session value\n        FUN_00509310(&amp;local_58);\n        *(undefined4 *)(*(int *)(iVar2 + 4) + 0x10) = local_58;\n\n        // Read stream count\n        FUN_00509310(&amp;local_64);\n\n        // Validate stream count (sanity check)\n        if (local_64 &gt;= *(uint *)(local_68 + 0x40)) {\n            FUN_00509f30(\"D_HANDSHAKE: insane stream_count\", param_2);\n            FUN_005099b0();\n            return;\n        }\n\n        // Process each stream\n        if (local_64 != 0) {\n            local_78 = 0;\n            do {\n                // Read stream name\n                FUN_00509340(&amp;local_6c);  // Read len-prefixed string\n                iVar2 = FUN_00503e80(local_6c);  // Create stream object\n                *(undefined1 *)(iVar2 + 4) = 1;\n                _free(local_6c);\n\n                // Read stream index count\n                FUN_00509310(&amp;local_5c);\n\n                // Read stream indices\n                uVar1 = 0;\n                if (local_5c != 0) {\n                    do {\n                        FUN_00509310(&amp;local_7c);  // Read index\n                        uVar1 = uVar1 + 1;\n                        // Assign stream to index\n                        *(int *)(*(int *)(iVar4 + 0x24) + local_7c * 4) = iVar2;\n                    } while (uVar1 &lt; local_5c);\n                }\n\n                local_78 = local_78 + 1;\n            } while (local_78 &lt; local_64);\n        }\n\n        // Read private stream count\n        FUN_00509310(&amp;local_74);\n\n        // Process private streams\n        uVar1 = 0;\n        if (local_74 != 0) {\n            do {\n                FUN_00509310(&amp;local_7c);   // Stream index\n                FUN_00509310(&amp;local_54);   // Stream value\n\n                // Create private stream if not exists\n                if (*(int *)(*(int *)(iVar4 + 0x24) + local_7c * 4) == 0) {\n                    _sprintf(local_50, \"* Private In Stream %d *\", local_7c);\n                    // Create new stream object...\n                }\n\n                // Set stream value\n                *(undefined4 *)(*(int *)(*(int *)(iVar4 + 0x24) + local_7c * 4) + 8) = local_54;\n                uVar1 = uVar1 + 1;\n            } while (uVar1 &lt; local_74);\n        }\n\n        // Mark handshake complete\n        *(undefined1 *)(iVar4 + 0x51) = 1;\n\n        // Send D_ACK response\n        uVar3 = (**(code **)(*DAT_005d5ee4 + 8))();  // Get timestamp\n        iVar4 = FUN_00509cf0(\"D_ACK\", 2, *(undefined4 *)(local_70 + 8), 6);\n        if (iVar4 != 0) {\n            FUN_00509440(0);       // Write sub-type 0 (8-bit)\n            FUN_00509520(uVar3);   // Write timestamp (32-bit)\n            FUN_0050a340(iVar4);   // Send\n        }\n    }\n    else {\n        // Already handshaked, just send ACK\n        FUN_005099b0(uVar1);\n        FUN_00504620();\n    }\n}\n</code></pre>"},{"location":"part-9-udp-protocol/d-handshake.html#d_ack-response-structure","title":"D_ACK Response Structure","text":"<p>When the client successfully processes D_HANDSHAKE, it responds with D_ACK:</p> <pre><code>D_ACK Response (Client \u2192 Server):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 D_Type   \u2502  Sub_Type \u2502  Sequence    \u2502\n\u2502  0x02    \u2502   0x00    \u2502  (4 bytes)   \u2502\n\u2502 (1 byte) \u2502  (1 byte) \u2502   uint32     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> Field Size Value Description D_Type 1 <code>0x02</code> D_ACK packet type Sub_Type 1 <code>0x00</code> Sub-type 0 = initial handshake ACK Sequence 4 uint32 Echoed timestamp for RTT calculation"},{"location":"part-9-udp-protocol/d-handshake.html#d_ack-sub-types","title":"D_ACK Sub-Types","text":"<p>The D_ACK packet has multiple sub-types for different purposes:</p> Sub-Type Purpose Additional Fields 0 Initial handshake ACK Sequence only 1 D_IGNORE acknowledgment Stream index (u8), Value (u16) 2 Extended ACK Sequence, Stream index (u8), Value (u16)"},{"location":"part-9-udp-protocol/d-handshake.html#validation-requirements","title":"Validation Requirements","text":"<p>The client performs several validation checks on D_HANDSHAKE:</p> <ol> <li>Sequence Validation: <code>received_sequence &gt;= last_sequence</code></li> <li>Prevents replay attacks</li> <li> <p>Packets with old sequences are silently discarded</p> </li> <li> <p>Stream Count Sanity Check: <code>stream_count &lt; max_streams</code></p> </li> <li>Error message: <code>\"D_HANDSHAKE: insane stream_count\"</code></li> <li> <p>Prevents buffer overflow attacks</p> </li> <li> <p>Handshake State Check: Only process if not already handshaked</p> </li> <li>Duplicate D_HANDSHAKE packets trigger re-ACK without reprocessing</li> </ol>"},{"location":"part-9-udp-protocol/d-handshake.html#connection-flow-diagram","title":"Connection Flow Diagram","text":"<pre><code>CLIENT                                              SERVER\n   \u2502                                                   \u2502\n   \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 TCP Connection \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n   \u2502                                                   \u2502\n   \u2502\u25c4\u2500\u2500\u2500\u2500 TCP: HELLO sub=0 (version 0x4E89) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n   \u2502                                                   \u2502\n   \u2502\u25c4\u2500\u2500\u2500\u2500 TCP: HELLO sub=1 (UDP port info) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n   \u2502                                                   \u2502\n   \u2502 Client binds UDP socket to server's UDP port     \u2502\n   \u2502                                                   \u2502\n   \u2502\u2500\u2500\u2500\u2500\u2500 UDP[0x08]: D_HANDSHAKE (type 3) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n   \u2502      seq=0, session_id, streams, players         \u2502\n   \u2502                                                   \u2502\n   \u2502\u25c4\u2500\u2500\u2500\u2500 UDP[0x08]: D_ACK (type 2) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502  \n   \u2502      sub_type=0, sequence                        \u2502\n   \u2502                                                   \u2502\n   \u2502           UDP Channel Authenticated              \u2502\n   \u2502                                                   \u2502\n   \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 UDP: PRIORITY, VOICE, etc. \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n   \u2502                                                   \u2502\n</code></pre> <p>Note: The actual direction of D_HANDSHAKE (who sends first) may vary. The decompiled code shows the client can both send and receive D_HANDSHAKE, suggesting it may be bidirectional depending on context.</p>"},{"location":"part-9-udp-protocol/d-handshake.html#implementation-guide","title":"Implementation Guide","text":""},{"location":"part-9-udp-protocol/d-handshake.html#python-server-implementation","title":"Python Server Implementation","text":"<pre><code>import struct\nimport socket\n\nclass DHandshakePacket:\n    \"\"\"\n    D_HANDSHAKE packet builder for Wulfram 2 server.\n\n    This packet is sent within a UDP type 0x08 frame as part of\n    the D_ protocol layer for connection authentication.\n    \"\"\"\n\n    UDP_FRAME_TYPE = 0x08\n    D_TYPE_HANDSHAKE = 0x03\n    D_TYPE_ACK = 0x02\n\n    def __init__(self, sequence: int, session_id: int, config_value: int):\n        self.sequence = sequence\n        self.session_id = session_id\n        self.config_value = config_value\n        self.streams = []  # List of (name, value, [indices])\n        self.players = []  # List of (index, value)\n\n    def add_stream(self, name: str, value: int, indices: list):\n        \"\"\"Add a stream definition to the handshake.\"\"\"\n        self.streams.append((name, value, indices))\n\n    def add_player(self, player_index: int, player_value: int):\n        \"\"\"Add an active player entry.\"\"\"\n        self.players.append((player_index, player_value))\n\n    @staticmethod\n    def encode_string(text: str) -&gt; bytes:\n        \"\"\"\n        Encode a string in Wulfram 2 format.\n        Format: [uint16 length][string bytes][null terminator]\n        \"\"\"\n        string_bytes = text.encode('utf-8') + b'\\x00'\n        return struct.pack('&gt;H', len(string_bytes)) + string_bytes\n\n    def build(self) -&gt; bytes:\n        \"\"\"\n        Build the complete D_HANDSHAKE packet.\n\n        Returns the D_ protocol payload (without UDP type byte).\n        Caller must wrap in UDP type 0x08 frame.\n        \"\"\"\n        packet = bytearray()\n\n        # D_ packet type\n        packet.append(self.D_TYPE_HANDSHAKE)\n\n        # Fixed header: sequence, session_id, config_value\n        packet.extend(struct.pack('&gt;I', self.sequence))\n        packet.extend(struct.pack('&gt;I', self.session_id))\n        packet.extend(struct.pack('&gt;I', self.config_value))\n\n        # Stream definitions\n        for name, value, indices in self.streams:\n            packet.extend(self.encode_string(name))\n            packet.extend(struct.pack('&gt;I', value))\n            for idx in indices:\n                packet.extend(struct.pack('&gt;I', idx))\n\n        # Player entries\n        packet.extend(struct.pack('&gt;I', len(self.players)))\n        for player_idx, player_val in self.players:\n            packet.extend(struct.pack('&gt;I', player_idx))\n            packet.extend(struct.pack('&gt;I', player_val))\n\n        return bytes(packet)\n\n    def build_udp_frame(self) -&gt; bytes:\n        \"\"\"Build complete UDP frame with type byte.\"\"\"\n        return bytes([self.UDP_FRAME_TYPE]) + self.build()\n\n\nclass DAckPacket:\n    \"\"\"D_ACK packet parser and builder.\"\"\"\n\n    D_TYPE_ACK = 0x02\n\n    @staticmethod\n    def build_handshake_ack(sequence: int) -&gt; bytes:\n        \"\"\"Build D_ACK sub-type 0 (handshake acknowledgment).\"\"\"\n        packet = bytearray()\n        packet.append(0x08)  # UDP frame type\n        packet.append(DAckPacket.D_TYPE_ACK)  # D_ACK\n        packet.append(0x00)  # Sub-type 0\n        packet.extend(struct.pack('&gt;I', sequence))\n        return bytes(packet)\n\n    @staticmethod\n    def parse(data: bytes) -&gt; dict:\n        \"\"\"\n        Parse incoming D_ACK packet.\n\n        Returns dict with sub_type and relevant fields.\n        \"\"\"\n        if len(data) &lt; 3:\n            raise ValueError(\"D_ACK packet too short\")\n\n        d_type = data[0]\n        sub_type = data[1]\n\n        result = {\n            'd_type': d_type,\n            'sub_type': sub_type\n        }\n\n        if sub_type == 0:\n            # Handshake ACK: sequence only\n            if len(data) &gt;= 6:\n                result['sequence'] = struct.unpack('&gt;I', data[2:6])[0]\n        elif sub_type == 1:\n            # D_IGNORE ACK\n            if len(data) &gt;= 5:\n                result['stream_index'] = data[2]\n                result['value'] = struct.unpack('&gt;H', data[3:5])[0]\n        elif sub_type == 2:\n            # Extended ACK\n            if len(data) &gt;= 9:\n                result['sequence'] = struct.unpack('&gt;I', data[2:6])[0]\n                result['stream_index'] = data[6]\n                result['value'] = struct.unpack('&gt;H', data[7:9])[0]\n\n        return result\n\n\n# Example usage\ndef send_d_handshake(udp_socket, client_addr, session):\n    \"\"\"\n    Send D_HANDSHAKE to establish UDP channel authentication.\n    \"\"\"\n    handshake = DHandshakePacket(\n        sequence=session.next_sequence(),\n        session_id=session.session_id,\n        config_value=session.config_flags\n    )\n\n    # Add voice channel streams\n    handshake.add_stream(\"Team Voice\", 1, [0, 1, 2, 3])\n    handshake.add_stream(\"Proximity Voice\", 2, [4, 5, 6, 7])\n\n    # Add connected players\n    for player in session.players:\n        if player.is_active:\n            handshake.add_player(player.index, player.permissions)\n\n    packet = handshake.build_udp_frame()\n    udp_socket.sendto(packet, client_addr)\n    print(f\"TX D_HANDSHAKE: {packet.hex(' ')}\")\n\n\ndef handle_d_ack(data: bytes, client_addr):\n    \"\"\"Handle incoming D_ACK from client.\"\"\"\n    # Skip UDP frame type byte\n    d_payload = data[1:]\n\n    ack = DAckPacket.parse(d_payload)\n\n    if ack['sub_type'] == 0:\n        print(f\"D_HANDSHAKE acknowledged, seq={ack.get('sequence')}\")\n        # Mark UDP channel as authenticated\n        return True\n\n    return False\n</code></pre>"},{"location":"part-9-udp-protocol/d-handshake.html#byte-level-example","title":"Byte-Level Example","text":""},{"location":"part-9-udp-protocol/d-handshake.html#minimal-d_handshake-no-streams-no-players","title":"Minimal D_HANDSHAKE (No Streams, No Players)","text":"<pre><code>Building minimal D_HANDSHAKE:\n\nUDP Frame:\n  08                    UDP type (D_ protocol)\n\nD_ Payload:\n  03                    D_Type: D_HANDSHAKE\n  00 00 00 01           Sequence: 1\n  00 00 12 34           Session_ID: 0x1234\n  00 00 00 00           Config_Value: 0\n  00 00 00 00           Active_Player_Count: 0\n\nComplete packet (hex):\n  08 03 00 00 00 01 00 00 12 34 00 00 00 00 00 00 00 00\n\nBreakdown:\n  08           = UDP frame type (D_ protocol carrier)\n  03           = D_HANDSHAKE\n  00 00 00 01  = Sequence number: 1\n  00 00 12 34  = Session ID: 0x1234\n  00 00 00 00  = Config value: 0\n  00 00 00 00  = Active player count: 0\n</code></pre>"},{"location":"part-9-udp-protocol/d-handshake.html#d_handshake-with-one-stream-and-one-player","title":"D_HANDSHAKE with One Stream and One Player","text":"<pre><code>Building D_HANDSHAKE with data:\n\nStream: \"Voice1\", value=1, indices=[0]\nPlayer: index=5, value=100\n\nUDP Frame:\n  08                    UDP type (D_ protocol)\n\nD_ Payload:\n  03                    D_Type: D_HANDSHAKE\n  00 00 00 02           Sequence: 2\n  00 00 AB CD           Session_ID: 0xABCD\n  00 00 00 01           Config_Value: 1\n\nStream definition:\n  00 07                 String length: 7 (including null)\n  56 6F 69 63 65 31 00  \"Voice1\\0\"\n  00 00 00 01           Stream value: 1\n  00 00 00 00           Stream index: 0\n\nPlayer entries:\n  00 00 00 01           Active_Player_Count: 1\n  00 00 00 05           Player_Index: 5\n  00 00 00 64           Player_Value: 100\n\nComplete packet (hex):\n  08 03 00 00 00 02 00 00 AB CD 00 00 00 01 \n  00 07 56 6F 69 63 65 31 00 00 00 00 01 00 00 00 00\n  00 00 00 01 00 00 00 05 00 00 00 64\n</code></pre>"},{"location":"part-9-udp-protocol/d-handshake.html#expected-d_ack-response","title":"Expected D_ACK Response","text":"<pre><code>D_ACK Response (sub-type 0):\n\n  08                    UDP type (D_ protocol)\n  02                    D_Type: D_ACK\n  00                    Sub-type: 0 (handshake ack)\n  00 00 00 02           Sequence: 2 (echo from handshake)\n\nComplete packet (hex):\n  08 02 00 00 00 00 02\n\nNote: The exact sequence value in the ACK may be the client's\ntimestamp rather than an echo, based on decompiled code analysis.\n</code></pre>"},{"location":"part-9-udp-protocol/d-handshake.html#error-conditions","title":"Error Conditions","text":"Error Cause Client Behavior Sequence too old <code>seq &lt; last_seq</code> Silently discard packet Insane stream count <code>stream_count &gt;= max_streams</code> Log error, discard packet Already handshaked Duplicate D_HANDSHAKE Re-send D_ACK only"},{"location":"part-9-udp-protocol/d-handshake.html#security-considerations","title":"Security Considerations","text":"<ol> <li> <p>Sequence Numbers: The client tracks the last received sequence and rejects older packets. Server must maintain per-session sequence counters.</p> </li> <li> <p>Session Binding: The <code>session_id</code> field should match the TCP session to prevent cross-session attacks.</p> </li> <li> <p>Stream Count Limits: The client validates stream counts against a maximum. Server should not exceed this limit.</p> </li> <li> <p>UDP Source Validation: Even after D_HANDSHAKE, verify UDP source address matches the authenticated client.</p> </li> </ol>"},{"location":"part-9-udp-protocol/d-handshake.html#debugging-tips","title":"Debugging Tips","text":"<ol> <li> <p>Wireshark Filter: <code>udp &amp;&amp; data[0] == 0x08 &amp;&amp; data[1] == 0x03</code> for D_HANDSHAKE packets</p> </li> <li> <p>Check Sequence: If D_HANDSHAKE is ignored, verify sequence is higher than previously sent</p> </li> <li> <p>Verify Framing: Ensure the packet is wrapped in UDP type 0x08, not sent raw</p> </li> <li> <p>Stream Count: Client has a maximum stream limit - check <code>D_HANDSHAKE: insane stream_count</code> in logs</p> </li> </ol>"},{"location":"part-9-udp-protocol/d-handshake.html#related-documentation","title":"Related Documentation","text":"<ul> <li>UDP Protocol Overview - General UDP packet reference</li> <li>HELLO_ACK / UDP Establishment - Initial UDP channel setup</li> <li>VOICE Protocol - Voice data that uses authenticated UDP channel</li> <li>Part 2: HELLO Handshake - TCP handshake that precedes UDP setup</li> </ul>"},{"location":"part-9-udp-protocol/d-handshake.html#appendix-packet-writing-functions-reference","title":"Appendix: Packet Writing Functions Reference","text":"Function Purpose Size <code>FUN_00509440</code> Write uint8 1 byte <code>FUN_005094b0</code> Write uint16 2 bytes <code>FUN_00509520</code> Write uint32 4 bytes <code>FUN_00509600</code> Write string 2 + len + 1 bytes <code>FUN_005092e0</code> Read uint8 1 byte <code>FUN_005092f0</code> Read uint16 2 bytes <code>FUN_00509310</code> Read uint32 4 bytes <code>FUN_00509340</code> Read string Variable <p>Previous: VOICE (UDP) Back to: UDP Protocol Overview</p>"},{"location":"part-9-udp-protocol/graph.html","title":"UDP GRAPH_RESPONSE (0x12) and GRAPH_DATA (0x13)","text":""},{"location":"part-9-udp-protocol/graph.html#overview","title":"Overview","text":"<p>GRAPH packets appear to be used for telemetry, debugging, or performance monitoring data. They transmit named data series with timestamped values.</p>"},{"location":"part-9-udp-protocol/graph.html#graph_response-0x12-structure","title":"GRAPH_RESPONSE (0x12) Structure","text":"<p>Response to a graph data request:</p> <pre><code>GRAPH_RESPONSE Packet Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TYPE    \u2502  NAME        \u2502  EXISTS  \u2502\n\u2502  0x12    \u2502  (string)    \u2502 (1 byte) \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> Field Size Type Description Type 1 uint8 <code>0x12</code> Name variable length-prefixed string Graph/data series name Exists 1 bool Whether the requested data exists"},{"location":"part-9-udp-protocol/graph.html#graph_data-0x13-structure","title":"GRAPH_DATA (0x13) Structure","text":"<p>Actual graph data transmission:</p> <pre><code>GRAPH_DATA Packet Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TYPE    \u2502  NAME        \u2502  TIMESTAMP   \u2502  COUNT      \u2502  DATA_POINTS        \u2502\n\u2502  0x13    \u2502  (string)    \u2502  (4 bytes)   \u2502  (4 bytes)  \u2502  (count \u00d7 8 bytes)  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> Field Size Type Description Type 1 uint8 <code>0x13</code> Name variable length-prefixed string Graph/data series name Timestamp 4 uint32 BE Time reference Count 4 uint32 BE Number of data points Data Points count \u00d7 8 array of doubles Data values (as strings, parsed to doubles)"},{"location":"part-9-udp-protocol/graph.html#verification-from-decompiled-code","title":"Verification from Decompiled Code","text":"<pre><code>// GRAPH_RESPONSE handler - FUN_00414110 (line 19282-19331)\nvoid FUN_00414110(undefined4 param_1, undefined4 param_2, undefined4 param_3) {\n    FUN_00509db0(\"GRAPH_RESPONSE\", param_3);\n    FUN_00509340(&amp;local_14);     // Name string\n    FUN_005092e0(&amp;local_15);     // Exists flag (1 byte)\n    // If exists, creates graph object...\n}\n\n// GRAPH_DATA handler - FUN_00414210 (line 19336-19377)\nvoid FUN_00414210(undefined4 param_1, undefined4 param_2, undefined4 param_3) {\n    FUN_00509db0(\"GRAPH_DATA\", param_3);\n    FUN_00509340(&amp;local_11c);    // Name string\n    FUN_00509310(&amp;local_10c);    // Timestamp\n    FUN_00509310(&amp;local_110);    // Count\n\n    iVar2 = 0;\n    if (0 &lt; local_110) {\n        puVar1 = local_108;\n        do {\n            FUN_00509340(&amp;local_118);  // Data point as string\n            FID_conflict__sscanf(local_118, \"%lf\", puVar1);  // Parse as double\n            _free(local_118);\n            iVar2 = iVar2 + 1;\n            puVar1 = puVar1 + 8;\n        } while (iVar2 &lt; local_110);\n    }\n}\n</code></pre>"},{"location":"part-9-udp-protocol/graph.html#notes","title":"Notes","text":"<ul> <li>Data points are transmitted as strings and parsed to doubles</li> <li>Maximum appears to be around 32 data points (256 bytes in local buffer)</li> <li>Likely used for debugging network performance or game metrics</li> </ul> <p>Back to UDP Protocol Overview</p>"},{"location":"part-9-udp-protocol/priority.html","title":"UDP PRIORITY (0x0B) and PRIORITY2 (0x0E)","text":""},{"location":"part-9-udp-protocol/priority.html#overview","title":"Overview","text":"<p>PRIORITY packets transmit real-time game state updates that need low latency but can tolerate occasional packet loss. These include player positions, velocities, and other frequently-changing state.</p>"},{"location":"part-9-udp-protocol/priority.html#priority-0x0b-structure","title":"PRIORITY (0x0B) Structure","text":"<pre><code>PRIORITY Packet Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TYPE    \u2502  OBJECT_ID   \u2502  STRING_1    \u2502  STRING_2    \u2502  POSITION/STATE     \u2502\n\u2502  0x0B    \u2502  (4 bytes)   \u2502  (variable)  \u2502  (variable)  \u2502  (3 \u00d7 4 bytes)      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> Field Size Type Description Type 1 uint8 <code>0x0B</code> Object ID 4 uint32 BE Entity being updated String 1 variable length-prefixed Position data as string (parsed as floats) String 2 variable length-prefixed Additional position/velocity data Field 3 4 uint32 BE Unknown Field 4 4 uint32 BE Unknown Field 5 4 uint32 BE Unknown"},{"location":"part-9-udp-protocol/priority.html#priority2-0x0e-structure","title":"PRIORITY2 (0x0E) Structure","text":"<p>PRIORITY2 appears to be a simpler variant:</p> <pre><code>PRIORITY2 Packet Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TYPE    \u2502  STRING_1    \u2502  STRING_2    \u2502\n\u2502  0x0E    \u2502  (variable)  \u2502  (variable)  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-9-udp-protocol/priority.html#verification-from-decompiled-code","title":"Verification from Decompiled Code","text":"<pre><code>// PRIORITY handler - FUN_00413be0 (line 19053-19095)\nvoid FUN_00413be0(undefined4 param_1, undefined4 param_2, undefined4 param_3) {\n    FUN_00509db0(\"PRIORITY\", param_3);\n    FUN_00509310(&amp;local_18);     // Object ID (4 bytes)\n    FUN_00509340(&amp;local_1c);     // String 1 (length-prefixed)\n    FUN_00509340(local_30);      // String 2 (length-prefixed)\n    FUN_00509310(&amp;local_20);     // Field 3\n    FUN_00509310(&amp;local_24);     // Field 4\n    FUN_00509310(&amp;local_28);     // Field 5\n    // String contains position like \"1.0 2.0 3.0\" - parsed with sscanf\n    FID_conflict__sscanf(local_30[0], \"%lf\", &amp;local_10);\n    // ...\n}\n\n// PRIORITY2 handler - FUN_00413f80 (line 19225-19256)\nvoid FUN_00413f80(undefined4 param_1, undefined4 param_2, undefined4 param_3) {\n    FUN_00509db0(\"PRIORITY\", param_3);  // Note: same debug name\n    FUN_00509340(&amp;local_30);     // String 1: \"%f %f %f\" format\n    FUN_00509340(local_2c);      // String 2: \"%f %f %f\" format\n    // Parses as 3D vectors\n    FID_conflict__sscanf(local_30, \"%f %f %f\", &amp;local_24, &amp;local_20, local_1c);\n    FID_conflict__sscanf(local_2c[0], \"%f %f %f\", &amp;local_c, &amp;local_8, &amp;local_4);\n}\n</code></pre>"},{"location":"part-9-udp-protocol/priority.html#usage-notes","title":"Usage Notes","text":"<ul> <li>Position strings use space-separated float format: <code>\"123.456 789.012 345.678\"</code></li> <li>These packets are sent frequently (potentially every frame for moving objects)</li> <li>Server should throttle/aggregate updates to avoid flooding clients</li> </ul> <p>Back to UDP Protocol Overview</p>"},{"location":"part-9-udp-protocol/protocol-overview.html","title":"Part 9.1: D_ Protocol Overview (UDP Type 0x08)","text":""},{"location":"part-9-udp-protocol/protocol-overview.html#overview","title":"Overview","text":"<p>UDP type <code>0x08</code> is a carrier frame for the D_ Protocol\u2014a sub-protocol layer that handles UDP connection management, authentication, and stream control. Unlike other UDP packet types that carry game data directly, type 0x08 packets contain an additional type byte that identifies the specific D_ packet being transmitted.</p> <p>Key Discovery: Initial analysis suggested 0x08 was a simple \"HELLO_ACK\" keepalive. Deeper reverse engineering revealed it's actually the transport layer for a sophisticated connection management protocol.</p>"},{"location":"part-9-udp-protocol/protocol-overview.html#d_-protocol-architecture","title":"D_ Protocol Architecture","text":"<pre><code>UDP Type 0x08 Frame:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  UDP Type    \u2502   D_Type     \u2502        D_ Payload               \u2502\n\u2502    0x08      \u2502   (1 byte)   \u2502        (variable)               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502               \u2502\n     \u2502               \u2514\u2500 Determines which D_ packet this is\n     \u2514\u2500 Identifies this as a D_ Protocol frame\n</code></pre> <p>The D_ Protocol provides: - Connection Authentication: Verifying UDP traffic comes from the correct TCP-authenticated client - Stream Management: Configuring voice channels and data streams - Sequence Control: Replay protection and ordering guarantees - Acknowledgments: Reliable delivery for control messages</p>"},{"location":"part-9-udp-protocol/protocol-overview.html#d_-packet-types","title":"D_ Packet Types","text":"D_Type Name Direction Documentation <code>0x01</code> D_IGNORE S\u2192C This document <code>0x02</code> D_ACK Bidirectional This document <code>0x03</code> D_HANDSHAKE Bidirectional Part 9.6: D_HANDSHAKE Deep Dive <code>0x04</code> D_SET_START S\u2192C This document"},{"location":"part-9-udp-protocol/protocol-overview.html#d_ignore-type-0x01","title":"D_IGNORE (Type 0x01)","text":"<p>Instructs the receiver to ignore packets on a specific stream index.</p>"},{"location":"part-9-udp-protocol/protocol-overview.html#packet-structure","title":"Packet Structure","text":"<pre><code>D_IGNORE Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 UDP Type \u2502  D_Type  \u2502 Stream_Index  \u2502    Value     \u2502\n\u2502   0x08   \u2502   0x01   \u2502   (1 byte)    \u2502  (2 bytes)   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> Field Offset Size Type Description UDP Type 0 1 uint8 Always <code>0x08</code> D_Type 1 1 uint8 Always <code>0x01</code> Stream_Index 2 1 uint8 Stream to ignore Value 3 2 uint16 BE Associated value"},{"location":"part-9-udp-protocol/protocol-overview.html#client-response","title":"Client Response","text":"<p>When the client receives D_IGNORE, it responds with D_ACK sub-type 1:</p> <pre><code>// From FUN_00505790 (wulfram2_exe.c line 181300-181326)\nFUN_00509db0(\"D_IGNORE\", param_3);\nFUN_005092e0(&amp;param_2);         // Read stream_index (u8)\nFUN_005092f0(local_8);          // Read value (u16)\nFUN_00509dc0(uVar2, uVar1);\nFUN_00505050(param_2 &amp; 0xff, local_8[0]);\n\n// Send D_ACK response\niVar3 = FUN_00509cf0(\"D_ACK\", 2, ...);\nif (iVar3 != 0) {\n    FUN_00509440(1);              // Sub-type 1\n    FUN_00509440(local_4);        // Echo stream_index\n    FUN_005094b0(local_8[0]);     // Echo value\n    FUN_0050a340(iVar3);\n}\n</code></pre>"},{"location":"part-9-udp-protocol/protocol-overview.html#d_ack-type-0x02","title":"D_ACK (Type 0x02)","text":"<p>Acknowledges receipt of D_ protocol packets. Has multiple sub-types for different acknowledgment contexts.</p>"},{"location":"part-9-udp-protocol/protocol-overview.html#packet-structure_1","title":"Packet Structure","text":"<pre><code>D_ACK Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 UDP Type \u2502  D_Type  \u2502 Sub_Type  \u2502   Sub-Type Specific Data    \u2502\n\u2502   0x08   \u2502   0x02   \u2502  (1 byte) \u2502        (variable)           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-9-udp-protocol/protocol-overview.html#d_ack-sub-types","title":"D_ACK Sub-Types","text":"Sub-Type Name Purpose Additional Fields 0 Handshake ACK Acknowledges D_HANDSHAKE Sequence (4 bytes) 1 Ignore ACK Acknowledges D_IGNORE Stream_Index (1), Value (2) 2 Extended ACK Extended acknowledgment Sequence (4), Stream_Index (1), Value (2)"},{"location":"part-9-udp-protocol/protocol-overview.html#sub-type-0-handshake-acknowledgment","title":"Sub-Type 0: Handshake Acknowledgment","text":"<pre><code>D_ACK Sub-Type 0 Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 UDP Type \u2502  D_Type  \u2502 Sub_Type  \u2502   Sequence   \u2502\n\u2502   0x08   \u2502   0x02   \u2502   0x00    \u2502  (4 bytes)   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Sent by the client after successfully processing D_HANDSHAKE. The server uses the sequence to calculate RTT and confirm the handshake completed.</p>"},{"location":"part-9-udp-protocol/protocol-overview.html#sub-type-1-ignore-acknowledgment","title":"Sub-Type 1: Ignore Acknowledgment","text":"<pre><code>D_ACK Sub-Type 1 Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 UDP Type \u2502  D_Type  \u2502 Sub_Type  \u2502 Stream_Index  \u2502    Value     \u2502\n\u2502   0x08   \u2502   0x02   \u2502   0x01    \u2502   (1 byte)    \u2502  (2 bytes)   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Sent by the client after receiving D_IGNORE, echoing back the stream index and value.</p>"},{"location":"part-9-udp-protocol/protocol-overview.html#sub-type-2-extended-acknowledgment","title":"Sub-Type 2: Extended Acknowledgment","text":"<pre><code>D_ACK Sub-Type 2 Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 UDP Type \u2502  D_Type  \u2502 Sub_Type  \u2502   Sequence   \u2502 Stream_Index  \u2502    Value     \u2502\n\u2502   0x08   \u2502   0x02   \u2502   0x02    \u2502  (4 bytes)   \u2502   (1 byte)    \u2502  (2 bytes)   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Used for acknowledgments that need both sequence validation and stream identification.</p>"},{"location":"part-9-udp-protocol/protocol-overview.html#decompiled-code-reference","title":"Decompiled Code Reference","text":"<pre><code>// From FUN_00505b80 (wulfram2_exe.c line 181496-181552)\n// D_ACK receiver/handler\n\nFUN_00509db0(\"D_ACK\", param_3);\nFUN_005092e0(&amp;param_2);           // Read sub_type\nuVar4 = param_2 &amp; 0xff;\n\nif (uVar4 == 0) {\n    // Sub-type 0: Handshake ACK\n    FUN_00509310(&amp;local_4);       // Read sequence\n    // Validate sequence, update connection state\n    *(undefined1 *)(iVar1 + 0x50) = 1;  // Mark connection established\n}\nelse if (uVar4 == 1) {\n    // Sub-type 1: Ignore ACK\n    FUN_005092e0(&amp;local_d);       // Read stream_index\n    FUN_005092f0(local_c);        // Read value\n    FUN_00504a90(local_d, local_c[0]);\n}\nelse if (uVar4 == 2) {\n    // Sub-type 2: Extended ACK\n    FUN_00509310(&amp;local_4);       // Read sequence\n    FUN_005092e0(&amp;local_d);       // Read stream_index\n    FUN_005092f0(local_c);        // Read value\n    FUN_00505ad0(local_d, local_c[0]);\n}\n</code></pre>"},{"location":"part-9-udp-protocol/protocol-overview.html#d_set_start-type-0x04","title":"D_SET_START (Type 0x04)","text":"<p>Sets the starting position/state for a stream. Used during stream initialization.</p>"},{"location":"part-9-udp-protocol/protocol-overview.html#packet-structure_2","title":"Packet Structure","text":"<pre><code>D_SET_START Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 UDP Type \u2502  D_Type  \u2502 Stream_Index  \u2502    Value     \u2502\n\u2502   0x08   \u2502   0x04   \u2502   (1 byte)    \u2502  (2 bytes)   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> Field Offset Size Type Description UDP Type 0 1 uint8 Always <code>0x08</code> D_Type 1 1 uint8 Always <code>0x04</code> Stream_Index 2 1 uint8 Target stream Value 3 2 uint16 BE Start position/value"},{"location":"part-9-udp-protocol/protocol-overview.html#decompiled-code-reference_1","title":"Decompiled Code Reference","text":"<pre><code>// From FUN_00505840 (wulfram2_exe.c line 181330-181347)\n// D_SET_START sender\n\niVar1 = FUN_00509cf0(\"D_SET_START\", 4, *(undefined4 *)(param_1 + 8), 2);\nif (iVar1 != 0) {\n    FUN_00509440(param_2);        // Write stream_index (u8)\n    FUN_005094b0(param_3);        // Write value (u16)\n    FUN_0050a340(iVar1);          // Send\n}\n</code></pre>"},{"location":"part-9-udp-protocol/protocol-overview.html#d_handshake-type-0x03","title":"D_HANDSHAKE (Type 0x03)","text":"<p>The most complex D_ packet, used for UDP channel authentication and stream configuration.</p> <p>Full Documentation: See Part 9.6: D_HANDSHAKE Deep Dive for complete structure, decompiled code analysis, and implementation guide.</p>"},{"location":"part-9-udp-protocol/protocol-overview.html#quick-summary","title":"Quick Summary","text":"<p>D_HANDSHAKE contains: - Sequence number (for replay protection) - Session ID (links to TCP connection) - Configuration value - Stream definitions (names, values, indices) - Active player entries</p>"},{"location":"part-9-udp-protocol/protocol-overview.html#simple-keepalive-usage","title":"Simple Keepalive Usage","text":"<p>In addition to the D_ protocol packets, the client also uses UDP type 0x08 for simple keepalives:</p> <pre><code>// From FUN_00417860 (wulfram2_exe.c line 21976-21983)\n// Client sends keepalive every 1000ms when idle\n\nif ((DAT_00677f1c == '\\0') &amp;&amp; (1000 &lt; (uint)(DAT_005d5ee8 - _DAT_00677f20))) {\n    iVar3 = FUN_00509cf0(\"HELLO\", 8, 0, 2);  // Type 8, mode 2\n    if (iVar3 != 0) {\n        FUN_00509520(uVar1);      // Write player ID (u32)\n        FUN_0050a340(iVar3);      // Send\n    }\n    _DAT_00677f20 = DAT_005d5ee8; // Reset timer\n}\n</code></pre> <p>These keepalive packets are simpler than D_ protocol packets:</p> <pre><code>Simple Keepalive Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 UDP Type \u2502    Player_ID     \u2502\n\u2502   0x08   \u2502    (4 bytes)     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Disambiguation: When the server receives a UDP 0x08 packet, it must check the length and first payload byte to determine if it's a simple keepalive or a D_ protocol packet. D_ protocol packets have a recognizable D_Type (0x01-0x04) as the first payload byte.</p>"},{"location":"part-9-udp-protocol/protocol-overview.html#python-implementation","title":"Python Implementation","text":"<pre><code>import struct\n\nclass DProtocolPacket:\n    \"\"\"Base class for D_ Protocol packets\"\"\"\n\n    UDP_FRAME_TYPE = 0x08\n\n    D_TYPE_IGNORE = 0x01\n    D_TYPE_ACK = 0x02\n    D_TYPE_HANDSHAKE = 0x03\n    D_TYPE_SET_START = 0x04\n\n    @staticmethod\n    def is_d_protocol(data: bytes) -&gt; bool:\n        \"\"\"Check if UDP packet is a D_ protocol packet (vs simple keepalive)\"\"\"\n        if len(data) &lt; 2:\n            return False\n        if data[0] != 0x08:\n            return False\n        # D_ types are 0x01-0x04\n        return 0x01 &lt;= data[1] &lt;= 0x04\n\n\nclass DIgnorePacket(DProtocolPacket):\n    \"\"\"D_IGNORE packet builder\"\"\"\n\n    @staticmethod\n    def build(stream_index: int, value: int) -&gt; bytes:\n        packet = bytearray()\n        packet.append(DProtocolPacket.UDP_FRAME_TYPE)\n        packet.append(DProtocolPacket.D_TYPE_IGNORE)\n        packet.append(stream_index &amp; 0xFF)\n        packet.extend(struct.pack('&gt;H', value))\n        return bytes(packet)\n\n\nclass DAckPacket(DProtocolPacket):\n    \"\"\"D_ACK packet builder and parser\"\"\"\n\n    @staticmethod\n    def build_handshake_ack(sequence: int) -&gt; bytes:\n        \"\"\"Sub-type 0: Acknowledge D_HANDSHAKE\"\"\"\n        packet = bytearray()\n        packet.append(DProtocolPacket.UDP_FRAME_TYPE)\n        packet.append(DProtocolPacket.D_TYPE_ACK)\n        packet.append(0x00)  # Sub-type 0\n        packet.extend(struct.pack('&gt;I', sequence))\n        return bytes(packet)\n\n    @staticmethod\n    def build_ignore_ack(stream_index: int, value: int) -&gt; bytes:\n        \"\"\"Sub-type 1: Acknowledge D_IGNORE\"\"\"\n        packet = bytearray()\n        packet.append(DProtocolPacket.UDP_FRAME_TYPE)\n        packet.append(DProtocolPacket.D_TYPE_ACK)\n        packet.append(0x01)  # Sub-type 1\n        packet.append(stream_index &amp; 0xFF)\n        packet.extend(struct.pack('&gt;H', value))\n        return bytes(packet)\n\n    @staticmethod\n    def build_extended_ack(sequence: int, stream_index: int, value: int) -&gt; bytes:\n        \"\"\"Sub-type 2: Extended acknowledgment\"\"\"\n        packet = bytearray()\n        packet.append(DProtocolPacket.UDP_FRAME_TYPE)\n        packet.append(DProtocolPacket.D_TYPE_ACK)\n        packet.append(0x02)  # Sub-type 2\n        packet.extend(struct.pack('&gt;I', sequence))\n        packet.append(stream_index &amp; 0xFF)\n        packet.extend(struct.pack('&gt;H', value))\n        return bytes(packet)\n\n    @staticmethod\n    def parse(data: bytes) -&gt; dict:\n        \"\"\"Parse incoming D_ACK packet\"\"\"\n        if len(data) &lt; 3 or data[0] != 0x08 or data[1] != 0x02:\n            raise ValueError(\"Invalid D_ACK packet\")\n\n        sub_type = data[2]\n        result = {'sub_type': sub_type}\n\n        if sub_type == 0 and len(data) &gt;= 7:\n            result['sequence'] = struct.unpack('&gt;I', data[3:7])[0]\n        elif sub_type == 1 and len(data) &gt;= 6:\n            result['stream_index'] = data[3]\n            result['value'] = struct.unpack('&gt;H', data[4:6])[0]\n        elif sub_type == 2 and len(data) &gt;= 10:\n            result['sequence'] = struct.unpack('&gt;I', data[3:7])[0]\n            result['stream_index'] = data[7]\n            result['value'] = struct.unpack('&gt;H', data[8:10])[0]\n\n        return result\n\n\nclass DSetStartPacket(DProtocolPacket):\n    \"\"\"D_SET_START packet builder\"\"\"\n\n    @staticmethod\n    def build(stream_index: int, value: int) -&gt; bytes:\n        packet = bytearray()\n        packet.append(DProtocolPacket.UDP_FRAME_TYPE)\n        packet.append(DProtocolPacket.D_TYPE_SET_START)\n        packet.append(stream_index &amp; 0xFF)\n        packet.extend(struct.pack('&gt;H', value))\n        return bytes(packet)\n\n\nclass SimpleKeepalive:\n    \"\"\"Simple UDP keepalive (not part of D_ protocol)\"\"\"\n\n    @staticmethod\n    def build(player_id: int) -&gt; bytes:\n        packet = bytearray()\n        packet.append(0x08)  # UDP type\n        packet.extend(struct.pack('&gt;I', player_id))\n        return bytes(packet)\n\n    @staticmethod\n    def parse(data: bytes) -&gt; int:\n        \"\"\"Parse keepalive, return player_id\"\"\"\n        if len(data) &lt; 5 or data[0] != 0x08:\n            raise ValueError(\"Invalid keepalive packet\")\n        return struct.unpack('&gt;I', data[1:5])[0]\n\n\n# Example: Dispatching incoming 0x08 packets\ndef handle_udp_0x08(data: bytes, client_addr):\n    \"\"\"Dispatch UDP type 0x08 packets\"\"\"\n    if len(data) &lt; 2:\n        return\n\n    if DProtocolPacket.is_d_protocol(data):\n        d_type = data[1]\n\n        if d_type == DProtocolPacket.D_TYPE_ACK:\n            ack = DAckPacket.parse(data)\n            print(f\"Received D_ACK sub_type={ack['sub_type']}\")\n            # Handle acknowledgment...\n\n        elif d_type == DProtocolPacket.D_TYPE_HANDSHAKE:\n            # See Part 9.6 for D_HANDSHAKE handling\n            print(\"Received D_HANDSHAKE - see d-handshake.md\")\n\n        # Note: D_IGNORE and D_SET_START are typically S\u2192C only\n    else:\n        # Simple keepalive\n        player_id = SimpleKeepalive.parse(data)\n        print(f\"Keepalive from player {player_id}\")\n</code></pre>"},{"location":"part-9-udp-protocol/protocol-overview.html#byte-level-examples","title":"Byte-Level Examples","text":""},{"location":"part-9-udp-protocol/protocol-overview.html#d_ignore-example","title":"D_IGNORE Example","text":"<pre><code>Hex: 08 01 05 00 64\n\nBreakdown:\n  08     = UDP type (D_ Protocol frame)\n  01     = D_Type: D_IGNORE\n  05     = Stream_Index: 5\n  00 64  = Value: 100\n</code></pre>"},{"location":"part-9-udp-protocol/protocol-overview.html#d_ack-sub-type-0-example","title":"D_ACK Sub-Type 0 Example","text":"<pre><code>Hex: 08 02 00 00 00 00 42\n\nBreakdown:\n  08           = UDP type (D_ Protocol frame)\n  02           = D_Type: D_ACK\n  00           = Sub_Type: 0 (handshake ack)\n  00 00 00 42  = Sequence: 66\n</code></pre>"},{"location":"part-9-udp-protocol/protocol-overview.html#d_ack-sub-type-1-example","title":"D_ACK Sub-Type 1 Example","text":"<pre><code>Hex: 08 02 01 05 00 64\n\nBreakdown:\n  08     = UDP type (D_ Protocol frame)\n  02     = D_Type: D_ACK\n  01     = Sub_Type: 1 (ignore ack)\n  05     = Stream_Index: 5\n  00 64  = Value: 100\n</code></pre>"},{"location":"part-9-udp-protocol/protocol-overview.html#simple-keepalive-example","title":"Simple Keepalive Example","text":"<pre><code>Hex: 08 00 00 00 07\n\nBreakdown:\n  08           = UDP type\n  00 00 00 07  = Player_ID: 7\n\nNote: This is NOT a D_ protocol packet (no D_Type byte).\n      The 0x00 is the high byte of the player ID, not a D_Type.\n</code></pre>"},{"location":"part-9-udp-protocol/protocol-overview.html#related-documentation","title":"Related Documentation","text":"<ul> <li>Part 9.6: D_HANDSHAKE Deep Dive - Complete D_HANDSHAKE protocol</li> <li>UDP Protocol Overview - General UDP packet reference</li> <li>Part 2: HELLO Handshake - TCP handshake that precedes UDP</li> </ul> <p>Back to UDP Protocol Overview Next: D_HANDSHAKE Deep Dive</p>"},{"location":"part-9-udp-protocol/voice.html","title":"UDP VOICE (0x0A)","text":""},{"location":"part-9-udp-protocol/voice.html#overview","title":"Overview","text":"<p>The VOICE packet transmits voice chat audio data from clients to the server for distribution to other players. This is why the TCP HELLO sub-type 1 packet is critical \u2014 it establishes the UDP port used for voice.</p>"},{"location":"part-9-udp-protocol/voice.html#packet-structure","title":"Packet Structure","text":"<pre><code>VOICE Packet Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TYPE    \u2502  FLAG_1  \u2502  FLAG_2  \u2502  PLAYER_ID   \u2502  AUDIO_LENGTH  \u2502  AUDIO_DATA \u2502\n\u2502  0x0A    \u2502 (1 byte) \u2502 (1 byte) \u2502  (4 bytes)   \u2502   (2 bytes)    \u2502  (variable) \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> Field Offset Size Type Description Type 0 1 uint8 Always <code>0x0A</code> Flag 1 1 1 uint8 Unknown flag Flag 2 2 1 uint8 Unknown flag Player ID 3 4 uint32 BE Sender's player ID Audio Length 7 2 uint16 BE Length of audio data Audio Data 9 variable bytes Compressed audio samples"},{"location":"part-9-udp-protocol/voice.html#verification-from-decompiled-code","title":"Verification from Decompiled Code","text":"<pre><code>// From FUN_00417a00 (line 22000-22020)\nvoid FUN_00417a00(undefined4 param_1, undefined4 param_2, undefined4 param_3) {\n    FUN_00509db0(\"VOICE\", param_3);\n    FUN_005092e0(&amp;local_d);      // Read flag 1 (1 byte)\n    FUN_005092e0(&amp;local_e);      // Read flag 2 (1 byte)\n    FUN_00509310(&amp;local_4);      // Read player ID (4 bytes)\n    FUN_005092f0(&amp;local_c);      // Read audio length (2 bytes)\n    FUN_005093c0(&amp;local_8, local_c &amp; 0xffff);  // Read audio data\n    // ...\n}\n</code></pre>"},{"location":"part-9-udp-protocol/voice.html#server-handling","title":"Server Handling","text":"<p>The server typically: 1. Receives VOICE packet from sending client 2. Determines which players should hear this audio (proximity, team, etc.) 3. Forwards the VOICE packet to appropriate clients</p> <pre><code>def handle_voice_packet(data, sender_addr):\n    \"\"\"Handle incoming voice packet\"\"\"\n    if len(data) &lt; 9:\n        return\n\n    flag1 = data[1]\n    flag2 = data[2]\n    player_id = struct.unpack('&gt;I', data[3:7])[0]\n    audio_len = struct.unpack('&gt;H', data[7:9])[0]\n    audio_data = data[9:9+audio_len]\n\n    # Find nearby players and forward\n    for recipient in get_voice_recipients(player_id):\n        udp_socket.sendto(data, recipient.udp_addr)\n</code></pre> <p>Back to UDP Protocol Overview</p>"},{"location":"part-9-udp-protocol/weapons.html","title":"UDP WEAPONS (0x0C) and ACK_WPNS (0x0D)","text":""},{"location":"part-9-udp-protocol/weapons.html#overview","title":"Overview","text":"<p>WEAPONS packets synchronize weapon state between server and clients. This includes ammunition counts, reload states, and weapon slot configurations.</p>"},{"location":"part-9-udp-protocol/weapons.html#weapons-0x0c-structure","title":"WEAPONS (0x0C) Structure","text":"<pre><code>WEAPONS Packet Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TYPE    \u2502  OBJECT_ID   \u2502  WEAPON_STRINGS (13\u00d7)          \u2502  AMMO_ARRAYS        \u2502\n\u2502  0x0C    \u2502  (4 bytes)   \u2502  (13 length-prefixed strings)  \u2502  (52 bytes each)    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> Field Size Type Description Type 1 uint8 <code>0x0C</code> Object ID 4 uint32 BE Entity whose weapons are being updated Weapon Strings 13 \u00d7 variable length-prefixed Weapon data for each slot (as parseable strings) Ammo Array 1 52 13 \u00d7 uint32 BE Primary ammo counts Ammo Array 2 52 13 \u00d7 uint32 BE Secondary ammo counts Ammo Array 3 52 13 \u00d7 uint32 BE Additional ammo data Ammo Array 4 52 13 \u00d7 uint32 BE Additional ammo data"},{"location":"part-9-udp-protocol/weapons.html#ack_wpns-0x0d-structure","title":"ACK_WPNS (0x0D) Structure","text":"<p>Acknowledgment packet confirming weapon state received:</p> <pre><code>ACK_WPNS Packet Structure:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TYPE    \u2502  OBJECT_ID   \u2502  ACK_ARRAY_1       \u2502  ACK_ARRAY_2       \u2502\n\u2502  0x0D    \u2502  (4 bytes)   \u2502  (13 \u00d7 4 bytes)    \u2502  (13 \u00d7 4 bytes)    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"part-9-udp-protocol/weapons.html#verification-from-decompiled-code","title":"Verification from Decompiled Code","text":"<pre><code>// WEAPONS handler - FUN_00413ce0 (line 19099-19143)\nvoid FUN_00413ce0(undefined4 param_1, undefined4 param_2, undefined4 param_3) {\n    FUN_00509db0(\"WEAPONS\", param_3);\n    FUN_00509310(&amp;local_144);    // Object ID\n\n    // Read 13 weapon slot strings\n    puVar2 = local_70;\n    iVar1 = 0xd;  // 13 slots\n    do {\n        FUN_00509340(local_14c);  // Length-prefixed string\n        FID_conflict__sscanf(local_14c[0], \"%lf\", puVar2);  // Parse as double\n        _free(local_14c[0]);\n        puVar2 = puVar2 + 8;\n        iVar1 = iVar1 + -1;\n    } while (iVar1 != 0);\n\n    // Read ammo arrays (13 \u00d7 4 bytes each, two passes)\n    iVar1 = 0;\n    do {\n        FUN_00509310(local_140 + iVar1);  // Array 1\n        FUN_00509310(local_d8 + iVar1);   // Array 2\n        iVar1 = iVar1 + 4;\n    } while (iVar1 &lt; 0x34);  // 0x34 = 52 bytes\n    // ... second pass for arrays 3 &amp; 4\n}\n\n// ACK_WPNS handler - FUN_00413e10 (line 19150-19218)\nvoid FUN_00413e10(undefined4 param_1, undefined4 param_2, undefined4 param_3) {\n    FUN_00509db0(\"ACKWPNS\", param_3);\n    FUN_00509310(&amp;local_6c);     // Object ID\n    iVar1 = 0;\n    do {\n        FUN_00509310(&amp;local_34 + iVar1);  // Ack array 1\n        FUN_00509310(&amp;local_68 + iVar1);  // Ack array 2\n        iVar1 = iVar1 + 4;\n    } while (iVar1 &lt; 0x34);\n}\n</code></pre>"},{"location":"part-9-udp-protocol/weapons.html#notes","title":"Notes","text":"<ul> <li>13 weapon slots matches the <code>WEAPON_SLOTS_PER_VEHICLE = 13</code> constant from BEHAVIOR packet</li> <li>Weapon strings likely contain floating-point reload timers or state values</li> <li>ACK_WPNS confirms client received weapon state, allowing server to track sync status</li> </ul> <p>Back to UDP Protocol Overview</p>"}]}